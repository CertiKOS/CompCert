
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Conventions</title>
<meta name="description" content="Documentation of Coq module Conventions" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Conventions</h1>
<div class="coq">
<br/>
<div class="doc">Function calling conventions and other conventions regarding the use of
    machine registers and stack slots. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Coqlib.html">Coqlib</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.AST.html">AST</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.Values.html">Values</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.Memory.html">Memory</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.LanguageInterface.html">LanguageInterface</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.backend.Locations.html">Locations</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.cklr.CKLR.html">CKLR</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Export</span> <span class="id"><a href="compcert.x86.Conventions1.html">Conventions1</a></span>.<br/>
<br/>
<div class="doc">The processor-dependent and EABI-dependent definitions are in
    <span class="bracket"><span class="id">arch</span>/<span class="id">abi</span>/<span class="id">Conventions1.v</span></span>.  This file adds various processor-independent
    definitions and lemmas. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="loc_arguments_acceptable_2">loc_arguments_acceptable_2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#s">s</a></span>)) -&gt; <span class="id"><a href="compcert.x86.Conventions1.html#loc_argument_acceptable">loc_argument_acceptable</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4150')">Proof.</div>
<div class="proofscript" id="proof4150">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">l</span>. <span class="tactic">generalize</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments_acceptable">loc_arguments_acceptable</a></span> <span class="id">s</span>). <span class="tactic">generalize</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l0</span> <span class="kwd">as</span> [ | <span class="id">p</span> <span class="id">pl</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">contradiction</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> Location of function parameters </h2>
<br/>
<div class="doc">A function finds the values of its parameter in the same locations
  where its caller stored them, except that the stack-allocated arguments,
  viewed as <span class="bracket"><span class="id">Outgoing</span></span> slots by the caller, are accessed via <span class="bracket"><span class="id">Incoming</span></span>
  slots (at the same offsets and types) in the callee. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="parameter_of_argument">parameter_of_argument</a></span> (<span class="id">l</span>: <span class="id"><a href="compcert.backend.Locations.html#loc">loc</a></span>) : <span class="id"><a href="compcert.backend.Locations.html#loc">loc</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id">n</span> <span class="id">ty</span> =&gt; <span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Incoming">Incoming</a></span> <span class="id">n</span> <span class="id">ty</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="loc_parameters">loc_parameters</a></span> (<span class="id">s</span>: <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="compcert.common.AST.html#rpair">rpair</a></span> <span class="id"><a href="compcert.backend.Locations.html#loc">loc</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="id"><a href="compcert.common.AST.html#map_rpair">map_rpair</a></span> <span class="id"><a href="compcert.backend.Conventions.html#parameter_of_argument">parameter_of_argument</a></span>) (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#s">s</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="incoming_slot_in_parameters">incoming_slot_in_parameters</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">sg</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Incoming">Incoming</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#loc_parameters">loc_parameters</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4151')">Proof.</div>
<div class="proofscript" id="proof4151">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#loc_parameters">loc_parameters</a></span> <span class="id">sg</span>)) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="compcert.backend.Conventions.html#parameter_of_argument">parameter_of_argument</a></span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id">sg</span>))) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Incoming">Incoming</a></span> <span class="id">ofs</span> <span class="id">ty</span>) <span class="kwd">with</span> (<span class="id"><a href="compcert.backend.Conventions.html#parameter_of_argument">parameter_of_argument</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id">ofs</span> <span class="id">ty</span>)) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.lib.Coqlib.html#list_in_map_inv">list_in_map_inv</a></span>. <span class="id">eexact</span> <span class="id">H</span>. <span class="tactic">intros</span> [<span class="id">x</span> [<span class="id">A</span> <span class="id">B</span>]]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_arguments_acceptable_2">loc_arguments_acceptable_2</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.x86.Conventions1.html#loc_argument_acceptable">loc_argument_acceptable</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">A</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">A</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_parameters">loc_parameters</a></span>. <span class="tactic">generalize</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id">sg</span>). <span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [ | <span class="id">p</span> <span class="id">l</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="tactic">f_equal</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h1> Tail calls </h1>
<br/>
<div class="doc">A tail-call is possible for a signature if the corresponding
    arguments are all passed in registers. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="tailcall_possible">tailcall_possible</a></span> (<span class="id">s</span>: <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#s">s</a></span> = 0.<br/>
<br/>
<div class="doc">Decide whether a tailcall is possible. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="tailcall_is_possible">tailcall_is_possible</a></span> (<span class="id">sg</span>: <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eqb">Z.eqb</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>) 0.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tailcall_is_possible_correct">tailcall_is_possible_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="compcert.backend.Conventions.html#tailcall_is_possible">tailcall_is_possible</a></span> <span class="id"><a href="compcert.backend.Conventions.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible">tailcall_possible</a></span> <span class="id"><a href="compcert.backend.Conventions.html#s">s</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4152')">Proof.</div>
<div class="proofscript" id="proof4152">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#tailcall_is_possible">tailcall_is_possible</a></span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eqb_eq">Z.eqb_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tailcall_is_possible_complete">tailcall_is_possible_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible">tailcall_possible</a></span> <span class="id"><a href="compcert.backend.Conventions.html#s">s</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#tailcall_is_possible">tailcall_is_possible</a></span> <span class="id"><a href="compcert.backend.Conventions.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4153')">Proof.</div>
<div class="proofscript" id="proof4153">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#tailcall_is_possible">tailcall_is_possible</a></span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eqb_eq">Z.eqb_eq</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="tailcall_possible_reg">tailcall_possible_reg</a></span> <span class="id">sg</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible">tailcall_possible</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> <span class="kwd">with</span> <span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> | <span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span> <span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4154')">Proof.</div>
<div class="proofscript" id="proof4154">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hsg</span> <span class="id">l</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">Hl</span> <span class="kwd">as</span> <span class="id">Hacc</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_arguments_acceptable_2">loc_arguments_acceptable_2</a></span> <span class="kwd">in</span> <span class="id">Hacc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [ | [ ]]; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">Hl</span> <span class="kwd">as</span> <span class="id">Hbnd</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments_bounded">loc_arguments_bounded</a></span> <span class="kwd">in</span> <span class="id">Hbnd</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.backend.Locations.html#typesize_pos">typesize_pos</a></span> <span class="id">ty</span>). <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">Hsg</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sg</span>, <span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> = 0 &lt;-&gt; <span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible">tailcall_possible</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4155')">Proof.</div>
<div class="proofscript" id="proof4155">
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<br/>
<h1> Callee-save locations </h1>
<br/>
<div class="doc">We classify locations as either
<ul>
<li>
 callee-save, i.e. preserved across function calls:
  callee-save registers, <span class="bracket"><span class="kwd">Local</span></span> and <span class="bracket"><span class="id">Incoming</span></span> stack slots;
</li>
<li>
 caller-save, i.e. possibly modified by a function call:
  non-callee-save registers, <span class="bracket"><span class="id">Outgoing</span></span> stack slots.
</li>
</ul>
Concerning <span class="bracket"><span class="id">Outgoing</span></span> stack slots: several ABIs allow a function to modify
the stack slots used for passing parameters to this function.
The code currently generated by CompCert never does so, but the code
generated by other compilers often does so (e.g. GCC for x86-32).
Hence, CompCert-generated code must not assume that <span class="bracket"><span class="id">Outgoing</span></span> stack slots
are preserved across function calls, because they might not be preserved
if the called function was compiled by another compiler. 
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="callee_save_loc">callee_save_loc</a></span> (<span class="id">l</span>: <span class="id"><a href="compcert.backend.Locations.html#loc">loc</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">r</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span> =&gt; <span class="id">sl</span> &lt;&gt; <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="agree_callee_save">agree_callee_save</a></span> (<span class="id">ls1</span> <span class="id">ls2</span>: <span class="id"><a href="compcert.backend.Locations.html#Locmap.t">Locmap.t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="compcert.backend.Conventions.html#callee_save_loc">callee_save_loc</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> = <span class="id"><a href="compcert.backend.Conventions.html#ls2">ls2</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>.<br/>
<br/>
<h1> Assigning result locations </h1>
<br/>
<div class="doc">Useful lemmas to reason about the result of an external call. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locmap_get_set_loc_result">locmap_get_set_loc_result</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sg</span> <span class="id">v</span> <span class="id">rs</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> <span class="kwd">with</span> <span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">r</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> | <span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> <span class="kwd">end</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Locations.html#Locmap.setpair">Locmap.setpair</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>) <span class="id"><a href="compcert.backend.Conventions.html#v">v</a></span> <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> = <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4156')">Proof.</div>
<div class="proofscript" id="proof4156">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gpo">Locmap.gpo</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">X</span>: <span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.backend.Conventions.html#r">r</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id"><a href="compcert.backend.Locations.html#Loc.diff">Loc.diff</a></span> <span class="id">l</span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#r">r</a></span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">simpl</span>. <span class="tactic">congruence</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result_caller_save">loc_result_caller_save</a></span> <span class="id">sg</span>). <span class="tactic">destruct</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id">sg</span>); <span class="tactic">simpl</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locmap_get_set_loc_result_callee_save">locmap_get_set_loc_result_callee_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sg</span> <span class="id">v</span> <span class="id">rs</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#callee_save_loc">callee_save_loc</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Locations.html#Locmap.setpair">Locmap.setpair</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>) <span class="id"><a href="compcert.backend.Conventions.html#v">v</a></span> <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> = <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4157')">Proof.</div>
<div class="proofscript" id="proof4157">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#locmap_get_set_loc_result">locmap_get_set_loc_result</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<h1> Language interface for locations </h1>
<br/>
<h2> External locations </h2>
<br/>
<div class="doc">Locset-based languages keep independent instances of the location
  set for each stack frame. The preservation of callee-save registers
  is expressed as part of the semantics itself, which restores the
  callee-save locations when they transition to <span class="bracket"><span class="id">Returnstate</span></span>s
  (see also <span class="bracket"><span class="id">LTL.return_regs</span></span>). In fact, at interaction points, LTL
  programs emitted by the Alloc pass are only sensitive to the values
  of locations used to pass incoming arguments, and those used to
  return the results of outgoing calls. Hence, since we don't need or
  want to precisely model the linking of arbitrary LTL programs, we do
  not pass the values of other locations explicitly across modules.
  Instead, components can harmlessly approximate them with <span class="bracket"><span class="id">Vundef</span></span>
  and simulation conventions can leave them unconstrained.
  For queries, the set of relevant locations is specified by the
  following predicate. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="loc_external">loc_external</a></span> (<span class="id">sg</span> : <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>) : <span class="id"><a href="compcert.backend.Locations.html#loc">loc</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="loc_external_reg">loc_external_reg</a></span> <span class="id">r</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_external">loc_external</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#r">r</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="loc_external_arg">loc_external_arg</a></span> <span class="id">ofs</span> <span class="id">ty</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_external">loc_external</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ty">ty</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="loc_is_external">loc_is_external</a></span> (<span class="id">sg</span> : <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>) (<span class="id">l</span> : <span class="id"><a href="compcert.backend.Locations.html#loc">loc</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id">ofs</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id"><a href="compcert.backend.Locations.html#Loc.eq">Loc.eq</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="loc_external_is">loc_external_is</a></span> <span class="id">sg</span> <span class="id">l</span> :<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_external">loc_external</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> &lt;-&gt; <span class="id"><a href="compcert.backend.Conventions.html#loc_is_external">loc_is_external</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4158')">Proof.</div>
<div class="proofscript" id="proof4158">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_is_external">loc_is_external</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> 1; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>; <span class="tactic">auto</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [ | [ ]]; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="loc_arguments_external">loc_arguments_external</a></span> <span class="id">sg</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Conventions.html#p">p</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.AST.html#forall_rpair">forall_rpair</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#loc_external">loc_external</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>) <span class="id"><a href="compcert.backend.Conventions.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4159')">Proof.</div>
<div class="proofscript" id="proof4159">
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments_acceptable">loc_arguments_acceptable</a></span> <span class="id">sg</span> <span class="id">p</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Conventions.html#loc_external_arg">loc_external_arg</a></span> <span class="id">sg</span>).<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#in_app">in_app</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hext</span> <span class="id">Hacc</span> [? | ?]; <span class="tactic">eauto</span> 10; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hacc</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#or_introl">or_introl</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>)).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">r</span> <span class="kwd">as</span> [ | [ ] ]; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> 10 <span class="kwd">using</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_external_reg">loc_external_reg</a></span>.<br/>
&nbsp;&nbsp;+ <span class="id">edestruct</span> <span class="id">Hacc</span> <span class="kwd">as</span> [? ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">rlo</span> <span class="kwd">as</span> [ | [ ] ]; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">rhi</span> <span class="kwd">as</span> [ | [ ] ]; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> 10 <span class="kwd">using</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_external_reg">loc_external_reg</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">After a query is received, the location state is initialized for
  those locations only, using the following construction. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="initial_regs">initial_regs</a></span> (<span class="id">sg</span> : <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>) (<span class="id">ls</span> : <span class="id"><a href="compcert.backend.Locations.html#Locmap.t">Locmap.t</a></span>) (<span class="id">l</span> : <span class="id"><a href="compcert.backend.Locations.html#loc">loc</a></span>) : <span class="id"><a href="compcert.common.Values.html#val">val</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_is_external">loc_is_external</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> <span class="kwd">then</span> <span class="id"><a href="compcert.backend.Conventions.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> <span class="kwd">else</span> <span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="external_initial_regs">external_initial_regs</a></span> <span class="id">sg</span> <span class="id">rs</span> <span class="id">l</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_external">loc_external</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#initial_regs">initial_regs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> = <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4160')">Proof.</div>
<div class="proofscript" id="proof4160">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hl</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_external_is">loc_external_is</a></span> <span class="kwd">in</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#initial_regs">initial_regs</a></span>. <span class="tactic">rewrite</span> <span class="id">Hl</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="getpair_initial_regs">getpair_initial_regs</a></span> <span class="id">sg</span> <span class="id">rs</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Conventions.html#p">p</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.backend.Conventions.html#p">p</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#initial_regs">initial_regs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span>) = <span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.backend.Conventions.html#p">p</a></span> <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4161')">Proof.</div>
<div class="proofscript" id="proof4161">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hp</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_arguments_external">loc_arguments_external</a></span> <span class="kwd">in</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">f_equal</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.backend.Conventions.html#external_initial_regs">external_initial_regs</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">A similar phenomenon occurs when external calls return. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="result_regs">result_regs</a></span> (<span class="id">sg</span> : <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>) (<span class="id">caller</span> <span class="id">callee</span> : <span class="id"><a href="compcert.backend.Locations.html#Locmap.t">Locmap.t</a></span>) (<span class="id">l</span> : <span class="id"><a href="compcert.backend.Locations.html#loc">loc</a></span>) : <span class="id"><a href="compcert.common.Values.html#val">val</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id"><a href="compcert.x86.Machregs.html#mreg_eq">mreg_eq</a></span> <span class="id">r</span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpair">regs_of_rpair</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) <span class="kwd">then</span> <span class="id"><a href="compcert.backend.Conventions.html#callee">callee</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span>) <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">r</span> <span class="kwd">then</span> <span class="id"><a href="compcert.backend.Conventions.html#caller">caller</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span>) <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#caller">caller</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="get_result_regs_result">get_result_regs_result</a></span> <span class="id">sg</span> <span class="id">caller</span> <span class="id">callee</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> (<span class="id"><a href="compcert.common.AST.html#map_rpair">map_rpair</a></span> <span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) (<span class="id"><a href="compcert.backend.Conventions.html#result_regs">result_regs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#caller">caller</a></span> <span class="id"><a href="compcert.backend.Conventions.html#callee">callee</a></span>) =<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> (<span class="id"><a href="compcert.common.AST.html#map_rpair">map_rpair</a></span> <span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) <span class="id"><a href="compcert.backend.Conventions.html#callee">callee</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4162')">Proof.</div>
<div class="proofscript" id="proof4162">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#result_regs">result_regs</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id">sg</span>); <span class="id">cbn</span> [<span class="id">map_rpair</span> <span class="id">Locmap.getpair</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>; <span class="id">cbn</span> <span class="kwd">in</span> * |- ; <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>; <span class="id">cbn</span> <span class="kwd">in</span> * |- ; <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">With the approach outlined above, simulation conventions only need
  to constrain external locations. The following relator is used. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="loc_external_rel">loc_external_rel</a></span> <span class="id">sg</span> (<span class="id">Rv</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id"><a href="compcert.common.Values.html#val">val</a></span>) (<span class="id">ls1</span> <span class="id">ls2</span>: <span class="id"><a href="compcert.backend.Locations.html#Locmap.t">Locmap.t</a></span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="compcert.backend.Conventions.html#loc_external">loc_external</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#Rv">Rv</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#ls2">ls2</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="loc_result_rel">loc_result_rel</a></span> <span class="id">sg</span> (<span class="id">Rv</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id"><a href="compcert.common.Values.html#val">val</a></span>) (<span class="id">ls1</span> <span class="id">ls2</span>: <span class="id"><a href="compcert.backend.Locations.html#Locmap.t">Locmap.t</a></span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Conventions.html#r">r</a></span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpair">regs_of_rpair</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) -&gt; <span class="id"><a href="compcert.backend.Conventions.html#Rv">Rv</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#ls1">ls1</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#r">r</a></span>)) (<span class="id"><a href="compcert.backend.Conventions.html#ls2">ls2</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#r">r</a></span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="initial_regs_inject">initial_regs_inject</a></span> <span class="id">sg</span> <span class="id">j</span> <span class="id">ls1</span> <span class="id">ls2</span> :<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_external_rel">loc_external_rel</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> (<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Conventions.html#j">j</a></span>) <span class="id"><a href="compcert.backend.Conventions.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ls2">ls2</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Conventions.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#initial_regs">initial_regs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#initial_regs">initial_regs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ls2">ls2</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4163')">Proof.</div>
<div class="proofscript" id="proof4163">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hls</span> <span class="id">l</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#initial_regs">initial_regs</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_is_external">loc_is_external</a></span> <span class="id">eqn</span>:<span class="id">Hl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_external_is">loc_external_is</a></span> <span class="kwd">in</span> <span class="id">Hl</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="result_regs_inject">result_regs_inject</a></span> <span class="id">sg</span> <span class="id">j</span> <span class="id">caller1</span> <span class="id">caller2</span> <span class="id">callee1</span> <span class="id">callee2</span>:<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Conventions.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#caller1">caller1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#caller2">caller2</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_result_rel">loc_result_rel</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> (<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Conventions.html#j">j</a></span>) <span class="id"><a href="compcert.backend.Conventions.html#callee1">callee1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#callee2">callee2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Conventions.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#result_regs">result_regs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#caller1">caller1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#callee1">callee1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#result_regs">result_regs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#caller2">caller2</a></span> <span class="id"><a href="compcert.backend.Conventions.html#callee2">callee2</a></span> <span class="id"><a href="compcert.backend.Conventions.html#l">l</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4164')">Proof.</div>
<div class="proofscript" id="proof4164">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hcaller</span> <span class="id">Hcallee</span> <span class="id">l</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#result_regs">result_regs</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">This makes it much easier to to reason about locset-based
  simulation conventions. In particular, proving the commutation of
  <span class="bracket"><span class="id">cc_locset_mach</span></span> with CKLRs involves constructing a new locset from
  the Mach state and proving that it is related to the source locset
  by the CKLR. The formulation we use makes it easier to avoid issues
  with extraneous locations which don't map to the target's stack or
  register. </div>
<br/>
<h2> Language interface </h2>
<br/>
<div class="doc">Location-based languages (currently LTL and Linear) use the
  following interface. We need to keep the C-level signature until
  Linear because it determines the stack layout used by the Linear
  to Mach calling convention to map locations to memory addresses. </div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="locset_query">locset_query</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="lq">lq</a></span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lq_vf">lq_vf</a></span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lq_sg">lq_sg</a></span>: <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lq_rs">lq_rs</a></span>: <span class="id"><a href="compcert.backend.Locations.html#Locmap.t">Locmap.t</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lq_mem">lq_mem</a></span>: <span class="id"><a href="compcert.common.Memory.html#mem">mem</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="locset_reply">locset_reply</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="lr">lr</a></span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lr_rs">lr_rs</a></span>: <span class="id"><a href="compcert.backend.Locations.html#Locmap.t">Locmap.t</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lr_mem">lr_mem</a></span>: <span class="id"><a href="compcert.common.Memory.html#mem">mem</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="id">Canonical</span> <span class="kwd">Structure</span> <span class="id">li_locset</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#language_interface">language_interface</a></span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#mk_language_interface">query</a></span> := <span class="id"><a href="compcert.backend.Conventions.html#locset_query">locset_query</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reply</span> := <span class="id"><a href="compcert.backend.Conventions.html#locset_reply">locset_reply</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">entry</span> := <span class="id"><a href="compcert.backend.Conventions.html#lq_vf">lq_vf</a></span>;<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<h1> Simulation conventions </h1>
<br/>
<span class="kwd">Unset</span> <span class="kwd">Program</span> <span class="id">Cases</span>.<br/>
<br/>
<h2> C- to locset-style calling convention </h2>
<br/>
<div class="doc">We first define the calling convention between C and locset
  languages, which relates the C-level argument list to the contents
  of the locations. The Kripke world keeps track of the signature and
  initial values registers, so that the return value can be
  interpreted in the correct way and the preservation of callee-save
  registers can be enforced. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cc_c_locset_mq">cc_c_locset_mq</a></span> <span class="id">sg</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#c_query">c_query</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#locset_query">locset_query</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="cc_c_locset_mq_intro">cc_c_locset_mq_intro</a></span> <span class="id">vf</span> <span class="id">args</span> <span class="id">rs</span> <span class="id">m</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#args">args</a></span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.backend.Conventions.html#p">p</a></span> <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span>) (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#cc_c_locset_mq">cc_c_locset_mq</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cq">cq</a></span> <span class="id"><a href="compcert.backend.Conventions.html#vf">vf</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#args">args</a></span> <span class="id"><a href="compcert.backend.Conventions.html#m">m</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#lq">lq</a></span> <span class="id"><a href="compcert.backend.Conventions.html#vf">vf</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Conventions.html#m">m</a></span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cc_c_locset_mr">cc_c_locset_mr</a></span> <span class="id">sg</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#c_reply">c_reply</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#locset_reply">locset_reply</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="cc_c_locset_mr_intro">cc_c_locset_mr_intro</a></span> <span class="id">res</span> <span class="id">rs</span>' <span class="id">m</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#res">res</a></span> = <span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> (<span class="id"><a href="compcert.common.AST.html#map_rpair">map_rpair</a></span> <span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)) <span class="id">rs</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#cc_c_locset_mr">cc_c_locset_mr</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cr">cr</a></span> <span class="id"><a href="compcert.backend.Conventions.html#res">res</a></span> <span class="id">m</span>') (<span class="id"><a href="compcert.backend.Conventions.html#lr">lr</a></span> <span class="id">rs</span>' <span class="id">m</span>').<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="cc_c_locset">cc_c_locset</a></span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.LanguageInterface.html#li_c">li_c</a></span> <span class="id"><a href="compcert.backend.Conventions.html#li_locset">li_locset</a></span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#mk_callconv">ccworld</a></span> := <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_senv</span> <span class="id">w</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_query</span> := <span class="id"><a href="compcert.backend.Conventions.html#cc_c_locset_mq">cc_c_locset_mq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_reply</span> := <span class="id"><a href="compcert.backend.Conventions.html#cc_c_locset_mr">cc_c_locset_mr</a></span>;<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<h2> Locset-style CKLR convention </h2>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cc_locset_query">cc_locset_query</a></span> <span class="id">R</span> <span class="id">sg</span> <span class="id">w</span>: <span class="id"><a href="compcert.backend.Conventions.html#locset_query">locset_query</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#locset_query">locset_query</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="cc_locset_query_intro">cc_locset_query_intro</a></span> <span class="id">vf1</span> <span class="id">vf2</span> <span class="id">ls1</span> <span class="id">ls2</span> <span class="id">m1</span> <span class="id">m2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span>) <span class="id"><a href="compcert.backend.Conventions.html#vf1">vf1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#vf2">vf2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_external_rel">loc_external_rel</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> (<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span>)) <span class="id"><a href="compcert.backend.Conventions.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ls2">ls2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span> <span class="id"><a href="compcert.backend.Conventions.html#m1">m1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#vf1">vf1</a></span> &lt;&gt; <span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#cc_locset_query">cc_locset_query</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#lq">lq</a></span> <span class="id"><a href="compcert.backend.Conventions.html#vf1">vf1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Conventions.html#m1">m1</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#lq">lq</a></span> <span class="id"><a href="compcert.backend.Conventions.html#vf2">vf2</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#ls2">ls2</a></span> <span class="id"><a href="compcert.backend.Conventions.html#m2">m2</a></span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cc_locset_reply">cc_locset_reply</a></span> <span class="id">R</span> <span class="id">sg</span> <span class="id">w</span>: <span class="id"><a href="compcert.backend.Conventions.html#locset_reply">locset_reply</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#locset_reply">locset_reply</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="cc_locset_reply_intro">cc_locset_reply_intro</a></span> <span class="id">ls1</span>' <span class="id">ls2</span>' <span class="id">m1</span>' <span class="id">m2</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_result_rel">loc_result_rel</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> (<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span>)) <span class="id">ls1</span>' <span class="id">ls2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span> <span class="id">m1</span>' <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#cc_locset_reply">cc_locset_reply</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#lr">lr</a></span> <span class="id">ls1</span>' <span class="id">m1</span>') (<span class="id"><a href="compcert.backend.Conventions.html#lr">lr</a></span> <span class="id">ls2</span>' <span class="id">m2</span>').<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="cc_locset">cc_locset</a></span> <span class="id">R</span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#mk_callconv">match_senv</a></span> '(<span class="id">sg</span>, <span class="id">w</span>) := <span class="id"><a href="compcert.cklr.CKLR.html#match_stbls">match_stbls</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_query</span> '(<span class="id">sg</span>, <span class="id">w</span>) := <span class="id"><a href="compcert.backend.Conventions.html#cc_locset_query">cc_locset_query</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_reply</span> '(<span class="id">sg</span>, <span class="id">w</span>) := (&lt;&gt; <span class="id"><a href="compcert.backend.Conventions.html#cc_locset_reply">cc_locset_reply</a></span> <span class="id"><a href="compcert.backend.Conventions.html#R">R</a></span> <span class="id"><a href="compcert.backend.Conventions.html#sg">sg</a></span>)%<span class="id">klr</span> <span class="id"><a href="compcert.backend.Conventions.html#w">w</a></span>;<br/>
&nbsp;&nbsp;|}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4165')">Next Obligation.</div>
<div class="proofscript" id="proof4165">
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#match_stbls_proj">match_stbls_proj</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Globalenvs.html#Genv.mge_public">Genv.mge_public</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof4166')">Next Obligation.</div>
<div class="proofscript" id="proof4166">
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#match_stbls_proj">match_stbls_proj</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="compcert.common.Globalenvs.html#Genv.valid_for_match">Genv.valid_for_match</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
