
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Unusedglobproof</title>
<meta name="description" content="Documentation of Coq module Unusedglobproof" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Unusedglobproof</h1>
<div class="coq">
<br/>
<div class="doc">Elimination of unreferenced static definitions </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FSets.html">FSets</a></span> <span class="id"><a href="compcert.lib.Coqlib.html">Coqlib</a></span> <span class="id"><a href="compcert.lib.Maps.html">Maps</a></span> <span class="id"><a href="compcert.lib.Ordered.html">Ordered</a></span> <span class="id"><a href="compcert.lib.Iteration.html">Iteration</a></span> <span class="id"><a href="compcert.common.Errors.html">Errors</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.AST.html">AST</a></span> <span class="id"><a href="compcert.common.Linking.html">Linking</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Integers.html">Integers</a></span> <span class="id"><a href="compcert.common.Values.html">Values</a></span> <span class="id"><a href="compcert.common.Memory.html">Memory</a></span> <span class="id"><a href="compcert.common.Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="compcert.common.Events.html">Events</a></span> <span class="id"><a href="compcert.common.Smallstep.html">Smallstep</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.x86.Op.html">Op</a></span> <span class="id"><a href="compcert.backend.Registers.html">Registers</a></span> <span class="id"><a href="compcert.backend.RTL.html">RTL</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.backend.Unusedglob.html">Unusedglob</a></span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="ISF">ISF</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FSetFacts.html#Facts">FSetFacts.Facts</a></span>(<span class="id"><a href="compcert.backend.Unusedglob.html#IS">IS</a></span>).<br/>
<span class="kwd">Module</span> <span class="id"><a name="ISP">ISP</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.FSets.FSetProperties.html#Properties">FSetProperties.Properties</a></span>(<span class="id"><a href="compcert.backend.Unusedglob.html#IS">IS</a></span>).<br/>
<br/>
<h1> Relational specification of the transformation </h1>
<br/>
<div class="doc">The transformed program is obtained from the original program
  by keeping only the global definitions that belong to a given
  set <span class="bracket"><span class="id">u</span></span> of names.  </div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="match_prog_1">match_prog_1</a></span> (<span class="id">u</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#IS.t">IS.t</a></span>) (<span class="id">p</span> <span class="id">tp</span>: <span class="id"><a href="compcert.backend.RTL.html#program">program</a></span>) : <span class="kwd">Prop</span> := {<br/>
&nbsp;&nbsp;<span class="id"><a name="match_prog_main">match_prog_main</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglobproof.html#tp">tp</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_main">prog_main</a></span>) = <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_main">prog_main</a></span>);<br/>
&nbsp;&nbsp;<span class="id"><a name="match_prog_public">match_prog_public</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglobproof.html#tp">tp</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_public">prog_public</a></span>) = <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_public">prog_public</a></span>);<br/>
&nbsp;&nbsp;<span class="id"><a name="match_prog_def">match_prog_def</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.common.AST.html#prog_defmap">prog_defmap</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#tp">tp</a></span>)!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = <span class="kwd">if</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="kwd">then</span> (<span class="id"><a href="compcert.common.AST.html#prog_defmap">prog_defmap</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>)!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>;<br/>
&nbsp;&nbsp;<span class="id"><a name="match_prog_unique">match_prog_unique</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Coqlib.html#list_norepet">list_norepet</a></span> (<span class="id"><a href="compcert.common.AST.html#prog_defs_names">prog_defs_names</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#tp">tp</a></span>)<br/>
}.<br/>
<br/>
<div class="doc">This set <span class="bracket"><span class="id">u</span></span> (as "used") must be closed under references, and
  contain the entry point and the public identifiers of the program. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ref_function">ref_function</a></span> (<span class="id">f</span>: <span class="id"><a href="compcert.backend.RTL.html#function">function</a></span>) (<span class="id">id</span>: <span class="id"><a href="compcert.common.AST.html#ident">ident</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">pc</span> <span class="id">i</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#f">f</a></span>.(<span class="id"><a href="compcert.backend.RTL.html#fn_code">fn_code</a></span>)!<span class="id"><a href="compcert.backend.Unusedglobproof.html#pc">pc</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#i">i</a></span> /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#ref_instruction">ref_instruction</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#i">i</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ref_fundef">ref_fundef</a></span> (<span class="id">fd</span>: <span class="id"><a href="compcert.backend.RTL.html#fundef">fundef</a></span>) (<span class="id">id</span>: <span class="id"><a href="compcert.common.AST.html#ident">ident</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#fd">fd</a></span> <span class="kwd">with</span> <span class="id"><a href="compcert.common.AST.html#Internal">Internal</a></span> <span class="id">f</span> =&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#ref_function">ref_function</a></span> <span class="id">f</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> | <span class="id"><a href="compcert.common.AST.html#External">External</a></span> <span class="id">ef</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ref_init">ref_init</a></span> (<span class="id">il</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.common.AST.html#init_data">init_data</a></span>) (<span class="id">id</span>: <span class="id"><a href="compcert.common.AST.html#ident">ident</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.common.AST.html#Init_addrof">Init_addrof</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ofs">ofs</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#il">il</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ref_def">ref_def</a></span> (<span class="id">gd</span>: <span class="id"><a href="compcert.common.AST.html#globdef">globdef</a></span> <span class="id"><a href="compcert.backend.RTL.html#fundef">fundef</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span>) (<span class="id">id</span>: <span class="id"><a href="compcert.common.AST.html#ident">ident</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gd">gd</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.common.AST.html#Gfun">Gfun</a></span> <span class="id">fd</span> =&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#ref_fundef">ref_fundef</a></span> <span class="id">fd</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.common.AST.html#Gvar">Gvar</a></span> <span class="id">gv</span> =&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#ref_init">ref_init</a></span> <span class="id">gv</span>.(<span class="id"><a href="compcert.common.AST.html#gvar_init">gvar_init</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="valid_used_set">valid_used_set</a></span> (<span class="id">p</span>: <span class="id"><a href="compcert.backend.RTL.html#program">program</a></span>) (<span class="id">u</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#IS.t">IS.t</a></span>) : <span class="kwd">Prop</span> := {<br/>
&nbsp;&nbsp;<span class="id"><a name="used_closed">used_closed</a></span>: <span class="kwd">forall</span> <span class="id">id</span> <span class="id">gd</span> <span class="id">id</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> -&gt; (<span class="id"><a href="compcert.common.AST.html#prog_defmap">prog_defmap</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>)!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gd">gd</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#ref_def">ref_def</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gd">gd</a></span> <span class="id">id</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id">id</span>' <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span>;<br/>
&nbsp;&nbsp;<span class="id"><a name="used_main">used_main</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_main">prog_main</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span>;<br/>
&nbsp;&nbsp;<span class="id"><a name="used_public">used_public</a></span>: <span class="kwd">forall</span> <span class="id">id</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_public">prog_public</a></span>) -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span>;<br/>
&nbsp;&nbsp;<span class="id"><a name="used_defined">used_defined</a></span>: <span class="kwd">forall</span> <span class="id">id</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> (<span class="id"><a href="compcert.common.AST.html#prog_defs_names">prog_defs_names</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>) \/ <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_main">prog_main</a></span>)<br/>
}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="match_prog">match_prog</a></span> (<span class="id">p</span> <span class="id">tp</span>: <span class="id"><a href="compcert.backend.RTL.html#program">program</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">u</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#IS.t">IS.t</a></span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#valid_used_set">valid_used_set</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> /\ <span class="id"><a href="compcert.backend.Unusedglobproof.html#match_prog_1">match_prog_1</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#tp">tp</a></span>.<br/>
<br/>
<h1> Properties of the static analysis </h1>
<br/>
<div class="doc">Monotonic evolution of the workset. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="workset_incl">workset_incl</a></span> (<span class="id">w1</span> <span class="id">w2</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#workset">workset</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="workset_incl_intro">workset_incl_intro</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">SEEN</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#IS.Subset">IS.Subset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w1">w1</a></span>.(<span class="id"><a href="compcert.backend.Unusedglob.html#w_seen">w_seen</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#w2">w2</a></span>.(<span class="id"><a href="compcert.backend.Unusedglob.html#w_seen">w_seen</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TODO</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">List.incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w1">w1</a></span>.(<span class="id"><a href="compcert.backend.Unusedglob.html#w_todo">w_todo</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#w2">w2</a></span>.(<span class="id"><a href="compcert.backend.Unusedglob.html#w_todo">w_todo</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TRACK</span>: <span class="kwd">forall</span> <span class="id">id</span>, <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w2">w2</a></span>.(<span class="id"><a href="compcert.backend.Unusedglob.html#w_seen">w_seen</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w1">w1</a></span>.(<span class="id"><a href="compcert.backend.Unusedglob.html#w_seen">w_seen</a></span>) \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w2">w2</a></span>.(<span class="id"><a href="compcert.backend.Unusedglob.html#w_todo">w_todo</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w1">w1</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w2">w2</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="seen_workset_incl">seen_workset_incl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w1</span> <span class="id">w2</span> <span class="id">id</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w1">w1</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w2">w2</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w1">w1</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w2">w2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3891')">Proof.</div>
<div class="proofscript" id="proof3891">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="workset_incl_refl">workset_incl_refl</a></span>: <span class="kwd">forall</span> <span class="id">w</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3892')">Proof.</div>
<div class="proofscript" id="proof3892">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="workset_incl_trans">workset_incl_trans</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w1</span> <span class="id">w2</span> <span class="id">w3</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w1">w1</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w2">w2</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w2">w2</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w3">w3</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w1">w1</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w3">w3</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3893')">Proof.</div>
<div class="proofscript" id="proof3893">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>, <span class="id">H0</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">edestruct</span> <span class="id">TRACK0</span>; <span class="tactic">eauto</span>. <span class="id">edestruct</span> <span class="id">TRACK</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_workset_incl">add_workset_incl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">w</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#add_workset">add_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3894')">Proof.</div>
<div class="proofscript" id="proof3894">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_workset">add_workset</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id">id</span> <span class="id">w</span>) <span class="id">eqn</span>:<span class="id">MEM</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_refl">workset_incl_refl</a></span>.<br/>
- <span class="tactic">split</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.add_2">IS.add_2</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.common.AST.html#ident_eq">ident_eq</a></span> <span class="id">id</span> <span class="id">id0</span>); <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.add_3">IS.add_3</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="addlist_workset_incl">addlist_workset_incl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">w</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#addlist_workset">addlist_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3895')">Proof.</div>
<div class="proofscript" id="proof3895">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_refl">workset_incl_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_trans">workset_incl_trans</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_workset_incl">add_workset_incl</a></span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_ref_function_incl">add_ref_function_incl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">w</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_function">add_ref_function</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#f">f</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3896')">Proof.</div>
<div class="proofscript" id="proof3896">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_function">add_ref_function</a></span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Maps.html#PTree_Properties.fold_rec">PTree_Properties.fold_rec</a></span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_refl">workset_incl_refl</a></span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_trans">workset_incl_trans</a></span> <span class="kwd">with</span> <span class="id">a</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_instruction">add_ref_instruction</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#addlist_workset_incl">addlist_workset_incl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_ref_globvar_incl">add_ref_globvar_incl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">gv</span> <span class="id">w</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_globvar">add_ref_globvar</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gv">gv</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3897')">Proof.</div>
<div class="proofscript" id="proof3897">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_globvar">add_ref_globvar</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">w</span>. <span class="tactic">induction</span> (<span class="id"><a href="compcert.common.AST.html#gvar_init">gvar_init</a></span> <span class="id">gv</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_refl">workset_incl_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_trans">workset_incl_trans</a></span>; [ | <span class="tactic">eauto</span> ].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_init_data">add_ref_init_data</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; (<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_refl">workset_incl_refl</a></span> || <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_workset_incl">add_workset_incl</a></span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_ref_definition_incl">add_ref_definition_incl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pm</span> <span class="id">id</span> <span class="id">w</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_definition">add_ref_definition</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#pm">pm</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3898')">Proof.</div>
<div class="proofscript" id="proof3898">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_definition">add_ref_definition</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">pm</span>!<span class="id">id</span>) <span class="kwd">as</span> [[[] | ? ] | ].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_ref_function_incl">add_ref_function_incl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_refl">workset_incl_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_ref_globvar_incl">add_ref_globvar_incl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_refl">workset_incl_refl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="initial_workset_incl">initial_workset_incl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl">workset_incl</a></span> {| <span class="id"><a href="compcert.backend.Unusedglob.html#mk_workset">w_seen</a></span> := <span class="id"><a href="compcert.backend.Unusedglob.html#IS.empty">IS.empty</a></span>; <span class="id">w_todo</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> |} (<span class="id"><a href="compcert.backend.Unusedglob.html#initial_workset">initial_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3899')">Proof.</div>
<div class="proofscript" id="proof3899">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#initial_workset">initial_workset</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_trans">workset_incl_trans</a></span>. 2: <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_workset_incl">add_workset_incl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> {| <span class="id"><a href="compcert.backend.Unusedglob.html#mk_workset">w_seen</a></span> := <span class="id"><a href="compcert.backend.Unusedglob.html#IS.empty">IS.empty</a></span>; <span class="id">w_todo</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> |}. <span class="tactic">induction</span> (<span class="id"><a href="compcert.common.AST.html#prog_public">prog_public</a></span> <span class="id">p</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_refl">workset_incl_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_incl_trans">workset_incl_trans</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_workset_incl">add_workset_incl</a></span>. <span class="tactic">apply</span> <span class="id">IHl</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Soundness properties for functions that add identifiers to the workset </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="seen_add_workset">seen_add_workset</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> (<span class="id">w</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#workset">workset</a></span>), <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#add_workset">add_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3900')">Proof.</div>
<div class="proofscript" id="proof3900">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_workset">add_workset</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id">id</span> <span class="id">w</span>) <span class="id">eqn</span>:<span class="id">MEM</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem_2">IS.mem_2</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.add_1">IS.add_1</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="seen_addlist_workset">seen_addlist_workset</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">l</span> (<span class="id">w</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#workset">workset</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#addlist_workset">addlist_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3901')">Proof.</div>
<div class="proofscript" id="proof3901">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">subst</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_workset_incl">seen_workset_incl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#addlist_workset_incl">addlist_workset_incl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_add_workset">seen_add_workset</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="seen_add_ref_function">seen_add_ref_function</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">f</span> <span class="id">w</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglobproof.html#ref_function">ref_function</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#f">f</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_function">add_ref_function</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#f">f</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3902')">Proof.</div>
<div class="proofscript" id="proof3902">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">w</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ref_function">ref_function</a></span>, <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_function">add_ref_function</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Maps.html#PTree_Properties.fold_rec">PTree_Properties.fold_rec</a></span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">pc</span> &amp; <span class="id">i</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">auto</span>. <span class="id">exists</span> <span class="id">pc</span>, <span class="id">i</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">pc</span> &amp; <span class="id">i</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gempty">PTree.gempty</a></span> <span class="kwd">in</span> <span class="id">A</span>; <span class="tactic">discriminate</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">pc</span> &amp; <span class="id">i</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span> <span class="kwd">in</span> <span class="id">A</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">pc</span> <span class="id">k</span>).<br/>
&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">A</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_instruction">add_ref_instruction</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_addlist_workset">seen_addlist_workset</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_instruction">add_ref_instruction</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_workset_incl">seen_workset_incl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#addlist_workset_incl">addlist_workset_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span>. <span class="id">exists</span> <span class="id">pc</span>, <span class="id">i</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="seen_add_ref_definition">seen_add_ref_definition</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pm</span> <span class="id">id</span> <span class="id">gd</span> <span class="id">id</span>' <span class="id">w</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglobproof.html#pm">pm</a></span>!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gd">gd</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#ref_def">ref_def</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gd">gd</a></span> <span class="id">id</span>' -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id">id</span>' (<span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_definition">add_ref_definition</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#pm">pm</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3903')">Proof.</div>
<div class="proofscript" id="proof3903">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_definition">add_ref_definition</a></span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">destruct</span> <span class="id">gd</span> <span class="kwd">as</span> [[<span class="id">f</span>|<span class="id">ef</span>]|<span class="id">gv</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_add_ref_function">seen_add_ref_function</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">ofs</span> &amp; <span class="id">IN</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_globvar">add_ref_globvar</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">l</span> (<span class="id">w</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#workset">workset</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id">id</span>' <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.common.AST.html#Init_addrof">Init_addrof</a></span> <span class="id">id</span>' <span class="id">ofs</span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id">id</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">fold_left</a></span> <span class="id"><a href="compcert.backend.Unusedglob.html#add_ref_init_data">add_ref_init_data</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>. <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_workset_incl">seen_workset_incl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_workset_incl">add_workset_incl</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="id">left</span>; <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_add_workset">seen_add_workset</a></span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="seen_main_initial_workset">seen_main_initial_workset</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span>, <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_main">prog_main</a></span>) (<span class="id"><a href="compcert.backend.Unusedglob.html#initial_workset">initial_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3904')">Proof.</div>
<div class="proofscript" id="proof3904">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_add_workset">seen_add_workset</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="seen_public_initial_workset">seen_public_initial_workset</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">id</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_public">prog_public</a></span>) -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#initial_workset">initial_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3905')">Proof.</div>
<div class="proofscript" id="proof3905">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#initial_workset">initial_workset</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_workset_incl">seen_workset_incl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_workset_incl">add_workset_incl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">l</span> (<span class="id">w</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#workset">workset</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id">id</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id">id</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">fold_left</a></span> (<span class="kwd">fun</span> <span class="id">w</span> <span class="id">id</span> =&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#add_workset">add_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>. <span class="tactic">intuition</span> <span class="tactic">auto</span>; <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_workset_incl">seen_workset_incl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_workset_incl">add_workset_incl</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">a</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_add_workset">seen_add_workset</a></span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h1> Correctness of the transformation with respect to the relational specification </h1>
<br/>
<div class="doc">Correctness of the dependency graph traversal. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="ANALYSIS">ANALYSIS</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="ANALYSIS.p">p</a></span>: <span class="id"><a href="compcert.backend.RTL.html#program">program</a></span>.<br/>
<span class="kwd">Let</span> <span class="id"><a name="ANALYSIS.pm">pm</a></span> := <span class="id"><a href="compcert.common.AST.html#prog_defmap">prog_defmap</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.p">p</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="workset_invariant">workset_invariant</a></span> (<span class="id">w</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#workset">workset</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">gd</span> <span class="id">id</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> -&gt; ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">List.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#w_todo">w_todo</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>) -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span>!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gd">gd</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#ref_def">ref_def</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gd">gd</a></span> <span class="id">id</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id">id</span>' <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="used_set_closed">used_set_closed</a></span> (<span class="id">u</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#IS.t">IS.t</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">gd</span> <span class="id">id</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span>!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gd">gd</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#ref_def">ref_def</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#gd">gd</a></span> <span class="id">id</span>' -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id">id</span>' <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="iter_step_invariant">iter_step_invariant</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_invariant">workset_invariant</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Unusedglob.html#iter_step">iter_step</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">u</span> =&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#used_set_closed">used_set_closed</a></span> <span class="id">u</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">w</span>' =&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_invariant">workset_invariant</a></span> <span class="id">w</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3906')">Proof.</div>
<div class="proofscript" id="proof3906">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#iter_step">iter_step</a></span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_invariant">workset_invariant</a></span>, <span class="id"><a href="compcert.backend.Unusedglobproof.html#used_set_closed">used_set_closed</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#w_todo">w_todo</a></span> <span class="id">w</span>) <span class="kwd">as</span> [ | <span class="id">id</span> <span class="id">rem</span> ]; <span class="tactic">intros</span>.<br/>
- <span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">set</span> (<span class="id">w</span>' := {| <span class="id"><a href="compcert.backend.Unusedglob.html#mk_workset">w_seen</a></span> := <span class="id">w</span>.(<span class="id"><a href="compcert.backend.Unusedglob.html#w_seen">w_seen</a></span>); <span class="id">w_todo</span> := <span class="id">rem</span> |}) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglobproof.html#add_ref_definition_incl">add_ref_definition_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span> <span class="id">id</span> <span class="id">w</span>').<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.common.AST.html#ident_eq">ident_eq</a></span> <span class="id">id</span> <span class="id">id0</span>).<br/>
&nbsp;&nbsp;+ <span class="tactic">subst</span> <span class="id">id0</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_add_ref_definition">seen_add_ref_definition</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">TRACK</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">SEEN</span>. <span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">id0</span> <span class="id">rem</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">change</span> <span class="id">rem</span> <span class="kwd">with</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#w_todo">w_todo</a></span> <span class="id">w</span>'). <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">elim</span> <span class="id">H1</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="used_globals_sound">used_globals_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">u</span>, <span class="id"><a href="compcert.backend.Unusedglob.html#used_globals">used_globals</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#used_set_closed">used_set_closed</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3907')">Proof.</div>
<div class="proofscript" id="proof3907">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#used_globals">used_globals</a></span>; <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.lib.Iteration.html#PrimIter.iterate_prop">PrimIter.iterate_prop</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="compcert.backend.Unusedglobproof.html#workset_invariant">workset_invariant</a></span>); <span class="tactic">eauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#iter_step_invariant">iter_step_invariant</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglobproof.html#initial_workset_incl">initial_workset_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.p">p</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">edestruct</span> <span class="id">TRACK</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">eelim</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.empty_1">IS.empty_1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="used_globals_incl">used_globals_incl</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">u</span>, <span class="id"><a href="compcert.backend.Unusedglob.html#used_globals">used_globals</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.Subset">IS.Subset</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#initial_workset">initial_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.p">p</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3908')">Proof.</div>
<div class="proofscript" id="proof3908">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#used_globals">used_globals</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.lib.Iteration.html#PrimIter.iterate_prop">PrimIter.iterate_prop</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="kwd">fun</span> (<span class="id">w</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#workset">workset</a></span>) =&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.Subset">IS.Subset</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#initial_workset">initial_workset</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.p">p</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#w">w</a></span>); <span class="tactic">eauto</span>.<br/>
- <span class="id">fold</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#iter_step">iter_step</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#w_todo">w_todo</a></span> <span class="id">a</span>) <span class="kwd">as</span> [ | <span class="id">id</span> <span class="id">rem</span> ].<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglobproof.html#add_ref_definition_incl">add_ref_definition_incl</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span> <span class="id">id</span> {| <span class="id"><a href="compcert.backend.Unusedglob.html#mk_workset">w_seen</a></span> := <span class="id">a</span>; <span class="id">w_todo</span> := <span class="id">rem</span> |}).<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="used_globals_valid">used_globals_valid</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">u</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#used_globals">used_globals</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.for_all">IS.for_all</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#global_defined">global_defined</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglobproof.html#valid_used_set">valid_used_set</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3909')">Proof.</div>
<div class="proofscript" id="proof3909">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">constructor</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#used_globals_sound">used_globals_sound</a></span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#used_globals_incl">used_globals_incl</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_main_initial_workset">seen_main_initial_workset</a></span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#used_globals_incl">used_globals_incl</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#seen_public_initial_workset">seen_public_initial_workset</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#for_all_iff">ISF.for_all_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
+ <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#global_defined">global_defined</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS.pm">pm</a></span>!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">g</span>|] <span class="id">eqn</span>:<span class="id">E</span>.<br/>
* <span class="id">left</span>. <span class="id">change</span> <span class="id">id</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id">id</span>,<span class="id">g</span>)). <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map">in_map</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.AST.html#in_prog_defmap">in_prog_defmap</a></span>; <span class="tactic">auto</span>.<br/>
* <span class="id">InvBooleans</span>; <span class="tactic">auto</span>.<br/>
+ <span class="id">hnf</span>. <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#ANALYSIS">ANALYSIS</a></span>.<br/>
<br/>
<div class="doc">Properties of the elimination of unused global definitions. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="TRANSFORMATION">TRANSFORMATION</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="TRANSFORMATION.p">p</a></span>: <span class="id"><a href="compcert.backend.RTL.html#program">program</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="TRANSFORMATION.used">used</a></span>: <span class="id"><a href="compcert.backend.Unusedglob.html#IS.t">IS.t</a></span>.<br/>
<br/>
<span class="kwd">Let</span> <span class="id"><a name="TRANSFORMATION.add_def">add_def</a></span> (<span class="id">m</span>: <span class="id"><a href="compcert.backend.Unusedglob.html#prog_map">prog_map</a></span>) <span class="id">idg</span> := <span class="id"><a href="compcert.lib.Maps.html#PTree.set">PTree.set</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#idg">idg</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#idg">idg</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#m">m</a></span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="filter_globdefs_accu">filter_globdefs_accu</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">accu1</span> <span class="id">accu2</span> <span class="id">u</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#filter_globdefs">filter_globdefs</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> (<span class="id"><a href="compcert.backend.Unusedglobproof.html#accu1">accu1</a></span> ++ <span class="id"><a href="compcert.backend.Unusedglobproof.html#accu2">accu2</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#defs">defs</a></span> = <span class="id"><a href="compcert.backend.Unusedglob.html#filter_globdefs">filter_globdefs</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#accu1">accu1</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#defs">defs</a></span> ++ <span class="id"><a href="compcert.backend.Unusedglobproof.html#accu2">accu2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3910')">Proof.</div>
<div class="proofscript" id="proof3910">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">defs</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">id</span> <span class="id">gd</span>]. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id">id</span> <span class="id">u</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">IHdefs</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="filter_globdefs_nil">filter_globdefs_nil</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">u</span> <span class="id">accu</span> <span class="id">defs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#filter_globdefs">filter_globdefs</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#accu">accu</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#defs">defs</a></span> = <span class="id"><a href="compcert.backend.Unusedglob.html#filter_globdefs">filter_globdefs</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#defs">defs</a></span> ++ <span class="id"><a href="compcert.backend.Unusedglobproof.html#accu">accu</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3911')">Proof.</div>
<div class="proofscript" id="proof3911">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_accu">filter_globdefs_accu</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_globdefs_map_1">filter_globdefs_map_1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">l</span> <span class="id">u</span> <span class="id">m1</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglobproof.html#m1">m1</a></span>!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">fold_left</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#TRANSFORMATION.add_def">add_def</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#filter_globdefs">filter_globdefs</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#m1">m1</a></span>)!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3912')">Proof.</div>
<div class="proofscript" id="proof3912">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [ | [<span class="id">id1</span> <span class="id">gd1</span>] <span class="id">l</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id">id1</span> <span class="id">u</span>) <span class="id">eqn</span>:<span class="id">MEM</span>.<br/>
+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_nil">filter_globdefs_nil</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left_app">fold_left_app</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_def">add_def</a></span> <span class="tactic">at</span> 1. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gso">PTree.gso</a></span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">eapply</span> <span class="id">IHl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#remove_b">ISF.remove_b</a></span>. <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">IHl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_globdefs_map_2">filter_globdefs_map_2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">l</span> <span class="id">u</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Unusedglobproof.html#m1">m1</a></span>!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = <span class="id"><a href="compcert.backend.Unusedglobproof.html#m2">m2</a></span>!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">fold_left</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#TRANSFORMATION.add_def">add_def</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#filter_globdefs">filter_globdefs</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#m1">m1</a></span>)!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">fold_left</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#TRANSFORMATION.add_def">add_def</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev">List.rev</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span>) <span class="id"><a href="compcert.backend.Unusedglobproof.html#m2">m2</a></span>)!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3913')">Proof.</div>
<div class="proofscript" id="proof3913">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [ | [<span class="id">id1</span> <span class="id">gd1</span>] <span class="id">l</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left_app">fold_left_app</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id">id1</span> <span class="id">u</span>) <span class="id">eqn</span>:<span class="id">MEM</span>.<br/>
+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_nil">filter_globdefs_nil</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left_app">fold_left_app</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_def">add_def</a></span> <span class="tactic">at</span> 1 3. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.lib.Maps.html#PTree.gsspec">PTree.gsspec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">id</span> <span class="id">id1</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem_1">IS.mem_1</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.remove_2">IS.remove_2</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem_2">IS.mem_2</a></span>; <span class="tactic">auto</span>.<br/>
+ <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#add_def">add_def</a></span> <span class="tactic">at</span> 2. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gso">PTree.gso</a></span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_globdefs_map">filter_globdefs_map</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">u</span> <span class="id">defs</span>,<br/>
&nbsp;&nbsp;(<span class="id"><a href="compcert.lib.Maps.html#PTree_Properties.of_list">PTree_Properties.of_list</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#filter_globdefs">filter_globdefs</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev">List.rev</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#defs">defs</a></span>)))! <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> =<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="kwd">then</span> (<span class="id"><a href="compcert.lib.Maps.html#PTree_Properties.of_list">PTree_Properties.of_list</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#defs">defs</a></span>)!<span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3914')">Proof.</div>
<div class="proofscript" id="proof3914">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Maps.html#PTree_Properties.of_list">PTree_Properties.of_list</a></span>. <span class="id">fold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#prog_map">prog_map</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.elt">PTree.elt</a></span>. <span class="id">fold</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#TRANSFORMATION.add_def">add_def</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id">id</span> <span class="id">u</span>) <span class="id">eqn</span>:<span class="id">MEM</span>.<br/>
- <span class="id">erewrite</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_map_2">filter_globdefs_map_2</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_involutive">List.rev_involutive</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_map_1">filter_globdefs_map_1</a></span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Maps.html#PTree.gempty">PTree.gempty</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_globdefs_domain">filter_globdefs_domain</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">l</span> <span class="id">u</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#filter_globdefs">filter_globdefs</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span>)) -&gt; <span class="id"><a href="compcert.backend.Unusedglob.html#IS.In">IS.In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#id">id</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3915')">Proof.</div>
<div class="proofscript" id="proof3915">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [ | [<span class="id">id1</span> <span class="id">gd1</span>] <span class="id">l</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">tauto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id">id1</span> <span class="id">u</span>) <span class="id">eqn</span>:<span class="id">MEM</span>.<br/>
+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_nil">filter_globdefs_nil</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#remove_iff">ISF.remove_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>. <span class="tactic">subst</span> <span class="id">id1</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem_2">IS.mem_2</a></span>; <span class="tactic">auto</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">IHl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_globdefs_unique_names">filter_globdefs_unique_names</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">u</span>, <span class="id"><a href="compcert.lib.Coqlib.html#list_norepet">list_norepet</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#filter_globdefs">filter_globdefs</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#u">u</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#l">l</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3916')">Proof.</div>
<div class="proofscript" id="proof3916">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [ | [<span class="id">id1</span> <span class="id">gd1</span>] <span class="id">l</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#IS.mem">IS.mem</a></span> <span class="id">id1</span> <span class="id">u</span>) <span class="id">eqn</span>:<span class="id">MEM</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_nil">filter_globdefs_nil</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#list_norepet_append">list_norepet_append</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">simpl</span>; <span class="tactic">tauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>. <span class="tactic">subst</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_domain">filter_globdefs_domain</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#remove_iff">ISF.remove_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#TRANSFORMATION">TRANSFORMATION</a></span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="transf_program_match">transf_program_match</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">tp</span>, <span class="id"><a href="compcert.backend.Unusedglob.html#transform_program">transform_program</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#tp">tp</a></span> -&gt; <span class="id"><a href="compcert.backend.Unusedglobproof.html#match_prog">match_prog</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#tp">tp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3917')">Proof.</div>
<div class="proofscript" id="proof3917">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Unusedglob.html#transform_program">transform_program</a></span>; <span class="tactic">intros</span> <span class="id">p</span> <span class="id">tp</span> <span class="id">TR</span>. <span class="tactic">set</span> (<span class="id">pm</span> := <span class="id"><a href="compcert.common.AST.html#prog_defmap">prog_defmap</a></span> <span class="id">p</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#used_globals">used_globals</a></span> <span class="id">p</span> <span class="id">pm</span>) <span class="kwd">as</span> [<span class="id">u</span>|] <span class="id">eqn</span>:<span class="id">U</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Unusedglob.html#IS.for_all">IS.for_all</a></span> (<span class="id"><a href="compcert.backend.Unusedglob.html#global_defined">global_defined</a></span> <span class="id">p</span> <span class="id">pm</span>) <span class="id">u</span>) <span class="id">eqn</span>:<span class="id">DEF</span>; <span class="id">inv</span> <span class="id">TR</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">u</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#used_globals_valid">used_globals_valid</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.common.AST.html#prog_defmap">prog_defmap</a></span>; <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_map">filter_globdefs_map</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#filter_globdefs_unique_names">filter_globdefs_unique_names</a></span>.<br/>
Qed.</div>
<br/>
<h1> Semantic preservation </h1>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="SOUNDNESS">SOUNDNESS</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="SOUNDNESS.p">p</a></span>: <span class="id"><a href="compcert.backend.RTL.html#program">program</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="SOUNDNESS.tp">tp</a></span>: <span class="id"><a href="compcert.backend.RTL.html#program">program</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="SOUNDNESS.used">used</a></span>: <span class="id"><a href="compcert.backend.Unusedglob.html#IS.t">IS.t</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="SOUNDNESS.USED_VALID">USED_VALID</a></span>: <span class="id"><a href="compcert.backend.Unusedglobproof.html#valid_used_set">valid_used_set</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#SOUNDNESS.p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#SOUNDNESS.used">used</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="SOUNDNESS.TRANSF">TRANSF</a></span>: <span class="id"><a href="compcert.backend.Unusedglobproof.html#match_prog_1">match_prog_1</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#SOUNDNESS.used">used</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#SOUNDNESS.p">p</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#SOUNDNESS.tp">tp</a></span>.<br/>
<span class="kwd">Let</span> <span class="id"><a name="SOUNDNESS.ge">ge</a></span> := <span class="id"><a href="compcert.common.Globalenvs.html#Genv.globalenv">Genv.globalenv</a></span> <span class="id"><a href="compcert.backend.Unusedglobproof.html#SOUNDNESS.p">p</a></span>.<br/>
<span class="kwd">Let</span> <span class="id">tge</span> := <span class="id">Genv.globalenv</span> <span class="id">tp</span>.<br/>
<span class="kwd">Let</span> <span class="id">pm</span> := <span class="id">prog_defmap</span> <span class="id">p</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">kept</span> (<span class="id">id</span>: <span class="id">ident</span>) : <span class="kwd">Prop</span> := <span class="id">IS.In</span> <span class="id">id</span> <span class="id">used</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">kept_closed</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">gd</span> <span class="id">id</span>',<br/>
&nbsp;&nbsp;<span class="id">kept</span> <span class="id">id</span> -&gt; <span class="id">pm</span>!<span class="id">id</span> = <span class="id">Some</span> <span class="id">gd</span> -&gt; <span class="id">ref_def</span> <span class="id">gd</span> <span class="id">id</span>' -&gt; <span class="id">kept</span> <span class="id">id</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3918')">Proof.</div>
<div class="proofscript" id="proof3918">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">used_closed</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">kept_main</span>:<br/>
&nbsp;&nbsp;<span class="id">kept</span> <span class="id">p</span>.(<span class="id">prog_main</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3919')">Proof.</div>
<div class="proofscript" id="proof3919">
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">used_main</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">kept_public</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">In</span> <span class="id">id</span> <span class="id">p</span>.(<span class="id">prog_public</span>) -&gt; <span class="id">kept</span> <span class="id">id</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3920')">Proof.</div>
<div class="proofscript" id="proof3920">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">used_public</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Relating <span class="bracket"><span class="id">Genv.find_symbol</span></span> operations in the original and transformed program </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">transform_find_symbol_1</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span> -&gt; <span class="id">kept</span> <span class="id">id</span> -&gt; <span class="id">exists</span> <span class="id">b</span>', <span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3921')">Proof.</div>
<div class="proofscript" id="proof3921">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">exists</span> <span class="id">g</span>, (<span class="id">prog_defmap</span> <span class="id">p</span>)!<span class="id">id</span> = <span class="id">Some</span> <span class="id">g</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">prog_defmap_dom</span>. <span class="tactic">eapply</span> <span class="id">Genv.find_symbol_inversion</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">A</span> <span class="kwd">as</span> (<span class="id">g</span> &amp; <span class="id">P</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Genv.find_symbol_exists</span> <span class="kwd">with</span> <span class="id">g</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_prog_defmap</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">match_prog_def</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">IS.mem_1</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">transform_find_symbol_2</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;<span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span> -&gt; <span class="id">kept</span> <span class="id">id</span> /\ <span class="id">exists</span> <span class="id">b</span>', <span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3922')">Proof.</div>
<div class="proofscript" id="proof3922">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">exists</span> <span class="id">g</span>, (<span class="id">prog_defmap</span> <span class="id">tp</span>)!<span class="id">id</span> = <span class="id">Some</span> <span class="id">g</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">prog_defmap_dom</span>. <span class="tactic">eapply</span> <span class="id">Genv.find_symbol_inversion</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">A</span> <span class="kwd">as</span> (<span class="id">g</span> &amp; <span class="id">P</span>).<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">match_prog_def</span> <span class="kwd">in</span> <span class="id">P</span> <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used</span>) <span class="id">eqn</span>:<span class="id">U</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">IS.mem_2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Genv.find_symbol_exists</span> <span class="kwd">with</span> <span class="id">g</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_prog_defmap</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Injections that preserve used globals. </div>
<br/>
<span class="kwd">Record</span> <span class="id">meminj_preserves_globals</span> (<span class="id">f</span>: <span class="id">meminj</span>) : <span class="kwd">Prop</span> := {<br/>
&nbsp;&nbsp;<span class="id">symbols_inject_1</span>: <span class="kwd">forall</span> <span class="id">id</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">delta</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>) -&gt; <span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">delta</span> = 0 /\ <span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>';<br/>
&nbsp;&nbsp;<span class="id">symbols_inject_2</span>: <span class="kwd">forall</span> <span class="id">id</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">kept</span> <span class="id">id</span> -&gt; <span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>', <span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>' /\ <span class="id">f</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', 0);<br/>
&nbsp;&nbsp;<span class="id">symbols_inject_3</span>: <span class="kwd">forall</span> <span class="id">id</span> <span class="id">b</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>, <span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span> /\ <span class="id">f</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', 0);<br/>
&nbsp;&nbsp;<span class="id">defs_inject</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">delta</span> <span class="id">gd</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>) -&gt; <span class="id">Genv.find_def</span> <span class="id">ge</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">gd</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.find_def</span> <span class="id">tge</span> <span class="id">b</span>' = <span class="id">Some</span> <span class="id">gd</span> /\ <span class="id">delta</span> = 0 /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">ref_def</span> <span class="id">gd</span> <span class="id">id</span> -&gt; <span class="id">kept</span> <span class="id">id</span>);<br/>
&nbsp;&nbsp;<span class="id">defs_rev_inject</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">delta</span> <span class="id">gd</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>) -&gt; <span class="id">Genv.find_def</span> <span class="id">tge</span> <span class="id">b</span>' = <span class="id">Some</span> <span class="id">gd</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.find_def</span> <span class="id">ge</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">gd</span> /\ <span class="id">delta</span> = 0<br/>
}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">init_meminj</span> : <span class="id">meminj</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">b</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Genv.invert_symbol</span> <span class="id">ge</span> <span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b</span>' =&gt; <span class="id">Some</span> (<span class="id">b</span>', 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id">init_meminj_eq</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">id</span> <span class="id">b</span> <span class="id">b</span>',<br/>
&nbsp;&nbsp;<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span> -&gt; <span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">init_meminj</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3923')">Proof.</div>
<div class="proofscript" id="proof3923">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">init_meminj</span>. <span class="id">erewrite</span> <span class="id">Genv.find_invert_symbol</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">init_meminj_invert</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">delta</span>,<br/>
&nbsp;&nbsp;<span class="id">init_meminj</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">delta</span> = 0 /\ <span class="id">exists</span> <span class="id">id</span>, <span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span> /\ <span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3924')">Proof.</div>
<div class="proofscript" id="proof3924">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">init_meminj</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.invert_symbol</span> <span class="id">ge</span> <span class="id">b</span>) <span class="kwd">as</span> [<span class="id">id</span>|] <span class="id">eqn</span>:<span class="id">S</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span>) <span class="kwd">as</span> [<span class="id">b</span>''|] <span class="id">eqn</span>:<span class="id">F</span>; <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="id">exists</span> <span class="id">id</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">Genv.invert_find_symbol</span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">init_meminj_preserves_globals</span>:<br/>
&nbsp;&nbsp;<span class="id">meminj_preserves_globals</span> <span class="id">init_meminj</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3925')">Proof.</div>
<div class="proofscript" id="proof3925">
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">exploit</span> <span class="id">init_meminj_invert</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id1</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">id1</span> = <span class="id">id</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> (<span class="id">Genv.genv_vars_inj</span> <span class="id">ge</span>); <span class="tactic">eauto</span>). <span class="tactic">subst</span> <span class="id">id1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
- <span class="id">exploit</span> <span class="id">transform_find_symbol_1</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">b</span>' &amp; <span class="id">F</span>). <span class="id">exists</span> <span class="id">b</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">init_meminj_eq</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">exploit</span> <span class="id">transform_find_symbol_2</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">K</span> &amp; <span class="id">b</span> &amp; <span class="id">F</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">init_meminj_eq</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">exploit</span> <span class="id">init_meminj_invert</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">kept</span> <span class="id">id</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">transform_find_symbol_2</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">pm</span>!<span class="id">id</span> = <span class="id">Some</span> <span class="id">gd</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">pm</span>; <span class="tactic">rewrite</span> <span class="id">Genv.find_def_symbol</span>. <span class="id">exists</span> <span class="id">b</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">prog_defmap</span> <span class="id">tp</span>)!<span class="id">id</span> = <span class="id">Some</span> <span class="id">gd</span>).<br/>
&nbsp;&nbsp;{ <span class="id">erewrite</span> <span class="id">match_prog_def</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">IS.mem_1</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Genv.find_def_symbol</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">b1</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span>).<br/>
&nbsp;&nbsp;<span class="id">fold</span> <span class="id">tge</span> <span class="kwd">in</span> <span class="id">P</span>. <span class="tactic">replace</span> <span class="id">b</span>' <span class="kwd">with</span> <span class="id">b1</span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">kept_closed</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">exploit</span> <span class="id">init_meminj_invert</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">prog_defmap</span> <span class="id">tp</span>)!<span class="id">id</span> = <span class="id">Some</span> <span class="id">gd</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Genv.find_def_symbol</span>. <span class="id">exists</span> <span class="id">b</span>'; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">match_prog_def</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Genv.find_def_symbol</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">b1</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span>).<br/>
&nbsp;&nbsp;<span class="id">fold</span> <span class="id">ge</span> <span class="kwd">in</span> <span class="id">P</span>. <span class="tactic">replace</span> <span class="id">b</span> <span class="kwd">with</span> <span class="id">b1</span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">globals_symbols_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span>, <span class="id">meminj_preserves_globals</span> <span class="id">j</span> -&gt; <span class="id">symbols_inject</span> <span class="id">j</span> <span class="id">ge</span> <span class="id">tge</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3926')">Proof.</div>
<div class="proofscript" id="proof3926">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">E1</span>: <span class="id">Genv.genv_public</span> <span class="id">ge</span> = <span class="id">p</span>.(<span class="id">prog_public</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">Genv.globalenv_public</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">E2</span>: <span class="id">Genv.genv_public</span> <span class="id">tge</span> = <span class="id">p</span>.(<span class="id">prog_public</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">tge</span>; <span class="tactic">rewrite</span> <span class="id">Genv.globalenv_public</span>. <span class="tactic">eapply</span> <span class="id">match_prog_public</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; [|<span class="tactic">split</span>;[|<span class="tactic">split</span>]]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> !<span class="id">Senv.public_symbol_of_genv</span>. <span class="tactic">unfold</span> <span class="id">Genv.public_symbol</span>. <span class="tactic">rewrite</span> <span class="id">E1</span>, <span class="id">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span>) <span class="kwd">as</span> [<span class="id">b</span>'|] <span class="id">eqn</span>:<span class="id">TFS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_3</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">b</span> &amp; <span class="id">FS</span> &amp; <span class="id">INJ</span>). <span class="tactic">rewrite</span> <span class="id">FS</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span>) <span class="kwd">as</span> [<span class="id">b</span>|] <span class="id">eqn</span>:<span class="id">FS</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">ident_eq</span> <span class="id">id</span> (<span class="id">prog_public</span> <span class="id">p</span>)); <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">kept_public</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">b</span>' &amp; <span class="id">TFS</span>' &amp; <span class="id">INJ</span>). <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">symbols_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> !<span class="id">Senv.public_symbol_of_genv</span> <span class="kwd">in</span> *; <span class="tactic">unfold</span> <span class="id">Genv.public_symbol</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span>) <span class="kwd">as</span> [<span class="id">b</span>|] <span class="id">eqn</span>:<span class="id">FS</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">E1</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">ident_eq</span> <span class="id">id</span> (<span class="id">prog_public</span> <span class="id">p</span>)); <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">kept_public</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">b</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>); <span class="id">exists</span> <span class="id">b</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> !<span class="id">Senv.block_is_volatile_of_genv</span>. <span class="tactic">unfold</span> <span class="id">Genv.block_is_volatile</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_var_info</span> <span class="id">ge</span> <span class="id">b1</span>) <span class="kwd">as</span> [<span class="id">gv</span>|] <span class="id">eqn</span>:<span class="id">V1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Genv.find_var_info_iff</span> <span class="kwd">in</span> <span class="id">V1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">defs_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Genv.find_var_info_iff</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_var_info</span> <span class="id">tge</span> <span class="id">b2</span>) <span class="kwd">as</span> [<span class="id">gv</span>|] <span class="id">eqn</span>:<span class="id">V2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Genv.find_var_info_iff</span> <span class="kwd">in</span> <span class="id">V2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">defs_rev_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Genv.find_var_info_iff</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">symbol_address_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">id</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;<span class="id">meminj_preserves_globals</span> <span class="id">j</span> -&gt; <span class="id">kept</span> <span class="id">id</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.inject</span> <span class="id">j</span> (<span class="id">Genv.symbol_address</span> <span class="id">ge</span> <span class="id">id</span> <span class="id">ofs</span>) (<span class="id">Genv.symbol_address</span> <span class="id">tge</span> <span class="id">id</span> <span class="id">ofs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3927')">Proof.</div>
<div class="proofscript" id="proof3927">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">Genv.symbol_address</span>. <span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span>) <span class="kwd">as</span> [<span class="id">b</span>|] <span class="id">eqn</span>:<span class="id">FS</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_2</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">b</span>' &amp; <span class="id">TFS</span> &amp; <span class="id">INJ</span>). <span class="tactic">rewrite</span> <span class="id">TFS</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_zero</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Semantic preservation </div>
<br/>
<span class="kwd">Definition</span> <span class="id">regset_inject</span> (<span class="id">f</span>: <span class="id">meminj</span>) (<span class="id">rs</span> <span class="id">rs</span>': <span class="id">regset</span>): <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, <span class="id">Val.inject</span> <span class="id">f</span> <span class="id">rs</span>#<span class="id">r</span> <span class="id">rs</span>'#<span class="id">r</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">regs_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">rs</span> <span class="id">rs</span>', <span class="id">regset_inject</span> <span class="id">f</span> <span class="id">rs</span> <span class="id">rs</span>' -&gt; <span class="kwd">forall</span> <span class="id">l</span>, <span class="id">Val.inject_list</span> <span class="id">f</span> <span class="id">rs</span>##<span class="id">l</span> <span class="id">rs</span>'##<span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3928')">Proof.</div>
<div class="proofscript" id="proof3928">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>. <span class="id">constructor</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">set_reg_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">rs</span> <span class="id">rs</span>' <span class="id">r</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;<span class="id">regset_inject</span> <span class="id">f</span> <span class="id">rs</span> <span class="id">rs</span>' -&gt; <span class="id">Val.inject</span> <span class="id">f</span> <span class="id">v</span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">regset_inject</span> <span class="id">f</span> (<span class="id">rs</span>#<span class="id">r</span> &lt;- <span class="id">v</span>) (<span class="id">rs</span>'#<span class="id">r</span> &lt;- <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3929')">Proof.</div>
<div class="proofscript" id="proof3929">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! <span class="id">Regmap.gsspec</span>. <span class="tactic">destruct</span> (<span class="id">peq</span> <span class="id">r0</span> <span class="id">r</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">set_res_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">rs</span> <span class="id">rs</span>' <span class="id">res</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;<span class="id">regset_inject</span> <span class="id">f</span> <span class="id">rs</span> <span class="id">rs</span>' -&gt; <span class="id">Val.inject</span> <span class="id">f</span> <span class="id">v</span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">regset_inject</span> <span class="id">f</span> (<span class="id">regmap_setres</span> <span class="id">res</span> <span class="id">v</span> <span class="id">rs</span>) (<span class="id">regmap_setres</span> <span class="id">res</span> <span class="id">v</span>' <span class="id">rs</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3930')">Proof.</div>
<div class="proofscript" id="proof3930">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">res</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">set_reg_inject</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">regset_inject_incr</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">f</span>' <span class="id">rs</span> <span class="id">rs</span>', <span class="id">regset_inject</span> <span class="id">f</span> <span class="id">rs</span> <span class="id">rs</span>' -&gt; <span class="id">inject_incr</span> <span class="id">f</span> <span class="id">f</span>' -&gt; <span class="id">regset_inject</span> <span class="id">f</span>' <span class="id">rs</span> <span class="id">rs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3931')">Proof.</div>
<div class="proofscript" id="proof3931">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">val_inject_incr</span> <span class="kwd">with</span> <span class="id">f</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">regset_undef_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">regset_inject</span> <span class="id">f</span> (<span class="id">Regmap.init</span> <span class="id">Vundef</span>) (<span class="id">Regmap.init</span> <span class="id">Vundef</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3932')">Proof.</div>
<div class="proofscript" id="proof3932">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Regmap.gi</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">init_regs_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">args</span> <span class="id">args</span>', <span class="id">Val.inject_list</span> <span class="id">f</span> <span class="id">args</span> <span class="id">args</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">params</span>,<br/>
&nbsp;&nbsp;<span class="id">regset_inject</span> <span class="id">f</span> (<span class="id">init_regs</span> <span class="id">args</span> <span class="id">params</span>) (<span class="id">init_regs</span> <span class="id">args</span>' <span class="id">params</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3933')">Proof.</div>
<div class="proofscript" id="proof3933">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">params</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">regset_undef_inject</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_reg_inject</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">match_stacks</span> (<span class="id">j</span>: <span class="id">meminj</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">list</span> <span class="id">stackframe</span> -&gt; <span class="id">list</span> <span class="id">stackframe</span> -&gt; <span class="id">block</span> -&gt; <span class="id">block</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">match_stacks_nil</span>: <span class="kwd">forall</span> <span class="id">bound</span> <span class="id">tbound</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">meminj_preserves_globals</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Ple</span> (<span class="id">Genv.genv_next</span> <span class="id">ge</span>) <span class="id">bound</span> -&gt; <span class="id">Ple</span> (<span class="id">Genv.genv_next</span> <span class="id">tge</span>) <span class="id">tbound</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stacks</span> <span class="id">j</span> <span class="id">nil</span> <span class="id">nil</span> <span class="id">bound</span> <span class="id">tbound</span><br/>
&nbsp;&nbsp;| <span class="id">match_stacks_cons</span>: <span class="kwd">forall</span> <span class="id">res</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">rs</span> <span class="id">s</span> <span class="id">tsp</span> <span class="id">trs</span> <span class="id">ts</span> <span class="id">bound</span> <span class="id">tbound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id">match_stacks</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">sp</span> <span class="id">tsp</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">KEPT</span>: <span class="kwd">forall</span> <span class="id">id</span>, <span class="id">ref_function</span> <span class="id">f</span> <span class="id">id</span> -&gt; <span class="id">kept</span> <span class="id">id</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SPINJ</span>: <span class="id">j</span> <span class="id">sp</span> = <span class="id">Some</span>(<span class="id">tsp</span>, 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">REGINJ</span>: <span class="id">regset_inject</span> <span class="id">j</span> <span class="id">rs</span> <span class="id">trs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">BELOW</span>: <span class="id">Plt</span> <span class="id">sp</span> <span class="id">bound</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TBELOW</span>: <span class="id">Plt</span> <span class="id">tsp</span> <span class="id">tbound</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_stacks</span> <span class="id">j</span> (<span class="id">Stackframe</span> <span class="id">res</span> <span class="id">f</span> (<span class="id">Vptr</span> <span class="id">sp</span> <span class="id">Ptrofs.zero</span>) <span class="id">pc</span> <span class="id">rs</span> :: <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Stackframe</span> <span class="id">res</span> <span class="id">f</span> (<span class="id">Vptr</span> <span class="id">tsp</span> <span class="id">Ptrofs.zero</span>) <span class="id">pc</span> <span class="id">trs</span> :: <span class="id">ts</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bound</span> <span class="id">tbound</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">match_stacks_preserves_globals</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">bound</span> <span class="id">tbound</span>,<br/>
&nbsp;&nbsp;<span class="id">match_stacks</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">bound</span> <span class="id">tbound</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">meminj_preserves_globals</span> <span class="id">j</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3934')">Proof.</div>
<div class="proofscript" id="proof3934">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">match_stacks_incr</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">j</span>', <span class="id">inject_incr</span> <span class="id">j</span> <span class="id">j</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">bound</span> <span class="id">tbound</span>, <span class="id">match_stacks</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">bound</span> <span class="id">tbound</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b1</span> <span class="id">b2</span> <span class="id">delta</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">j</span> <span class="id">b1</span> = <span class="id">None</span> -&gt; <span class="id">j</span>' <span class="id">b1</span> = <span class="id">Some</span>(<span class="id">b2</span>, <span class="id">delta</span>) -&gt; <span class="id">Ple</span> <span class="id">bound</span> <span class="id">b1</span> /\ <span class="id">Ple</span> <span class="id">tbound</span> <span class="id">b2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">match_stacks</span> <span class="id">j</span>' <span class="id">s</span> <span class="id">ts</span> <span class="id">bound</span> <span class="id">tbound</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3935')">Proof.</div>
<div class="proofscript" id="proof3935">
&nbsp;&nbsp;<span class="tactic">induction</span> 2; <span class="tactic">intros</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">SAME</span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">delta</span>, <span class="id">Plt</span> <span class="id">b</span> (<span class="id">Genv.genv_next</span> <span class="id">ge</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">j</span>' <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>) -&gt; <span class="id">j</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">b</span>) <span class="kwd">as</span> [[<span class="id">b1</span> <span class="id">delta1</span>] | ] <span class="id">eqn</span>: <span class="id">J</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H3</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">elim</span> (<span class="id">Plt_strict</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Ple_trans</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SAME</span>': <span class="kwd">forall</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">delta</span>, <span class="id">Plt</span> <span class="id">b</span>' (<span class="id">Genv.genv_next</span> <span class="id">tge</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">j</span>' <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>) -&gt; <span class="id">j</span> <span class="id">b</span> = <span class="id">Some</span> (<span class="id">b</span>', <span class="id">delta</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">b</span>) <span class="kwd">as</span> [[<span class="id">b1</span> <span class="id">delta1</span>] | ] <span class="id">eqn</span>: <span class="id">J</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H3</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">elim</span> (<span class="id">Plt_strict</span> <span class="id">b</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Ple_trans</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.  <span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">symbols_inject_1</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SAME</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.genv_symb_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">symbols_inject_2</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">b</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id">symbols_inject_3</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">b</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">defs_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SAME</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">defs_rev_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SAME</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.genv_defs_range</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHmatch_stacks</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">H1</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>; <span class="tactic">eapply</span> <span class="id">Ple_trans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Plt_Ple</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">Plt_Ple</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">regset_inject_incr</span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">match_stacks_bound</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">bound</span> <span class="id">tbound</span> <span class="id">bound</span>' <span class="id">tbound</span>',<br/>
&nbsp;&nbsp;<span class="id">match_stacks</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">bound</span> <span class="id">tbound</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Ple</span> <span class="id">bound</span> <span class="id">bound</span>' -&gt; <span class="id">Ple</span> <span class="id">tbound</span> <span class="id">tbound</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">match_stacks</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">bound</span>' <span class="id">tbound</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3936')">Proof.</div>
<div class="proofscript" id="proof3936">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
- <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id">Ple_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Ple_trans</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Plt_Ple_trans</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id">match_states</span>: <span class="id">state</span> -&gt; <span class="id">state</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">match_states_regular</span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">pc</span> <span class="id">rs</span> <span class="id">m</span> <span class="id">ts</span> <span class="id">tsp</span> <span class="id">trs</span> <span class="id">tm</span> <span class="id">j</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id">match_stacks</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> <span class="id">sp</span> <span class="id">tsp</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">KEPT</span>: <span class="kwd">forall</span> <span class="id">id</span>, <span class="id">ref_function</span> <span class="id">f</span> <span class="id">id</span> -&gt; <span class="id">kept</span> <span class="id">id</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SPINJ</span>: <span class="id">j</span> <span class="id">sp</span> = <span class="id">Some</span>(<span class="id">tsp</span>, 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">REGINJ</span>: <span class="id">regset_inject</span> <span class="id">j</span> <span class="id">rs</span> <span class="id">trs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEMINJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m</span> <span class="id">tm</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">State</span> <span class="id">s</span> <span class="id">f</span> (<span class="id">Vptr</span> <span class="id">sp</span> <span class="id">Ptrofs.zero</span>) <span class="id">pc</span> <span class="id">rs</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">State</span> <span class="id">ts</span> <span class="id">f</span> (<span class="id">Vptr</span> <span class="id">tsp</span> <span class="id">Ptrofs.zero</span>) <span class="id">pc</span> <span class="id">trs</span> <span class="id">tm</span>)<br/>
&nbsp;&nbsp;| <span class="id">match_states_call</span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">fd</span> <span class="id">args</span> <span class="id">m</span> <span class="id">ts</span> <span class="id">targs</span> <span class="id">tm</span> <span class="id">j</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id">match_stacks</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> (<span class="id">Mem.nextblock</span> <span class="id">m</span>) (<span class="id">Mem.nextblock</span> <span class="id">tm</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">KEPT</span>: <span class="kwd">forall</span> <span class="id">id</span>, <span class="id">ref_fundef</span> <span class="id">fd</span> <span class="id">id</span> -&gt; <span class="id">kept</span> <span class="id">id</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGINJ</span>: <span class="id">Val.inject_list</span> <span class="id">j</span> <span class="id">args</span> <span class="id">targs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEMINJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m</span> <span class="id">tm</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">Callstate</span> <span class="id">s</span> <span class="id">fd</span> <span class="id">args</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Callstate</span> <span class="id">ts</span> <span class="id">fd</span> <span class="id">targs</span> <span class="id">tm</span>)<br/>
&nbsp;&nbsp;| <span class="id">match_states_return</span>: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">res</span> <span class="id">m</span> <span class="id">ts</span> <span class="id">tres</span> <span class="id">tm</span> <span class="id">j</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id">match_stacks</span> <span class="id">j</span> <span class="id">s</span> <span class="id">ts</span> (<span class="id">Mem.nextblock</span> <span class="id">m</span>) (<span class="id">Mem.nextblock</span> <span class="id">tm</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RESINJ</span>: <span class="id">Val.inject</span> <span class="id">j</span> <span class="id">res</span> <span class="id">tres</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MEMINJ</span>: <span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m</span> <span class="id">tm</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_states</span> (<span class="id">Returnstate</span> <span class="id">s</span> <span class="id">res</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Returnstate</span> <span class="id">ts</span> <span class="id">tres</span> <span class="id">tm</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">external_call_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ef</span> <span class="id">vargs</span> <span class="id">m1</span> <span class="id">t</span> <span class="id">vres</span> <span class="id">m2</span> <span class="id">f</span> <span class="id">m1</span>' <span class="id">vargs</span>',<br/>
&nbsp;&nbsp;<span class="id">meminj_preserves_globals</span> <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">external_call</span> <span class="id">ef</span> <span class="id">ge</span> <span class="id">vargs</span> <span class="id">m1</span> <span class="id">t</span> <span class="id">vres</span> <span class="id">m2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">Mem.inject</span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m1</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Val.inject_list</span> <span class="id">f</span> <span class="id">vargs</span> <span class="id">vargs</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">f</span>', <span class="id">exists</span> <span class="id">vres</span>', <span class="id">exists</span> <span class="id">m2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">external_call</span> <span class="id">ef</span> <span class="id">tge</span> <span class="id">vargs</span>' <span class="id">m1</span>' <span class="id">t</span> <span class="id">vres</span>' <span class="id">m2</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Val.inject</span> <span class="id">f</span>' <span class="id">vres</span> <span class="id">vres</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Mem.inject</span> <span class="id">f</span>' <span class="id">m2</span> <span class="id">m2</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Mem.unchanged_on</span> (<span class="id">loc_unmapped</span> <span class="id">f</span>) <span class="id">m1</span> <span class="id">m2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Mem.unchanged_on</span> (<span class="id">loc_out_of_reach</span> <span class="id">f</span> <span class="id">m1</span>) <span class="id">m1</span>' <span class="id">m2</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">inject_incr</span> <span class="id">f</span> <span class="id">f</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">inject_separated</span> <span class="id">f</span> <span class="id">f</span>' <span class="id">m1</span> <span class="id">m1</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3937')">Proof.</div>
<div class="proofscript" id="proof3937">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">external_call_mem_inject_gen</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">globals_symbols_inject</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">find_function_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ros</span> <span class="id">rs</span> <span class="id">fd</span> <span class="id">trs</span>,<br/>
&nbsp;&nbsp;<span class="id">meminj_preserves_globals</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">find_function</span> <span class="id">ge</span> <span class="id">ros</span> <span class="id">rs</span> = <span class="id">Some</span> <span class="id">fd</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ros</span> <span class="kwd">with</span> <span class="id">inl</span> <span class="id">r</span> =&gt; <span class="id">regset_inject</span> <span class="id">j</span> <span class="id">rs</span> <span class="id">trs</span> | <span class="id">inr</span> <span class="id">id</span> =&gt; <span class="id">kept</span> <span class="id">id</span> <span class="kwd">end</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">find_function</span> <span class="id">tge</span> <span class="id">ros</span> <span class="id">trs</span> = <span class="id">Some</span> <span class="id">fd</span> /\ (<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">ref_fundef</span> <span class="id">fd</span> <span class="id">id</span> -&gt; <span class="id">kept</span> <span class="id">id</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3938')">Proof.</div>
<div class="proofscript" id="proof3938">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">ros</span> <span class="kwd">as</span> [<span class="id">r</span>|<span class="id">id</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
- <span class="id">exploit</span> <span class="id">Genv.find_funct_inv</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">b</span> &amp; <span class="id">R</span>). <span class="tactic">rewrite</span> <span class="id">R</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Genv.find_funct_find_funct_ptr</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">r</span>). <span class="tactic">rewrite</span> <span class="id">R</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Genv.find_funct_ptr_iff</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">defs_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Genv.find_funct_ptr_iff</span> <span class="kwd">in</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">B</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span>) <span class="kwd">as</span> [<span class="id">b</span>|] <span class="id">eqn</span>:<span class="id">FS</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_2</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">tb</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span>). <span class="tactic">rewrite</span> <span class="id">P</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Genv.find_funct_ptr_iff</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">defs_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Genv.find_funct_ptr_iff</span> <span class="kwd">in</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eval_builtin_arg_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">sp</span> <span class="id">m</span> <span class="id">j</span> <span class="id">rs</span>' <span class="id">sp</span>' <span class="id">m</span>' <span class="id">a</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">eval_builtin_arg</span> <span class="id">ge</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">rs</span>#<span class="id">r</span>) (<span class="id">Vptr</span> <span class="id">sp</span> <span class="id">Ptrofs.zero</span>) <span class="id">m</span> <span class="id">a</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">j</span> <span class="id">sp</span> = <span class="id">Some</span>(<span class="id">sp</span>', 0) -&gt;<br/>
&nbsp;&nbsp;<span class="id">meminj_preserves_globals</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">regset_inject</span> <span class="id">j</span> <span class="id">rs</span> <span class="id">rs</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">In</span> <span class="id">id</span> (<span class="id">globals_of_builtin_arg</span> <span class="id">a</span>) -&gt; <span class="id">kept</span> <span class="id">id</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_builtin_arg</span> <span class="id">tge</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">rs</span>'#<span class="id">r</span>) (<span class="id">Vptr</span> <span class="id">sp</span>' <span class="id">Ptrofs.zero</span>) <span class="id">m</span>' <span class="id">a</span> <span class="id">v</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">Val.inject</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3939')">Proof.</div>
<div class="proofscript" id="proof3939">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">SP</span> <span class="id">GL</span> <span class="id">RS</span> <span class="id">MI</span> <span class="id">K</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">K</span>.<br/>
- <span class="id">exists</span> <span class="id">rs</span>'#<span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">exploit</span> <span class="id">Mem.load_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Z.add_0_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">v</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id">v</span>'; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>. <span class="tactic">simpl</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_zero</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">Val.inject</span> <span class="id">j</span> (<span class="id">Senv.symbol_address</span> <span class="id">ge</span> <span class="id">id</span> <span class="id">ofs</span>) (<span class="id">Senv.symbol_address</span> <span class="id">tge</span> <span class="id">id</span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">Senv.symbol_address</span>, <span class="id">Genv.symbol_address</span>. <span class="tactic">rewrite</span> !<span class="id">Senv.find_symbol_of_genv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span>) <span class="kwd">as</span> [<span class="id">b</span>|] <span class="id">eqn</span>:<span class="id">FS</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_2</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">b</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">rewrite</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_zero</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.loadv_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id">v</span>'; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Senv.symbol_address</span>, <span class="id">Genv.symbol_address</span>. <span class="tactic">rewrite</span> !<span class="id">Senv.find_symbol_of_genv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span>) <span class="kwd">as</span> [<span class="id">b</span>|] <span class="id">eqn</span>:<span class="id">FS</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_2</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">b</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">rewrite</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Ptrofs.add_zero</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">IHeval_builtin_arg1</span> <span class="kwd">as</span> (<span class="id">v1</span>' &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">in_or_app</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHeval_builtin_arg2</span> <span class="kwd">as</span> (<span class="id">v2</span>' &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">in_or_app</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">Val.longofwords</span> <span class="id">v1</span>' <span class="id">v2</span>'); <span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Val.longofwords_inject</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">IHeval_builtin_arg1</span> <span class="kwd">as</span> (<span class="id">v1</span>' &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">in_or_app</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHeval_builtin_arg2</span> <span class="kwd">as</span> (<span class="id">v2</span>' &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">in_or_app</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Archi.ptr64</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">Val.add_inject</span>, <span class="id">Val.addl_inject</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eval_builtin_args_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rs</span> <span class="id">sp</span> <span class="id">m</span> <span class="id">j</span> <span class="id">rs</span>' <span class="id">sp</span>' <span class="id">m</span>' <span class="id">al</span> <span class="id">vl</span>,<br/>
&nbsp;&nbsp;<span class="id">eval_builtin_args</span> <span class="id">ge</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">rs</span>#<span class="id">r</span>) (<span class="id">Vptr</span> <span class="id">sp</span> <span class="id">Ptrofs.zero</span>) <span class="id">m</span> <span class="id">al</span> <span class="id">vl</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">j</span> <span class="id">sp</span> = <span class="id">Some</span>(<span class="id">sp</span>', 0) -&gt;<br/>
&nbsp;&nbsp;<span class="id">meminj_preserves_globals</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">regset_inject</span> <span class="id">j</span> <span class="id">rs</span> <span class="id">rs</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">Mem.inject</span> <span class="id">j</span> <span class="id">m</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">In</span> <span class="id">id</span> (<span class="id">globals_of_builtin_args</span> <span class="id">al</span>) -&gt; <span class="id">kept</span> <span class="id">id</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vl</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_builtin_args</span> <span class="id">tge</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">rs</span>'#<span class="id">r</span>) (<span class="id">Vptr</span> <span class="id">sp</span>' <span class="id">Ptrofs.zero</span>) <span class="id">m</span>' <span class="id">al</span> <span class="id">vl</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">Val.inject_list</span> <span class="id">j</span> <span class="id">vl</span> <span class="id">vl</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3940')">Proof.</div>
<div class="proofscript" id="proof3940">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
- <span class="id">exists</span> (@<span class="id">nil</span> <span class="id">val</span>); <span class="tactic">split</span>; <span class="id">constructor</span>.<br/>
- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_builtin_arg_inject</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">in_or_app</span>. <span class="tactic">intros</span> (<span class="id">v1</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHlist_forall2</span> <span class="kwd">as</span> (<span class="id">vl</span>' &amp; <span class="id">C</span> &amp; <span class="id">D</span>); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">in_or_app</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">v1</span>' :: <span class="id">vl</span>'); <span class="tactic">split</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">step_simulation</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S1</span> <span class="id">t</span> <span class="id">S2</span>, <span class="id">step</span> <span class="id">ge</span> <span class="id">S1</span> <span class="id">t</span> <span class="id">S2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S1</span>' (<span class="id">MS</span>: <span class="id">match_states</span> <span class="id">S1</span> <span class="id">S1</span>'),<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">S2</span>', <span class="id">step</span> <span class="id">tge</span> <span class="id">S1</span>' <span class="id">t</span> <span class="id">S2</span>' /\ <span class="id">match_states</span> <span class="id">S2</span> <span class="id">S2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3941')">Proof.</div>
<div class="proofscript" id="proof3941">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>; <span class="id">inv</span> <span class="id">MS</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;nop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_Inop</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;op&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">exists</span> <span class="id">tv</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_operation</span> <span class="id">tge</span> (<span class="id">Vptr</span> <span class="id">tsp</span> <span class="id">Ptrofs.zero</span>) <span class="id">op</span> <span class="id">trs</span>##<span class="id">args</span> <span class="id">tm</span> = <span class="id">Some</span> <span class="id">tv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Val.inject</span> <span class="id">j</span> <span class="id">v</span> <span class="id">tv</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">eval_operation_inj</span> <span class="kwd">with</span> (<span class="id">ge1</span> := <span class="id">ge</span>) (<span class="id">m1</span> := <span class="id">m</span>) (<span class="id">sp1</span> := <span class="id">Vptr</span> <span class="id">sp0</span> <span class="id">Ptrofs.zero</span>) (<span class="id">vl1</span> := <span class="id">rs</span>##<span class="id">args</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">Mem.valid_pointer_inject_val</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">Mem.weak_valid_pointer_inject_val</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">Mem.weak_valid_pointer_inject_no_overflow</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">Mem.different_pointers_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">symbol_address_inject</span>. <span class="tactic">eapply</span> <span class="id">match_stacks_preserves_globals</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">KEPT</span>. <span class="tactic">red</span>. <span class="id">exists</span> <span class="id">pc</span>, (<span class="id">Iop</span> <span class="id">op</span> <span class="id">args</span> <span class="id">res</span> <span class="id">pc</span>'); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">regs_inject</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">A</span> <span class="kwd">as</span> (<span class="id">tv</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">exec_Iop</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">set_reg_inject</span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;load&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">exists</span> <span class="id">ta</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_addressing</span> <span class="id">tge</span> (<span class="id">Vptr</span> <span class="id">tsp</span> <span class="id">Ptrofs.zero</span>) <span class="id">addr</span> <span class="id">trs</span>##<span class="id">args</span> = <span class="id">Some</span> <span class="id">ta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Val.inject</span> <span class="id">j</span> <span class="id">a</span> <span class="id">ta</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">eval_addressing_inj</span> <span class="kwd">with</span> (<span class="id">ge1</span> := <span class="id">ge</span>) (<span class="id">sp1</span> := <span class="id">Vptr</span> <span class="id">sp0</span> <span class="id">Ptrofs.zero</span>) (<span class="id">vl1</span> := <span class="id">rs</span>##<span class="id">args</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">symbol_address_inject</span>. <span class="tactic">eapply</span> <span class="id">match_stacks_preserves_globals</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">KEPT</span>. <span class="tactic">red</span>. <span class="id">exists</span> <span class="id">pc</span>, (<span class="id">Iload</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">dst</span> <span class="id">pc</span>'); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">regs_inject</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">A</span> <span class="kwd">as</span> (<span class="id">ta</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.loadv_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">tv</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">exec_Iload</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">set_reg_inject</span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;store&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">exists</span> <span class="id">ta</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_addressing</span> <span class="id">tge</span> (<span class="id">Vptr</span> <span class="id">tsp</span> <span class="id">Ptrofs.zero</span>) <span class="id">addr</span> <span class="id">trs</span>##<span class="id">args</span> = <span class="id">Some</span> <span class="id">ta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Val.inject</span> <span class="id">j</span> <span class="id">a</span> <span class="id">ta</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">eval_addressing_inj</span> <span class="kwd">with</span> (<span class="id">ge1</span> := <span class="id">ge</span>) (<span class="id">sp1</span> := <span class="id">Vptr</span> <span class="id">sp0</span> <span class="id">Ptrofs.zero</span>) (<span class="id">vl1</span> := <span class="id">rs</span>##<span class="id">args</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">symbol_address_inject</span>. <span class="tactic">eapply</span> <span class="id">match_stacks_preserves_globals</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">KEPT</span>. <span class="tactic">red</span>. <span class="id">exists</span> <span class="id">pc</span>, (<span class="id">Istore</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">args</span> <span class="id">src</span> <span class="id">pc</span>'); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">regs_inject</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">A</span> <span class="kwd">as</span> (<span class="id">ta</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.storev_mapped_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">tm</span>' &amp; <span class="id">D</span> &amp; <span class="id">E</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">exec_Istore</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">find_function_inject</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_stacks_preserves_globals</span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ros</span> <span class="kwd">as</span> [<span class="id">r</span>|<span class="id">id</span>]. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">KEPT</span>. <span class="tactic">red</span>. <span class="id">econstructor</span>; <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">exec_Icall</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Mem.valid_block</span> <span class="id">m</span> <span class="id">sp0</span>). <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Mem.valid_block</span> <span class="id">tm</span> <span class="id">tsp</span>). <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">regs_inject</span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;tailcall&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">find_function_inject</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_stacks_preserves_globals</span>; <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ros</span> <span class="kwd">as</span> [<span class="id">r</span>|<span class="id">id</span>]. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">KEPT</span>. <span class="tactic">red</span>. <span class="id">econstructor</span>; <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.free_parallel_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> ! <span class="id">Z.add_0_r</span>. <span class="tactic">intros</span> (<span class="id">tm</span>' &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_Itailcall</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">match_stacks_bound</span> <span class="kwd">with</span> <span class="id">stk</span> <span class="id">tsp</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Plt_Ple</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Mem.valid_block</span> <span class="id">m</span>' <span class="id">stk</span>). <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Plt_Ple</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Mem.valid_block</span> <span class="id">tm</span>' <span class="id">tsp</span>). <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">regs_inject</span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;builtin&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">eval_builtin_args_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_stacks_preserves_globals</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">KEPT</span>. <span class="tactic">red</span>. <span class="id">econstructor</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">vargs</span>' &amp; <span class="id">P</span> &amp; <span class="id">Q</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">external_call_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_stacks_preserves_globals</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">j</span>' &amp; <span class="id">tv</span> &amp; <span class="id">tm</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span> &amp; <span class="id">G</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_Ibuiltin</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_states_regular</span> <span class="kwd">with</span> (<span class="id">j</span> := <span class="id">j</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">match_stacks_incr</span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">G</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">U</span> <span class="id">V</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Mem.valid_block</span> <span class="id">m</span> <span class="id">sp0</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Mem.valid_block</span> <span class="id">tm</span> <span class="id">tsp</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_2</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_res_inject</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">regset_inject_incr</span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;cond&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">C</span>: <span class="id">eval_condition</span> <span class="id">cond</span> <span class="id">trs</span>##<span class="id">args</span> <span class="id">tm</span> = <span class="id">Some</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">eval_condition_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">regs_inject</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_Icond</span> <span class="kwd">with</span> (<span class="id">pc</span>' := <span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">ifso</span> <span class="kwd">else</span> <span class="id">ifnot</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;jumptbl&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">REGINJ</span> <span class="id">arg</span>); <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">intros</span> <span class="id">INJ</span>; <span class="id">inv</span> <span class="id">INJ</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_Ijumptable</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;return&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.free_parallel_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> ! <span class="id">Z.add_0_r</span>. <span class="tactic">intros</span> (<span class="id">tm</span>' &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_Ireturn</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">match_stacks_bound</span> <span class="kwd">with</span> <span class="id">stk</span> <span class="id">tsp</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Plt_Ple</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Mem.valid_block</span> <span class="id">m</span>' <span class="id">stk</span>). <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Plt_Ple</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">Mem.valid_block</span> <span class="id">tm</span>' <span class="id">tsp</span>). <span class="tactic">eapply</span> <span class="id">Mem.valid_block_inject_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">or</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;internal&nbsp;function&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Mem.alloc_parallel_inject</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">Z.le_refl</span>. <span class="tactic">apply</span> <span class="id">Z.le_refl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">j</span>' &amp; <span class="id">tm</span>' &amp; <span class="id">tstk</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span> &amp; <span class="id">G</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">STK</span>: <span class="id">stk</span> = <span class="id">Mem.nextblock</span> <span class="id">m</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">Mem.alloc_result</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">TSTK</span>: <span class="id">tstk</span> = <span class="id">Mem.nextblock</span> <span class="id">tm</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">Mem.alloc_result</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">STACKS</span>': <span class="id">match_stacks</span> <span class="id">j</span>' <span class="id">s</span> <span class="id">ts</span> <span class="id">stk</span> <span class="id">tstk</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">STK</span>, <span class="id">TSTK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">match_stacks_incr</span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">eq_block</span> <span class="id">b1</span> <span class="id">stk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">b1</span>. <span class="tactic">rewrite</span> <span class="id">F</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id">Ple_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">G</span> <span class="kwd">in</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_function_internal</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_states_regular</span> <span class="kwd">with</span> (<span class="id">j</span> := <span class="id">j</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">init_regs_inject</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">val_inject_list_incr</span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;external&nbsp;function&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">external_call_inject</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_stacks_preserves_globals</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">j</span>' &amp; <span class="id">tres</span> &amp; <span class="id">tm</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span> &amp; <span class="id">G</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_function_external</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">match_states_return</span> <span class="kwd">with</span> (<span class="id">j</span> := <span class="id">j</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">match_stacks_bound</span> <span class="kwd">with</span> (<span class="id">Mem.nextblock</span> <span class="id">m</span>) (<span class="id">Mem.nextblock</span> <span class="id">tm</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">match_stacks_incr</span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">G</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">P</span> <span class="id">Q</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Mem.valid_block</span> <span class="kwd">in</span> *; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">external_call_nextblock</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">external_call_nextblock</span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;return&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STACKS</span>. <span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">exec_return</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">set_reg_inject</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Relating initial memory states </div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">init_meminj_invert_strong</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">delta</span>,<br/>
&nbsp;&nbsp;<span class="id">init_meminj</span> <span class="id">b</span> = <span class="id">Some</span>(<span class="id">b</span>', <span class="id">delta</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">delta</span> = 0 /\<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">id</span> <span class="id">gd</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;/\ <span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">id</span> = <span class="id">Some</span> <span class="id">b</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">Genv.find_def</span> <span class="id">ge</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">gd</span><br/>
&nbsp;&nbsp;/\ <span class="id">Genv.find_def</span> <span class="id">tge</span> <span class="id">b</span>' = <span class="id">Some</span> <span class="id">gd</span><br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">i</span>, <span class="id">ref_def</span> <span class="id">gd</span> <span class="id">i</span> -&gt; <span class="id">kept</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3942')">Proof.</div>
<div class="proofscript" id="proof3942">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">init_meminj_invert</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">gd</span>, (<span class="id">prog_defmap</span> <span class="id">p</span>)!<span class="id">id</span> = <span class="id">Some</span> <span class="id">gd</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">prog_defmap_dom</span>. <span class="tactic">eapply</span> <span class="id">Genv.find_symbol_inversion</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">gd</span> <span class="id">DM</span>]. <span class="tactic">rewrite</span> <span class="id">Genv.find_def_symbol</span> <span class="kwd">in</span> <span class="id">DM</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">DM</span> <span class="kwd">as</span> (<span class="id">b</span>'' &amp; <span class="id">P</span> &amp; <span class="id">Q</span>). <span class="id">fold</span> <span class="id">ge</span> <span class="kwd">in</span> <span class="id">P</span>. <span class="tactic">rewrite</span> <span class="id">P</span> <span class="kwd">in</span> <span class="id">B</span>; <span class="id">inv</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="id">fold</span> <span class="id">ge</span> <span class="kwd">in</span> <span class="id">Q</span>. <span class="id">exploit</span> <span class="id">defs_inject</span>. <span class="tactic">apply</span> <span class="id">init_meminj_preserves_globals</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">X</span> &amp; <span class="id">_</span> &amp; <span class="id">Y</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="id">exists</span> <span class="id">id</span>, <span class="id">gd</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id">INIT_MEM</span>.<br/>
<br/>
<span class="kwd">Variables</span> <span class="id">m</span> <span class="id">tm</span>: <span class="id">mem</span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id">IM</span>: <span class="id">Genv.init_mem</span> <span class="id">p</span> = <span class="id">Some</span> <span class="id">m</span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id">TIM</span>: <span class="id">Genv.init_mem</span> <span class="id">tp</span> = <span class="id">Some</span> <span class="id">tm</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">bytes_of_init_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">il</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">ref_init</span> <span class="id">il</span> <span class="id">id</span> -&gt; <span class="id">kept</span> <span class="id">id</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">list_forall2</span> (<span class="id">memval_inject</span> <span class="id">init_meminj</span>) (<span class="id">Genv.bytes_of_init_data_list</span> <span class="id">ge</span> <span class="id">il</span>) (<span class="id">Genv.bytes_of_init_data_list</span> <span class="id">tge</span> <span class="id">il</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3943')">Proof.</div>
<div class="proofscript" id="proof3943">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">il</span> <span class="kwd">as</span> [ | <span class="id">i1</span> <span class="id">il</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">constructor</span>.<br/>
- <span class="tactic">apply</span> <span class="id">list_forall2_app</span>.<br/>
+ <span class="tactic">destruct</span> <span class="id">i1</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">inj_bytes_inject</span>).<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> (<span class="id">Z.to_nat</span> <span class="id">z</span>); <span class="tactic">simpl</span>; <span class="id">constructor</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">ge</span> <span class="id">i</span>) <span class="kwd">as</span> [<span class="id">b</span>|] <span class="id">eqn</span>:<span class="id">FS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">kept</span> <span class="id">i</span>). { <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">red</span>. <span class="id">exists</span> <span class="id">i0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>. }<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_2</span>. <span class="tactic">apply</span> <span class="id">init_meminj_preserves_globals</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">b</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">rewrite</span> <span class="id">A</span>. <span class="tactic">apply</span> <span class="id">inj_value_inject</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id">Ptrofs.add_zero</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Genv.find_symbol</span> <span class="id">tge</span> <span class="id">i</span>) <span class="kwd">as</span> [<span class="id">b</span>'|] <span class="id">eqn</span>:<span class="id">FS</span>'.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_3</span>. <span class="tactic">apply</span> <span class="id">init_meminj_preserves_globals</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">b</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">repeat_Undef_inject_self</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">IHil</span>. <span class="tactic">intros</span> <span class="id">id</span> [<span class="id">ofs</span> <span class="id">IN</span>]. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">exists</span> <span class="id">ofs</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">Mem_getN_forall2</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">P</span>: <span class="id">memval</span> -&gt; <span class="id">memval</span> -&gt; <span class="kwd">Prop</span>) <span class="id">c1</span> <span class="id">c2</span> <span class="id">i</span> <span class="id">n</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;<span class="id">list_forall2</span> <span class="id">P</span> (<span class="id">Mem.getN</span> <span class="id">n</span> <span class="id">p</span> <span class="id">c1</span>) (<span class="id">Mem.getN</span> <span class="id">n</span> <span class="id">p</span> <span class="id">c2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">p</span> &lt;= <span class="id">i</span> -&gt; <span class="id">i</span> &lt; <span class="id">p</span> + <span class="id">Z.of_nat</span> <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">P</span> (<span class="id">ZMap.get</span> <span class="id">i</span> <span class="id">c1</span>) (<span class="id">ZMap.get</span> <span class="id">i</span> <span class="id">c2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3944')">Proof.</div>
<div class="proofscript" id="proof3944">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">simpl</span> <span class="id">Mem.getN</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">omegaContradiction</span>.<br/>
- <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">Nat2Z.inj_succ</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">i</span> <span class="id">p0</span>).<br/>
+ <span class="tactic">congruence</span>.<br/>
+ <span class="tactic">apply</span> <span class="id">IHn</span> <span class="kwd">with</span> (<span class="id">p0</span> + 1); <span class="tactic">auto</span>. <span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">init_mem_inj_1</span>:<br/>
&nbsp;&nbsp;<span class="id">Mem.mem_inj</span> <span class="id">init_meminj</span> <span class="id">m</span> <span class="id">tm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3945')">Proof.</div>
<div class="proofscript" id="proof3945">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
- <span class="id">exploit</span> <span class="id">init_meminj_invert_strong</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">gd</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Genv.init_mem_characterization_gen</span> <span class="id">p</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Genv.init_mem_characterization_gen</span> <span class="id">tp</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">gd</span> <span class="kwd">as</span> [<span class="id">f</span>|<span class="id">v</span>].<br/>
+ <span class="tactic">intros</span> (<span class="id">P2</span> &amp; <span class="id">Q2</span>) (<span class="id">P1</span> &amp; <span class="id">Q1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Q1</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">auto</span>.<br/>
+ <span class="tactic">intros</span> (<span class="id">P2</span> &amp; <span class="id">Q2</span> &amp; <span class="id">R2</span> &amp; <span class="id">S2</span>) (<span class="id">P1</span> &amp; <span class="id">Q1</span> &amp; <span class="id">R1</span> &amp; <span class="id">S1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Q1</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">P2</span>. <span class="tactic">omega</span>.<br/>
- <span class="id">exploit</span> <span class="id">init_meminj_invert</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">delta</span>. <span class="tactic">apply</span> <span class="id">Z.divide_0_r</span>.<br/>
- <span class="id">exploit</span> <span class="id">init_meminj_invert_strong</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">gd</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Genv.init_mem_characterization_gen</span> <span class="id">p</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Genv.init_mem_characterization_gen</span> <span class="id">tp</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">gd</span> <span class="kwd">as</span> [<span class="id">f</span>|<span class="id">v</span>].<br/>
+ <span class="tactic">intros</span> (<span class="id">P2</span> &amp; <span class="id">Q2</span>) (<span class="id">P1</span> &amp; <span class="id">Q1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Q1</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">discriminate</span>.<br/>
+ <span class="tactic">intros</span> (<span class="id">P2</span> &amp; <span class="id">Q2</span> &amp; <span class="id">R2</span> &amp; <span class="id">S2</span>) (<span class="id">P1</span> &amp; <span class="id">Q1</span> &amp; <span class="id">R1</span> &amp; <span class="id">S1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Q1</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NO</span>: <span class="id">gvar_volatile</span> <span class="id">v</span> = <span class="id">false</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">Genv.perm_globvar</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> (<span class="id">gvar_volatile</span> <span class="id">v</span>); <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H1</span>. }<br/>
<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Mem.loadbytes</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">S1</span> <span class="id">NO</span>). <span class="tactic">unfold</span> <span class="id">Mem.loadbytes</span>. <span class="tactic">destruct</span> <span class="id">Mem.range_perm_dec</span>; <span class="tactic">intros</span> <span class="id">E1</span>; <span class="id">inv</span> <span class="id">E1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">S2</span> <span class="id">NO</span>). <span class="tactic">unfold</span> <span class="id">Mem.loadbytes</span>. <span class="tactic">destruct</span> <span class="id">Mem.range_perm_dec</span>; <span class="tactic">intros</span> <span class="id">E2</span>; <span class="id">inv</span> <span class="id">E2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z.add_0_r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Mem_getN_forall2</span> <span class="kwd">with</span> (<span class="id">p</span> := 0) (<span class="id">n</span> := <span class="id">nat_of_Z</span> (<span class="id">init_data_list_size</span> (<span class="id">gvar_init</span> <span class="id">v</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>, <span class="id">H4</span>. <span class="tactic">apply</span> <span class="id">bytes_of_init_inject</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">nat_of_Z_eq</span> <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">init_data_list_size_pos</span>). <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">init_mem_inj_2</span>:<br/>
&nbsp;&nbsp;<span class="id">Mem.inject</span> <span class="id">init_meminj</span> <span class="id">m</span> <span class="id">tm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3946')">Proof.</div>
<div class="proofscript" id="proof3946">
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id">init_mem_inj_1</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id">init_meminj</span> <span class="id">b</span>) <span class="kwd">as</span> [[<span class="id">b</span>' <span class="id">delta</span>]|] <span class="id">eqn</span>:<span class="id">INJ</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>. <span class="id">exploit</span> <span class="id">init_meminj_invert</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.find_symbol_not_fresh</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">exploit</span> <span class="id">init_meminj_invert</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Genv.find_symbol_not_fresh</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">init_meminj_invert</span>. <span class="id">eexact</span> <span class="id">H0</span>. <span class="tactic">intros</span> (<span class="id">A1</span> &amp; <span class="id">id1</span> &amp; <span class="id">B1</span> &amp; <span class="id">C1</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">init_meminj_invert</span>. <span class="id">eexact</span> <span class="id">H1</span>. <span class="tactic">intros</span> (<span class="id">A2</span> &amp; <span class="id">id2</span> &amp; <span class="id">B2</span> &amp; <span class="id">C2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id1</span> <span class="id">id2</span>). <span class="tactic">congruence</span>. <span class="id">left</span>; <span class="tactic">eapply</span> <span class="id">Genv.global_addresses_distinct</span>; <span class="tactic">eauto</span>.<br/>
- <span class="id">exploit</span> <span class="id">init_meminj_invert</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">subst</span> <span class="id">delta</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">omega</span>. <span class="tactic">generalize</span> (<span class="id">Ptrofs.unsigned_range_2</span> <span class="id">ofs</span>). <span class="tactic">omega</span>.<br/>
- <span class="id">exploit</span> <span class="id">init_meminj_invert_strong</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">id</span> &amp; <span class="id">gd</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Genv.init_mem_characterization_gen</span> <span class="id">p</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">Genv.init_mem_characterization_gen</span> <span class="id">tp</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">gd</span> <span class="kwd">as</span> [<span class="id">f</span>|<span class="id">v</span>].<br/>
+ <span class="tactic">intros</span> (<span class="id">P2</span> &amp; <span class="id">Q2</span>) (<span class="id">P1</span> &amp; <span class="id">Q1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Q2</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">subst</span>. <span class="tactic">replace</span> <span class="id">ofs</span> <span class="kwd">with</span> 0 <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>; <span class="tactic">auto</span>.<br/>
+ <span class="tactic">intros</span> (<span class="id">P2</span> &amp; <span class="id">Q2</span> &amp; <span class="id">R2</span> &amp; <span class="id">S2</span>) (<span class="id">P1</span> &amp; <span class="id">Q1</span> &amp; <span class="id">R1</span> &amp; <span class="id">S1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Q2</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">apply</span> <span class="id">Mem.perm_cur</span>. <span class="tactic">eapply</span> <span class="id">Mem.perm_implies</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">P1</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">INIT_MEM</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">init_mem_exists</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>, <span class="id">Genv.init_mem</span> <span class="id">p</span> = <span class="id">Some</span> <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tm</span>, <span class="id">Genv.init_mem</span> <span class="id">tp</span> = <span class="id">Some</span> <span class="id">tm</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3947')">Proof.</div>
<div class="proofscript" id="proof3947">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">Genv.init_mem_exists</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">P</span>: (<span class="id">prog_defmap</span> <span class="id">tp</span>)!<span class="id">id</span> = <span class="id">Some</span> (<span class="id">Gvar</span> <span class="id">v</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">prog_defmap_norepet</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">match_prog_unique</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">match_prog_def</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">TRANSF</span>) <span class="kwd">in</span> <span class="id">P</span>. <span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used</span>) <span class="id">eqn</span>:<span class="id">U</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Genv.init_mem_inversion</span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">in_prog_defmap</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">AL</span> <span class="id">FV</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">FV</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">b</span> &amp; <span class="id">FS</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">transform_find_symbol_1</span> <span class="kwd">with</span> <span class="id">b</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">kept_closed</span> <span class="kwd">with</span> <span class="id">id</span> (<span class="id">Gvar</span> <span class="id">v</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IS.mem_2</span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>. <span class="tactic">red</span>. <span class="tactic">red</span>. <span class="id">exists</span> <span class="id">o</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">init_mem_inject</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;<span class="id">Genv.init_mem</span> <span class="id">p</span> = <span class="id">Some</span> <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">f</span> <span class="id">tm</span>, <span class="id">Genv.init_mem</span> <span class="id">tp</span> = <span class="id">Some</span> <span class="id">tm</span> /\ <span class="id">Mem.inject</span> <span class="id">f</span> <span class="id">m</span> <span class="id">tm</span> /\ <span class="id">meminj_preserves_globals</span> <span class="id">f</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3948')">Proof.</div>
<div class="proofscript" id="proof3948">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">init_mem_exists</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">tm</span> <span class="id">INIT</span>].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">init_meminj</span>, <span class="id">tm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id">init_mem_inj_2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">init_meminj_preserves_globals</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">transf_initial_states</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S1</span>, <span class="id">initial_state</span> <span class="id">p</span> <span class="id">S1</span> -&gt; <span class="id">exists</span> <span class="id">S2</span>, <span class="id">initial_state</span> <span class="id">tp</span> <span class="id">S2</span> /\ <span class="id">match_states</span> <span class="id">S1</span> <span class="id">S2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3949')">Proof.</div>
<div class="proofscript" id="proof3949">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">exploit</span> <span class="id">init_mem_inject</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">j</span> &amp; <span class="id">tm</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">symbols_inject_2</span>. <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">kept_main</span>. <span class="id">eexact</span> <span class="id">H1</span>. <span class="tactic">intros</span> (<span class="id">tb</span> &amp; <span class="id">P</span> &amp; <span class="id">Q</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Genv.find_funct_ptr_iff</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">defs_inject</span>. <span class="tactic">eauto</span>. <span class="id">eexact</span> <span class="id">Q</span>. <span class="tactic">exact</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">R</span> &amp; <span class="id">S</span> &amp; <span class="id">T</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Genv.find_funct_ptr_iff</span> <span class="kwd">in</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">Callstate</span> <span class="id">nil</span> <span class="id">f</span> <span class="id">nil</span> <span class="id">tm</span>); <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">fold</span> <span class="id">tge</span>. <span class="id">erewrite</span> <span class="id">match_prog_main</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">Genv.init_mem_genv_next</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">Ple_refl</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id">Genv.init_mem_genv_next</span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">Ple_refl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">transf_final_states</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">S1</span> <span class="id">S2</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id">match_states</span> <span class="id">S1</span> <span class="id">S2</span> -&gt; <span class="id">final_state</span> <span class="id">S1</span> <span class="id">r</span> -&gt; <span class="id">final_state</span> <span class="id">S2</span> <span class="id">r</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3950')">Proof.</div>
<div class="proofscript" id="proof3950">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">STACKS</span>. <span class="id">inv</span> <span class="id">RESINJ</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">transf_program_correct_1</span>:<br/>
&nbsp;&nbsp;<span class="id">forward_simulation</span> (<span class="id">semantics</span> <span class="id">p</span>) (<span class="id">semantics</span> <span class="id">tp</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3951')">Proof.</div>
<div class="proofscript" id="proof3951">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">forward_simulation_step</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">globals_symbols_inject</span>. <span class="tactic">apply</span> <span class="id">init_meminj_preserves_globals</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">exact</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">transf_initial_states</span>.<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">transf_final_states</span>.<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">step_simulation</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">SOUNDNESS</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">transf_program_correct</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">tp</span>, <span class="id">match_prog</span> <span class="id">p</span> <span class="id">tp</span> -&gt; <span class="id">forward_simulation</span> (<span class="id">semantics</span> <span class="id">p</span>) (<span class="id">semantics</span> <span class="id">tp</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3952')">Proof.</div>
<div class="proofscript" id="proof3952">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">p</span> <span class="id">tp</span> (<span class="id">used</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>).  <span class="tactic">apply</span> <span class="id">transf_program_correct_1</span> <span class="kwd">with</span> <span class="id">used</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h1> Commutation with linking </h1>
<br/>
<span class="kwd">Remark</span> <span class="id">link_def_either</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">gd1</span> <span class="id">gd2</span> <span class="id">gd</span>: <span class="id">globdef</span> <span class="id">fundef</span> <span class="id">unit</span>),<br/>
&nbsp;&nbsp;<span class="id">link_def</span> <span class="id">gd1</span> <span class="id">gd2</span> = <span class="id">Some</span> <span class="id">gd</span> -&gt; <span class="id">gd</span> = <span class="id">gd1</span> \/ <span class="id">gd</span> = <span class="id">gd2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3953')">Proof with</div>
<div class="proofscript" id="proof3953">
 (<span class="tactic">try</span> <span class="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">gd</span>.<br/>
<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id">Linker_def</span> <span class="id">Linker_fundef</span> <span class="id">Linker_varinit</span> <span class="id">Linker_vardef</span> <span class="id">Linker_unit</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">gd1</span> <span class="kwd">as</span> [<span class="id">f1</span>|<span class="id">v1</span>], <span class="id">gd2</span> <span class="kwd">as</span> [<span class="id">f2</span>|<span class="id">v2</span>]...<br/>
<span class="comment">(*&nbsp;Two&nbsp;fundefs&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f1</span> <span class="kwd">as</span> [<span class="id">f1</span>|<span class="id">ef1</span>], <span class="id">f2</span> <span class="kwd">as</span> [<span class="id">f2</span>|<span class="id">ef2</span>]; <span class="tactic">simpl</span>...<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ef2</span>; <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ef1</span>; <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">external_function_eq</span> <span class="id">ef1</span> <span class="id">ef2</span>); <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
<span class="comment">(*&nbsp;Two&nbsp;vardefs&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id">link_vardef</span>. <span class="tactic">destruct</span> <span class="id">v1</span> <span class="kwd">as</span> [<span class="id">info1</span> <span class="id">init1</span> <span class="id">ro1</span> <span class="id">vo1</span>], <span class="id">v2</span> <span class="kwd">as</span> [<span class="id">info2</span> <span class="id">init2</span> <span class="id">ro2</span> <span class="id">vo2</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">link_varinit</span> <span class="id">init1</span> <span class="id">init2</span>) <span class="kwd">as</span> [<span class="id">init</span>|] <span class="id">eqn</span>:<span class="id">LI</span>...<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eqb</span> <span class="id">ro1</span> <span class="id">ro2</span>) <span class="id">eqn</span>:<span class="id">RO</span>...<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">eqb</span> <span class="id">vo1</span> <span class="id">vo2</span>) <span class="id">eqn</span>:<span class="id">VO</span>...<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">info1</span>, <span class="id">info2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EITHER</span>: <span class="id">init</span> = <span class="id">init1</span> \/ <span class="id">init</span> = <span class="id">init2</span>).<br/>
&nbsp;&nbsp;{ <span class="id">revert</span> <span class="id">LI</span>. <span class="tactic">unfold</span> <span class="id">link_varinit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">classify_init</span> <span class="id">init1</span>), (<span class="id">classify_init</span> <span class="id">init2</span>); <span class="tactic">intro</span> <span class="id">EQ</span>; <span class="id">inv</span> <span class="id">EQ</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">sz</span> (<span class="id">Z.max</span> <span class="id">sz0</span> 0 + 0)); <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">sz</span> (<span class="id">init_data_list_size</span> <span class="id">il</span>)); <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">zeq</span> <span class="id">sz</span> (<span class="id">init_data_list_size</span> <span class="id">il</span>)); <span class="id">inv</span> <span class="id">H0</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eqb_prop</span> <span class="kwd">in</span> <span class="id">RO</span>. <span class="tactic">apply</span> <span class="id">eqb_prop</span> <span class="kwd">in</span> <span class="id">VO</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">EQ</span>; <span class="id">inv</span> <span class="id">EQ</span>. <span class="tactic">destruct</span> <span class="id">EITHER</span>; <span class="tactic">subst</span> <span class="id">init</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">used_not_defined</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">used</span> <span class="id">id</span>,<br/>
&nbsp;&nbsp;<span class="id">valid_used_set</span> <span class="id">p</span> <span class="id">used</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">prog_defmap</span> <span class="id">p</span>)!<span class="id">id</span> = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used</span> = <span class="id">false</span> \/ <span class="id">id</span> = <span class="id">prog_main</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3954')">Proof.</div>
<div class="proofscript" id="proof3954">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used</span>) <span class="id">eqn</span>:<span class="id">M</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">used_defined</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">IS.mem_2</span>. <span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">prog_defmap_dom</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="tactic">destruct</span> <span class="id">A</span> <span class="kwd">as</span> [<span class="id">g</span> <span class="id">E</span>]; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">used_not_defined_2</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">used</span> <span class="id">id</span>,<br/>
&nbsp;&nbsp;<span class="id">valid_used_set</span> <span class="id">p</span> <span class="id">used</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">id</span> &lt;&gt; <span class="id">prog_main</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">prog_defmap</span> <span class="id">p</span>)!<span class="id">id</span> = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;~<span class="id">IS.In</span> <span class="id">id</span> <span class="id">used</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3955')">Proof.</div>
<div class="proofscript" id="proof3955">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">used_not_defined</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>].<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">IS.mem_1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">link_valid_used_set</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">p</span> <span class="id">used1</span> <span class="id">used2</span>,<br/>
&nbsp;&nbsp;<span class="id">link</span> <span class="id">p1</span> <span class="id">p2</span> = <span class="id">Some</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">valid_used_set</span> <span class="id">p1</span> <span class="id">used1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">valid_used_set</span> <span class="id">p2</span> <span class="id">used2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">valid_used_set</span> <span class="id">p</span> (<span class="id">IS.union</span> <span class="id">used1</span> <span class="id">used2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3956')">Proof.</div>
<div class="proofscript" id="proof3956">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">used2</span>; <span class="tactic">intros</span> <span class="id">L</span> <span class="id">V1</span> <span class="id">V2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">link_prog_inv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">L</span>) <span class="kwd">as</span> (<span class="id">X</span> &amp; <span class="id">Y</span> &amp; <span class="id">Z</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Z</span>; <span class="tactic">clear</span> <span class="id">Z</span>; <span class="id">constructor</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">ISF.union_iff</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">ISF.union_iff</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">prog_defmap_elements</span>, <span class="id">PTree.gcombine</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">prog_defmap</span> <span class="id">p1</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">gd1</span>|] <span class="id">eqn</span>:<span class="id">GD1</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">prog_defmap</span> <span class="id">p2</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">gd2</span>|] <span class="id">eqn</span>:<span class="id">GD2</span>;<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
+ <span class="comment">(*&nbsp;common&nbsp;definition&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">Y</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">PUB1</span> &amp; <span class="id">PUB2</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">link_def_either</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">EQ</span>|<span class="id">EQ</span>]; <span class="tactic">subst</span> <span class="id">gd</span>.<br/>
* <span class="id">left</span>. <span class="tactic">eapply</span> <span class="id">used_closed</span>. <span class="id">eexact</span> <span class="id">V1</span>. <span class="tactic">eapply</span> <span class="id">used_public</span>. <span class="id">eexact</span> <span class="id">V1</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
* <span class="id">right</span>. <span class="tactic">eapply</span> <span class="id">used_closed</span>. <span class="id">eexact</span> <span class="id">V2</span>. <span class="tactic">eapply</span> <span class="id">used_public</span>. <span class="id">eexact</span> <span class="id">V2</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
+ <span class="comment">(*&nbsp;left&nbsp;definition&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">ISP.In_dec</span> <span class="id">id</span> <span class="id">used1</span>).<br/>
* <span class="id">left</span>; <span class="tactic">eapply</span> <span class="id">used_closed</span>; <span class="tactic">eauto</span>.<br/>
* <span class="tactic">assert</span> (<span class="id">IS.In</span> <span class="id">id</span> <span class="id">used2</span>) <span class="tactic">by</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">used_defined</span>. <span class="id">eexact</span> <span class="id">V2</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">prog_defmap_dom</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">g</span> <span class="id">E</span>]; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">n</span>. <span class="tactic">rewrite</span> <span class="id">A</span>, &lt;- <span class="id">X</span>. <span class="tactic">eapply</span> <span class="id">used_main</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="comment">(*&nbsp;right&nbsp;definition&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">ISP.In_dec</span> <span class="id">id</span> <span class="id">used2</span>).<br/>
* <span class="id">right</span>; <span class="tactic">eapply</span> <span class="id">used_closed</span>; <span class="tactic">eauto</span>.<br/>
* <span class="tactic">assert</span> (<span class="id">IS.In</span> <span class="id">id</span> <span class="id">used1</span>) <span class="tactic">by</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">used_defined</span>. <span class="id">eexact</span> <span class="id">V1</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">prog_defmap_dom</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">g</span> <span class="id">E</span>]; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">n</span>. <span class="tactic">rewrite</span> <span class="id">A</span>, <span class="id">X</span>. <span class="tactic">eapply</span> <span class="id">used_main</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="comment">(*&nbsp;no&nbsp;definition&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">ISF.union_iff</span>; <span class="id">left</span>; <span class="tactic">eapply</span> <span class="id">used_main</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">simpl</span>. <span class="tactic">intros</span> <span class="id">id</span>. <span class="tactic">rewrite</span> <span class="id">in_app_iff</span>, <span class="id">ISF.union_iff</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>]; [<span class="id">left</span>|<span class="id">right</span>]; <span class="tactic">eapply</span> <span class="id">used_public</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">ISF.union_iff</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ident_eq</span> <span class="id">id</span> (<span class="id">prog_main</span> <span class="id">p1</span>)).<br/>
+ <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
+ <span class="tactic">assert</span> (<span class="id">E</span>: <span class="id">exists</span> <span class="id">g</span>, <span class="id">link_prog_merge</span> (<span class="id">prog_defmap</span> <span class="id">p1</span>)!<span class="id">id</span> (<span class="id">prog_defmap</span> <span class="id">p2</span>)!<span class="id">id</span> = <span class="id">Some</span> <span class="id">g</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">prog_defmap</span> <span class="id">p1</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">gd1</span>|] <span class="id">eqn</span>:<span class="id">GD1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">prog_defmap</span> <span class="id">p2</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">gd2</span>|] <span class="id">eqn</span>:<span class="id">GD2</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Y</span> <span class="kwd">with</span> <span class="id">id</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;* <span class="id">exists</span> <span class="id">gd1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;* <span class="id">exists</span> <span class="id">gd2</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">used_not_defined_2</span> <span class="kwd">in</span> <span class="id">GD1</span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">used_not_defined_2</span> <span class="kwd">in</span> <span class="id">GD2</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">E</span> <span class="kwd">as</span> [<span class="id">g</span> <span class="id">LD</span>].<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">unfold</span> <span class="id">prog_defs_names</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> <span class="id">id</span> <span class="kwd">with</span> (<span class="id">fst</span> (<span class="id">id</span>, <span class="id">g</span>)). <span class="tactic">apply</span> <span class="id">in_map</span>. <span class="tactic">apply</span> <span class="id">PTree.elements_correct</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PTree.gcombine</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id">link_match_program</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">tp1</span> <span class="id">tp2</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;<span class="id">link</span> <span class="id">p1</span> <span class="id">p2</span> = <span class="id">Some</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">match_prog</span> <span class="id">p1</span> <span class="id">tp1</span> -&gt; <span class="id">match_prog</span> <span class="id">p2</span> <span class="id">tp2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tp</span>, <span class="id">link</span> <span class="id">tp1</span> <span class="id">tp2</span> = <span class="id">Some</span> <span class="id">tp</span> /\ <span class="id">match_prog</span> <span class="id">p</span> <span class="id">tp</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3957')">Proof.</div>
<div class="proofscript" id="proof3957">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">used1</span> &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>). <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">used2</span> &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">link_prog_inv</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>) <span class="kwd">as</span> (<span class="id">U</span> &amp; <span class="id">V</span> &amp; <span class="id">W</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">apply</span> <span class="id">link_prog_succeeds</span>.<br/>
+ <span class="tactic">rewrite</span> (<span class="id">match_prog_main</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B1</span>), (<span class="id">match_prog_main</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B2</span>). <span class="tactic">auto</span>.<br/>
+ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">match_prog_def</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B1</span>) <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">match_prog_def</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B2</span>) <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used1</span>) <span class="id">eqn</span>:<span class="id">U1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used2</span>) <span class="id">eqn</span>:<span class="id">U2</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">V</span> <span class="kwd">as</span> (<span class="id">X</span> &amp; <span class="id">Y</span> &amp; <span class="id">gd</span> &amp; <span class="id">Z</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> (<span class="id">match_prog_public</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B1</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> (<span class="id">match_prog_public</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
- <span class="id">exists</span> (<span class="id">IS.union</span> <span class="id">used1</span> <span class="id">used2</span>); <span class="tactic">split</span>.<br/>
+ <span class="tactic">eapply</span> <span class="id">link_valid_used_set</span>; <span class="tactic">eauto</span>.<br/>
+ <span class="tactic">rewrite</span> <span class="id">W</span>. <span class="id">constructor</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
* <span class="tactic">eapply</span> <span class="id">match_prog_main</span>; <span class="tactic">eauto</span>.<br/>
* <span class="tactic">rewrite</span> (<span class="id">match_prog_public</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B1</span>), (<span class="id">match_prog_public</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B2</span>). <span class="tactic">auto</span>.<br/>
* <span class="tactic">rewrite</span> ! <span class="id">prog_defmap_elements</span>, !<span class="id">PTree.gcombine</span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">match_prog_def</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B1</span> <span class="id">id</span>), (<span class="id">match_prog_def</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">B2</span> <span class="id">id</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ISF.union_b</span>.<br/>
{<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">prog_defmap</span> <span class="id">p1</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">gd1</span>|] <span class="id">eqn</span>:<span class="id">GD1</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">prog_defmap</span> <span class="id">p2</span>)!<span class="id">id</span> <span class="kwd">as</span> [<span class="id">gd2</span>|] <span class="id">eqn</span>:<span class="id">GD2</span>.<br/>
- <span class="comment">(*&nbsp;both&nbsp;defined&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">V</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">PUB1</span> &amp; <span class="id">PUB2</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EQ1</span>: <span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used1</span> = <span class="id">true</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">IS.mem_1</span>; <span class="tactic">eapply</span> <span class="id">used_public</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EQ2</span>: <span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used2</span> = <span class="id">true</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">IS.mem_1</span>; <span class="tactic">eapply</span> <span class="id">used_public</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">EQ1</span>, <span class="id">EQ2</span>; <span class="tactic">auto</span>.<br/>
- <span class="comment">(*&nbsp;left&nbsp;defined&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">used_not_defined</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>, <span class="id">orb_false_r</span>. <span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used1</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used1</span>) <span class="kwd">with</span> <span class="id">true</span>. <span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">IS.mem_1</span>. <span class="tactic">rewrite</span> <span class="id">A</span>, &lt;- <span class="id">U</span>. <span class="tactic">eapply</span> <span class="id">used_main</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;right&nbsp;defined&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">used_not_defined</span>. <span class="id">eexact</span> <span class="id">A1</span>. <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">A</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>, <span class="id">orb_false_l</span>. <span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used2</span>) <span class="kwd">with</span> <span class="id">true</span>. <span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used1</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">IS.mem_1</span>. <span class="tactic">rewrite</span> <span class="id">A</span>, <span class="id">U</span>. <span class="tactic">eapply</span> <span class="id">used_main</span>; <span class="tactic">eauto</span>.<br/>
- <span class="comment">(*&nbsp;none&nbsp;defined&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used1</span>), (<span class="id">IS.mem</span> <span class="id">id</span> <span class="id">used2</span>); <span class="tactic">auto</span>.<br/>
}<br/>
* <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">PTree.elements_keys_norepet</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id">TransfSelectionLink</span> : <span class="id">TransfLink</span> <span class="id">match_prog</span> := <span class="id">link_match_program</span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
