
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Stackingproof</title>
<meta name="description" content="Documentation of Coq module Stackingproof" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Stackingproof</h1>
<div class="coq">
<br/>
<div class="doc">Correctness proof for the translation from Linear to Mach. </div>
<br/>
<div class="doc">This file proves semantic preservation for the <span class="bracket"><span class="id">Stacking</span></span> pass. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Coqlib.html">Coqlib</a></span> <span class="id"><a href="compcert.common.Errors.html">Errors</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Integers.html">Integers</a></span> <span class="id"><a href="compcert.common.AST.html">AST</a></span> <span class="id"><a href="compcert.common.Linking.html">Linking</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.Values.html">Values</a></span> <span class="id"><a href="compcert.common.Memory.html">Memory</a></span> <span class="id"><a href="compcert.common.Separation.html">Separation</a></span> <span class="id"><a href="compcert.common.Events.html">Events</a></span> <span class="id"><a href="compcert.common.Globalenvs.html">Globalenvs</a></span> <span class="id"><a href="compcert.common.Smallstep.html">Smallstep</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.backend.LTL.html">LTL</a></span> <span class="id"><a href="compcert.x86.Op.html">Op</a></span> <span class="id"><a href="compcert.backend.Locations.html">Locations</a></span> <span class="id"><a href="compcert.backend.Linear.html">Linear</a></span> <span class="id"><a href="compcert.backend.Mach.html">Mach</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.backend.Bounds.html">Bounds</a></span> <span class="id"><a href="compcert.backend.Conventions.html">Conventions</a></span> <span class="id"><a href="compcert.x86.Stacklayout.html">Stacklayout</a></span> <span class="id"><a href="compcert.backend.Lineartyping.html">Lineartyping</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.backend.Stacking.html">Stacking</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.LanguageInterface.html">LanguageInterface</a></span> <span class="id"><a href="compcert.common.Invariant.html">Invariant</a></span> <span class="id"><a href="compcert.cklr.Inject.html">cklr.Inject</a></span> <span class="id"><a href="compcert.cklr.InjectFootprint.html">cklr.InjectFootprint</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">sep_scope</span>.<br/>
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add">Z.add</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.mul">Z.mul</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide">Z.divide</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="match_prog">match_prog</a></span> (<span class="id">p</span>: <span class="id"><a href="compcert.backend.Linear.html#program">Linear.program</a></span>) (<span class="id">tp</span>: <span class="id"><a href="compcert.backend.Mach.html#program">Mach.program</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Linking.html#match_program">match_program</a></span> (<span class="kwd">fun</span> <span class="id">_</span> <span class="id">f</span> <span class="id">tf</span> =&gt; <span class="id"><a href="compcert.backend.Stacking.html#transf_fundef">transf_fundef</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tp">tp</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transf_program_match">transf_program_match</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">tp</span>, <span class="id"><a href="compcert.backend.Stacking.html#transf_program">transf_program</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tp">tp</a></span> -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#match_prog">match_prog</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tp">tp</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4470')">Proof.</div>
<div class="proofscript" id="proof4470">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Linking.html#match_transform_partial_program">match_transform_partial_program</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<h1> Basic properties of the translation </h1>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="typesize_typesize">typesize_typesize</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span>, <span class="id"><a href="compcert.common.AST.html#typesize">AST.typesize</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> = 4 * <span class="id"><a href="compcert.backend.Locations.html#typesize">Locations.typesize</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4471')">Proof.</div>
<div class="proofscript" id="proof4471">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="size_type_chunk">size_type_chunk</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span>, <span class="id"><a href="compcert.common.Memdata.html#size_chunk">size_chunk</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) = <span class="id"><a href="compcert.common.AST.html#typesize">AST.typesize</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4472')">Proof.</div>
<div class="proofscript" id="proof4472">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="align_type_chunk">align_type_chunk</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span>, <span class="id"><a href="compcert.common.Memdata.html#align_chunk">align_chunk</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) = 4 * <span class="id"><a href="compcert.backend.Locations.html#typealign">Locations.typealign</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4473')">Proof.</div>
<div class="proofscript" id="proof4473">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="slot_outgoing_argument_valid">slot_outgoing_argument_valid</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">sg</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span>)) -&gt; <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4474')">Proof.</div>
<div class="proofscript" id="proof4474">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_arguments_acceptable_2">loc_arguments_acceptable_2</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Coqlib.html#proj_sumbool">proj_sumbool</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zle_true">zle_true</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#pred_dec_true">pred_dec_true</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_result_inject">load_result_inject</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ty</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id">v</span>' -&gt; <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> -&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> (<span class="id"><a href="compcert.common.Values.html#Val.load_result">Val.load_result</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4475')">Proof.</div>
<div class="proofscript" id="proof4475">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">v</span>'; <span class="tactic">unfold</span> <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span>, <span class="id"><a href="compcert.common.Values.html#Val.load_result">Val.load_result</a></span>; <span class="tactic">destruct</span> <span class="id"><a href="compcert.x86_64.Archi.html#ptr64">Archi.ptr64</a></span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> 1; <span class="tactic">intros</span>; <span class="tactic">auto</span>; <span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PRESERVATION">PRESERVATION</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.return_address_offset">return_address_offset</a></span>: <span class="id"><a href="compcert.backend.Mach.html#function">Mach.function</a></span> -&gt; <span class="id"><a href="compcert.backend.Mach.html#code">Mach.code</a></span> -&gt; <span class="id"><a href="compcert.lib.Integers.html#ptrofs">ptrofs</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.return_address_offset_exists">return_address_offset_exists</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">sg</span> <span class="id">ros</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> (<span class="id"><a href="compcert.backend.Mach.html#Mcall">Mcall</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ros">ros</a></span> :: <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#fn_code">fn_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.return_address_offset">return_address_offset</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>.<br/>
<br/>
<span class="kwd">Let</span> <span class="id"><a name="PRESERVATION.step">step</a></span> := <span class="id"><a href="compcert.backend.Mach.html#step">Mach.step</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.return_address_offset">return_address_offset</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.prog">prog</a></span>: <span class="id"><a href="compcert.backend.Linear.html#program">Linear.program</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.tprog">tprog</a></span>: <span class="id"><a href="compcert.backend.Mach.html#program">Mach.program</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.TRANSF">TRANSF</a></span>: <span class="id"><a href="compcert.backend.Stackingproof.html#match_prog">match_prog</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.prog">prog</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tprog">tprog</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.se">se</a></span>: <span class="id"><a href="compcert.common.Globalenvs.html#Genv.symtbl">Genv.symtbl</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.tse">tse</a></span>: <span class="id"><a href="compcert.common.Globalenvs.html#Genv.symtbl">Genv.symtbl</a></span>.<br/>
<span class="kwd">Let</span> <span class="id"><a name="PRESERVATION.ge">ge</a></span> := <span class="id"><a href="compcert.common.Globalenvs.html#Genv.globalenv">Genv.globalenv</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.prog">prog</a></span>.<br/>
<span class="kwd">Let</span> <span class="id"><a name="PRESERVATION.tge">tge</a></span> := <span class="id"><a href="compcert.common.Globalenvs.html#Genv.globalenv">Genv.globalenv</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tprog">tprog</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES">FRAME_PROPERTIES</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.f">f</a></span>: <span class="id"><a href="compcert.backend.Linear.html#function">Linear.function</a></span>.<br/>
<span class="kwd">Let</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.b">b</a></span> := <span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>.<br/>
<span class="kwd">Let</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> := <span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.tf">tf</a></span>: <span class="id"><a href="compcert.backend.Mach.html#function">Mach.function</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.TRANSF_F">TRANSF_F</a></span>: <span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.tf">tf</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unfold_transf_function">unfold_transf_function</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.tf">tf</a></span> = <span class="id"><a href="compcert.backend.Mach.html#mkfunction">Mach.mkfunction</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>.(<span class="id"><a href="compcert.backend.Linear.html#fn_sig">Linear.fn_sig</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Stacking.html#transl_body">transl_body</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_size">fe_size</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_link">fe_ofs_link</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_retaddr">fe_ofs_retaddr</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4476')">Proof.</div>
<div class="proofscript" id="proof4476">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.TRANSF_F">TRANSF_F</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Lineartyping.html#wt_function">wt_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>); <span class="tactic">simpl</span> <span class="id">negb</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#fe_size">fe_size</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>)))).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#b">b</a></span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transf_function_well_typed">transf_function_well_typed</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Lineartyping.html#wt_function">wt_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4477')">Proof.</div>
<div class="proofscript" id="proof4477">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.TRANSF_F">TRANSF_F</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Lineartyping.html#wt_function">wt_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>); <span class="tactic">simpl</span> <span class="id">negb</span>. <span class="tactic">auto</span>. <span class="tactic">intros</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="size_no_overflow">size_no_overflow</a></span>: <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_size">fe_size</a></span>) &lt;= <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4478')">Proof.</div>
<div class="proofscript" id="proof4478">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.TRANSF_F">TRANSF_F</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Lineartyping.html#wt_function">wt_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>); <span class="tactic">simpl</span> <span class="id">negb</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#fe_size">fe_size</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>)))).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#b">b</a></span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="bound_outgoing_no_overflow">bound_outgoing_no_overflow</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.x86.Stacklayout.html#fe_ofs_arg">fe_ofs_arg</a></span> + 4 * (<span class="id"><a href="compcert.backend.Bounds.html#bound_outgoing">bound_outgoing</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>)) &lt;= <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4479')">Proof.</div>
<div class="proofscript" id="proof4479">
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="compcert.backend.Stackingproof.html#size_no_overflow">size_no_overflow</a></span>. <span class="tactic">subst</span> <span class="id">b</span> <span class="id">fe</span>.<br/>
&nbsp;&nbsp;<span class="id">etransitivity</span>; <span class="tactic">eauto</span>; <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;<span class="id">cbv</span> [<span class="id"><a href="compcert.x86.Stacklayout.html#fe_ofs_arg">fe_ofs_arg</a></span> <span class="id"><a href="compcert.backend.Bounds.html#fe_size">fe_size</a></span> <span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="kwd">if</span> <span class="id"><a href="compcert.x86_64.Archi.html#ptr64">Archi.ptr64</a></span> <span class="kwd">then</span> 8 <span class="kwd">else</span> 4) &gt; 0) <span class="tactic">by</span> (<span class="tactic">destruct</span> <span class="id"><a href="compcert.x86_64.Archi.html#ptr64">Archi.ptr64</a></span>; <span class="id">xomega</span>).<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span> [<span class="id"><a href="compcert.lib.Coqlib.html#align">align</a></span> ?<span class="id">x</span> ?<span class="id">a</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lazymatch</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id">x</span> &lt;= <span class="id"><a href="compcert.lib.Coqlib.html#align">align</a></span> <span class="id">x</span> <span class="id">a</span> |- <span class="id">_</span> =&gt; <span class="tactic">fail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">assert</span> (<span class="id">x</span> &lt;= <span class="id"><a href="compcert.lib.Coqlib.html#align">align</a></span> <span class="id">x</span> <span class="id">a</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> (<span class="id"><a href="compcert.lib.Coqlib.html#align_le">align_le</a></span> <span class="id">x</span> <span class="id">a</span>); <span class="id">xomega</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id">context</span> [<span class="id"><a href="compcert.backend.Bounds.html#size_callee_save_area">size_callee_save_area</a></span> ?<span class="id">b</span> ?<span class="id">x</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lazymatch</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span>: <span class="id">x</span> &lt;= <span class="id"><a href="compcert.backend.Bounds.html#size_callee_save_area">size_callee_save_area</a></span> <span class="id">b</span> <span class="id">x</span> |- <span class="id">_</span> =&gt; <span class="tactic">fail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">assert</span> (<span class="id">x</span> &lt;= <span class="id"><a href="compcert.backend.Bounds.html#size_callee_save_area">size_callee_save_area</a></span> <span class="id">b</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Bounds.html#size_callee_save_area_incr">size_callee_save_area_incr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.backend.Bounds.html#bound_local_pos">bound_local_pos</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>)).<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.backend.Bounds.html#bound_outgoing_pos">bound_outgoing_pos</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>)).<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.backend.Bounds.html#bound_stack_data_pos">bound_stack_data_pos</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>)).<br/>
&nbsp;&nbsp;<span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="bound_stack_data_stacksize">bound_stack_data_stacksize</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>.(<span class="id"><a href="compcert.backend.Linear.html#fn_stacksize">Linear.fn_stacksize</a></span>) &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#bound_stack_data">bound_stack_data</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4480')">Proof.</div>
<div class="proofscript" id="proof4480">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#b">b</a></span>, <span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span>, <span class="id"><a href="compcert.backend.Bounds.html#bound_stack_data">bound_stack_data</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.le_max_l">Z.le_max_l</a></span>.<br/>
Qed.</div>
<br/>
<h1> Memory assertions used to describe the contents of stack frames </h1>
<br/>
<div class="doc">Accessing the stack frame using <span class="bracket"><span class="id">load_stack</span></span> and <span class="bracket"><span class="id">store_stack</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="contains_get_stack">contains_get_stack</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">spec</span> <span class="id">m</span> <span class="id">ty</span> <span class="id">sp</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.common.Separation.html#contains">contains</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#spec">spec</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>, <span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> /\ <span class="id"><a href="compcert.backend.Stackingproof.html#spec">spec</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4481')">Proof.</div>
<div class="proofscript" id="proof4481">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="compcert.common.Values.html#Val.offset_ptr">Val.offset_ptr</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id">ofs</span>)) <span class="kwd">with</span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#loadv_rule">loadv_rule</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_zero_l">Ptrofs.add_zero_l</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hasvalue_get_stack">hasvalue_get_stack</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">m</span> <span class="id">sp</span> <span class="id">ofs</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.common.Separation.html#hasvalue">hasvalue</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4482')">Proof.</div>
<div class="proofscript" id="proof4482">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#contains_get_stack">contains_get_stack</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="contains_set_stack">contains_set_stack</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">spec</span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span> -&gt; <span class="kwd">Prop</span>) <span class="id">v</span> <span class="id">spec1</span> <span class="id">m</span> <span class="id">ty</span> <span class="id">sp</span> <span class="id">ofs</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.common.Separation.html#contains">contains</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#spec1">spec1</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#spec">spec</a></span> (<span class="id"><a href="compcert.common.Values.html#Val.load_result">Val.load_result</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">m</span>' |= <span class="id"><a href="compcert.common.Separation.html#contains">contains</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#spec">spec</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4483')">Proof.</div>
<div class="proofscript" id="proof4483">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="compcert.common.Values.html#Val.offset_ptr">Val.offset_ptr</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id">ofs</span>)) <span class="kwd">with</span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#storev_rule">storev_rule</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_zero_l">Ptrofs.add_zero_l</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">contains_locations</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">pos</span> <span class="id">bound</span> <span class="id">sl</span> <span class="id">ls</span></span> is a separation logic assertion
  that holds if the memory area at block <span class="bracket"><span class="id">sp</span></span>, offset <span class="bracket"><span class="id">pos</span></span>, size <span class="bracket">4 * <span class="id">bound</span></span>,
  reflects the values of the stack locations of kind <span class="bracket"><span class="id">sl</span></span> given by the
  location map <span class="bracket"><span class="id">ls</span></span>, up to the memory injection <span class="bracket"><span class="id">j</span></span>.
  Two such <span class="bracket"><span class="id">contains_locations</span></span> assertions will be used later, one to
  reason about the values of <span class="bracket"><span class="kwd">Local</span></span> slots, the other about the values of
  <span class="bracket"><span class="id">Outgoing</span></span> slots. </div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="contains_locations">contains_locations</a></span> (<span class="id">j</span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>) (<span class="id">sp</span>: <span class="id"><a href="compcert.common.Values.html#block">block</a></span>) (<span class="id">pos</span> <span class="id">bound</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">sl</span>: <span class="id"><a href="compcert.backend.Locations.html#slot">slot</a></span>) (<span class="id">ls</span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>) : <span class="id"><a href="compcert.common.Separation.html#massert">massert</a></span> := {|<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#Build_massert">m_pred</a></span> := <span class="kwd">fun</span> <span class="id">m</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(8 | <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span>) /\ 0 &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> /\ <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> + 4 * <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> &lt;= <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.modulus">Ptrofs.modulus</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> + 4 * <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span>) <span class="id"><a href="compcert.common.Memtype.html#Cur">Cur</a></span> <span class="id"><a href="compcert.common.Memtype.html#Freeable">Freeable</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span>, 0 &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> + <span class="id"><a href="compcert.backend.Locations.html#typesize">typesize</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> -&gt; (<span class="id"><a href="compcert.backend.Locations.html#typealign">typealign</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> | <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>, <span class="id"><a href="compcert.common.Memory.html#Mem.load">Mem.load</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> + 4 * <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>;<br/>
&nbsp;&nbsp;<span class="id">m_footprint</span> := <span class="kwd">fun</span> <span class="id">b</span> <span class="id">ofs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#b">b</a></span> = <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> /\ <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> &lt; <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> + 4 * <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span><br/>
|}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4484')">Next Obligation.</div>
<div class="proofscript" id="proof4484">
&nbsp;&nbsp;<span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_unchanged_on">Mem.perm_unchanged_on</a></span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">exploit</span> <span class="id">H4</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id">v</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_unchanged_on">Mem.load_unchanged_on</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#size_type_chunk">size_type_chunk</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#typesize_typesize">typesize_typesize</a></span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof4485')">Next Obligation.</div>
<div class="proofscript" id="proof4485">
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="valid_access_location">valid_access_location</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">sp</span> <span class="id">pos</span> <span class="id">bound</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;(8 | <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> + 4 * <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span>) <span class="id"><a href="compcert.common.Memtype.html#Cur">Cur</a></span> <span class="id"><a href="compcert.common.Memtype.html#Freeable">Freeable</a></span> -&gt;<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> + <span class="id"><a href="compcert.backend.Locations.html#typesize">typesize</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> -&gt; (<span class="id"><a href="compcert.backend.Locations.html#typealign">typealign</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> | <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.valid_access">Mem.valid_access</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> + 4 * <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4486')">Proof.</div>
<div class="proofscript" id="proof4486">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_implies">Mem.perm_implies</a></span> <span class="kwd">with</span> <span class="id"><a href="compcert.common.Memtype.html#Freeable">Freeable</a></span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#size_type_chunk">size_type_chunk</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#typesize_typesize">typesize_typesize</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">omega</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#align_type_chunk">align_type_chunk</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide_add_r">Z.divide_add_r</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide_trans">Z.divide_trans</a></span> <span class="kwd">with</span> 8; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (8 / (4 * <span class="id"><a href="compcert.backend.Locations.html#typealign">typealign</a></span> <span class="id">ty</span>)); <span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.mul_divide_mono_l">Z.mul_divide_mono_l</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="get_location">get_location</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">pos</span> <span class="id">bound</span> <span class="id">sl</span> <span class="id">ls</span> <span class="id">ofs</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> -&gt;<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> + <span class="id"><a href="compcert.backend.Locations.html#typesize">typesize</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> -&gt; (<span class="id"><a href="compcert.backend.Locations.html#typealign">typealign</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> | <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> + 4 * <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4487')">Proof.</div>
<div class="proofscript" id="proof4487">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span> &amp; <span class="id">G</span> &amp; <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v</span> &amp; <span class="id">U</span> &amp; <span class="id">V</span>). <span class="id">exists</span> <span class="id">v</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_zero_l">Ptrofs.add_zero_l</a></span>, <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.unsigned_repr">Ptrofs.unsigned_repr</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span>. <span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Locations.html#typesize_pos">typesize_pos</a></span> <span class="id">ty</span>). <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="set_location">set_location</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">pos</span> <span class="id">bound</span> <span class="id">sl</span> <span class="id">ls</span> <span class="id">P</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> + <span class="id"><a href="compcert.backend.Locations.html#typesize">typesize</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> -&gt; (<span class="id"><a href="compcert.backend.Locations.html#typealign">typealign</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> | <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> + 4 * <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>)) <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4488')">Proof.</div>
<div class="proofscript" id="proof4488">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">destruct</span> <span class="id">A</span> <span class="kwd">as</span> (<span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span> &amp; <span class="id">G</span> &amp; <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_access_store">Mem.valid_access_store</a></span> <span class="kwd">as</span> [<span class="id">m</span>' <span class="id">STORE</span>].<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#valid_access_location">valid_access_location</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">PERM</span>: <span class="id"><a href="compcert.common.Memory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id">m</span>' <span class="id">sp</span> <span class="id">pos</span> (<span class="id">pos</span> + 4 * <span class="id">bound</span>) <span class="id"><a href="compcert.common.Memtype.html#Cur">Cur</a></span> <span class="id"><a href="compcert.common.Memtype.html#Freeable">Freeable</a></span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>. }<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>'; <span class="tactic">split</span>.<br/>
- <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_zero_l">Ptrofs.add_zero_l</a></span>, <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.unsigned_repr">Ptrofs.unsigned_repr</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span>. <span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Locations.html#typesize_pos">typesize_pos</a></span> <span class="id">ty</span>). <span class="tactic">omega</span>.<br/>
- <span class="tactic">simpl</span>. <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
+ <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Locations.html#Loc.eq">Loc.eq</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>) (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id">sl</span> <span class="id">ofs0</span> <span class="id">ty0</span>)); [|<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Locations.html#Loc.diff_dec">Loc.diff_dec</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>) (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id">sl</span> <span class="id">ofs0</span> <span class="id">ty0</span>))].<br/>
* <span class="comment">(*&nbsp;same&nbsp;location&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">e</span>. <span class="tactic">rename</span> <span class="id">ofs0</span> <span class="id">into</span> <span class="id">ofs</span>. <span class="tactic">rename</span> <span class="id">ty0</span> <span class="id">into</span> <span class="id">ty</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.common.Values.html#Val.load_result">Val.load_result</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id">ty</span>) <span class="id">v</span>'); <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_store_similar_2">Mem.load_store_similar_2</a></span>; <span class="tactic">eauto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.load_result_inject">Val.load_result_inject</a></span>; <span class="tactic">auto</span>.<br/>
* <span class="comment">(*&nbsp;different&nbsp;locations&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v0</span> &amp; <span class="id">X</span> &amp; <span class="id">Y</span>). <span class="id">exists</span> <span class="id">v0</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">X</span>; <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_store_other">Mem.load_store_other</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>. <span class="tactic">congruence</span>. <span class="id">right</span>. <span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.backend.Stackingproof.html#size_type_chunk">size_type_chunk</a></span>, ! <span class="id"><a href="compcert.backend.Stackingproof.html#typesize_typesize">typesize_typesize</a></span>. <span class="tactic">omega</span>.<br/>
* <span class="comment">(*&nbsp;overlapping&nbsp;locations&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.valid_access_load">Mem.valid_access_load</a></span> <span class="id">m</span>' (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id">ty0</span>) <span class="id">sp</span> (<span class="id">pos</span> + 4 * <span class="id">ofs0</span>)) <span class="kwd">as</span> [<span class="id">v</span>'' <span class="id">LOAD</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_access_implies">Mem.valid_access_implies</a></span> <span class="kwd">with</span> <span class="id"><a href="compcert.common.Memtype.html#Writable">Writable</a></span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#valid_access_location">valid_access_location</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>''; <span class="tactic">auto</span>.<br/>
+ <span class="tactic">apply</span> (<span class="id"><a href="compcert.common.Separation.html#m_invar">m_invar</a></span> <span class="id">P</span>) <span class="kwd">with</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.store_unchanged_on">Mem.store_unchanged_on</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">i</span>; <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#size_type_chunk">size_type_chunk</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#typesize_typesize">typesize_typesize</a></span>. <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">eelim</span> <span class="id">C</span>; <span class="tactic">eauto</span>. <span class="tactic">simpl</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="initial_locations">initial_locations</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">pos</span> <span class="id">bound</span> <span class="id">P</span> <span class="id">sl</span> <span class="id">ls</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.common.Separation.html#range">range</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> + 4 * <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span>) ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;(8 | <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span>, <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) = <span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4489')">Proof.</div>
<div class="proofscript" id="proof4489">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">destruct</span> <span class="id">A</span> <span class="kwd">as</span> (<span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span>). <span class="tactic">split</span>.<br/>
- <span class="tactic">simpl</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.valid_access_load">Mem.valid_access_load</a></span> <span class="id">m</span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id">ty</span>) <span class="id">sp</span> (<span class="id">pos</span> + 4 * <span class="id">ofs</span>)) <span class="kwd">as</span> [<span class="id">v</span> <span class="id">LOAD</span>].<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#valid_access_location">valid_access_location</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">mem</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="contains_locations_exten">contains_locations_exten</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls</span> <span class="id">ls</span>' <span class="id">j</span> <span class="id">sp</span> <span class="id">pos</span> <span class="id">bound</span> <span class="id">sl</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span>, <span class="id"><a href="compcert.common.Values.html#Val.lessdef">Val.lessdef</a></span> (<span class="id">ls</span>' (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)) (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#massert_imp">massert_imp</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id">ls</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4490')">Proof.</div>
<div class="proofscript" id="proof4490">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="id">exploit</span> <span class="id">H5</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id">v</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">ofs</span> <span class="id">ty</span>). <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">congruence</span>. <span class="tactic">auto</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="contains_locations_incr">contains_locations_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">j</span>' <span class="id">sp</span> <span class="id">pos</span> <span class="id">bound</span> <span class="id">sl</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#massert_imp">massert_imp</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#bound">bound</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4491')">Proof.</div>
<div class="proofscript" id="proof4491">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="id">exploit</span> <span class="id">H5</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id">v</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">contains_callee_saves</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">pos</span> <span class="id">rl</span> <span class="id">ls</span></span> is a memory assertion that holds
  if block <span class="bracket"><span class="id">sp</span></span>, starting at offset <span class="bracket"><span class="id">pos</span></span>, contains the values of the
  callee-save registers <span class="bracket"><span class="id">rl</span></span> as given by the location map <span class="bracket"><span class="id">ls</span></span>,
  up to the memory injection <span class="bracket"><span class="id">j</span></span>.  The memory layout of the registers in <span class="bracket"><span class="id">rl</span></span>
  is the same as that implemented by <span class="bracket"><span class="id">save_callee_save_rec</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="contains_callee_saves">contains_callee_saves</a></span> (<span class="id">j</span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>) (<span class="id">sp</span>: <span class="id"><a href="compcert.common.Values.html#block">block</a></span>) (<span class="id">pos</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">rl</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.x86.Machregs.html#mreg">mreg</a></span>) (<span class="id">ls</span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>) : <span class="id"><a href="compcert.common.Separation.html#massert">massert</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="compcert.common.Separation.html#pure">pure</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;| <span class="id">r</span> :: <span class="id">rl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ty</span> := <span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span> <span class="id">r</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sz</span> := <span class="id"><a href="compcert.common.AST.html#typesize">AST.typesize</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">pos1</span> := <span class="id"><a href="compcert.lib.Coqlib.html#align">align</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sz">sz</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#contains">contains</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos1">pos1</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves">contains_callee_saves</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#pos1">pos1</a></span> + <span class="id"><a href="compcert.backend.Stackingproof.html#sz">sz</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="contains_callee_saves_incr">contains_callee_saves_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">j</span>' <span class="id">sp</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rl</span> <span class="id">pos</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#massert_imp">massert_imp</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves">contains_callee_saves</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves">contains_callee_saves</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4492')">Proof.</div>
<div class="proofscript" id="proof4492">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span> <span class="kwd">as</span> [ | <span class="id">r1</span> <span class="id">rl</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">reflexivity</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sepconj_morph_1">sepconj_morph_1</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#contains_imp">contains_imp</a></span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="contains_callee_saves_exten">contains_callee_saves_exten</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls</span>' <span class="id">rl</span> <span class="id">pos</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> -&gt; <span class="id">ls</span>' (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) = <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#massert_eqv">massert_eqv</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves">contains_callee_saves</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves">contains_callee_saves</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id">ls</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4493')">Proof.</div>
<div class="proofscript" id="proof4493">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span> <span class="kwd">as</span> [ | <span class="id">r1</span> <span class="id">rl</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">reflexivity</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sepconj_morph_2">sepconj_morph_2</a></span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id">H</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Separation logic assertions describing the stack frame at <span class="bracket"><span class="id">sp</span></span>.
  It must contain:
  - the values of the <span class="bracket"><span class="kwd">Local</span></span> stack slots of <span class="bracket"><span class="id">ls</span></span>, as per <span class="bracket"><span class="id">contains_locations</span></span>
  - the values of the <span class="bracket"><span class="id">Outgoing</span></span> stack slots of <span class="bracket"><span class="id">ls</span></span>, as per <span class="bracket"><span class="id">contains_locations</span></span>
  - the <span class="bracket"><span class="id">parent</span></span> pointer representing the back link to the caller's frame
  - the <span class="bracket"><span class="id">retaddr</span></span> pointer representing the saved return address
  - the initial values of the used callee-save registers as given by <span class="bracket"><span class="id">ls0</span></span>,
    as per <span class="bracket"><span class="id">contains_callee_saves</span></span>.
In addition, we use a nonseparating conjunction to record the fact that
we have full access rights on the stack frame, except the part that
represents the Linear stack data. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="frame_contents_1">frame_contents_1</a></span> (<span class="id">j</span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>) (<span class="id">sp</span>: <span class="id"><a href="compcert.common.Values.html#block">block</a></span>) (<span class="id">ls</span> <span class="id">ls0</span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>) (<span class="id">parent</span> <span class="id">retaddr</span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_local">fe_ofs_local</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#bound_local">bound_local</a></span>) <span class="kwd">Local</span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span><br/>
&nbsp;** <span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.x86.Stacklayout.html#fe_ofs_arg">fe_ofs_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#bound_outgoing">bound_outgoing</a></span>) <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span><br/>
&nbsp;** <span class="id"><a href="compcert.common.Separation.html#hasvalue">hasvalue</a></span> <span class="id"><a href="compcert.common.AST.html#Mptr">Mptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_link">fe_ofs_link</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span><br/>
&nbsp;** <span class="id"><a href="compcert.common.Separation.html#hasvalue">hasvalue</a></span> <span class="id"><a href="compcert.common.AST.html#Mptr">Mptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_retaddr">fe_ofs_retaddr</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span><br/>
&nbsp;** <span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves">contains_callee_saves</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_callee_save">fe_ofs_callee_save</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#used_callee_save">used_callee_save</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="frame_contents">frame_contents</a></span> (<span class="id">j</span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>) (<span class="id">sp</span>: <span class="id"><a href="compcert.common.Values.html#block">block</a></span>) (<span class="id">ls</span> <span class="id">ls0</span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>) (<span class="id">parent</span> <span class="id">retaddr</span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#mconj">mconj</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.common.Separation.html#range">range</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> 0 <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span>) **<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#range">range</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span>) + <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#bound_stack_data">bound_stack_data</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_size">fe_size</a></span>)).<br/>
<br/>
<div class="doc">Accessing components of the frame. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="frame_get_local">frame_get_local</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Bounds.html#slot_within_bounds">slot_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="kwd">Local</span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> -&gt; <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span> <span class="kwd">Local</span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#offset_local">offset_local</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="kwd">Local</span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4494')">Proof.</div>
<div class="proofscript" id="proof4494">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>; <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">InvBooleans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#get_location">get_location</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="frame_get_outgoing">frame_get_outgoing</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Bounds.html#slot_within_bounds">slot_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> -&gt; <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#offset_arg">offset_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4495')">Proof.</div>
<div class="proofscript" id="proof4495">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>; <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">InvBooleans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_pick2">sep_pick2</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#get_location">get_location</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="frame_get_parent">frame_get_parent</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_link">fe_ofs_link</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4496')">Proof.</div>
<div class="proofscript" id="proof4496">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_pick3">sep_pick3</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.AST.html#chunk_of_Tptr">chunk_of_Tptr</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#hasvalue_get_stack">hasvalue_get_stack</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="frame_get_retaddr">frame_get_retaddr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_retaddr">fe_ofs_retaddr</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4497')">Proof.</div>
<div class="proofscript" id="proof4497">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_pick4">sep_pick4</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.AST.html#chunk_of_Tptr">chunk_of_Tptr</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#hasvalue_get_stack">hasvalue_get_stack</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Assigning a <span class="bracket"><span class="kwd">Local</span></span> or <span class="bracket"><span class="id">Outgoing</span></span> stack slot. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="frame_set_local">frame_set_local</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Bounds.html#slot_within_bounds">slot_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="kwd">Local</span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> -&gt; <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span> <span class="kwd">Local</span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#offset_local">offset_local</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>)) <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="kwd">Local</span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4498')">Proof.</div>
<div class="proofscript" id="proof4498">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>; <span class="tactic">intros</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">InvBooleans</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#set_location">set_location</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">m</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">i</span> <span class="id">k</span> <span class="id">p</span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m</span> <span class="id">sp</span> <span class="id"><a href="compcert.backend.Stackingproof.html#i">i</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> -&gt; <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m</span>' <span class="id">sp</span> <span class="id"><a href="compcert.backend.Stackingproof.html#i">i</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span>).<br/>
&nbsp;&nbsp;{  <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="kwd">in</span> <span class="id">A</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_store_1">Mem.perm_store_1</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#frame_mconj">frame_mconj</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>; <span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>; <span class="tactic">exact</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_preserved">sep_preserved</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj2">mconj_proj2</a></span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#range_preserved">range_preserved</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#range_preserved">range_preserved</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="frame_set_outgoing">frame_set_outgoing</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Bounds.html#slot_within_bounds">slot_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> -&gt; <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#offset_arg">offset_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>)) <span class="id">v</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'<br/>
&nbsp;&nbsp;/\ <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4499')">Proof.</div>
<div class="proofscript" id="proof4499">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span>. <span class="tactic">intros</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">InvBooleans</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#set_location">set_location</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">m</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">i</span> <span class="id">k</span> <span class="id">p</span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m</span> <span class="id">sp</span> <span class="id"><a href="compcert.backend.Stackingproof.html#i">i</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> -&gt; <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m</span>' <span class="id">sp</span> <span class="id"><a href="compcert.backend.Stackingproof.html#i">i</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span>).<br/>
&nbsp;&nbsp;{  <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="kwd">in</span> <span class="id">A</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">A</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_store_1">Mem.perm_store_1</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#frame_mconj">frame_mconj</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>; <span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_preserved">sep_preserved</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj2">mconj_proj2</a></span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#range_preserved">range_preserved</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#range_preserved">range_preserved</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Invariance by change of location maps. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="frame_contents_exten">frame_contents_exten</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">ls</span>' <span class="id">ls0</span>' <span class="id">j</span> <span class="id">sp</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">P</span> <span class="id">m</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span>, <span class="id"><a href="compcert.common.Values.html#Val.lessdef">Val.lessdef</a></span> (<span class="id">ls</span>' (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="kwd">Local</span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)) (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="kwd">Local</span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>))) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span>, <span class="id"><a href="compcert.common.Values.html#Val.lessdef">Val.lessdef</a></span> (<span class="id">ls</span>' (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)) (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>))) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#used_callee_save">used_callee_save</a></span>) -&gt; <span class="id">ls0</span>' (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) = <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id">ls</span>' <span class="id">ls0</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4500')">Proof.</div>
<div class="proofscript" id="proof4500">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- ! (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations_exten">contains_locations_exten</a></span> <span class="id">ls</span> <span class="id">ls</span>') <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span>  &lt;- <span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves_exten">contains_callee_saves_exten</a></span> <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Invariance by assignment to registers. </div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="frame_set_reg">frame_set_reg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">v</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4501')">Proof.</div>
<div class="proofscript" id="proof4501">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_exten">frame_contents_exten</a></span> <span class="kwd">with</span> <span class="id">ls</span> <span class="id">ls0</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="frame_undef_regs">frame_undef_regs</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span> <span class="id">rl</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4502')">Proof.</div>
<div class="proofscript" id="proof4502">
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id"><a href="compcert.common.Separation.html#sepconj">sepconj</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_set_reg">frame_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="frame_set_regpair">frame_set_regpair</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span> <span class="id">p</span> <span class="id">v</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.setpair">Locmap.setpair</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4503')">Proof.</div>
<div class="proofscript" id="proof4503">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_set_reg">frame_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_set_reg">frame_set_reg</a></span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_set_reg">frame_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="frame_set_res">frame_set_res</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span> <span class="id">res</span> <span class="id">v</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.setres">Locmap.setres</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#res">res</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4504')">Proof.</div>
<div class="proofscript" id="proof4504">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">res</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_set_reg">frame_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Invariance by change of memory injection. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="frame_contents_incr">frame_contents_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">retaddr</span> <span class="id">m</span> <span class="id">P</span> <span class="id">j</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4505')">Proof.</div>
<div class="proofscript" id="proof4505">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations_incr">contains_locations_incr</a></span> <span class="id">j</span> <span class="id">j</span>') <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations_incr">contains_locations_incr</a></span> <span class="id">j</span> <span class="id">j</span>') <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span>  &lt;- <span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves_incr">contains_callee_saves_incr</a></span> <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<h1> Agreement between location sets and Mach states </h1>
<br/>
<div class="doc">Agreement with Mach register states </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="agree_regs">agree_regs</a></span> (<span class="id">j</span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>) (<span class="id">ls</span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>) (<span class="id">rs</span>: <span class="id"><a href="compcert.backend.Mach.html#regset">regset</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) (<span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>).<br/>
<br/>
<div class="doc">Agreement over locations </div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="agree_locs">agree_locs</a></span> (<span class="id">ls</span> <span class="id">ls0</span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="mk_agree_locs">mk_agree_locs</a></span> {<br/>
<br/>
<div class="doc">Unused registers have the same value as in the caller </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="agree_unused_reg">agree_unused_reg</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, ~(<span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) = <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>);<br/>
<br/>
<div class="doc">Incoming stack slots have the same value as the
        corresponding Outgoing stack slots in the caller </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="agree_incoming">agree_incoming</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Incoming">Incoming</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#loc_parameters">loc_parameters</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>.(<span class="id"><a href="compcert.backend.Linear.html#fn_sig">Linear.fn_sig</a></span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Incoming">Incoming</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) = <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)<br/>
}.<br/>
<br/>
<h2> Properties of <span class="bracket"><span class="id">agree_regs</span></span>. </h2>
<br/>
<div class="doc">Values of registers </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_reg">agree_reg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">rs</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) (<span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4506')">Proof.</div>
<div class="proofscript" id="proof4506">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_reglist">agree_reglist</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">rs</span> <span class="id">rl</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject_list">Val.inject_list</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.LTL.html#reglist">reglist</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span>) (<span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>##<span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4507')">Proof.</div>
<div class="proofscript" id="proof4507">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_reg">agree_reg</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">agree_reg</span> <span class="id">agree_reglist</span>: <span class="id">stacking</span>.<br/>
<br/>
<div class="doc">Preservation under assignments of machine registers. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_regs_set_reg">agree_regs_set_reg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">rs</span> <span class="id">r</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#Regmap.set">Regmap.set</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id">v</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4508')">Proof.</div>
<div class="proofscript" id="proof4508">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#Regmap.set">Regmap.set</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Mach.html#RegEq.eq">RegEq.eq</a></span> <span class="id">r0</span> <span class="id">r</span>). <span class="tactic">subst</span> <span class="id">r0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gss">Locmap.gss</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gso">Locmap.gso</a></span>; <span class="tactic">auto</span>. <span class="tactic">red</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_regs_set_pair">agree_regs_set_pair</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">p</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">ls</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.setpair">Locmap.setpair</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#set_pair">set_pair</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id">v</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4509')">Proof.</div>
<div class="proofscript" id="proof4509">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.hiword_inject">Val.hiword_inject</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.loword_inject">Val.loword_inject</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_regs_set_res">agree_regs_set_res</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">res</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">ls</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.setres">Locmap.setres</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#res">res</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#set_res">set_res</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#res">res</a></span> <span class="id">v</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4510')">Proof.</div>
<div class="proofscript" id="proof4510">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">res</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">IHres2</span>. <span class="tactic">apply</span> <span class="id">IHres1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.hiword_inject">Val.hiword_inject</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.loword_inject">Val.loword_inject</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_regs_exten">agree_regs_exten</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">rs</span> <span class="id">ls</span>' <span class="id">rs</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id">ls</span>' (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) = <span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span> \/ <span class="id">ls</span>' (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) = <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) /\ <span class="id">rs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> = <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">ls</span>' <span class="id">rs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4511')">Proof.</div>
<div class="proofscript" id="proof4511">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H0</span> <span class="id">r</span>) <span class="kwd">as</span> [<span class="id">A</span> | [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">rewrite</span> <span class="id">B</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_regs_undef_regs">agree_regs_undef_regs</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">rl</span> <span class="id">ls</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#undef_regs">Mach.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4512')">Proof.</div>
<div class="proofscript" id="proof4512">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_regs_undef_caller_save_regs">agree_regs_undef_caller_save_regs</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.LTL.html#undef_caller_save_regs">LTL.undef_caller_save_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#undef_caller_save_regs">Mach.undef_caller_save_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4513')">Proof.</div>
<div class="proofscript" id="proof4513">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.LTL.html#undef_caller_save_regs">LTL.undef_caller_save_regs</a></span>, <span class="id"><a href="compcert.backend.Mach.html#undef_caller_save_regs">Mach.undef_caller_save_regs</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">r</span>); <span class="tactic">auto</span>. <br/>
Qed.</div>
<br/>
<div class="doc">Preservation under assignment of stack slot </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_regs_set_slot">agree_regs_set_slot</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">rs</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4514')">Proof.</div>
<div class="proofscript" id="proof4514">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gso">Locmap.gso</a></span>; <span class="tactic">auto</span>. <span class="tactic">red</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Preservation by increasing memory injections </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_regs_inject_incr">agree_regs_inject_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">rs</span> <span class="id">j</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt; <span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>' -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4515')">Proof.</div>
<div class="proofscript" id="proof4515">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">stacking</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Preservation at function entry. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_regs_call_regs">agree_regs_call_regs</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">rs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.LTL.html#call_regs">call_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4516')">Proof.</div>
<div class="proofscript" id="proof4516">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.LTL.html#call_regs">call_regs</a></span>; <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> Properties of <span class="bracket"><span class="id">agree_locs</span></span> </h2>
<br/>
<div class="doc">Preservation under assignment of machine register. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_locs_set_reg">agree_locs_set_reg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">r</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4517')">Proof.</div>
<div class="proofscript" id="proof4517">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gso">Locmap.gso</a></span>. <span class="tactic">auto</span>. <span class="tactic">red</span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="caller_save_reg_within_bounds">caller_save_reg_within_bounds</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4518')">Proof.</div>
<div class="proofscript" id="proof4518">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_locs_set_pair">agree_locs_set_pair</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls0</span> <span class="id">p</span> <span class="id">v</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.AST.html#forall_rpair">forall_rpair</a></span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.setpair">Locmap.setpair</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4519')">Proof.</div>
<div class="proofscript" id="proof4519">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#caller_save_reg_within_bounds">caller_save_reg_within_bounds</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#caller_save_reg_within_bounds">caller_save_reg_within_bounds</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#caller_save_reg_within_bounds">caller_save_reg_within_bounds</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_locs_set_res">agree_locs_set_res</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls0</span> <span class="id">res</span> <span class="id">v</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> (<span class="id"><a href="compcert.common.AST.html#params_of_builtin_res">params_of_builtin_res</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#res">res</a></span>) -&gt; <span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.setres">Locmap.setres</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#res">res</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4520')">Proof.</div>
<div class="proofscript" id="proof4520">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">res</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">IHres2</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_locs_undef_regs">agree_locs_undef_regs</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls0</span> <span class="id">regs</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#regs">regs</a></span> -&gt; <span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> (<span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#regs">regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4521')">Proof.</div>
<div class="proofscript" id="proof4521">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">regs</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_locs_undef_locs_1">agree_locs_undef_locs_1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls0</span> <span class="id">regs</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#regs">regs</a></span> -&gt; <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> (<span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#regs">regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4522')">Proof.</div>
<div class="proofscript" id="proof4522">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_regs">agree_locs_undef_regs</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#caller_save_reg_within_bounds">caller_save_reg_within_bounds</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_locs_undef_locs">agree_locs_undef_locs</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls0</span> <span class="id">regs</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#regs">regs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> (<span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#regs">regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4523')">Proof.</div>
<div class="proofscript" id="proof4523">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs_1">agree_locs_undef_locs_1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">r</span>) <span class="id">eqn</span>:<span class="id">CS</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">regs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>. <span class="id">exists</span> <span class="id">r</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Preservation by assignment to local slot </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_locs_set_slot">agree_locs_set_slot</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Lineartyping.html#slot_writable">slot_writable</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4524')">Proof.</div>
<div class="proofscript" id="proof4524">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gso">Locmap.gso</a></span>; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gso">Locmap.gso</a></span>; <span class="tactic">auto</span>. <span class="tactic">red</span>. <span class="id">left</span>. <span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Preservation at return points (when <span class="bracket"><span class="id">ls</span></span> is changed but not <span class="bracket"><span class="id">ls0</span></span>). </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="agree_locs_return">agree_locs_return</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">ls</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#agree_callee_save">agree_callee_save</a></span> <span class="id">ls</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id">ls</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4525')">Proof.</div>
<div class="proofscript" id="proof4525">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">inv</span> <span class="id">H</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
- <span class="tactic">rewrite</span> &lt;- <span class="id">agree_incoming0</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<h2> Properties of destroyed registers. </h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="no_callee_saves">no_callee_saves</a></span> (<span class="id">l</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.x86.Machregs.html#mreg">mreg</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="destroyed_by_op_caller_save">destroyed_by_op_caller_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span>, <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_op">destroyed_by_op</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#op">op</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4526')">Proof.</div>
<div class="proofscript" id="proof4526">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span>; <span class="tactic">destruct</span> <span class="id">op</span>; (<span class="tactic">reflexivity</span> || <span class="tactic">destruct</span> <span class="id">c</span>; <span class="tactic">reflexivity</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="destroyed_by_load_caller_save">destroyed_by_load_caller_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span>, <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_load">destroyed_by_load</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#chunk">chunk</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#addr">addr</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4527')">Proof.</div>
<div class="proofscript" id="proof4527">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span>; <span class="tactic">destruct</span> <span class="id">chunk</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="destroyed_by_store_caller_save">destroyed_by_store_caller_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span>, <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_store">destroyed_by_store</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#chunk">chunk</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#addr">addr</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4528')">Proof.</div>
<div class="proofscript" id="proof4528">
<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_store">destroyed_by_store</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span>, <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_store">destroyed_by_store</a></span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">chunk</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">destruct</span> <span class="id"><a href="compcert.x86_64.Archi.html#ptr64">Archi.ptr64</a></span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="destroyed_by_cond_caller_save">destroyed_by_cond_caller_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cond</span>, <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_cond">destroyed_by_cond</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cond">cond</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4529')">Proof.</div>
<div class="proofscript" id="proof4529">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span>; <span class="tactic">destruct</span> <span class="id">cond</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="destroyed_by_jumptable_caller_save">destroyed_by_jumptable_caller_save</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_jumptable">destroyed_by_jumptable</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4530')">Proof.</div>
<div class="proofscript" id="proof4530">
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="destroyed_by_setstack_caller_save">destroyed_by_setstack_caller_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span>, <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_setstack">destroyed_by_setstack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4531')">Proof.</div>
<div class="proofscript" id="proof4531">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span>; <span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="destroyed_at_function_entry_caller_save">destroyed_at_function_entry_caller_save</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#no_callee_saves">no_callee_saves</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4532')">Proof.</div>
<div class="proofscript" id="proof4532">
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">destroyed_by_op_caller_save</span> <span class="id">destroyed_by_load_caller_save</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destroyed_by_store_caller_save</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destroyed_by_cond_caller_save</span> <span class="id">destroyed_by_jumptable_caller_save</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destroyed_at_function_entry_caller_save</span>: <span class="id">stacking</span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="destroyed_by_setstack_function_entry">destroyed_by_setstack_function_entry</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_setstack">destroyed_by_setstack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4533')">Proof.</div>
<div class="proofscript" id="proof4533">
<span class="kwd">Local</span> <span class="id">Transparent</span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_setstack">destroyed_by_setstack</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span>; <span class="tactic">destruct</span> <span class="id">ty</span>; <span class="tactic">simpl</span>; <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="transl_destroyed_by_op">transl_destroyed_by_op</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">op</span> <span class="id">e</span>, <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_op">destroyed_by_op</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_op">transl_op</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#e">e</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#op">op</a></span>) = <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_op">destroyed_by_op</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#op">op</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4534')">Proof.</div>
<div class="proofscript" id="proof4534">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">op</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="transl_destroyed_by_load">transl_destroyed_by_load</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">e</span>, <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_load">destroyed_by_load</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#chunk">chunk</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_addr">transl_addr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#e">e</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#addr">addr</a></span>) = <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_load">destroyed_by_load</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#chunk">chunk</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#addr">addr</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4535')">Proof.</div>
<div class="proofscript" id="proof4535">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">chunk</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="transl_destroyed_by_store">transl_destroyed_by_store</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">chunk</span> <span class="id">addr</span> <span class="id">e</span>, <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_store">destroyed_by_store</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#chunk">chunk</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_addr">transl_addr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#e">e</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#addr">addr</a></span>) = <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_store">destroyed_by_store</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#chunk">chunk</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#addr">addr</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4536')">Proof.</div>
<div class="proofscript" id="proof4536">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">chunk</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<h1> Correctness of saving and restoring of callee-save registers </h1>
<br/>
<div class="doc">The following lemmas show the correctness of the register saving
  code generated by <span class="bracket"><span class="id">save_callee_save</span></span>: after this code has executed,
  the register save areas of the current frame do contain the
  values of the callee-save registers used by the function. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE">SAVE_CALLEE_SAVE</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.j">j</a></span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.cs">cs</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.backend.Mach.html#stackframe">stackframe</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.vf">vf</a></span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.sp">sp</a></span>: <span class="id"><a href="compcert.common.Values.html#block">block</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls">ls</a></span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>.<br/>
<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls_temp_undef">ls_temp_undef</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_setstack">destroyed_by_setstack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) = <span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span>.<br/>
<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.wt_ls">wt_ls</a></span>: <span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) (<span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="save_callee_save_rec_correct">save_callee_save_rec_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">l</span> <span class="id">pos</span> <span class="id">rs</span> <span class="id">m</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> -&gt; <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.common.Separation.html#range">range</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#size_callee_save_area_rec">size_callee_save_area_rec</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span>) ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span>', <span class="id">exists</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#star">star</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.step">step</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.vf">vf</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#save_callee_save_rec">save_callee_save_rec</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#E0">E0</a></span> (<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.vf">vf</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id">rs</span>' <span class="id">m</span>')<br/>
&nbsp;&nbsp;/\ <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves">contains_callee_saves</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pos">pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls">ls</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span><br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> -&gt; <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span>)<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls">ls</a></span> <span class="id">rs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4537')">Proof.</div>
<div class="proofscript" id="proof4537">
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [ | <span class="id">r</span> <span class="id">l</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">until</span> <span class="id">P</span>; <span class="tactic">intros</span> <span class="id">CS</span> <span class="id">SEP</span> <span class="id">AG</span>.<br/>
- <span class="id">exists</span> <span class="id">rs</span>, <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#star_refl">star_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_pure">sep_pure</a></span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_drop">sep_drop</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
- <span class="tactic">set</span> (<span class="id">ty</span> := <span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span> <span class="id">r</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">sz</span> := <span class="id"><a href="compcert.common.AST.html#typesize">AST.typesize</a></span> <span class="id">ty</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">pos1</span> := <span class="id"><a href="compcert.lib.Coqlib.html#align">align</a></span> <span class="id">pos</span> <span class="id">sz</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SZPOS</span>: <span class="id">sz</span> &gt; 0) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="compcert.common.AST.html#typesize_pos">AST.typesize_pos</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SZREC</span>: <span class="id">pos1</span> + <span class="id">sz</span> &lt;= <span class="id"><a href="compcert.backend.Bounds.html#size_callee_save_area_rec">size_callee_save_area_rec</a></span> <span class="id">l</span> (<span class="id">pos1</span> + <span class="id">sz</span>)) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Bounds.html#size_callee_save_area_rec_incr">size_callee_save_area_rec_incr</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">POS1</span>: <span class="id">pos</span> &lt;= <span class="id">pos1</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#align_le">align_le</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">AL1</span>: (<span class="id"><a href="compcert.common.Memdata.html#align_chunk">align_chunk</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id">ty</span>) | <span class="id">pos1</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">pos1</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide_trans">Z.divide_trans</a></span> <span class="kwd">with</span> <span class="id">sz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sz</span>; <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.backend.Stackingproof.html#size_type_chunk">size_type_chunk</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memdata.html#align_size_chunk_divides">align_size_chunk_divides</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#align_divides">align_divides</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#range_drop_left">range_drop_left</a></span> <span class="kwd">with</span> (<span class="id">mid</span> := <span class="id">pos1</span>) <span class="kwd">in</span> <span class="id">SEP</span>; [ | <span class="tactic">omega</span> ].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#range_split">range_split</a></span> <span class="kwd">with</span> (<span class="id">mid</span> := <span class="id">pos1</span> + <span class="id">sz</span>) <span class="kwd">in</span> <span class="id">SEP</span>; [ | <span class="tactic">omega</span> ].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">sz</span> <span class="tactic">at</span> 1 <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.backend.Stackingproof.html#size_type_chunk">size_type_chunk</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#range_contains">range_contains</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_set_stack">contains_set_stack</a></span> (<span class="kwd">fun</span> <span class="id">v</span>' =&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span>)) <span class="id">v</span>') (<span class="id">rs</span> <span class="id">r</span>)).<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#load_result_inject">load_result_inject</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.wt_ls">wt_ls</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>; <span class="tactic">intros</span> (<span class="id">m1</span> &amp; <span class="id">STORE</span> &amp; <span class="id">SEP</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">rs1</span> := <span class="id"><a href="compcert.backend.Mach.html#undef_regs">undef_regs</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_setstack">destroyed_by_setstack</a></span> <span class="id">ty</span>) <span class="id">rs</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">AG1</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls">ls</a></span> <span class="id">rs1</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">rs1</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_dec">In_dec</a></span> <span class="id"><a href="compcert.x86.Machregs.html#mreg_eq">mreg_eq</a></span> <span class="id">r0</span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_setstack">destroyed_by_setstack</a></span> <span class="id">ty</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE.ls_temp_undef">ls_temp_undef</a></span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Mach.html#undef_regs_other">undef_regs_other</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">AG</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IHl</span> (<span class="id">pos1</span> + <span class="id">sz</span>) <span class="id">rs1</span> <span class="id">m1</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">rs2</span> &amp; <span class="id">m2</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs2</span>, <span class="id">m2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Smallstep.html#star_left">star_left</a></span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>. <span class="tactic">exact</span> <span class="id">STORE</span>. <span class="tactic">auto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span>. <span class="tactic">exact</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">C</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="kwd">in</span> <span class="id">STORE</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">STORE</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_store_1">Mem.perm_store_1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.SAVE_CALLEE_SAVE">SAVE_CALLEE_SAVE</a></span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="LTL_undef_regs_same">LTL_undef_regs_same</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">rl</span> <span class="id">ls</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> -&gt; <span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) = <span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4538')">Proof.</div>
<div class="proofscript" id="proof4538">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Locations.html#Loc.eq">Loc.eq</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">a</span>) (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span>)). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Locations.html#Loc.diff_dec">Loc.diff_dec</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">a</span>) (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHrl</span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="LTL_undef_regs_others">LTL_undef_regs_others</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">rl</span> <span class="id">ls</span>, ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> -&gt; <span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) = <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4539')">Proof.</div>
<div class="proofscript" id="proof4539">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gso">Locmap.gso</a></span>. <span class="tactic">apply</span> <span class="id">IHrl</span>. <span class="tactic">intuition</span>. <span class="tactic">red</span>. <span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="LTL_undef_regs_slot">LTL_undef_regs_slot</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">rl</span> <span class="id">ls</span>, <span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) = <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4540')">Proof.</div>
<div class="proofscript" id="proof4540">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gso">Locmap.gso</a></span>. <span class="tactic">apply</span> <span class="id">IHrl</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="undef_regs_type">undef_regs_type</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ty</span> <span class="id">l</span> <span class="id">rl</span> <span class="id">ls</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> -&gt; <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rl">rl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4541')">Proof.</div>
<div class="proofscript" id="proof4541">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Locations.html#Loc.eq">Loc.eq</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">a</span>) <span class="id">l</span>). <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Locations.html#Loc.diff_dec">Loc.diff_dec</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">a</span>) <span class="id">l</span>); <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="save_callee_save_correct">save_callee_save_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">rs</span> <span class="id">sp</span> <span class="id">cs</span> <span class="id">fb</span> <span class="id">k</span> <span class="id">m</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.common.Separation.html#range">range</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_callee_save">fe_ofs_callee_save</a></span>) (<span class="id"><a href="compcert.backend.Bounds.html#size_callee_save_area">size_callee_save_area</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_callee_save">fe_ofs_callee_save</a></span>)) ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) (<span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#agree_callee_save">agree_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ls1</span> := <span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span> (<span class="id"><a href="compcert.backend.LTL.html#call_regs">LTL.call_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">rs1</span> := <span class="id"><a href="compcert.backend.Mach.html#undef_regs">undef_regs</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span>', <span class="id">exists</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#star">star</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.step">step</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#save_callee_save">save_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs1">rs1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#E0">E0</a></span> (<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id">rs</span>' <span class="id">m</span>')<br/>
&nbsp;&nbsp;/\ <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves">contains_callee_saves</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_ofs_callee_save">fe_ofs_callee_save</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#used_callee_save">used_callee_save</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span><br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> -&gt; <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span>)<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls1">ls1</a></span> <span class="id">rs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4542')">Proof.</div>
<div class="proofscript" id="proof4542">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">P</span>; <span class="tactic">intros</span> <span class="id">SEP</span> <span class="id">TY</span> <span class="id">AGCS</span> <span class="id">AG</span>; <span class="tactic">intros</span> <span class="id">ls1</span> <span class="id">rs1</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#save_callee_save_rec_correct">save_callee_save_rec_correct</a></span> <span class="id">j</span> <span class="id">cs</span> <span class="id">fb</span> <span class="id">sp</span> <span class="id">ls1</span>).<br/>
- <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">ls1</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#LTL_undef_regs_same">LTL_undef_regs_same</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#destroyed_by_setstack_function_entry">destroyed_by_setstack_function_entry</a></span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">ls1</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#undef_regs_type">undef_regs_type</a></span>. <span class="tactic">apply</span> <span class="id">TY</span>.<br/>
- <span class="tactic">exact</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#used_callee_save_prop">used_callee_save_prop</a></span>).<br/>
- <span class="id">eexact</span> <span class="id">SEP</span>.<br/>
- <span class="id">instantiate</span> (1 := <span class="id">rs1</span>). <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_regs">agree_regs_undef_regs</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_call_regs">agree_regs_call_regs</a></span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">clear</span> <span class="id">SEP</span>. <span class="tactic">intros</span> (<span class="id">rs</span>' &amp; <span class="id">m</span>' &amp; <span class="id">EXEC</span> &amp; <span class="id">SEP</span> &amp; <span class="id">PERMS</span> &amp; <span class="id">AG</span>').<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span>', <span class="id">m</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">eexact</span> <span class="id">EXEC</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves_exten">contains_callee_saves_exten</a></span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls0</span> <span class="id">ls1</span>). <span class="tactic">exact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#used_callee_save_prop">used_callee_save_prop</a></span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ls1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#LTL_undef_regs_others">LTL_undef_regs_others</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.LTL.html#call_regs">call_regs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">AGCS</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span>  (<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#destroyed_at_function_entry_caller_save">destroyed_at_function_entry_caller_save</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>. <span class="id">exists</span> <span class="id">r</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">exact</span> <span class="id">PERMS</span>. <span class="tactic">exact</span> <span class="id">AG</span>'.<br/>
Qed.</div>
<br/>
<div class="doc">As a corollary of the previous lemmas, we obtain the following
  correctness theorem for the execution of a function prologue
  (allocation of the frame + saving of the link and return address +
  saving of the used callee-save registers). </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="function_prologue_correct">function_prologue_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">ls1</span> <span class="id">rs</span> <span class="id">rs1</span> <span class="id">m1</span> <span class="id">m1</span>' <span class="id">m2</span> <span class="id">sp</span> <span class="id">parent</span> <span class="id">ra</span> <span class="id">cs</span> <span class="id">fb</span> <span class="id">k</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#agree_callee_save">agree_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Lineartyping.html#agree_outgoing_arguments">agree_outgoing_arguments</a></span> (<span class="id"><a href="compcert.backend.Linear.html#fn_sig">Linear.fn_sig</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) (<span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#ls1">ls1</a></span> = <span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span> (<span class="id"><a href="compcert.backend.LTL.html#call_regs">LTL.call_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#rs1">rs1</a></span> = <span class="id"><a href="compcert.backend.Mach.html#undef_regs">undef_regs</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.alloc">Mem.alloc</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m1">m1</a></span> 0 <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>.(<span class="id"><a href="compcert.backend.Linear.html#fn_stacksize">Linear.fn_stacksize</a></span>) = (<span class="id"><a href="compcert.backend.Stackingproof.html#m2">m2</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> -&gt; <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span> <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">m1</span>' |= <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m1">m1</a></span> ** <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m1">m1</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">j</span>', <span class="id">exists</span> <span class="id">rs</span>', <span class="id">exists</span> <span class="id">m2</span>', <span class="id">exists</span> <span class="id">sp</span>', <span class="id">exists</span> <span class="id">m3</span>', <span class="id">exists</span> <span class="id">m4</span>', <span class="id">exists</span> <span class="id">m5</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.alloc">Mem.alloc</a></span> <span class="id">m1</span>' 0 <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.tf">tf</a></span>.(<span class="id"><a href="compcert.backend.Mach.html#fn_stacksize">fn_stacksize</a></span>) = (<span class="id">m2</span>', <span class="id">sp</span>')<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="id">m2</span>' (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.tf">tf</a></span>.(<span class="id"><a href="compcert.backend.Mach.html#fn_link_ofs">fn_link_ofs</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m3</span>'<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="id">m3</span>' (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.tf">tf</a></span>.(<span class="id"><a href="compcert.backend.Mach.html#fn_retaddr_ofs">fn_retaddr_ofs</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m4</span>'<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Smallstep.html#star">star</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.step">step</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#save_callee_save">save_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs1">rs1</a></span> <span class="id">m4</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#E0">E0</a></span> (<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id">rs</span>' <span class="id">m5</span>')<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ls1">ls1</a></span> <span class="id">rs</span>'<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span><br/>
&nbsp;&nbsp;/\ <span class="id">m5</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id">j</span>' <span class="id">sp</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span> ** <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#m2">m2</a></span> ** <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#m2">m2</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span><br/>
&nbsp;&nbsp;/\ <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id">sp</span>', <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span>))<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>'<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Events.html#inject_separated">inject_separated</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#m1">m1</a></span> <span class="id">m1</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4543')">Proof.</div>
<div class="proofscript" id="proof4543">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">P</span>; <span class="tactic">intros</span> <span class="id">AGREGS</span> <span class="id">AGCS</span> <span class="id">AGARGS</span> <span class="id">WTREGS</span> <span class="id">LS1</span> <span class="id">RS1</span> <span class="id">ALLOC</span> <span class="id">TYPAR</span> <span class="id">TYRA</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#unfold_transf_function">unfold_transf_function</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#fn_stacksize">fn_stacksize</a></span>, <span class="id"><a href="compcert.backend.Mach.html#fn_link_ofs">fn_link_ofs</a></span>, <span class="id"><a href="compcert.backend.Mach.html#fn_retaddr_ofs">fn_retaddr_ofs</a></span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Stack&nbsp;layout&nbsp;info&nbsp;*)</span><br/>
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id"><a href="compcert.backend.Stackingproof.html#b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.x86.Stacklayout.html#frame_env_range">frame_env_range</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>) (<span class="id"><a href="compcert.x86.Stacklayout.html#frame_env_aligned">frame_env_aligned</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>). <span class="tactic">replace</span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>) <span class="kwd">with</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">LAYOUT1</span> <span class="id">LAYOUT2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Allocation&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.alloc">Mem.alloc</a></span> <span class="id">m1</span>' 0 (<span class="id"><a href="compcert.backend.Bounds.html#fe_size">fe_size</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>)) <span class="kwd">as</span> [<span class="id">m2</span>' <span class="id">sp</span>'] <span class="id">eqn</span>:<span class="id">ALLOC</span>'.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#alloc_parallel_rule_2">alloc_parallel_rule_2</a></span>.<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">SEP</span>. <span class="id">eexact</span> <span class="id">ALLOC</span>. <span class="id">eexact</span> <span class="id">ALLOC</span>'.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>). <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> + <span class="id"><a href="compcert.backend.Bounds.html#bound_stack_data">bound_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>). <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max_comm">Z.max_comm</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Bounds.html#bound_stack_data_pos">bound_stack_data_pos</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#size_no_overflow">size_no_overflow</a></span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>. <span class="tactic">intros</span> (<span class="id">j</span>' &amp; <span class="id">SEP</span> &amp; <span class="id">INCR</span> &amp; <span class="id">SAME</span> &amp; <span class="id">INJSEP</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Remember&nbsp;the&nbsp;freeable&nbsp;permissions&nbsp;using&nbsp;a&nbsp;mconj&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SEPCONJ</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m2</span>' |= <span class="id"><a href="compcert.common.Separation.html#mconj">mconj</a></span> (<span class="id"><a href="compcert.common.Separation.html#range">range</a></span> <span class="id">sp</span>' 0 (<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>) ** <span class="id"><a href="compcert.common.Separation.html#range">range</a></span> <span class="id">sp</span>' (<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> + <span class="id"><a href="compcert.backend.Bounds.html#bound_stack_data">bound_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>) (<span class="id"><a href="compcert.backend.Bounds.html#fe_size">fe_size</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.common.Separation.html#range">range</a></span> <span class="id">sp</span>' 0 (<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>) ** <span class="id"><a href="compcert.common.Separation.html#range">range</a></span> <span class="id">sp</span>' (<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> + <span class="id"><a href="compcert.backend.Bounds.html#bound_stack_data">bound_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>) (<span class="id"><a href="compcert.backend.Bounds.html#fe_size">fe_size</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id">j</span>' <span class="id">m2</span> ** <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id">j</span>' <span class="id">m2</span> ** <span class="id">P</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_intro">mconj_intro</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Dividing&nbsp;up&nbsp;the&nbsp;frame&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="compcert.x86.Stacklayout.html#frame_env_separated">frame_env_separated</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>) <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">replace</span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>) <span class="kwd">with</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> <span class="kwd">in</span> <span class="id">SEP</span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Store&nbsp;of&nbsp;parent&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap3">sep_swap3</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="compcert.common.Separation.html#range_contains">range_contains</a></span> <span class="id"><a href="compcert.common.AST.html#Mptr">Mptr</a></span>) <span class="kwd">in</span> <span class="id">SEP</span>; [|<span class="tactic">tauto</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_set_stack">contains_set_stack</a></span> (<span class="kwd">fun</span> <span class="id">v</span>' =&gt; <span class="id">v</span>' = <span class="id">parent</span>) <span class="id">parent</span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) <span class="id">m2</span>' <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.AST.html#chunk_of_Tptr">chunk_of_Tptr</a></span>; <span class="id">eexact</span> <span class="id">SEP</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.load_result_same">Val.load_result_same</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>; <span class="tactic">intros</span> (<span class="id">m3</span>' &amp; <span class="id">STORE_PARENT</span> &amp; <span class="id">SEP</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap3">sep_swap3</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Store&nbsp;of&nbsp;return&nbsp;address&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap4">sep_swap4</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="compcert.common.Separation.html#range_contains">range_contains</a></span> <span class="id"><a href="compcert.common.AST.html#Mptr">Mptr</a></span>) <span class="kwd">in</span> <span class="id">SEP</span>; [|<span class="tactic">tauto</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#contains_set_stack">contains_set_stack</a></span> (<span class="kwd">fun</span> <span class="id">v</span>' =&gt; <span class="id">v</span>' = <span class="id">ra</span>) <span class="id">ra</span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) <span class="id">m3</span>' <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.AST.html#chunk_of_Tptr">chunk_of_Tptr</a></span>; <span class="id">eexact</span> <span class="id">SEP</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.load_result_same">Val.load_result_same</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>; <span class="tactic">intros</span> (<span class="id">m4</span>' &amp; <span class="id">STORE_RETADDR</span> &amp; <span class="id">SEP</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap4">sep_swap4</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Saving&nbsp;callee-save&nbsp;registers&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap5">sep_swap5</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#save_callee_save_correct">save_callee_save_correct</a></span> <span class="id">j</span>' <span class="id">ls</span> <span class="id">ls0</span> <span class="id">rs</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_inject_incr">agree_regs_inject_incr</a></span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span> (<span class="id"><a href="compcert.backend.LTL.html#call_regs">call_regs</a></span> <span class="id">ls</span>)) <span class="kwd">with</span> <span class="id">ls1</span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="compcert.backend.Mach.html#undef_regs">undef_regs</a></span> <span class="id"><a href="compcert.x86.Machregs.html#destroyed_at_function_entry">destroyed_at_function_entry</a></span> <span class="id">rs</span>) <span class="kwd">with</span> <span class="id">rs1</span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>; <span class="tactic">intros</span> (<span class="id">rs2</span> &amp; <span class="id">m5</span>' &amp; <span class="id">SAVE_CS</span> &amp; <span class="id">SEP</span> &amp; <span class="id">PERMS</span> &amp; <span class="id">AGREGS</span>').<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap5">sep_swap5</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Materializing&nbsp;the&nbsp;Local&nbsp;and&nbsp;Outgoing&nbsp;locations&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#initial_locations">initial_locations</a></span> <span class="id">j</span>'). <span class="id">eexact</span> <span class="id">SEP</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="kwd">Local</span>). <span class="id">instantiate</span> (1 := <span class="id">ls1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">LS1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#LTL_undef_regs_slot">LTL_undef_regs_slot</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>; <span class="tactic">intros</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#initial_locations">initial_locations</a></span> <span class="id">j</span>'). <span class="id">eexact</span> <span class="id">SEP</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span>). <span class="id">instantiate</span> (1 := <span class="id">ls1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">LS1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#LTL_undef_regs_slot">LTL_undef_regs_slot</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>; <span class="tactic">intros</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;frame&nbsp;this&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SEPFINAL</span>: <span class="id">m5</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id">j</span>' <span class="id">sp</span>' <span class="id">ls1</span> <span class="id">ls0</span> <span class="id">parent</span> <span class="id">ra</span> ** <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id">j</span>' <span class="id">m2</span> ** <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id">j</span>' <span class="id">m2</span> ** <span class="id">P</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#frame_mconj">frame_mconj</a></span>. <span class="id">eexact</span> <span class="id">SEPCONJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.AST.html#chunk_of_Tptr">chunk_of_Tptr</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span>; <span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>. <span class="tactic">exact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m2</span>' <span class="id">sp</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> -&gt; <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m5</span>' <span class="id">sp</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">PERMS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="kwd">in</span> <span class="id">STORE_PARENT</span>, <span class="id">STORE_RETADDR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">STORE_PARENT</span>, <span class="id">STORE_RETADDR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_store_1">Mem.perm_store_1</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_preserved">sep_preserved</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj2">mconj_proj2</a></span>. <span class="id">eexact</span> <span class="id">SEPCONJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#range_preserved">range_preserved</a></span> <span class="kwd">with</span> <span class="id">m2</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#range_preserved">range_preserved</a></span> <span class="kwd">with</span> <span class="id">m2</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span> <span class="id">SEPCONJ</span>.<br/>
<span class="comment">(*&nbsp;Conclusions&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">j</span>', <span class="id">rs2</span>, <span class="id">m2</span>', <span class="id">sp</span>', <span class="id">m3</span>', <span class="id">m4</span>', <span class="id">m5</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">exact</span> <span class="id">STORE_PARENT</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">exact</span> <span class="id">STORE_RETADDR</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">eexact</span> <span class="id">SAVE_CS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">exact</span> <span class="id">AGREGS</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id">LS1</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs">agree_locs_undef_locs</a></span>; [|<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.LTL.html#call_regs">call_regs</a></span>. <span class="tactic">apply</span> <span class="id">AGCS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.LTL.html#call_regs">call_regs</a></span>. <span class="tactic">apply</span> <span class="id">AGARGS</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#incoming_slot_in_parameters">incoming_slot_in_parameters</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">exact</span> <span class="id">SEPFINAL</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">exact</span> <span class="id">SAME</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">exact</span> <span class="id">INCR</span>. <span class="tactic">exact</span> <span class="id">INJSEP</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The following lemmas show the correctness of the register reloading
  code generated by <span class="bracket"><span class="id">reload_callee_save</span></span>: after this code has executed,
  all callee-save registers contain the same values they had at
  function entry. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE">RESTORE_CALLEE_SAVE</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.j">j</a></span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.cs">cs</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.backend.Mach.html#stackframe">stackframe</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.fb">fb</a></span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.sp">sp</a></span>: <span class="id"><a href="compcert.common.Values.html#block">block</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.ls0">ls0</a></span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.m">m</a></span>: <span class="id"><a href="compcert.common.Memory.html#mem">mem</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="agree_unused">agree_unused</a></span> (<span class="id">ls0</span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>) (<span class="id">rs</span>: <span class="id"><a href="compcert.backend.Mach.html#regset">regset</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, ~(<span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) -&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) (<span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="restore_callee_save_rec_correct">restore_callee_save_rec_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">ofs</span> <span class="id">rs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#contains_callee_saves">contains_callee_saves</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_unused">agree_unused</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> -&gt; <span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#star">star</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.step">step</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#restore_callee_save_rec">restore_callee_save_rec</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.m">m</a></span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#E0">E0</a></span> (<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id">rs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.m">m</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> -&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.ls0">ls0</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) (<span class="id">rs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>))<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">r</span>, ~(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span>) -&gt; <span class="id">rs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> = <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Stackingproof.html#agree_unused">agree_unused</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE.ls0">ls0</a></span> <span class="id">rs</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4544')">Proof.</div>
<div class="proofscript" id="proof4544">
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [ | <span class="id">r</span> <span class="id">l</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="comment">(*&nbsp;base&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span>. <span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#star_refl">star_refl</a></span>.<br/>
- <span class="comment">(*&nbsp;inductive&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ty</span> := <span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span> <span class="id">r</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">sz</span> := <span class="id"><a href="compcert.common.AST.html#typesize">AST.typesize</a></span> <span class="id">ty</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ofs1</span> := <span class="id"><a href="compcert.lib.Coqlib.html#align">align</a></span> <span class="id">ofs</span> <span class="id">sz</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SZPOS</span>: <span class="id">sz</span> &gt; 0) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="compcert.common.AST.html#typesize_pos">AST.typesize_pos</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">OFSLE</span>: <span class="id">ofs</span> &lt;= <span class="id">ofs1</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#align_le">align_le</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">BOUND</span>: <span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span> <span class="id">r</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#contains_get_stack">contains_get_stack</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">v</span> &amp; <span class="id">LOAD</span> &amp; <span class="id">SPEC</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">IHl</span> (<span class="id">ofs1</span> + <span class="id">sz</span>) (<span class="id">rs</span>#<span class="id">r</span> &lt;- <span class="id">v</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Mach.html#Regmap.gso">Regmap.gso</a></span>. <span class="tactic">auto</span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">rs</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Smallstep.html#star_step">star_step</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">exact</span> <span class="id">LOAD</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_dec">In_dec</a></span> <span class="id"><a href="compcert.x86.Machregs.html#mreg_eq">mreg_eq</a></span> <span class="id">r0</span> <span class="id">l</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">r</span> = <span class="id">r0</span>) <span class="tactic">by</span> <span class="tactic">tauto</span>. <span class="tactic">subst</span> <span class="id">r0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">C</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Mach.html#Regmap.gss">Regmap.gss</a></span>. <span class="tactic">exact</span> <span class="id">SPEC</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">C</span> <span class="tactic">by</span> <span class="tactic">tauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Mach.html#Regmap.gso">Regmap.gso</a></span>. <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">D</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.RESTORE_CALLEE_SAVE">RESTORE_CALLEE_SAVE</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="restore_callee_save_correct">restore_callee_save_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">j</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">ls0</span> <span class="id">pa</span> <span class="id">ra</span> <span class="id">P</span> <span class="id">rs</span> <span class="id">k</span> <span class="id">cs</span> <span class="id">fb</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pa">pa</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_unused">agree_unused</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#star">star</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.step">step</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#restore_callee_save">restore_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#E0">E0</a></span> (<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id">rs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>)<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>)) (<span class="id">rs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>))<br/>
&nbsp;&nbsp;/\ (<span class="kwd">forall</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id">rs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span> = <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r">r</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4545')">Proof.</div>
<div class="proofscript" id="proof4545">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_pick5">sep_pick5</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#restore_callee_save_rec_correct">restore_callee_save_rec_correct</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">rs</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">eexact</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In_dec">In_dec</a></span> <span class="id"><a href="compcert.x86.Machregs.html#mreg_eq">mreg_eq</a></span> <span class="id">r</span> (<span class="id"><a href="compcert.backend.Bounds.html#used_callee_save">used_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">B</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">C</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Bounds.html#mreg_within_bounds">mreg_within_bounds</a></span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">C</span>. <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> (<span class="id"><a href="compcert.backend.Bounds.html#used_callee_save_prop">used_callee_save_prop</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.b">b</a></span>) <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">As a corollary, we obtain the following correctness result for
  the execution of a function epilogue (reloading of used callee-save
  registers + reloading of the link and return address + freeing
  of the frame). </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="function_epilogue_correct">function_epilogue_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>' <span class="id">j</span> <span class="id">sp</span>' <span class="id">ls</span> <span class="id">ls0</span> <span class="id">pa</span> <span class="id">ra</span> <span class="id">P</span> <span class="id">m</span> <span class="id">rs</span> <span class="id">sp</span> <span class="id">m1</span> <span class="id">k</span> <span class="id">cs</span> <span class="id">fb</span>,<br/>
&nbsp;&nbsp;<span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pa">pa</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span> ** <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id">sp</span>', <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.free">Mem.free</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> 0 <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.f">f</a></span>.(<span class="id"><a href="compcert.backend.Linear.html#fn_stacksize">Linear.fn_stacksize</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs1</span>, <span class="id">exists</span> <span class="id">m1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id">m</span>' (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.tf">tf</a></span>.(<span class="id"><a href="compcert.backend.Mach.html#fn_link_ofs">fn_link_ofs</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#pa">pa</a></span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id">m</span>' (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.tf">tf</a></span>.(<span class="id"><a href="compcert.backend.Mach.html#fn_retaddr_ofs">fn_retaddr_ofs</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Memory.html#Mem.free">Mem.free</a></span> <span class="id">m</span>' <span class="id">sp</span>' 0 <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.tf">tf</a></span>.(<span class="id"><a href="compcert.backend.Mach.html#fn_stacksize">fn_stacksize</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m1</span>'<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Smallstep.html#star">star</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.step">step</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#restore_callee_save">restore_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES.fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#E0">E0</a></span> (<span class="id"><a href="compcert.backend.Mach.html#State">State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs1">rs1</a></span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.LTL.html#return_regs">return_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs1">rs1</a></span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Conventions.html#agree_callee_save">agree_callee_save</a></span> (<span class="id"><a href="compcert.backend.LTL.html#return_regs">return_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls0">ls0</a></span><br/>
&nbsp;&nbsp;/\ <span class="id">m1</span>' |= <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m1">m1</a></span> ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4546')">Proof.</div>
<div class="proofscript" id="proof4546">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">fb</span>; <span class="tactic">intros</span> <span class="id">SEP</span> <span class="id">AGR</span> <span class="id">AGL</span> <span class="id">INJ</span> <span class="id">FREE</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Can&nbsp;free&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#free_parallel_rule">free_parallel_rule</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj2">mconj_proj2</a></span>. <span class="id">eexact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">FREE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">INJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max_comm">Z.max_comm</a></span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">m1</span>' &amp; <span class="id">FREE</span>' &amp; <span class="id">SEP</span>').<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Reloading&nbsp;the&nbsp;callee-save&nbsp;registers&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#restore_callee_save_correct">restore_callee_save_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">rs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">AGL</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">agree_unused_reg0</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">AGR</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">rs</span>' &amp; <span class="id">LOAD_CS</span> &amp; <span class="id">CS</span> &amp; <span class="id">NCS</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Reloading&nbsp;the&nbsp;back&nbsp;link&nbsp;and&nbsp;return&nbsp;address&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_1">frame_contents_1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#hasvalue_get_stack">hasvalue_get_stack</a></span> <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span>). <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.AST.html#chunk_of_Tptr">chunk_of_Tptr</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_pick3">sep_pick3</a></span>; <span class="id">eexact</span> <span class="id">SEP</span>. <span class="tactic">intros</span> <span class="id">LOAD_LINK</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#hasvalue_get_stack">hasvalue_get_stack</a></span> <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span>). <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.AST.html#chunk_of_Tptr">chunk_of_Tptr</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_pick4">sep_pick4</a></span>; <span class="id">eexact</span> <span class="id">SEP</span>. <span class="tactic">intros</span> <span class="id">LOAD_RETADDR</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Conclusions&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#unfold_transf_function">unfold_transf_function</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">rs</span>', <span class="id">m1</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">red</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.LTL.html#return_regs">return_regs</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">r</span>) <span class="id">eqn</span>:<span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">CS</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">NCS</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">AGR</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">red</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.LTL.html#return_regs">return_regs</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>. <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">auto</span>; <span class="id">contradiction</span>. <br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.FRAME_PROPERTIES">FRAME_PROPERTIES</a></span>.<br/>
<br/>
<h1> Call stack invariants </h1>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT">STEP_CORRECT</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.w">w</a></span> : <span class="id"><a href="compcert.backend.Mach.html#cc_stacking_world">cc_stacking_world</a></span> <span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span>.<br/>
<br/>
<div class="doc">This is the memory assertion that captures the contents of the stack frames
  mentioned in the call stacks. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="stack_contents">stack_contents</a></span> (<span class="id">j</span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>) (<span class="id">cs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.backend.Linear.html#stackframe">Linear.stackframe</a></span>) (<span class="id">cs</span>': <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.backend.Mach.html#stackframe">Mach.stackframe</a></span>) : <span class="id"><a href="compcert.common.Separation.html#massert">massert</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span>, <span class="id">cs</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Linear.html#Stackbase">Linear.Stackbase</a></span> <span class="id">ls</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="compcert.backend.Mach.html#Stackbase">Mach.Stackbase</a></span> <span class="id">_</span> <span class="id">ra</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#contains_init_args">contains_init_args</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_sg">stk_sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">ls</span> (<span class="id"><a href="compcert.backend.Mach.html#stk_m2">stk_m2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#stk_sp2">stk_sp2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Linear.html#Stackframe">Linear.Stackframe</a></span> <span class="id">f</span> <span class="id">_</span> <span class="id">ls</span> <span class="id">c</span> :: <span class="id">cs</span>, <span class="id"><a href="compcert.backend.Mach.html#Stackframe">Mach.Stackframe</a></span> <span class="id">fb</span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id">_</span>) <span class="id">ra</span> <span class="id">c</span>' :: <span class="id">cs</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id">f</span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">sp</span>' <span class="id">ls</span> (<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') (<span class="id"><a href="compcert.backend.Mach.html#parent_ra">parent_ra</a></span> <span class="id">cs</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>'<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="compcert.common.Separation.html#pure">pure</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">match_stacks</span></span> captures additional properties (not related to memory)
  of the Linear and Mach call stacks. Note that the <span class="bracket"><span class="id">signature</span></span>
  argument corresponds to the function which is currently executing,
  or the callee in the case of a <span class="bracket"><span class="id">Callstate</span></span> or <span class="bracket"><span class="id">Returnstate</span></span>, whereas
  the frames correspond to the suspended functions. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="match_stacks">match_stacks</a></span> (<span class="id">j</span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.backend.Linear.html#stackframe">Linear.stackframe</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.backend.Mach.html#stackframe">stackframe</a></span> -&gt; <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="match_stacks_base">match_stacks_base</a></span>: <span class="kwd">forall</span> <span class="id">ra</span> <span class="id">sg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TY_SP</span>: <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_sp2">stk_sp2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TY_RA</span>: <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span> <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> = <span class="id"><a href="compcert.backend.Mach.html#stk_sg">stk_sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span> \/ <span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible">tailcall_possible</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.Inject.html#injw_next_r">injw_next_r</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) = <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_m2">stk_m2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b1</span> <span class="id">b2</span> <span class="id">delta</span>, <span class="id"><a href="compcert.cklr.Inject.html#injw_meminj">injw_meminj</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#b1">b1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#b1">b1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#b2">b2</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#delta">delta</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.Inject.html#injw_next_l">injw_next_l</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#b1">b1</a></span> /\ <span class="id"><a href="compcert.cklr.Inject.html#injw_next_r">injw_next_r</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#b2">b2</a></span>)%<span class="id">positive</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Linear.html#Stackbase">Linear.Stackbase</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#initial_regs">initial_regs</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_sg">stk_sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#stk_ls1">stk_ls1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>)) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#Stackbase">Stackbase</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_sp2">stk_sp2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="match_stacks_cons">match_stacks_cons</a></span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">ls</span> <span class="id">c</span> <span class="id">cs</span> <span class="id">fb</span> <span class="id">sp</span>' <span class="id">ra</span> <span class="id">c</span>' <span class="id">cs</span>' <span class="id">sg</span> <span class="id">trf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TAIL</span>: <span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> (<span class="id"><a href="compcert.backend.Linear.html#fn_code">Linear.fn_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FINDF</span>: <span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_funct">Genv.find_funct</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.common.AST.html#Internal">Internal</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#trf">trf</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TRF</span>: <span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#trf">trf</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TRC</span>: <span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> = <span class="id">c</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJ</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id">sp</span>', (<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>)))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TY_RA</span>: <span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span> <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGL</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ARGS</span>: <span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Bounds.html#slot_within_bounds">slot_within_bounds</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>) <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SZA</span>: <span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> &lt;= <span class="id"><a href="compcert.backend.Bounds.html#bound_outgoing">bound_outgoing</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STK</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' (<span class="id"><a href="compcert.backend.Linear.html#fn_sig">Linear.fn_sig</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Linear.html#Stackframe">Linear.Stackframe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> :: <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#Stackframe">Stackframe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#ra">ra</a></span> <span class="id">c</span>' :: <span class="id">cs</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span>.<br/>
<br/>
<div class="doc">Invariance with respect to change of memory injection. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="contains_init_args_incr">contains_init_args_incr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sg</span> <span class="id">j</span> <span class="id">j</span>' <span class="id">ls</span> <span class="id">m0</span> <span class="id">sp</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#massert_imp">massert_imp</a></span> (<span class="id"><a href="compcert.backend.Mach.html#contains_init_args">contains_init_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m0">m0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#contains_init_args">contains_init_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m0">m0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4547')">Proof.</div>
<div class="proofscript" id="proof4547">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">m</span> (<span class="id">UNCH</span> &amp; <span class="id">PERM</span> &amp; <span class="id">ARGS</span>).<br/>
&nbsp;&nbsp;<span class="id">cbn</span>; <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">REG</span>. <span class="id">edestruct</span> <span class="id">ARGS</span> <span class="kwd">as</span> (? &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="stack_contents_change_meminj">stack_contents_change_meminj</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span> <span class="id">j</span> <span class="id">j</span>', <span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4548')">Proof.</div>
<div class="proofscript" id="proof4548">
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id"><a href="compcert.common.Separation.html#sepconj">sepconj</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">cs</span> <span class="kwd">as</span> [ | [] <span class="id">cs</span>]; <span class="tactic">destruct</span> <span class="id">cs</span>' <span class="kwd">as</span> [ | [] <span class="id">cs</span>']; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">sp0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_incr">frame_contents_incr</a></span> <span class="kwd">with</span> (<span class="id">j</span> := <span class="id">j</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span>. <span class="tactic">apply</span> <span class="id">IHcs</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span>. <span class="tactic">assumption</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">cs</span>, <span class="id">cs</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="compcert.backend.Stackingproof.html#contains_init_args_incr">contains_init_args_incr</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="match_stacks_change_meminj">match_stacks_change_meminj</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">j</span>' <span class="id">m</span> <span class="id">m</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#inject_separated">inject_separated</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.le">Pos.le</a></span> (<span class="id"><a href="compcert.cklr.Inject.html#injw_next_l">injw_next_l</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>)) (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.le">Pos.le</a></span> (<span class="id"><a href="compcert.cklr.Inject.html#injw_next_r">injw_next_r</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>)) (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">m</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">sg</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id">j</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4549')">Proof.</div>
<div class="proofscript" id="proof4549">
&nbsp;&nbsp;<span class="tactic">induction</span> 5; <span class="tactic">intros</span>.<br/>
- <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Values.html#inject_incr_trans">inject_incr_trans</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">j</span> <span class="id">b1</span>) <span class="kwd">as</span> [[<span class="id">xb2</span> <span class="id">xdelta</span>] | ] <span class="id">eqn</span>:<span class="id">Hb1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H8</span>; <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">H8</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">edestruct</span> <span class="id">H0</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span> <span class="kwd">in</span> *. <span class="id">xomega</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="stack_contents_nextblock">stack_contents_nextblock</a></span> <span class="id">m</span> <span class="id">j</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">sg</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.le">Pos.le</a></span> (<span class="id"><a href="compcert.cklr.Inject.html#injw_next_r">injw_next_r</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>)) (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4550')">Proof.</div>
<div class="proofscript" id="proof4550">
&nbsp;&nbsp;<span class="tactic">induction</span> 2.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_nextblock">Mem.unchanged_on_nextblock</a></span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHmatch_stacks</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Invariance with respect to change of signature. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="match_stacks_change_sig">match_stacks_change_sig</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sg1</span> <span class="id">j</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">sg</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible">tailcall_possible</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg1">sg1</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg1">sg1</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4551')">Proof.</div>
<div class="proofscript" id="proof4551">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">elim</span> (<span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible_reg">tailcall_possible_reg</a></span> <span class="id">_</span> <span class="id">H0</span> <span class="id">_</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments_above">size_arguments_above</a></span> <span class="id">sg</span>). <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Typing properties of <span class="bracket"><span class="id">match_stacks</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="match_stacks_type_sp">match_stacks_type_sp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">sg</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4552')">Proof.</div>
<div class="proofscript" id="proof4552">
&nbsp;&nbsp;<span class="tactic">destruct</span> 1; <span class="tactic">auto</span>; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="match_stacks_type_retaddr">match_stacks_type_retaddr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">sg</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="compcert.backend.Mach.html#parent_ra">parent_ra</a></span> <span class="id">cs</span>') <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4553')">Proof.</div>
<div class="proofscript" id="proof4553">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#parent_ra">parent_ra</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Accessing the parent's outgoing locations </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_stack_arg">load_stack_arg</a></span> <span class="id">m</span> <span class="id">j</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">sg</span> <span class="id">ty</span> <span class="id">ofs</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#offset_arg">offset_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4554')">Proof.</div>
<div class="proofscript" id="proof4554">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">REG</span> <span class="id">MS</span> <span class="id">SEP</span>. <span class="tactic">destruct</span> <span class="id">MS</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [? | <span class="id">TCP</span>]; [<span class="tactic">subst</span> | <span class="tactic">elim</span> (<span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible_reg">tailcall_possible_reg</a></span> <span class="id">_</span> <span class="id">TCP</span> <span class="id">_</span> <span class="id">REG</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">SEP</span> <span class="kwd">as</span> (<span class="id">UNCH</span> &amp; <span class="id">FITS</span> &amp; <span class="id">ARGS</span>), <span class="id">ARGS</span> <span class="kwd">as</span> (<span class="id">v</span> &amp; <span class="id">Hload</span> &amp; <span class="id">Hv</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_get_outgoing">frame_get_outgoing</a></span>; <span class="tactic">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Conventions.html#loc_arguments_acceptable_2">loc_arguments_acceptable_2</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">REG</span>) <span class="kwd">as</span> [? ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span>, <span class="id"><a href="compcert.lib.Coqlib.html#proj_sumbool">proj_sumbool</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zle_true">zle_true</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#pred_dec_true">pred_dec_true</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="match_stacks_range_perm_args">match_stacks_range_perm_args</a></span> <span class="id">m</span> <span class="id">j</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">sg</span> <span class="id">sb</span> <span class="id">sofs</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>' = <span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sb">sb</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sofs">sofs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sb">sb</a></span> (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sofs">sofs</a></span> 0) (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sofs">sofs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span>)) <span class="id"><a href="compcert.common.Memtype.html#Cur">Cur</a></span> <span class="id"><a href="compcert.common.Memtype.html#Freeable">Freeable</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4555')">Proof.</div>
<div class="proofscript" id="proof4555">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">MS</span> <span class="id">SEP</span> <span class="id">SP</span>. <span class="tactic">destruct</span> <span class="id">MS</span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">SP</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">SEP</span> <span class="kwd">as</span> (? &amp; <span class="id">PERM</span> &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [? | <span class="id">Hsg</span>]; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> 0 (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_sg">stk_sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">edestruct</span> <span class="id">PERM</span> <span class="kwd">as</span> (<span class="id">sb</span>' &amp; <span class="id">sofs</span>' &amp; <span class="id">Hsp</span> &amp; <span class="id">PERM</span>' &amp; <span class="id">FITS</span>). <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">Hsp</span>. <span class="id">inv</span> <span class="id">Hsp</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intro</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">Hsg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="tactic">intro</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">SEP</span> <span class="kwd">as</span> (<span class="id">_</span> &amp; ? &amp; ? &amp; <span class="id">PERM</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ofs</span> <span class="id">Hofs</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> <span class="id">Hofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_zero_l">Ptrofs.add_zero_l</a></span>, <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.unsigned_repr">Ptrofs.unsigned_repr</a></span> <span class="kwd">in</span> <span class="id">Hofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">PERM</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="match_stacks_args_fit">match_stacks_args_fit</a></span> <span class="id">m</span> <span class="id">j</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">sg</span> <span class="id">ofs</span> <span class="id">sb</span> <span class="id">sofs</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>' = <span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sb">sb</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sofs">sofs</a></span> -&gt;<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> &lt; <span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#offset_fits">offset_fits</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sofs">sofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4556')">Proof.</div>
<div class="proofscript" id="proof4556">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">MS</span> <span class="id">SEP</span> <span class="id">SP</span> <span class="id">OFS</span>. <span class="tactic">red</span>. <span class="tactic">destruct</span> <span class="id">MS</span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="id">inv</span> <span class="id">SP</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [? | <span class="id">Hsg</span>]; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">edestruct</span> <span class="id">SEP</span> <span class="kwd">as</span> (? &amp; <span class="id">HH</span> &amp; ?), <span class="id">HH</span> <span class="kwd">as</span> (<span class="id">sb</span>' &amp; <span class="id">sofs</span>' &amp; <span class="id">Hsp</span> &amp; <span class="id">PERM</span> &amp; <span class="id">FITS</span>). <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span> <span class="kwd">in</span> <span class="id">Hsp</span>. <span class="id">inv</span> <span class="id">Hsp</span>. <span class="tactic">apply</span> <span class="id">FITS</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">Hsg</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#mconj_proj1">mconj_proj1</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="comment">(*&nbsp;split;&nbsp;try&nbsp;xomega.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">SEP</span> <span class="kwd">as</span> (<span class="id">_</span> &amp; ? &amp; ? &amp; <span class="id">_</span> &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_zero_l">Ptrofs.add_zero_l</a></span>, !<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.unsigned_repr">Ptrofs.unsigned_repr</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span>; <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="match_stacks_init_args">match_stacks_init_args</a></span> <span class="id">j</span> <span class="id">cs</span> <span class="id">cs</span>' <span class="id">sg</span> <span class="id">m</span> <span class="id">P</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.backend.Mach.html#contains_init_args">contains_init_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') ** <span class="id"><a href="compcert.backend.Stackingproof.html#P">P</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4557')">Proof.</div>
<div class="proofscript" id="proof4557">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">MS</span> <span class="id">SEP</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">pose</span> <span class="id">proof</span> <span class="id">MS</span> <span class="kwd">as</span> <span class="id">MS</span>'. <span class="tactic">destruct</span> <span class="id">MS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">SEP</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">decompose</span> [<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#and">and</a></span>] <span class="id">SEP</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_refl">Mem.unchanged_on_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? ? <span class="id">REG</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible_reg">tailcall_possible_reg</a></span> <span class="kwd">in</span> <span class="id">REG</span>; <span class="tactic">auto</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cbn</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_refl">Mem.unchanged_on_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">Hsz</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">_</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eauto</span> 10 <span class="kwd">using</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_range_perm_args">match_stacks_range_perm_args</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_args_fit">match_stacks_args_fit</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">REG</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.backend.Stackingproof.html#load_stack_arg">load_stack_arg</a></span> <span class="kwd">as</span> (? &amp; ? &amp; ?); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span>. <span class="tactic">destruct</span> <span class="id">SEP</span> <span class="kwd">as</span> (<span class="id">SEP</span> &amp; <span class="id">_</span> &amp; <span class="id">DISJ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Hofs</span> <span class="id">Hofs</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">MS</span>; <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hofs</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hofs</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">DISJ</span>; <span class="tactic">eauto</span>. <span class="id">left</span>. <span class="id">left</span>. <span class="id">right</span>. <span class="id">left</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span> [<span class="id">m_footprint</span> <span class="id">contains_locations</span> <span class="id">function_bounds</span> <span class="id">bound_outgoing</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_zero_l">Ptrofs.add_zero_l</a></span>, <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.unsigned_repr">Ptrofs.unsigned_repr</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eassert</span> (<span class="id">H</span> : <span class="id">m</span> |= <span class="id"><a href="compcert.backend.Stackingproof.html#contains_locations">contains_locations</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="compcert.x86.Stacklayout.html#fe_ofs_arg">fe_ofs_arg</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="tactic">by</span> <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.max_unsigned">Ptrofs.max_unsigned</a></span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<h1> Syntactic properties of the translation </h1>
<br/>
<div class="doc">Preservation of code labels through the translation. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.LABELS">LABELS</a></span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="find_label_save_callee_save">find_label_save_callee_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">lbl</span> <span class="id">l</span> <span class="id">ofs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#find_label">Mach.find_label</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#lbl">lbl</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#save_callee_save_rec">save_callee_save_rec</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>) = <span class="id"><a href="compcert.backend.Mach.html#find_label">Mach.find_label</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#lbl">lbl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4558')">Proof.</div>
<div class="proofscript" id="proof4558">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="find_label_restore_callee_save">find_label_restore_callee_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">lbl</span> <span class="id">l</span> <span class="id">ofs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#find_label">Mach.find_label</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#lbl">lbl</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#restore_callee_save_rec">restore_callee_save_rec</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>) = <span class="id"><a href="compcert.backend.Mach.html#find_label">Mach.find_label</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#lbl">lbl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4559')">Proof.</div>
<div class="proofscript" id="proof4559">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transl_code_eq">transl_code_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fe</span> <span class="id">i</span> <span class="id">c</span>, <span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#i">i</a></span> :: <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>) = <span class="id"><a href="compcert.backend.Stacking.html#transl_instr">transl_instr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#i">i</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4560')">Proof.</div>
<div class="proofscript" id="proof4560">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#list_fold_right_eq">list_fold_right_eq</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="find_label_transl_code">find_label_transl_code</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fe</span> <span class="id">lbl</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#find_label">Mach.find_label</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#lbl">lbl</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Coqlib.html#option_map">option_map</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span>) (<span class="id"><a href="compcert.backend.Linear.html#find_label">Linear.find_label</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#lbl">lbl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4561')">Proof.</div>
<div class="proofscript" id="proof4561">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">c</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_code_eq">transl_code_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transl_instr">transl_instr</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#restore_callee_save">restore_callee_save</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#find_label_restore_callee_save">find_label_restore_callee_save</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">lbl</span> <span class="id">l</span>). <span class="tactic">reflexivity</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#restore_callee_save">restore_callee_save</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#find_label_restore_callee_save">find_label_restore_callee_save</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transl_find_label">transl_find_label</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">tf</span> <span class="id">lbl</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Linear.html#find_label">Linear.find_label</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#lbl">lbl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>.(<span class="id"><a href="compcert.backend.Linear.html#fn_code">Linear.fn_code</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#find_label">Mach.find_label</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#lbl">lbl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span>.(<span class="id"><a href="compcert.backend.Mach.html#fn_code">Mach.fn_code</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4562')">Proof.</div>
<div class="proofscript" id="proof4562">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#unfold_transf_function">unfold_transf_function</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).  <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transl_body">transl_body</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#save_callee_save">save_callee_save</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#find_label_save_callee_save">find_label_save_callee_save</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#find_label_transl_code">find_label_transl_code</a></span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.LABELS">LABELS</a></span>.<br/>
<br/>
<div class="doc">Code tail property for Linear executions. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="find_label_tail">find_label_tail</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">lbl</span> <span class="id">c</span> <span class="id">c</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Linear.html#find_label">Linear.find_label</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#lbl">lbl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">c</span>' -&gt; <span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> <span class="id">c</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4563')">Proof.</div>
<div class="proofscript" id="proof4563">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">c</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">c</span>'. <span class="tactic">case</span> (<span class="id"><a href="compcert.backend.Linear.html#is_label">Linear.is_label</a></span> <span class="id">lbl</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">injection</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">c</span>'. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Code tail property for translations </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="is_tail_save_callee_save">is_tail_save_callee_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">ofs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#save_callee_save_rec">save_callee_save_rec</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4564')">Proof.</div>
<div class="proofscript" id="proof4564">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="is_tail_restore_callee_save">is_tail_restore_callee_save</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">ofs</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#restore_callee_save_rec">restore_callee_save_rec</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4565')">Proof.</div>
<div class="proofscript" id="proof4565">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="is_tail_transl_instr">is_tail_transl_instr</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fe</span> <span class="id">i</span> <span class="id">k</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_instr">transl_instr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#i">i</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#k">k</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4566')">Proof.</div>
<div class="proofscript" id="proof4566">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transl_instr">transl_instr</a></span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#restore_callee_save">restore_callee_save</a></span>.  <span class="tactic">eapply</span> <span class="id"><a href="compcert.lib.Coqlib.html#is_tail_trans">is_tail_trans</a></span>. 2: <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#is_tail_restore_callee_save">is_tail_restore_callee_save</a></span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#restore_callee_save">restore_callee_save</a></span>.  <span class="tactic">eapply</span> <span class="id"><a href="compcert.lib.Coqlib.html#is_tail_trans">is_tail_trans</a></span>. 2: <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#is_tail_restore_callee_save">is_tail_restore_callee_save</a></span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="is_tail_transl_code">is_tail_transl_code</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fe</span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c1">c1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c2">c2</a></span> -&gt; <span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c1">c1</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c2">c2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4567')">Proof.</div>
<div class="proofscript" id="proof4567">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>. <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_code_eq">transl_code_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.lib.Coqlib.html#is_tail_trans">is_tail_trans</a></span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#is_tail_transl_instr">is_tail_transl_instr</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="is_tail_transf_function">is_tail_transf_function</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">tf</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> (<span class="id"><a href="compcert.backend.Linear.html#fn_code">Linear.fn_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#fn_code">fn_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4568')">Proof.</div>
<div class="proofscript" id="proof4568">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#unfold_transf_function">unfold_transf_function</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>). <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transl_body">transl_body</a></span>, <span class="id"><a href="compcert.backend.Stacking.html#save_callee_save">save_callee_save</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.lib.Coqlib.html#is_tail_trans">is_tail_trans</a></span>. 2: <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#is_tail_save_callee_save">is_tail_save_callee_save</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#is_tail_transl_code">is_tail_transl_code</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h1> Semantic preservation </h1>
<br/>
<div class="doc">Preservation / translation of global symbols and functions. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="symbols_preserved">symbols_preserved</a></span> (<span class="id">j</span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Globalenvs.html#Genv.match_stbls">Genv.match_stbls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>: <span class="id"><a href="compcert.common.AST.html#ident">ident</a></span>) (<span class="id">b</span>: <span class="id"><a href="compcert.common.Values.html#block">block</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#b">b</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tb</span>, <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#b">b</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#tb">tb</a></span>, 0) /\ <span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_symbol">Genv.find_symbol</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#s">s</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tb">tb</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4569')">Proof.</div>
<div class="proofscript" id="proof4569">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_symbol_match">Genv.find_symbol_match</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="functions_translated">functions_translated</a></span> (<span class="id">j</span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Globalenvs.html#Genv.match_stbls">Genv.match_stbls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">tv</span> <span class="id">f</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_funct">Genv.find_funct</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> -&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tv">tv</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tf</span>, <span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_funct">Genv.find_funct</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tv">tv</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span> /\ <span class="id"><a href="compcert.backend.Stacking.html#transf_fundef">transf_fundef</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4570')">Proof.</div>
<div class="proofscript" id="proof4570">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> (<span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_funct_transf_partial">Genv.find_funct_transf_partial</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.TRANSF">TRANSF</a></span>); <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sig_preserved">sig_preserved</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span> <span class="id">tf</span>, <span class="id"><a href="compcert.backend.Stacking.html#transf_fundef">transf_fundef</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span> -&gt; <span class="id"><a href="compcert.backend.Mach.html#funsig">Mach.funsig</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span> = <span class="id"><a href="compcert.backend.Linear.html#funsig">Linear.funsig</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4571')">Proof.</div>
<div class="proofscript" id="proof4571">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">tf</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transf_fundef">transf_fundef</a></span>, <span class="id"><a href="compcert.common.AST.html#transf_partial_fundef">transf_partial_fundef</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">f</span>; <span class="tactic">intros</span>; <span class="id">monadInv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#unfold_transf_function">unfold_transf_function</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">EQ</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="find_function_translated">find_function_translated</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">rs</span> <span class="id">m1</span> <span class="id">m</span> <span class="id">ros</span> <span class="id">f</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> |= <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m1">m1</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_funct">Genv.find_funct</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> (<span class="id"><a href="compcert.backend.Linear.html#ros_address">Linear.ros_address</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ros">ros</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">tf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_funct">Genv.find_funct</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span> (<span class="id"><a href="compcert.backend.Mach.html#ros_address">ros_address</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ros">ros</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span><br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.backend.Stacking.html#transf_fundef">transf_fundef</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4572')">Proof.</div>
<div class="proofscript" id="proof4572">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">until</span> <span class="id">f</span>; <span class="tactic">intros</span> <span class="id">AG</span> [??] <span class="id">FF</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#functions_translated">functions_translated</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.x86.Op.html#symbol_address_inject">symbol_address_inject</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Preservation of the arguments to an external call. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS">EXTERNAL_ARGUMENTS</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.j">j</a></span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.cs">cs</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.backend.Linear.html#stackframe">Linear.stackframe</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id">cs</span>': <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="compcert.backend.Mach.html#stackframe">stackframe</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.sg">sg</a></span>: <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>.<br/>
<span class="kwd">Variables</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.bound">bound</a></span> <span class="id">bound</span>': <span class="id"><a href="compcert.common.Values.html#block">block</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.MS">MS</a></span>: <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.sg">sg</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.ls">ls</a></span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.rs">rs</a></span>: <span class="id"><a href="compcert.backend.Mach.html#regset">regset</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.AGR">AGR</a></span>: <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.rs">rs</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.AGCS">AGCS</a></span>: <span class="id"><a href="compcert.backend.Conventions.html#agree_callee_save">agree_callee_save</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.ls">ls</a></span> (<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.cs">cs</a></span>).<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.AGARGS">AGARGS</a></span>: <span class="id"><a href="compcert.backend.Lineartyping.html#agree_outgoing_arguments">agree_outgoing_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.ls">ls</a></span> (<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.cs">cs</a></span>).<br/>
<span class="kwd">Variable</span> <span class="id">m</span>': <span class="id"><a href="compcert.common.Memory.html#mem">mem</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.SEP">SEP</a></span>: <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.cs">cs</a></span> <span class="id">cs</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transl_external_argument">transl_external_argument</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.sg">sg</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>, <span class="id"><a href="compcert.backend.Mach.html#extcall_arg">extcall_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.rs">rs</a></span> <span class="id">m</span>' (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> /\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.j">j</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4573')">Proof.</div>
<div class="proofscript" id="proof4573">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_argument_acceptable">loc_argument_acceptable</a></span> <span class="id">l</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_arguments_acceptable_2">loc_arguments_acceptable_2</a></span> <span class="kwd">with</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.sg">sg</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
- <span class="id">exists</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.rs">rs</a></span> <span class="id">r</span>); <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.AGARGS">AGARGS</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.backend.Stackingproof.html#load_stack_arg">load_stack_arg</a></span> <span class="kwd">as</span> (<span class="id">v</span> &amp; <span class="id">LOAD</span> &amp; <span class="id">INJ</span>); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.backend.Mach.html#extcall_arg_stack">extcall_arg_stack</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transl_external_argument_2">transl_external_argument_2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.sg">sg</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>, <span class="id"><a href="compcert.backend.Mach.html#extcall_arg_pair">extcall_arg_pair</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.rs">rs</a></span> <span class="id">m</span>' (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> /\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.j">j</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4574')">Proof.</div>
<div class="proofscript" id="proof4574">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">p</span> <span class="kwd">as</span> [<span class="id">l</span> | <span class="id">l1</span> <span class="id">l2</span>].<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#transl_external_argument">transl_external_argument</a></span> <span class="id">l</span>) <span class="kwd">as</span> (<span class="id">v</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.AST.html#in_regs_of_rpairs">in_regs_of_rpairs</a></span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#transl_external_argument">transl_external_argument</a></span> <span class="id">l1</span>) <span class="kwd">as</span> (<span class="id">v1</span> &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>). <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.AST.html#in_regs_of_rpairs">in_regs_of_rpairs</a></span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#transl_external_argument">transl_external_argument</a></span> <span class="id">l2</span>) <span class="kwd">as</span> (<span class="id">v2</span> &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>). <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.AST.html#in_regs_of_rpairs">in_regs_of_rpairs</a></span>; <span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.common.Values.html#Val.longofwords">Val.longofwords</a></span> <span class="id">v1</span> <span class="id">v2</span>); <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.longofwords_inject">Val.longofwords_inject</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transl_external_arguments_rec">transl_external_arguments_rec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">locs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#locs">locs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.sg">sg</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Coqlib.html#list_forall2">list_forall2</a></span> (<span class="id"><a href="compcert.backend.Mach.html#extcall_arg_pair">extcall_arg_pair</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.rs">rs</a></span> <span class="id">m</span>' (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>')) <span class="id"><a href="compcert.backend.Stackingproof.html#locs">locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#vl">vl</a></span><br/>
&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject_list">Val.inject_list</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.j">j</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#locs">locs</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#vl">vl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4575')">Proof.</div>
<div class="proofscript" id="proof4575">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">locs</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="compcert.common.Values.html#val">val</a></span>); <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_external_argument_2">transl_external_argument_2</a></span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>. <span class="tactic">intros</span> [<span class="id">v</span> [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHlocs</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>. <span class="tactic">intros</span> [<span class="id">vl</span> [<span class="id">C</span> <span class="id">D</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">v</span> :: <span class="id">vl</span>); <span class="tactic">split</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transl_external_arguments">transl_external_arguments</a></span>:<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vl</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#extcall_arguments">extcall_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.rs">rs</a></span> <span class="id">m</span>' (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#vl">vl</a></span><br/>
&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject_list">Val.inject_list</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.j">j</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#p">p</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.ls">ls</a></span>) (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS.sg">sg</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#vl">vl</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4576')">Proof.</div>
<div class="proofscript" id="proof4576">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#extcall_arguments">extcall_arguments</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_external_arguments_rec">transl_external_arguments_rec</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.EXTERNAL_ARGUMENTS">EXTERNAL_ARGUMENTS</a></span>.<br/>
<br/>
<div class="doc">Preservation of the arguments to a builtin. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS">BUILTIN_ARGUMENTS</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.f">f</a></span>: <span class="id"><a href="compcert.backend.Linear.html#function">Linear.function</a></span>.<br/>
<span class="kwd">Let</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.b">b</a></span> := <span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.f">f</a></span>.<br/>
<span class="kwd">Let</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.fe">fe</a></span> := <span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.b">b</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.tf">tf</a></span>: <span class="id"><a href="compcert.backend.Mach.html#function">Mach.function</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.TRANSF_F">TRANSF_F</a></span>: <span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.tf">tf</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.j">j</a></span>: <span class="id"><a href="compcert.common.Values.html#meminj">meminj</a></span>.<br/>
<span class="kwd">Variables</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.m">m</a></span> <span class="id">m</span>': <span class="id"><a href="compcert.common.Memory.html#mem">mem</a></span>.<br/>
<span class="kwd">Variables</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.ls">ls</a></span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.ls0">ls0</a></span>: <span class="id"><a href="compcert.backend.Linear.html#locset">locset</a></span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.rs">rs</a></span>: <span class="id"><a href="compcert.backend.Mach.html#regset">regset</a></span>.<br/>
<span class="kwd">Variables</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.sp">sp</a></span> <span class="id">sp</span>': <span class="id"><a href="compcert.common.Values.html#block">block</a></span>.<br/>
<span class="kwd">Variables</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.parent">parent</a></span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.retaddr">retaddr</a></span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.INJ">INJ</a></span>: <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.sp">sp</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id">sp</span>', <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.fe">fe</a></span>.(<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span>)).<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.AGR">AGR</a></span>: <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.rs">rs</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.SEP">SEP</a></span>: <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.f">f</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.j">j</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.ls0">ls0</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.parent">parent</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.retaddr">retaddr</a></span> ** <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.m">m</a></span> ** <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.m">m</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transl_builtin_arg_correct">transl_builtin_arg_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#eval_builtin_arg">eval_builtin_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.ls">ls</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#a">a</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> (<span class="id"><a href="compcert.common.AST.html#params_of_builtin_arg">params_of_builtin_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#a">a</a></span>) -&gt; <span class="id"><a href="compcert.backend.Lineartyping.html#loc_valid">loc_valid</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.f">f</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#params_of_builtin_arg">params_of_builtin_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#a">a</a></span>) -&gt; <span class="id"><a href="compcert.backend.Bounds.html#slot_within_bounds">slot_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#eval_builtin_arg">eval_builtin_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.rs">rs</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id">m</span>' (<span class="id"><a href="compcert.backend.Stacking.html#transl_builtin_arg">transl_builtin_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.fe">fe</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#a">a</a></span>) <span class="id">v</span>'<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v">v</a></span> <span class="id">v</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4577')">Proof.</div>
<div class="proofscript" id="proof4577">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">SEINJ</span>: <span class="id"><a href="compcert.common.Globalenvs.html#Genv.match_stbls">Genv.match_stbls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span>) <span class="tactic">by</span> <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.SEP">SEP</a></span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.x86.Op.html#symbol_address_inject">symbol_address_inject</a></span> <span class="id">SEINJ</span>) <span class="kwd">as</span> <span class="id">SAINJ</span>.<br/>
<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id"><a href="compcert.backend.Stackingproof.html#fe">fe</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">VALID</span> <span class="id">BOUNDS</span>.<br/>
- <span class="tactic">assert</span> (<span class="id"><a href="compcert.backend.Lineartyping.html#loc_valid">loc_valid</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.f">f</a></span> <span class="id">x</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span> <span class="kwd">as</span> [<span class="id">r</span> | [] <span class="id">ofs</span> <span class="id">ty</span>]; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.rs">rs</a></span> <span class="id">r</span>); <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_get_local">frame_get_local</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="tactic">set</span> (<span class="id">ofs</span>' := <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add">Ptrofs.add</a></span> <span class="id">ofs</span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.fe">fe</a></span>))).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#loadv_parallel_rule">loadv_parallel_rule</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="compcert.common.Values.html#Val.offset_ptr">Val.offset_ptr</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id">ofs</span>').<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_zero_l">Ptrofs.add_zero_l</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">v</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id">v</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.common.Values.html#Val.offset_ptr">Val.offset_ptr</a></span>. <span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_zero_l">Ptrofs.add_zero_l</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#loadv_parallel_rule">loadv_parallel_rule</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">v</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id">v</span>'; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="id">econstructor</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">IHeval_builtin_arg1</span> <span class="kwd">as</span> (<span class="id">v1</span> &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>); <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHeval_builtin_arg2</span> <span class="kwd">as</span> (<span class="id">v2</span> &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>); <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.common.Values.html#Val.longofwords">Val.longofwords</a></span> <span class="id">v1</span> <span class="id">v2</span>); <span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.longofwords_inject">Val.longofwords_inject</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">IHeval_builtin_arg1</span> <span class="kwd">as</span> (<span class="id">v1</span>' &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>); <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHeval_builtin_arg2</span> <span class="kwd">as</span> (<span class="id">v2</span>' &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>); <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">barg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.x86_64.Archi.html#ptr64">Archi.ptr64</a></span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Values.html#Val.add_inject">Val.add_inject</a></span>, <span class="id"><a href="compcert.common.Values.html#Val.addl_inject">Val.addl_inject</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transl_builtin_args_correct">transl_builtin_args_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">al</span> <span class="id">vl</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#eval_builtin_args">eval_builtin_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.ls">ls</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#al">al</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#vl">vl</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> (<span class="id"><a href="compcert.common.AST.html#params_of_builtin_args">params_of_builtin_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#al">al</a></span>) -&gt; <span class="id"><a href="compcert.backend.Lineartyping.html#loc_valid">loc_valid</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.f">f</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#l">l</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#params_of_builtin_args">params_of_builtin_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#al">al</a></span>) -&gt; <span class="id"><a href="compcert.backend.Bounds.html#slot_within_bounds">slot_within_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.b">b</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sl">sl</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vl</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#eval_builtin_args">eval_builtin_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.rs">rs</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id">m</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="id"><a href="compcert.backend.Stacking.html#transl_builtin_arg">transl_builtin_arg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.fe">fe</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#al">al</a></span>) <span class="id">vl</span>'<br/>
&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject_list">Val.inject_list</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS.j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#vl">vl</a></span> <span class="id">vl</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4578')">Proof.</div>
<div class="proofscript" id="proof4578">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">VALID</span> <span class="id">BOUNDS</span>.<br/>
- <span class="id">exists</span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="compcert.common.Values.html#val">val</a></span>); <span class="tactic">split</span>; <span class="id">constructor</span>.<br/>
- <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_builtin_arg_correct">transl_builtin_arg_correct</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>. <span class="tactic">intros</span> (<span class="id">v1</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">IHlist_forall2</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>. <span class="tactic">intros</span> (<span class="id">vl</span>' &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">v1</span>'::<span class="id">vl</span>'); <span class="tactic">split</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.BUILTIN_ARGUMENTS">BUILTIN_ARGUMENTS</a></span>.<br/>
<br/>
<br/>
<div class="doc">The proof of semantic preservation relies on simulation diagrams
  of the following form:
<pre>
           st1 --------------- st2
            |                   |
           t|                  +|t
            |                   |
            v                   v
           st1'--------------- st2'</pre>
  Matching between source and target states is defined by <span class="bracket"><span class="id">match_states</span></span>
  below.  It implies:
<ul>
<li>
 Satisfaction of the separation logic assertions that describe the contents
  of memory.  This is a separating conjunction of facts about:
<ul>
<li>
 the current stack frame
</li>
<li>
 the frames in the call stack
</li>
<li>
 the injection from the Linear memory state into the Mach memory state
</li>
<li>
 the preservation of the global environment.
</li>
</ul>
 Agreement between, on the Linear side, the location sets <span class="bracket"><span class="id">ls</span></span>
  and <span class="bracket"><span class="id">parent_locset</span> <span class="id">s</span></span> of the current function and its caller,
  and on the Mach side the register set <span class="bracket"><span class="id">rs</span></span>.
</li>
<li>
 The Linear code <span class="bracket"><span class="id">c</span></span> is a suffix of the code of the
  function <span class="bracket"><span class="id">f</span></span> being executed.
</li>
<li>
 Well-typedness of <span class="bracket"><span class="id">f</span></span>.
</li>
</ul>
</div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="match_states">match_states</a></span>: <span class="id"><a href="compcert.backend.Linear.html#state">Linear.state</a></span> -&gt; <span class="id"><a href="compcert.backend.Mach.html#state">Mach.state</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="match_states_intro">match_states_intro</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cs</span> <span class="id">f</span> <span class="id">sp</span> <span class="id">c</span> <span class="id">ls</span> <span class="id">m</span> <span class="id">cs</span>' <span class="id">fb</span> <span class="id">sp</span>' <span class="id">rs</span> <span class="id">m</span>' <span class="id">j</span> <span class="id">tf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NB</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.le">Pos.le</a></span> (<span class="id"><a href="compcert.cklr.Inject.html#injw_next_l">injw_next_l</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>)) (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>.(<span class="id"><a href="compcert.backend.Linear.html#fn_sig">Linear.fn_sig</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TRANSL</span>: <span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> = <span class="id"><a href="compcert.common.Errors.html#OK">OK</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FIND</span>: <span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_funct">Genv.find_funct</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.common.AST.html#Internal">Internal</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tf">tf</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREGS</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGLOCS</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs">agree_locs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">INJSP</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span>(<span class="id">sp</span>', <span class="id"><a href="compcert.backend.Bounds.html#fe_stack_data">fe_stack_data</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TAIL</span>: <span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> (<span class="id"><a href="compcert.backend.Linear.html#fn_code">Linear.fn_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SEP</span>: <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> (<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') (<span class="id"><a href="compcert.backend.Mach.html#parent_ra">parent_ra</a></span> <span class="id">cs</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> (<span class="id"><a href="compcert.backend.Linear.html#State">Linear.State</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#State">Mach.State</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#fb">fb</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#transl_code">transl_code</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>)) <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a name="match_states_call">match_states_call</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cs</span> <span class="id">vf</span> <span class="id">f</span> <span class="id">ls</span> <span class="id">m</span> <span class="id">cs</span>' <span class="id">vf</span>' <span class="id">rs</span> <span class="id">m</span>' <span class="id">j</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NB</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.le">Pos.le</a></span> (<span class="id"><a href="compcert.cklr.Inject.html#injw_next_l">injw_next_l</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>)) (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' (<span class="id"><a href="compcert.backend.Linear.html#funsig">Linear.funsig</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FIND</span>: <span class="id"><a href="compcert.common.Globalenvs.html#Genv.find_funct">Genv.find_funct</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#vf">vf</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">FINJ</span>: <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#vf">vf</a></span> <span class="id">vf</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREGS</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SEP</span>: <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> (<span class="id"><a href="compcert.backend.Linear.html#Callstate">Linear.Callstate</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#vf">vf</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#Callstate">Mach.Callstate</a></span> <span class="id">cs</span>' <span class="id">vf</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id">m</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a name="match_states_return">match_states_return</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">cs</span> <span class="id">ls</span> <span class="id">m</span> <span class="id">cs</span>' <span class="id">rs</span> <span class="id">m</span>' <span class="id">j</span> <span class="id">sg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NB</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.le">Pos.le</a></span> (<span class="id"><a href="compcert.cklr.Inject.html#injw_next_l">injw_next_l</a></span> (<span class="id"><a href="compcert.backend.Mach.html#stk_w">stk_w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT.w">w</a></span>)) (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">STACKS</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks">match_stacks</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">AGREGS</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs">agree_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SEP</span>: <span class="id">m</span>' |= <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id">cs</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> (<span class="id"><a href="compcert.backend.Linear.html#Returnstate">Linear.Returnstate</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#cs">cs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#Returnstate">Mach.Returnstate</a></span> <span class="id">cs</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#rs">rs</a></span> <span class="id">m</span>').<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="transf_step_correct">transf_step_correct</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s1</span> <span class="id">t</span> <span class="id">s2</span>, <span class="id"><a href="compcert.backend.Linear.html#step">Linear.step</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#s1">s1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#t">t</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#s2">s2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">WTS</span>: <span class="id"><a href="compcert.backend.Lineartyping.html#wt_state">wt_state</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.prog">prog</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#s1">s1</a></span>) <span class="id">s1</span>' (<span class="id">MS</span>: <span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#s1">s1</a></span> <span class="id">s1</span>'),<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s2</span>', <span class="id"><a href="compcert.common.Smallstep.html#plus">plus</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.step">step</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span> <span class="id">s1</span>' <span class="id"><a href="compcert.backend.Stackingproof.html#t">t</a></span> <span class="id">s2</span>' /\ <span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#s2">s2</a></span> <span class="id">s2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4579')">Proof.</div>
<div class="proofscript" id="proof4579">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">inv</span> <span class="id">MS</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_code_eq">transl_code_eq</a></span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">generalize</span> (<span class="id"><a href="compcert.backend.Bounds.html#function_is_within_bounds">function_is_within_bounds</a></span> <span class="id">f</span> <span class="id">_</span> (<span class="id"><a href="compcert.lib.Coqlib.html#is_tail_in">is_tail_in</a></span> <span class="id">TAIL</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">BOUND</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">BOUND</span>);<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transl_instr">transl_instr</a></span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lgetstack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">BOUND</span> <span class="kwd">as</span> [<span class="id">BOUND1</span> <span class="id">BOUND2</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Lineartyping.html#wt_state_getstack">wt_state_getstack</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">SV</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.LTL.html#destroyed_by_getstack">destroyed_by_getstack</a></span>; <span class="tactic">destruct</span> <span class="id">sl</span>.<br/>
+ <span class="comment">(*&nbsp;Lgetstack,&nbsp;local&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_get_local">frame_get_local</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_Mgetstack">exec_Mgetstack</a></span>. <span class="tactic">exact</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
+ <span class="comment">(*&nbsp;Lgetstack,&nbsp;incoming&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Lineartyping.html#slot_valid">slot_valid</a></span> <span class="kwd">in</span> <span class="id">SV</span>. <span class="id">InvBooleans</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Conventions.html#incoming_slot_in_parameters">incoming_slot_in_parameters</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">IN_ARGS</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.backend.Stackingproof.html#load_stack_arg">load_stack_arg</a></span> <span class="kwd">as</span> (<span class="id">v</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>); <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_Mgetparam">exec_Mgetparam</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#unfold_transf_function">unfold_transf_function</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">TRANSL</span>). <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#fn_link_ofs">fn_link_ofs</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_get_parent">frame_get_parent</a></span>. <span class="id">eexact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>. <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_incoming">agree_incoming</a></span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="tactic">exact</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs">agree_locs_undef_locs</a></span>; <span class="tactic">auto</span>.<br/>
+ <span class="comment">(*&nbsp;Lgetstack,&nbsp;outgoing&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_get_outgoing">frame_get_outgoing</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">v</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_Mgetstack">exec_Mgetstack</a></span>. <span class="tactic">exact</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lsetstack&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Lineartyping.html#wt_state_setstack">wt_state_setstack</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> (<span class="id">SV</span> &amp; <span class="id">SW</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ofs</span>' := <span class="kwd">match</span> <span class="id">sl</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="kwd">Local</span> =&gt; <span class="id"><a href="compcert.backend.Stacking.html#offset_local">offset_local</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id">f</span>)) <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#Incoming">Incoming</a></span> =&gt; 0 <span class="comment">(*&nbsp;dummy&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> =&gt; <span class="id"><a href="compcert.backend.Stacking.html#offset_arg">offset_arg</a></span> <span class="id">ofs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_undef_regs">frame_undef_regs</a></span> <span class="kwd">with</span> (<span class="id">rl</span> := <span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_setstack">destroyed_by_setstack</a></span> <span class="id">ty</span>) <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="id">exists</span> <span class="id">m</span>'',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#store_stack">store_stack</a></span> <span class="id">m</span>' (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) <span class="id">ty</span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id">ofs</span>') (<span class="id">rs0</span> <span class="id">src</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>''<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">m</span>'' |= <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents">frame_contents</a></span> <span class="id">f</span> <span class="id">j</span> <span class="id">sp</span>' (<span class="id"><a href="compcert.backend.Locations.html#Locmap.set">Locmap.set</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id">sl</span> <span class="id">ofs</span> <span class="id">ty</span>) (<span class="id">rs</span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">src</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.LTL.html#undef_regs">LTL.undef_regs</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#destroyed_by_setstack">destroyed_by_setstack</a></span> <span class="id">ty</span>) <span class="id">rs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id">s</span>) (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') (<span class="id"><a href="compcert.backend.Mach.html#parent_ra">parent_ra</a></span> <span class="id">cs</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id">j</span> <span class="id">s</span> <span class="id">cs</span>' ** <span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id">j</span> <span class="id">m</span> ** <span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id">j</span> <span class="id">m</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id">ofs</span>'; <span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_set_local">frame_set_local</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_set_outgoing">frame_set_outgoing</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>; <span class="tactic">destruct</span> <span class="id">A</span> <span class="kwd">as</span> (<span class="id">m</span>'' &amp; <span class="id">STORE</span> &amp; <span class="id">SEP</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="tactic">destruct</span> <span class="id">sl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexact</span> <span class="id">STORE</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="id">eexact</span> <span class="id">STORE</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_slot">agree_regs_set_slot</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_regs">agree_regs_undef_regs</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_slot">agree_locs_set_slot</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs">agree_locs_undef_locs</a></span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#destroyed_by_setstack_caller_save">destroyed_by_setstack_caller_save</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>. <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.x86.Op.html#eval_operation">eval_operation</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#transl_op">transl_op</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id">f</span>)) <span class="id">op</span>) <span class="id">rs0</span>##<span class="id">args</span> <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.x86.Op.html#eval_operation_inject">eval_operation_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_reglist">agree_reglist</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">exact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">v</span>' [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_destroyed_by_op">transl_destroyed_by_op</a></span>.  <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_regs">agree_regs_undef_regs</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs">agree_locs_undef_locs</a></span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#destroyed_by_op_caller_save">destroyed_by_op_caller_save</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_set_reg">frame_set_reg</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_undef_regs">frame_undef_regs</a></span>. <span class="tactic">exact</span> <span class="id">SEP</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lload&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">a</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.x86.Op.html#eval_addressing">eval_addressing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#transl_addr">transl_addr</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id">f</span>)) <span class="id">addr</span>) <span class="id">rs0</span>##<span class="id">args</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id">j</span> <span class="id">a</span> <span class="id">a</span>').<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.x86.Op.html#eval_addressing_inject">eval_addressing_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_reglist">agree_reglist</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">a</span>' [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#loadv_parallel_rule">loadv_parallel_rule</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="id">eexact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">v</span>' [<span class="id">C</span> <span class="id">D</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_reg">agree_regs_set_reg</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_destroyed_by_load">transl_destroyed_by_load</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_regs">agree_regs_undef_regs</a></span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_reg">agree_locs_set_reg</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs">agree_locs_undef_locs</a></span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#destroyed_by_load_caller_save">destroyed_by_load_caller_save</a></span>. <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lstore&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">a</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.x86.Op.html#eval_addressing">eval_addressing</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id">sp</span>' <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.zero">Ptrofs.zero</a></span>) (<span class="id"><a href="compcert.backend.Stacking.html#transl_addr">transl_addr</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#make_env">make_env</a></span> (<span class="id"><a href="compcert.backend.Bounds.html#function_bounds">function_bounds</a></span> <span class="id">f</span>)) <span class="id">addr</span>) <span class="id">rs0</span>##<span class="id">args</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id">j</span> <span class="id">a</span> <span class="id">a</span>').<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.x86.Op.html#eval_addressing_inject">eval_addressing_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_reglist">agree_reglist</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">a</span>' [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap3">sep_swap3</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#storev_parallel_rule">storev_parallel_rule</a></span>. <span class="id">eexact</span> <span class="id">SEP</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">AGREGS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>; <span class="tactic">intros</span> (<span class="id">m1</span>' &amp; <span class="id">C</span> &amp; <span class="id">SEP</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap3">sep_swap3</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_store">Mem.nextblock_store</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_destroyed_by_store">transl_destroyed_by_store</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_regs">agree_regs_undef_regs</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs">agree_locs_undef_locs</a></span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#destroyed_by_store_caller_save">destroyed_by_store_caller_save</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#globalenv_nextblock">globalenv_nextblock</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_undef_regs">frame_undef_regs</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_store">Mem.nextblock_store</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">reflexivity</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lcall&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#find_function_translated">find_function_translated</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span>. <span class="id">eexact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">tf</span>' [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#is_tail_transf_function">is_tail_transf_function</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">IST</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_code_eq">transl_code_eq</a></span> <span class="kwd">in</span> <span class="id">IST</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IST</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.return_address_offset_exists">return_address_offset_exists</a></span>. <span class="id">eexact</span> <span class="id">IST</span>. <span class="tactic">intros</span> [<span class="id">ra</span> <span class="id">D</span>].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.common.Values.html#Val.offset_ptr">Val.offset_ptr</a></span>. <span class="tactic">destruct</span> <span class="id">fb</span>; <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.le_trans">Z.le_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> (<span class="id"><a href="compcert.backend.Linear.html#funsig">Linear.funsig</a></span> <span class="id">f</span>')); <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments_bounded">loc_arguments_bounded</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.x86.Op.html#symbol_address_inject">symbol_address_inject</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>. <span class="tactic">exact</span> <span class="id">SEP</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Ltailcall&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id">j</span> <span class="id">s</span> <span class="id">cs</span>')) <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#function_epilogue_correct">function_epilogue_correct</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>. <span class="tactic">intros</span> (<span class="id">rs1</span> &amp; <span class="id">m1</span>' &amp; <span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span> &amp; <span class="id">S</span> &amp; <span class="id">T</span> &amp; <span class="id">U</span> &amp; <span class="id">SEP</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#find_function_translated">find_function_translated</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span>. <span class="id">eexact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">tf</span>' [<span class="id">A</span> <span class="id">B</span>]].<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_right">plus_right</a></span>. <span class="id">eexact</span> <span class="id">S</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_free">Mem.nextblock_free</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_change_sig">match_stacks_change_sig</a></span> <span class="kwd">with</span> (<span class="id"><a href="compcert.backend.Linear.html#fn_sig">Linear.fn_sig</a></span> <span class="id">f</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Lineartyping.html#wt_state_tailcall">wt_state_tailcall</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.x86.Op.html#symbol_address_inject">symbol_address_inject</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#globalenv_nextblock">globalenv_nextblock</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_free">Mem.nextblock_free</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">reflexivity</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lbuiltin&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">BOUND</span> <span class="kwd">as</span> [<span class="id">BND1</span> <span class="id">BND2</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_builtin_args_correct">transl_builtin_args_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj2">sep_proj2</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="id">eexact</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#forallb_forall">forallb_forall</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Lineartyping.html#wt_state_builtin">wt_state_builtin</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">BND2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">vargs</span>' [<span class="id">P</span> <span class="id">Q</span>]].<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">SEP</span> <span class="kwd">as</span> <span class="id">SEP</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_comm">sep_comm</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#external_call_parallel_rule">external_call_parallel_rule</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>; <span class="tactic">intros</span> (<span class="id">j</span>' &amp; <span class="id">res</span>' &amp; <span class="id">m1</span>' &amp; <span class="id">EC</span> &amp; <span class="id">RES</span> &amp; <span class="id">UNCH</span> &amp; <span class="id">SEP</span> &amp; <span class="id">INCR</span> &amp; <span class="id">ISEP</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_comm">sep_comm</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_states_intro">match_states_intro</a></span> <span class="kwd">with</span> (<span class="id">j</span> := <span class="id">j</span>'); <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_nextblock">Mem.unchanged_on_nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_change_meminj">match_stacks_change_meminj</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents_nextblock">stack_contents_nextblock</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_res">agree_regs_set_res</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_regs">agree_regs_undef_regs</a></span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_inject_incr">agree_regs_inject_incr</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_set_res">agree_locs_set_res</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_regs">agree_locs_undef_regs</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_set_res">frame_set_res</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_undef_regs">frame_undef_regs</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_incr">frame_contents_incr</a></span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap2">sep_swap2</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents_change_meminj">stack_contents_change_meminj</a></span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap2">sep_swap2</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">SEP</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Llabel&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_Mlabel">exec_Mlabel</a></span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lgoto&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>; <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_Mgoto">exec_Mgoto</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_find_label">transl_find_label</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#find_label_tail">find_label_tail</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lcond,&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_Mcond_true">exec_Mcond_true</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.x86.Op.html#eval_condition_inject">eval_condition_inject</a></span> <span class="kwd">with</span> (<span class="id">m1</span> := <span class="id">m</span>). <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_reglist">agree_reglist</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_pick3">sep_pick3</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="tactic">exact</span> <span class="id">SEP</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_find_label">transl_find_label</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_regs">agree_regs_undef_regs</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs">agree_locs_undef_locs</a></span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#destroyed_by_cond_caller_save">destroyed_by_cond_caller_save</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#find_label_tail">find_label_tail</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_undef_regs">frame_undef_regs</a></span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lcond,&nbsp;false&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_Mcond_false">exec_Mcond_false</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.x86.Op.html#eval_condition_inject">eval_condition_inject</a></span> <span class="kwd">with</span> (<span class="id">m1</span> := <span class="id">m</span>). <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_reglist">agree_reglist</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_pick3">sep_pick3</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="tactic">exact</span> <span class="id">SEP</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_regs">agree_regs_undef_regs</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs">agree_locs_undef_locs</a></span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#destroyed_by_cond_caller_save">destroyed_by_cond_caller_save</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_undef_regs">frame_undef_regs</a></span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Ljumptable&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">rs0</span> <span class="id">arg</span> = <span class="id"><a href="compcert.common.Values.html#Vint">Vint</a></span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">generalize</span> (<span class="id">AGREGS</span> <span class="id">arg</span>). <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">intro</span> <span class="id">IJ</span>; <span class="id">inv</span> <span class="id">IJ</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>; <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_Mjumptable">exec_Mjumptable</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_find_label">transl_find_label</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_regs">agree_regs_undef_regs</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_undef_locs">agree_locs_undef_locs</a></span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#destroyed_by_jumptable_caller_save">destroyed_by_jumptable_caller_save</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#find_label_tail">find_label_tail</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_undef_regs">frame_undef_regs</a></span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;Lreturn&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents">stack_contents</a></span> <span class="id">j</span> <span class="id">s</span> <span class="id">cs</span>')) <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#function_epilogue_correct">function_epilogue_correct</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">rs</span>' &amp; <span class="id">m1</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span> &amp; <span class="id">G</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_right">plus_right</a></span>. <span class="id">eexact</span> <span class="id">D</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_free">Mem.nextblock_free</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#globalenv_nextblock">globalenv_nextblock</a></span> <span class="kwd">in</span> <span class="id">G</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span>; <span class="tactic">exact</span> <span class="id">G</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_free">Mem.nextblock_free</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">reflexivity</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;internal&nbsp;function&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FIND</span> <span class="kwd">in</span> <span class="id">FIND0</span>. <span class="id">inv</span> <span class="id">FIND0</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.backend.Stackingproof.html#functions_translated">functions_translated</a></span> <span class="kwd">as</span> (<span class="id">tf</span> &amp; <span class="id">TFIND</span> &amp; <span class="id">TRANSL</span>); <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">TRANSL</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transf_fundef">transf_fundef</a></span>, <span class="id"><a href="compcert.common.AST.html#transf_partial_fundef">transf_partial_fundef</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span> <span class="id">f</span>) <span class="kwd">as</span> [<span class="id">tfn</span>|] <span class="id">eqn</span>:<span class="id">TRANSL</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">EQ</span>; <span class="tactic">inversion</span> <span class="id">EQ</span>; <span class="tactic">clear</span> <span class="id">EQ</span>; <span class="tactic">subst</span> <span class="id">tf</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">SEP</span> <span class="kwd">as</span> <span class="id">SEP</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_comm">sep_comm</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Lineartyping.html#wt_callstate_agree">wt_callstate_agree</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">AGCS</span> <span class="id">AGARGS</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#function_prologue_correct">function_prologue_correct</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Lineartyping.html#wt_callstate_wt_regs">wt_callstate_wt_regs</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_type_sp">match_stacks_type_sp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_type_retaddr">match_stacks_type_retaddr</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">SEP</span>;<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">j</span>' &amp; <span class="id">rs</span>' &amp; <span class="id">m2</span>' &amp; <span class="id">sp</span>' &amp; <span class="id">m3</span>' &amp; <span class="id">m4</span>' &amp; <span class="id">m5</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span> &amp; <span class="id">SEP</span> &amp; <span class="id">J</span> &amp; <span class="id">K</span> &amp; <span class="id">L</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.common.Separation.html#sep_comm">sep_comm</a></span> (<span class="id"><a href="compcert.common.Separation.html#globalenv_inject">globalenv_inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> <span class="id">j</span>' <span class="id">m</span>')) <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span> (<span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id">j</span>' <span class="id">m</span>')) <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_left">plus_left</a></span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.backend.Stackingproof.html#unfold_transf_function">unfold_transf_function</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">TRANSL</span>). <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#fn_code">fn_code</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transl_body">transl_body</a></span>.<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">D</span>. <span class="id">traceEq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_states_intro">match_states_intro</a></span> <span class="kwd">with</span> (<span class="id">j</span> := <span class="id">j</span>'); <span class="tactic">eauto</span> <span class="kwd">with</span> <span class="id">coqlib</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_alloc">Mem.nextblock_alloc</a></span>; <span class="tactic">eauto</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_change_meminj">match_stacks_change_meminj</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents_nextblock">stack_contents_nextblock</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_swap">sep_swap</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents_change_meminj">stack_contents_change_meminj</a></span>; <span class="tactic">eauto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;external&nbsp;function&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FIND</span> <span class="kwd">in</span> <span class="id">FIND0</span>. <span class="id">inv</span> <span class="id">FIND0</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.backend.Stackingproof.html#functions_translated">functions_translated</a></span> <span class="kwd">as</span> (<span class="id">tf</span> &amp; <span class="id">TFIND</span> &amp; <span class="id">TRANSL</span>); <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">TRANSL</span>. <span class="tactic">inversion</span> <span class="id">TRANSL</span>; <span class="tactic">subst</span> <span class="id">tf</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Lineartyping.html#wt_callstate_agree">wt_callstate_agree</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">AGCS</span> <span class="id">AGARGS</span>].<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transl_external_arguments">transl_external_arguments</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Separation.html#sep_proj1">sep_proj1</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">vl</span> [<span class="id">ARGS</span> <span class="id">VINJ</span>]].<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">SEP</span> <span class="kwd">as</span> <span class="id">SEP</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_comm">sep_comm</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.common.Separation.html#external_call_parallel_rule">external_call_parallel_rule</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">j</span>' &amp; <span class="id">res</span>' &amp; <span class="id">m1</span>' &amp; <span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span> &amp; <span class="id">F</span>).<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_function_external">exec_function_external</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_states_return">match_states_return</a></span> <span class="kwd">with</span> (<span class="id">j</span> := <span class="id">j</span>').<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_nextblock">Mem.unchanged_on_nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*eauto&nbsp;using&nbsp;external_call_max_perm.*)</span><br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_change_meminj">match_stacks_change_meminj</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents_nextblock">stack_contents_nextblock</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_set_pair">agree_regs_set_pair</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_undef_caller_save_regs">agree_regs_undef_caller_save_regs</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_regs_inject_incr">agree_regs_inject_incr</a></span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents_change_meminj">stack_contents_change_meminj</a></span> <span class="kwd">with</span> <span class="id">j</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_comm">sep_comm</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>; <span class="tactic">auto</span>.<br/>
<br/>
- <span class="comment">(*&nbsp;return&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">STACKS</span>. <span class="id">exploit</span> <span class="id"><a href="compcert.backend.Lineartyping.html#wt_returnstate_agree">wt_returnstate_agree</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">AGCS</span> <span class="id">OUTU</span>].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">AGCS</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#plus_one">plus_one</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Mach.html#exec_return">exec_return</a></span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#agree_locs_return">agree_locs_return</a></span> <span class="kwd">with</span> <span class="id">rs0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#frame_contents_exten">frame_contents_exten</a></span> <span class="kwd">with</span> <span class="id">rs0</span> (<span class="id"><a href="compcert.backend.Linear.html#parent_locset">parent_locset</a></span> <span class="id">s</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.lessdef_same">Val.lessdef_same</a></span>; <span class="tactic">apply</span> <span class="id">AGCS</span>; <span class="tactic">red</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> (<span class="id">OUTU</span> <span class="id">ty</span> <span class="id">ofs</span>); <span class="tactic">auto</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.STEP_CORRECT">STEP_CORRECT</a></span>.<br/>
<br/>
<span class="kwd">Let</span> <span class="id"><a name="PRESERVATION.ccA">ccA</a></span> : <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.backend.Conventions.html#li_locset">li_locset</a></span> <span class="id"><a href="compcert.backend.Mach.html#li_mach">li_mach</a></span> := <span class="id"><a href="compcert.backend.Mach.html#cc_stacking">cc_stacking</a></span> <span class="id"><a href="compcert.cklr.InjectFootprint.html#injp">injp</a></span>.<br/>
<span class="kwd">Let</span> <span class="id"><a name="PRESERVATION.ccB">ccB</a></span> : <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.backend.Conventions.html#li_locset">li_locset</a></span> <span class="id"><a href="compcert.backend.Mach.html#li_mach">li_mach</a></span> := <span class="id"><a href="compcert.backend.Mach.html#cc_stacking">cc_stacking</a></span> <span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="load_stack_inject">load_stack_inject</a></span> <span class="id">j</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">sp1</span> <span class="id">sp2</span> <span class="id">ty</span> <span class="id">ofs</span> <span class="id">v1</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m1">m1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp1">sp1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v1">v1</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.inject">Mem.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m1">m1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp1">sp1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp2">sp2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m2">m2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp2">sp2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ty">ty</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v2">v2</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v1">v1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#v2">v2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4580')">Proof.</div>
<div class="proofscript" id="proof4580">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hv1</span> <span class="id">Hm</span> <span class="id">Hsp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hsp</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_inject">Mem.load_inject</a></span> <span class="kwd">as</span> (<span class="id">v2</span> &amp; <span class="id">Hv2</span> &amp; <span class="id">Hv</span>); <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id">Hv1</span>. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span>, &lt;- <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_assoc">Ptrofs.add_assoc</a></span>, (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span> <span class="id">ofs</span> <span class="id">ofs1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_valid_access">Mem.load_valid_access</a></span> <span class="kwd">in</span> <span class="id">Hv1</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.address_inject">Mem.address_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hv1</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.common.Memdata.html#size_chunk_pos">size_chunk_pos</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id">ty</span>)). <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_args_initial_regs">init_args_initial_regs</a></span> <span class="id">sg</span> <span class="id">j</span> <span class="id">ls</span> <span class="id">m</span> <span class="id">sp</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#massert_imp">massert_imp</a></span> (<span class="id"><a href="compcert.backend.Mach.html#contains_init_args">contains_init_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#contains_init_args">contains_init_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#initial_regs">initial_regs</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls">ls</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4581')">Proof.</div>
<div class="proofscript" id="proof4581">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> <span class="id">m</span>' <span class="id">Hm</span>'. <span class="id">cbn</span> <span class="kwd">in</span> *. <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#initial_regs">initial_regs</a></span>. <span class="tactic">replace</span> (<span class="id"><a href="compcert.backend.Conventions.html#loc_is_external">loc_is_external</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_external_is">loc_external_is</a></span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transf_initial_states">transf_initial_states</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span> <span class="id">q1</span> <span class="id">q2</span>, <span class="id"><a href="compcert.common.LanguageInterface.html#match_senv">match_senv</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ccB">ccB</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#w">w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> -&gt; <span class="id"><a href="compcert.common.LanguageInterface.html#match_query">match_query</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ccB">ccB</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#w">w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#q1">q1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#q2">q2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span>, <span class="id"><a href="compcert.backend.Linear.html#initial_state">Linear.initial_state</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#q1">q1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st1">st1</a></span> -&gt; <br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st2</span>, <span class="id"><a href="compcert.backend.Mach.html#initial_state">Mach.initial_state</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#q2">q2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st2">st2</a></span> /\ <span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#w">w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st1">st1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st2">st2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4582')">Proof.</div>
<div class="proofscript" id="proof4582">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">w</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">Hse</span> <span class="id">Hq</span> <span class="id">st1</span> <span class="id">Hst1</span>. <span class="id">inv</span> <span class="id">Hst1</span>. <span class="id">inv</span> <span class="id">Hq</span>. <span class="id">inv</span> <span class="id">Hse</span>. <span class="tactic">destruct</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span> [<span class="id">injw_next_l</span> <span class="id">injw_next_r</span> <span class="id">stk_w</span> <span class="id">CKLR.mi</span> <span class="id">inj</span> <span class="id">injw_meminj</span>] <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.backend.Stackingproof.html#functions_translated">functions_translated</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">tf</span> [<span class="id">FIND</span> <span class="id">TR</span>]].<br/>
&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;exists&nbsp;(Callstate&nbsp;(Stackbase&nbsp;(Vptr&nbsp;sb&nbsp;sofs)&nbsp;ra2&nbsp;::&nbsp;nil)&nbsp;vf2&nbsp;rs3&nbsp;m2).&nbsp;split.&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id">monadInv</span> <span class="id">TR</span>. <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_states_call">match_states_call</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">m1</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cbn</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="id">cbn</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cbn</span> [<span class="id">stack_contents</span> <span class="id">stk_sg</span> <span class="id">stk_sp2</span> <span class="id">stk_m2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">rs0</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.backend.Stackingproof.html#init_args_initial_regs">init_args_initial_regs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span>. <span class="tactic">repeat</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Hofs</span> (<span class="id">b0</span> &amp; <span class="id">delta</span> &amp; <span class="id">Hb</span> &amp; <span class="id">Hp</span>). <span class="tactic">eapply</span> <span class="id">H11</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> ? ?. <span class="id">cbn</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transf_final_states">transf_final_states</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">r1</span>, <span class="id"><a href="compcert.backend.Lineartyping.html#wt_state">wt_state</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.prog">prog</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st1">st1</a></span> -&gt; <span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#w">w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st1">st1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st2">st2</a></span> -&gt; <span class="id"><a href="compcert.backend.Linear.html#final_state">Linear.final_state</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st1">st1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r1">r1</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r2</span>, <span class="id"><a href="compcert.backend.Mach.html#final_state">Mach.final_state</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st2">st2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r2">r2</a></span> /\ <span class="id"><a href="compcert.common.LanguageInterface.html#match_reply">match_reply</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ccB">ccB</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#w">w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r1">r1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r2">r2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4583')">Proof.</div>
<div class="proofscript" id="proof4583">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H1</span>. <span class="id">inv</span> <span class="id">STACKS</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.backend.Mach.html#mr">mr</a></span> <span class="id">rs</span> <span class="id">m</span>'). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">cbn</span> [<span class="id">stack_contents</span>] <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">SEP</span> <span class="kwd">as</span> (((<span class="id">PERM</span> &amp; <span class="id">UNCH</span> &amp; <span class="id">ARGS</span>) &amp; <span class="id">MINJ</span> &amp; <span class="id">DISJ</span>) &amp; <span class="id">GINJ</span> &amp; <span class="id">_</span>). <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">w</span>; <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Mach.html#cc_stacking_mr_intro">cc_stacking_mr_intro</a></span> <span class="kwd">with</span> (<span class="id">w</span>' := <span class="id"><a href="compcert.cklr.Inject.html#injw">injw</a></span> <span class="id">j</span> <span class="id">_</span> <span class="id">_</span>); <span class="id">cbn</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">stk_w</span> <span class="kwd">as</span> [<span class="id">j0</span> <span class="id">nb1</span> <span class="id">nb2</span>]; <span class="id">cbn</span> <span class="kwd">in</span> *. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_nextblock">Mem.unchanged_on_nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r</span> <span class="id">Hr</span>. <span class="tactic">setoid_rewrite</span> &lt;- (<span class="id">AGCS</span> (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span>) <span class="id">Hr</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">sb2</span> <span class="id">sofs2</span> <span class="id">H</span> <span class="id">sb1</span> <span class="id">delta</span> <span class="id">Hsb</span> <span class="id">Hp</span>. <span class="tactic">eapply</span> <span class="id">DISJ</span>; <span class="id">cbn</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_args_agree_outgoing_arguments">init_args_agree_outgoing_arguments</a></span> <span class="id">sg</span> <span class="id">j</span> <span class="id">ls1</span> <span class="id">ls2</span> <span class="id">m</span> <span class="id">sp</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Lineartyping.html#agree_outgoing_arguments">agree_outgoing_arguments</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls2">ls2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Separation.html#massert_imp">massert_imp</a></span> (<span class="id"><a href="compcert.backend.Mach.html#contains_init_args">contains_init_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls2">ls2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#contains_init_args">contains_init_args</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#j">j</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ls1">ls1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#m">m</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sp">sp</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4584')">Proof.</div>
<div class="proofscript" id="proof4584">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hargs</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> <span class="id">m</span>' (<span class="id">PERM</span> &amp; <span class="id">FITS</span> &amp; <span class="id">ARGS</span>). <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">Hargs</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transf_external_states">transf_external_states</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">q1</span>, <span class="id"><a href="compcert.backend.Lineartyping.html#wt_state">wt_state</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.prog">prog</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st1">st1</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#w">w</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st1">st1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st2">st2</a></span> -&gt; <span class="id"><a href="compcert.backend.Linear.html#at_external">Linear.at_external</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st1">st1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#q1">q1</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">wx</span> <span class="id">q2</span>, <span class="id"><a href="compcert.backend.Mach.html#at_external">Mach.at_external</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tge">tge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st2">st2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#q2">q2</a></span> /\ <span class="id"><a href="compcert.common.LanguageInterface.html#match_query">match_query</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ccA">ccA</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#wx">wx</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#q1">q1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#q2">q2</a></span> /\ <span class="id"><a href="compcert.common.LanguageInterface.html#match_senv">match_senv</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ccA">ccA</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#wx">wx</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.se">se</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.tse">tse</a></span> /\<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">st1</span>', <span class="id"><a href="compcert.common.LanguageInterface.html#match_reply">match_reply</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ccA">ccA</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#wx">wx</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r1">r1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r2">r2</a></span> -&gt; <span class="id"><a href="compcert.backend.Linear.html#after_external">Linear.after_external</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st1">st1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r1">r1</a></span> <span class="id">st1</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">st2</span>', <span class="id"><a href="compcert.backend.Mach.html#after_external">Mach.after_external</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#st2">st2</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#r2">r2</a></span> <span class="id">st2</span>' /\ <span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#w">w</a></span> <span class="id">st1</span>' <span class="id">st2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4585')">Proof.</div>
<div class="proofscript" id="proof4585">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">w</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">q1</span> <span class="id">WTS</span> <span class="id">Hst</span> <span class="id">Hq1</span>. <span class="tactic">destruct</span> <span class="id">Hst</span>; <span class="id">inv</span> <span class="id">Hq1</span>.<br/>
&nbsp;&nbsp;<span class="id">inv</span> <span class="id">WTS</span>. <span class="tactic">rewrite</span> <span class="id">FIND</span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">inv</span> <span class="id">H4</span>. <span class="id">fold</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.ge">ge</a></span> <span class="kwd">in</span> <span class="id">FIND0</span>. <span class="tactic">rewrite</span> <span class="id">FIND</span> <span class="kwd">in</span> <span class="id">FIND0</span>; <span class="id">inv</span> <span class="id">FIND0</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.backend.Stackingproof.html#functions_translated">functions_translated</a></span> <span class="kwd">as</span> (<span class="id">tf</span> &amp; <span class="id">TFIND</span> &amp; <span class="id">TRANSL</span>); <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">TRANSL</span>. <span class="id">inv</span> <span class="id">TRANSL</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">MINJ</span>: <span class="id"><a href="compcert.common.Memory.html#Mem.inject">Mem.inject</a></span> <span class="id">j</span> <span class="id">m</span> <span class="id">m</span>') <span class="tactic">by</span> <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span> (<span class="id"><a href="compcert.backend.Mach.html#stkw">stkw</a></span> <span class="id"><a href="compcert.cklr.InjectFootprint.html#injp">injp</a></span> (<span class="id"><a href="compcert.cklr.InjectFootprint.html#injpw">injpw</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">MINJ</span>) <span class="id">_</span> <span class="id">ls</span> (<span class="id"><a href="compcert.backend.Mach.html#parent_sp">parent_sp</a></span> <span class="id">cs</span>') <span class="id">m</span>'), <span class="id">_</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_init_args">match_stacks_init_args</a></span> <span class="kwd">in</span> <span class="id">SEP</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">vf</span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#init_args_agree_outgoing_arguments">init_args_agree_outgoing_arguments</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span>. <span class="tactic">destruct</span> <span class="id">SEP</span> <span class="kwd">as</span> ((<span class="id">_</span> &amp; <span class="id">_</span> &amp; <span class="id">DISJ</span>) &amp; <span class="id">_</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">Hofs</span> <span class="id">b</span>' <span class="id">ofs</span>' <span class="id">H</span>' <span class="id">Hp</span>. <span class="tactic">eapply</span> <span class="id">DISJ</span>; <span class="id">cbn</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_type_sp">match_stacks_type_sp</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_type_retaddr">match_stacks_type_retaddr</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">st1</span>' <span class="id">Hr</span> <span class="id">Hst1</span>'. <span class="id">inv</span> <span class="id">Hr</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">inv</span> <span class="id">Hst1</span>'. <span class="id">inv</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H17</span> <span class="kwd">in</span> <span class="id">FIND</span>. <span class="id">inv</span> <span class="id">FIND</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_states_return">match_states_return</a></span> <span class="kwd">with</span> (<span class="id">j</span> := <span class="id">f</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">etransitivity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_nextblock">Mem.unchanged_on_nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#match_stacks_change_meminj">match_stacks_change_meminj</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents_nextblock">stack_contents_nextblock</a></span>; <span class="tactic">eauto</span>. <span class="tactic">apply</span> <span class="id">SEP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">r</span>. <span class="id">cbn</span>. <span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">eqn</span>:<span class="id">Hr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#stack_contents_change_meminj">stack_contents_change_meminj</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_comm">sep_comm</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#minjection_incr">minjection_incr</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.Separation.html#sep_comm">sep_comm</a></span>, <span class="id"><a href="compcert.common.Separation.html#sep_assoc">sep_assoc</a></span> <span class="kwd">in</span> <span class="id">SEP</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#globalenv_inject_incr">globalenv_inject_incr</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_nextblock">Mem.unchanged_on_nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_prog">wt_prog</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span> <span class="id">fd</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Stackingproof.html#i">i</a></span>, <span class="id"><a href="compcert.common.AST.html#Gfun">Gfun</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fd">fd</a></span>) <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.prog">prog</a></span>.(<span class="id"><a href="compcert.common.AST.html#prog_defs">prog_defs</a></span>) -&gt; <span class="id"><a href="compcert.backend.Lineartyping.html#wt_fundef">wt_fundef</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#fd">fd</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4586')">Proof.</div>
<div class="proofscript" id="proof4586">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.lib.Coqlib.html#list_forall2_in_left">list_forall2_in_left</a></span>. <span class="id">eexact</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION.TRANSF">TRANSF</a></span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> ([<span class="id">i</span>' <span class="id">g</span>] &amp; <span class="id">P</span> &amp; <span class="id">Q</span> &amp; <span class="id">R</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">R</span>. <span class="tactic">destruct</span> <span class="id">fd</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
- <span class="id">monadInv</span> <span class="id">H2</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Stacking.html#transf_function">transf_function</a></span> <span class="kwd">in</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.backend.Lineartyping.html#wt_function">wt_function</a></span> <span class="id">f</span>). <span class="tactic">auto</span>. <span class="tactic">discriminate</span>.<br/>
- <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.backend.Stackingproof.html#PRESERVATION">PRESERVATION</a></span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="transf_program_correct">transf_program_correct</a></span> <span class="id">rao</span> <span class="id">prog</span> <span class="id">tprog</span>:<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">f</span> <span class="id">sg</span> <span class="id">ros</span> <span class="id">c</span>, <span class="id"><a href="compcert.lib.Coqlib.html#is_tail">is_tail</a></span> (<span class="id"><a href="compcert.backend.Mach.html#Mcall">Mcall</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#sg">sg</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ros">ros</a></span> :: <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#fn_code">fn_code</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ofs</span>, <span class="id"><a href="compcert.backend.Stackingproof.html#rao">rao</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#f">f</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#c">c</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Stackingproof.html#match_prog">match_prog</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#prog">prog</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tprog">tprog</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#forward_simulation">forward_simulation</a></span> (<span class="id"><a href="compcert.backend.Lineartyping.html#wt_loc">wt_loc</a></span> @ <span class="id"><a href="compcert.backend.Mach.html#cc_stacking">cc_stacking</a></span> <span class="id"><a href="compcert.cklr.InjectFootprint.html#injp">injp</a></span>) (<span class="id"><a href="compcert.backend.Lineartyping.html#wt_loc">wt_loc</a></span> @ <span class="id"><a href="compcert.backend.Mach.html#cc_stacking">cc_stacking</a></span> <span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Linear.html#semantics">Linear.semantics</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#prog">prog</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#semantics">Mach.semantics</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#rao">rao</a></span> <span class="id"><a href="compcert.backend.Stackingproof.html#tprog">tprog</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4587')">Proof.</div>
<div class="proofscript" id="proof4587">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hrao</span> <span class="id">MATCH</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#source_invariant_fsim">source_invariant_fsim</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.backend.Lineartyping.html#linear_wt">linear_wt</a></span>, <span class="id"><a href="compcert.backend.Stackingproof.html#wt_prog">wt_prog</a></span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">MATCH</span>.<br/>
&nbsp;&nbsp;<span class="id">fsim</span> <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Smallstep.html#forward_simulation_plus">forward_simulation_plus</a></span> <span class="kwd">with</span> (<span class="id">match_states</span>:= <span class="id"><a href="compcert.backend.Stackingproof.html#match_states">match_states</a></span> <span class="id">rao</span> <span class="id">prog</span> <span class="id">tprog</span> <span class="id">se1</span> <span class="id">se2</span> <span class="id">w</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">Hq</span>. <span class="tactic">destruct</span> <span class="id">Hq</span>. <span class="id">inv</span> <span class="id">Hse</span>. <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id"><a href="compcert.common.Globalenvs.html#Genv.is_internal_transf_partial">Genv.is_internal_transf_partial</a></span> <span class="id">MATCH</span>); <span class="tactic">eauto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [|] ? <span class="id">Hfd</span>; <span class="id">monadInv</span> <span class="id">Hfd</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">cbn</span>. <span class="tactic">intuition</span> <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transf_initial_states">transf_initial_states</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">r1</span> <span class="id">Hs</span>  (<span class="id">Hr1</span> &amp; [? ?] &amp; <span class="id">Hxse</span> &amp; <span class="id">WTS</span> &amp; <span class="id">WTR</span>). <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Hxse</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transf_final_states">transf_final_states</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">q1</span> <span class="id">Hs</span> (<span class="id">Hq1</span> &amp; [? ?] &amp; ? &amp; <span class="id">Hx</span> &amp; <span class="id">WTS</span> &amp; <span class="id">WTQ</span>). <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transf_external_states">transf_external_states</a></span> <span class="kwd">as</span> (<span class="id">wx</span> &amp; <span class="id">qx2</span> &amp; ? &amp; ? &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">wx</span>, <span class="id">qx2</span>. <span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> (<span class="id">Hs1</span>' &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">st2</span>' &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s1</span> <span class="id">t</span> <span class="id">s1</span>' (<span class="id">Hs1</span>' &amp; [<span class="id">xse</span> ?] &amp; <span class="id">Hx</span> &amp; <span class="id">WTS</span> &amp; <span class="id">WTS</span>') <span class="id">s2</span> <span class="id">Hs</span>. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Hx</span>, <span class="id">Hs1</span>', <span class="id">Hs</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.backend.Stackingproof.html#transf_step_correct">transf_step_correct</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
