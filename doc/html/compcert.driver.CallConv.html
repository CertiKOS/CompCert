
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CallConv</title>
<meta name="description" content="Documentation of Coq module CallConv" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CallConv</h1>
<div class="coq">
<div class="doc">This file defines the overall calling convention for CompCertO
  and provides the simulation convention algebra used in the
  <span class="bracket"><span class="id">driver.Compiler</span></span> library to compose passes into the corresponding
  correctness theorem. </div>
<br/>
<div class="doc">The main principle before our approach is to separate the structural
  aspect of calling conventions on one hand, which establish
  connections between the successive language interfaces, and the
  CKLRs used by various passes on the other hand, which can be
  promoted to endogenous simulation conventions for each language
  interface. Although composing the various pass correctness theorems
  directly yields a mixture of stuctural conventions and CKLRs, we use
  commutation properties to separate these two components. </div>
<br/>
<div class="doc">More precisely, for a structural component <span class="bracket"><span class="id">CC</span></span>, we make sure that
  the following holds for all CKLRs <span class="bracket"><span class="id">R</span></span>:
<pre>
                    ccref (CC @ R) (R @ CC)</pre>
  In the context of external calls, this allows us to propagate CKLRs
  towards the source level, where they can be satisfied by the
  relational parametricity property of Clight. For incoming calls,
  this allows a target-level injection to be duplicated and propagated
  in order to satisfy the incoming simulation convention of the
  various compiler passes. Ultimately, we can formulate a simulation
  convention for the whole compiler of the form:
<pre>
         (R1 + ... + Rn)^{*} @ (CC1 @ ... @ CCk) @ vainj</pre>
  The first component expresses source-level compatibility with the
  various CKLRs <span class="bracket"><span class="id">R1</span></span>, ..., <span class="bracket"><span class="id">Rn</span></span> (and hence, thanks to commutation
  properties, overall compatibility with CKLRs for incoming calls).
  The second component encodes the structural aspects of the
  relationship between source- and target-level calls. The last
  component represents a minimal CKLR: a memory injection is necessary
  since the target program will allocate stack frames instead of
  individual memory blocks for local variable, and queries must
  contain memory states which conform to the invariants used by the
  ValueAnalysis passes. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.LanguageInterface.html">LanguageInterface</a></span> <span class="id"><a href="compcert.common.CallconvAlgebra.html">CallconvAlgebra</a></span> <span class="id"><a href="compcert.common.Invariant.html">Invariant</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.cklr.CKLR.html">CKLR</a></span> <span class="id"><a href="compcert.cklr.Inject.html">Inject</a></span> <span class="id"><a href="compcert.cklr.InjectFootprint.html">InjectFootprint</a></span> <span class="id"><a href="compcert.cklr.Extends.html">Extends</a></span> <span class="id"><a href="compcert.cklr.VAInject.html">VAInject</a></span> <span class="id"><a href="compcert.cklr.VAExtends.html">VAExtends</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.backend.Mach.html">Mach</a></span> <span class="id"><a href="compcert.backend.Locations.html">Locations</a></span> <span class="id"><a href="compcert.backend.Conventions.html">Conventions</a></span> <span class="id"><a href="compcert.x86.Asm.html">Asm</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.backend.ValueAnalysis.html">ValueAnalysis</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.backend.Allocproof.html">Allocproof</a></span> <span class="id"><a href="compcert.backend.Lineartyping.html">Lineartyping</a></span> <span class="id"><a href="compcert.backend.Asmgenproof0.html">Asmgenproof0</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Maps.html">Maps</a></span> <span class="id"><a href="compcert.x86.Stacklayout.html">Stacklayout</a></span>.<br/>
<span class="kwd">Unset</span> <span class="kwd">Program</span> <span class="id">Cases</span>.<br/>
<br/>
<span class="kwd">Coercion</span> <span class="id">cc_c</span> : <span class="id">cklr</span> &gt;-&gt; <span class="id">callconv</span>.<br/>
<br/>
<br/>
<h1> Commutation properties </h1>
<br/>
<div class="doc">First, we define a general form for the commutation properties we
  need, and prove the straightforward ones. </div>
<br/>
<h2> Basic setup </h2>
<br/>
<div class="doc">The following class captures a general commutation property.
  In general, <span class="bracket"><span class="id">cc</span></span> will be a structural simulation convention;
  <span class="bracket"><span class="id">R1</span></span> and <span class="bracket"><span class="id">R2</span></span> will be corresponding source- and target-level CKLR
  simulation conventions. </div>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="Commutes">Commutes</a></span> {<span class="id">liA</span> <span class="id">liB</span>} (<span class="id">cc</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liA">liA</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liB">liB</a></span>) <span class="id">R1</span> <span class="id">R2</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="commute">commute</a></span> : <span class="id"><a href="compcert.common.CallconvAlgebra.html#ccref">ccref</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#cc">cc</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#R2">R2</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#R1">R1</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#cc">cc</a></span>).<br/>
<br/>
<div class="doc">The following lemma provides a convenient way to use <span class="bracket"><span class="id">commute</span></span> for
  rewriting within more complex sequences of simulation conventions. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="commute_around">commute_around</a></span> `{<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span>} {<span class="id">liC</span>} (<span class="id">x</span> : <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liB">liB</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liC">liC</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#ccref">ccref</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#cc">cc</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#R2">R2</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#x">x</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#R1">R1</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#cc">cc</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#x">x</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5313')">Proof.</div>
<div class="proofscript" id="proof5313">
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- !<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_assoc">cc_compose_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="id">rstep</span>; <span class="tactic">auto</span>).<br/>
Qed.</div>
<br/>
<span class="id">Arguments</span> <span class="id"><a href="compcert.driver.CallConv.html#commute_around">commute_around</a></span> {<span class="id">liA</span> <span class="id">liB</span>} <span class="id">cc</span> {<span class="id">R1</span> <span class="id">R2</span> <span class="id">H</span> <span class="id">liC</span> <span class="id">x</span>}.<br/>
<br/>
<div class="doc">Finally, we provide some composite instances for <span class="bracket"><span class="id">Commutes</span></span>. </div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="commut_join">commut_join</a></span> {<span class="id">liA</span> <span class="id">liB</span>} <span class="id">cc</span> <span class="id">R1</span> <span class="id">R2</span> <span class="id">S1</span> <span class="id">S2</span> :<br/>
&nbsp;&nbsp;@<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liA">liA</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liB">liB</a></span> <span class="id"><a href="compcert.driver.CallConv.html#cc">cc</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R1">R1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R2">R2</a></span> -&gt;<br/>
&nbsp;&nbsp;@<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liA">liA</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liB">liB</a></span> <span class="id"><a href="compcert.driver.CallConv.html#cc">cc</a></span> <span class="id"><a href="compcert.driver.CallConv.html#S1">S1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#S2">S2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> <span class="id"><a href="compcert.driver.CallConv.html#cc">cc</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#R1">R1</a></span> + <span class="id"><a href="compcert.driver.CallConv.html#S1">S1</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#R2">R2</a></span> + <span class="id"><a href="compcert.driver.CallConv.html#S2">S2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5314')">Proof.</div>
<div class="proofscript" id="proof5314">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_join_distr_l">cc_join_distr_l</a></span>, <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_join_distr_r">cc_join_distr_r</a></span>, !<span class="id"><a href="compcert.driver.CallConv.html#commute">commute</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="commut_star">commut_star</a></span> `(<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> <span class="id"><a href="compcert.driver.CallConv.html#cc">cc</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#R1">R1</a></span>^{*}) (<span class="id"><a href="compcert.driver.CallConv.html#R2">R2</a></span>^{*}).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5315')">Proof.</div>
<div class="proofscript" id="proof5315">
&nbsp;&nbsp;<span class="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_id_left">cc_compose_id_left</a></span> <span class="id">cc</span>), (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_id_star">cc_id_star</a></span> <span class="id">R1</span>) <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_star_ind_r">cc_star_ind_r</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_assoc">cc_compose_assoc</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#commute">commute</a></span>, &lt;- <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_assoc">cc_compose_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_one_star">cc_one_star</a></span> <span class="id">R1</span>) <span class="tactic">at</span> 2. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_star_idemp">cc_star_idemp</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="commut_compose">commut_compose</a></span> {<span class="id">liA</span> <span class="id">liB</span> <span class="id">liC</span>} <span class="id">cc1</span> <span class="id">cc2</span> <span class="id">RA</span> <span class="id">RB</span> <span class="id">RC</span>:<br/>
&nbsp;&nbsp;@<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liA">liA</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liB">liB</a></span> <span class="id"><a href="compcert.driver.CallConv.html#cc1">cc1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#RA">RA</a></span> <span class="id"><a href="compcert.driver.CallConv.html#RB">RB</a></span> -&gt;<br/>
&nbsp;&nbsp;@<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liB">liB</a></span> <span class="id"><a href="compcert.driver.CallConv.html#liC">liC</a></span> <span class="id"><a href="compcert.driver.CallConv.html#cc2">cc2</a></span> <span class="id"><a href="compcert.driver.CallConv.html#RB">RB</a></span> <span class="id"><a href="compcert.driver.CallConv.html#RC">RC</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#cc1">cc1</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#cc2">cc2</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#RA">RA</a></span> <span class="id"><a href="compcert.driver.CallConv.html#RC">RC</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5316')">Proof.</div>
<div class="proofscript" id="proof5316">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">HAB</span> <span class="id">HBC</span>. <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_assoc">cc_compose_assoc</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#commute">commute</a></span>, &lt;- <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_assoc">cc_compose_assoc</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#commute">commute</a></span>, <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_assoc">cc_compose_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<h2> <span class="bracket"><span class="id">cc_c_locset</span></span> </h2>
<br/>
<div class="doc">The commutation of <span class="bracket"><span class="id">cc_c_locset</span></span> basically follows the way the
  original LTL semantics evaluates calls to external functions:
  for queries, we read out the arguments from the location set;
  once we get a C reply, we write back the
  result and mark the appropriate registers undefined. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locmap_getpair_inject">locmap_getpair_inject</a></span> <span class="id">f</span> <span class="id">ls1</span> <span class="id">ls2</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.AST.html#forall_rpair">forall_rpair</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#ls1">ls1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#l">l</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#ls2">ls2</a></span> <span class="id"><a href="compcert.driver.CallConv.html#l">l</a></span>)) <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> (<span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ls1">ls1</a></span>) (<span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ls2">ls2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5317')">Proof.</div>
<div class="proofscript" id="proof5317">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="id">cbn</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.longofwords_inject">Val.longofwords_inject</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">For now we restrict ourselves to 64-bit x86, where no register
  pairs are involved. Eventually we'll want to fold register typing
  into the property below (or maybe the calling conventions
  themselves) to ensure that split integers are the right sizes. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="loc_arguments_always_one">loc_arguments_always_one</a></span> <span class="id">sg</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">l</span>, <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span> = <span class="id"><a href="compcert.common.AST.html#One">One</a></span> <span class="id"><a href="compcert.driver.CallConv.html#l">l</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5318')">Proof.</div>
<div class="proofscript" id="proof5318">
&nbsp;&nbsp;<span class="tactic">cut</span> (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">p</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments_64">loc_arguments_64</a></span> (<span class="id"><a href="compcert.common.AST.html#sig_args">sig_args</a></span> <span class="id">sg</span>) <span class="id"><a href="compcert.driver.CallConv.html#x">x</a></span> <span class="id"><a href="compcert.driver.CallConv.html#y">y</a></span> <span class="id"><a href="compcert.driver.CallConv.html#z">z</a></span>) -&gt; <span class="id">exists</span> <span class="id">l</span>, <span class="id">p</span> = <span class="id"><a href="compcert.common.AST.html#One">One</a></span> <span class="id"><a href="compcert.driver.CallConv.html#l">l</a></span>).<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">apply</span> (<span class="id">H</span> 0 0 0). <span class="tactic">apply</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">induction</span> <span class="id"><a href="compcert.common.AST.html#sig_args">sig_args</a></span>; <span class="id">cbn</span> -[<span class="id">list_nth_z</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>, <span class="id"><a href="compcert.lib.Coqlib.html#list_nth_z">list_nth_z</a></span>; <span class="id">cbn</span>; <span class="tactic">intros</span> [? | ?]; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="loc_result_always_one">loc_result_always_one</a></span> <span class="id">sg</span>:<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r</span>, <span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> = <span class="id"><a href="compcert.common.AST.html#One">One</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5319')">Proof.</div>
<div class="proofscript" id="proof5319">
&nbsp;&nbsp;<span class="id">change</span> <span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="kwd">with</span> <span class="id"><a href="compcert.x86.Conventions1.html#loc_result_64">loc_result_64</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.x86.Conventions1.html#loc_result_64">loc_result_64</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.common.AST.html#sig_res">sig_res</a></span> <span class="kwd">as</span> [[ ] | ]; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="commut_c_locset">commut_c_locset</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> <span class="id"><a href="compcert.backend.Conventions.html#cc_c_locset">cc_c_locset</a></span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cc_c">cc_c</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#cc_locset">cc_locset</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5320')">Proof.</div>
<div class="proofscript" id="proof5320">
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">_</span> <span class="id">w</span>] [<span class="id">sg</span> <span class="id">wR</span>]] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> [[ ] <span class="id">Hse2</span>] (<span class="id">qi</span> &amp; <span class="id">Hq1i</span> &amp; <span class="id">Hqi2</span>).<br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> * |- . <span class="tactic">destruct</span> <span class="id">Hqi2</span>. <span class="id">inv</span> <span class="id">Hq1i</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se2</span>, <span class="id">wR</span>, <span class="id">sg</span>). <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">set</span> (<span class="id">args1</span> := (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span> <span class="id">ls1</span>) ## (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id">sg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">args2</span> := (<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id"><a href="compcert.backend.Locations.html#Locmap.getpair">Locmap.getpair</a></span> <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span> <span class="id">ls2</span>) ## (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id">sg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cq">cq</a></span> <span class="id">vf2</span> <span class="id">sg</span> <span class="id">args2</span> <span class="id">m2</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">clear</span> - <span class="id">H0</span>. <span class="tactic">subst</span> <span class="id">args1</span> <span class="id">args2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Conventions.html#loc_external_rel">loc_external_rel</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.backend.Conventions.html#loc_arguments_external">loc_arguments_external</a></span> <span class="id">sg</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.driver.CallConv.html#locmap_getpair_inject">locmap_getpair_inject</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.AST.html#forall_rpair">forall_rpair</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#loc_external">loc_external</a></span> <span class="id">sg</span>) <span class="id">a</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">ri</span> &amp; (<span class="id">wR</span>' &amp; <span class="id">HwR</span>' &amp; <span class="id">Hr1i</span>) &amp; <span class="id">Hri2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hr1i</span>. <span class="id">inv</span> <span class="id">Hri2</span>. <span class="tactic">rename</span> <span class="id">rs</span>' <span class="id">into</span> <span class="id">ls2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ls1</span>' := <span class="id"><a href="compcert.backend.Locations.html#Locmap.setpair">Locmap.setpair</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id">sg</span>) <span class="id">vres1</span> (<span class="id"><a href="compcert.backend.LTL.html#undef_caller_save_regs">LTL.undef_caller_save_regs</a></span> <span class="id">ls1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.backend.Conventions.html#lr">lr</a></span> <span class="id">ls1</span>' <span class="id">m1</span>'). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span> <span class="id">ls1</span>'. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.driver.CallConv.html#loc_result_always_one">loc_result_always_one</a></span> <span class="id">sg</span>) <span class="kwd">as</span> [<span class="id">r</span> -&gt;].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gss">Locmap.gss</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">subst</span> <span class="id">ls1</span>'. <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.driver.CallConv.html#loc_result_always_one">loc_result_always_one</a></span> <span class="id">sg</span>) <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hr</span>]. <span class="tactic">rewrite</span> <span class="id">Hr</span> <span class="kwd">in</span> *. <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span> <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.backend.Locations.html#Locmap.gss">Locmap.gss</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> <span class="bracket"><span class="id">cc_mach_asm</span></span> </h2>
<br/>
<div class="doc">The commutation property for <span class="bracket"><span class="id">cc_mach_asm</span></span> is straightforward.
  The only subtlety is reconstructing the intermediate <span class="bracket"><span class="id">Asm.regset</span></span>
  from the source reply's <span class="bracket"><span class="id">Mach.regset</span></span>. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="preg_class">preg_class</a></span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="prc_pc">prc_pc</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="prc_sp">prc_sp</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="prc_preg_of">prc_preg_of</a></span> (<span class="id">r</span> : <span class="id"><a href="compcert.x86.Machregs.html#mreg">mreg</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="prc_other">prc_other</a></span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="preg_classify_spec">preg_classify_spec</a></span> : <span class="id"><a href="compcert.driver.CallConv.html#preg_class">preg_class</a></span> -&gt; <span class="id"><a href="compcert.x86.Asm.html#preg">preg</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="prc_pc_spec">prc_pc_spec</a></span> : <span class="id"><a href="compcert.driver.CallConv.html#preg_classify_spec">preg_classify_spec</a></span> <span class="id"><a href="compcert.driver.CallConv.html#prc_pc">prc_pc</a></span> <span class="id"><a href="compcert.x86.Asm.html#PC">PC</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="prc_sp_spec">prc_sp_spec</a></span> : <span class="id"><a href="compcert.driver.CallConv.html#preg_classify_spec">preg_classify_spec</a></span> <span class="id"><a href="compcert.driver.CallConv.html#prc_sp">prc_sp</a></span> <span class="id"><a href="compcert.x86.Asm.html#SP">SP</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="prc_preg_spec">prc_preg_spec</a></span> <span class="id">m</span> : <span class="id"><a href="compcert.driver.CallConv.html#preg_classify_spec">preg_classify_spec</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>) (<span class="id"><a href="compcert.x86.Asm.html#preg_of">preg_of</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="prc_other_spec">prc_other_spec</a></span> <span class="id">r</span> : <span class="id"><a href="compcert.driver.CallConv.html#preg_classify_spec">preg_classify_spec</a></span> <span class="id"><a href="compcert.driver.CallConv.html#prc_other">prc_other</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="preg_classify">preg_classify</a></span> <span class="id">r</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#PC">PC</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_pc">prc_pc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SP</span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_sp">prc_sp</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#RAX">RAX</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#AX">AX</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#RBX">RBX</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#BX">BX</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#RCX">RCX</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#CX">CX</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#RDX">RDX</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#DX">DX</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#RSI">RSI</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#SI">SI</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#RDI">RDI</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#DI">DI</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#RBP">RBP</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#BP">BP</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#R8">R8</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#R8">Machregs.R8</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#R9">R9</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#R9">Machregs.R9</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#R10">R10</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#R10">Machregs.R10</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#R11">R11</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#R11">Machregs.R11</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#R12">R12</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#R12">Machregs.R12</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#R13">R13</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#R13">Machregs.R13</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#R14">R14</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#R14">Machregs.R14</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#R15">R15</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#R15">Machregs.R15</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM0">XMM0</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X0">X0</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM1">XMM1</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X1">X1</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM2">XMM2</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X2">X2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM3">XMM3</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X3">X3</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM4">XMM4</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X4">X4</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM5">XMM5</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X5">X5</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM6">XMM6</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X6">X6</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM7">XMM7</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X7">X7</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM8">XMM8</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X8">X8</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM9">XMM9</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X9">X9</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM10">XMM10</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X10">X10</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM11">XMM11</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X11">X11</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM12">XMM12</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X12">X12</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM13">XMM13</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X13">X13</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM14">XMM14</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X14">X14</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#XMM15">XMM15</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#X15">X15</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#ST0">ST0</a></span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.x86.Machregs.html#FP0">FP0</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.x86.Asm.html#RA">RA</a></span> | <span class="id"><a href="compcert.x86.Asm.html#CR">CR</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#prc_other">prc_other</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="preg_classify_preg">preg_classify_preg</a></span> <span class="id">m</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#preg_classify">preg_classify</a></span> (<span class="id"><a href="compcert.x86.Asm.html#preg_of">preg_of</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>) = <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5321')">Proof.</div>
<div class="proofscript" id="proof5321">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="preg_classify_cases">preg_classify_cases</a></span> <span class="id">r</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#preg_classify_spec">preg_classify_spec</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#preg_classify">preg_classify</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5322')">Proof.</div>
<div class="proofscript" id="proof5322">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">r</span> <span class="kwd">as</span> [ | [ ] | [ ] | | | ]; <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="commut_mach_asm">commut_mach_asm</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> <span class="id"><a href="compcert.x86.Asm.html#cc_mach_asm">cc_mach_asm</a></span> (<span class="id"><a href="compcert.backend.Mach.html#cc_mach">cc_mach</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>) (<span class="id"><a href="compcert.x86.Asm.html#cc_asm">cc_asm</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5323')">Proof.</div>
<div class="proofscript" id="proof5323">
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">_</span> [<span class="id">rs1</span> <span class="id">nb1</span>]] <span class="id">wR</span>] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> [[ ] <span class="id">Hse2</span>] (<span class="id">qi</span> &amp; <span class="id">Hq1i</span> &amp; <span class="id">Hqi2</span>).<br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> * |- . <span class="tactic">destruct</span> <span class="id">Hq1i</span>. <span class="tactic">destruct</span> <span class="id">q2</span> <span class="kwd">as</span> [<span class="id">rs2</span> <span class="id">m2</span>], <span class="id">Hqi2</span> <span class="kwd">as</span> (<span class="id">Hrs</span> &amp; <span class="id">Hpc</span> &amp; <span class="id">Hm</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">m</span> <span class="id">into</span> <span class="id">m1</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se2</span>, <span class="id">wR</span>, (<span class="id">rs2</span>, <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">m2</span>)). <span class="id">cbn</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> (<span class="id"><a href="compcert.backend.Mach.html#mq">mq</a></span> <span class="id">rs2</span>#<span class="id"><a href="compcert.x86.Asm.html#PC">PC</a></span> <span class="id">rs2</span>#<span class="id"><a href="compcert.x86.Asm.html#SP">SP</a></span> <span class="id">rs2</span>#<span class="id"><a href="compcert.x86.Asm.html#RA">RA</a></span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">rs2</span> (<span class="id"><a href="compcert.x86.Asm.html#preg_of">preg_of</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>)) <span class="id">m2</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">setoid_rewrite</span> <span class="id">H2</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> (<span class="id">Hrs</span> <span class="id"><a href="compcert.x86.Asm.html#PC">PC</a></span>); <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id">Hrs</span> <span class="id"><a href="compcert.x86.Asm.html#SP">SP</a></span>). <span class="tactic">destruct</span> <span class="id">Hrs</span>; <span class="id">inv</span> <span class="id">H0</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">b1</span> &lt; <span class="id">_</span>)%<span class="id">positive</span> <span class="kwd">with</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span> <span class="id">m1</span> <span class="id">b1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id">b2</span> &lt; <span class="id">_</span>)%<span class="id">positive</span> <span class="kwd">with</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span> <span class="id">m2</span> <span class="id">b2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rstep</span>. <span class="id">rstep</span>. <span class="id">rstep</span>. <span class="id">rstep</span>. <span class="tactic">red</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id">Hrs</span> <span class="id"><a href="compcert.x86.Asm.html#RA">RA</a></span>). <span class="tactic">destruct</span> <span class="id">Hrs</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">ri</span> &amp; (<span class="id">wR</span>' &amp; <span class="id">HwR</span>' &amp; <span class="id">Hr1i</span>) &amp; <span class="id">Hri2</span>). <span class="id">inv</span> <span class="id">Hri2</span>. <span class="id">inv</span> <span class="id">Hr1i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">rs1</span>' <span class="id">r</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.driver.CallConv.html#preg_classify">preg_classify</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.driver.CallConv.html#prc_pc">prc_pc</a></span> =&gt; <span class="id">rs1</span> <span class="id"><a href="compcert.x86.Asm.html#RA">RA</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.driver.CallConv.html#prc_sp">prc_sp</a></span> =&gt; <span class="id">rs1</span> <span class="id"><a href="compcert.x86.Asm.html#SP">SP</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.driver.CallConv.html#prc_preg_of">prc_preg_of</a></span> <span class="id">m</span> =&gt; <span class="id">rs0</span> <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.driver.CallConv.html#prc_other">prc_other</a></span> =&gt; <span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">rs1</span>', <span class="id">m0</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#cklr_nextblock_incr">cklr_nextblock_incr</a></span>; <span class="tactic">eauto</span>. <span class="id">rauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span> <span class="id">rs1</span>'. <span class="tactic">intros</span> <span class="id">r</span>. <span class="id">cbn</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.driver.CallConv.html#preg_classify_preg">preg_classify_preg</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">wR</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">r</span>. <span class="tactic">subst</span> <span class="id">rs1</span>'. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.driver.CallConv.html#preg_classify_cases">preg_classify_cases</a></span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">H4</span>. <span class="tactic">generalize</span> (<span class="id">Hrs</span> <span class="id"><a href="compcert.x86.Asm.html#RA">RA</a></span>). <span class="id">rauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">H3</span>. <span class="tactic">generalize</span> (<span class="id">Hrs</span> <span class="id"><a href="compcert.x86.Asm.html#SP">SP</a></span>). <span class="id">rauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- <span class="id">H6</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<br/>
<h1> Typing invariants </h1>
<br/>
<div class="doc">On their own, the typing invariants <span class="bracket"><span class="id">wt_c</span></span> and <span class="bracket"><span class="id">wt_loc</span></span> do not
  commute with CKLRs. This is because a source value may be <span class="bracket"><span class="id">Vundef</span></span>,
  hence well-typed, even when the target value is defined but ill-typed.
  However, we can recover a sufficient commutation property by
  introducing some slack as <span class="bracket"><span class="id">wt</span> @ <span class="id">lessdef</span></span>, where <span class="bracket"><span class="id">lessdef</span></span> is a
  simulation convention allowing values to be refined. Then we can use
  <span class="bracket"><span class="id">Val.ensure_type</span></span> to make sure that the intermediate values are
  well-typed. </div>
<br/>
<h2> Helper lemmas </h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="val_lessdef_inject_list_compose">val_lessdef_inject_list_compose</a></span> <span class="id">f</span> <span class="id">vs_</span> <span class="id">vs1</span> <span class="id">vs2</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.lessdef_list">Val.lessdef_list</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vs_">vs_</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vs1">vs1</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject_list">Val.inject_list</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vs1">vs1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vs2">vs2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject_list">Val.inject_list</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vs_">vs_</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vs2">vs2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5324')">Proof.</div>
<div class="proofscript" id="proof5324">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hvs_</span> <span class="id">Hvs</span>. <span class="id">revert</span> <span class="id">vs2</span> <span class="id">Hvs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hvs_</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> 1; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.val_lessdef_inject_compose">Mem.val_lessdef_inject_compose</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="has_type_inject">has_type_inject</a></span> <span class="id">f</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">t</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="compcert.driver.CallConv.html#v1">v1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#t">t</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> <span class="id"><a href="compcert.driver.CallConv.html#v1">v1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#v2">v2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> <span class="id"><a href="compcert.driver.CallConv.html#v1">v1</a></span> (<span class="id"><a href="compcert.common.Values.html#Val.ensure_type">Val.ensure_type</a></span> <span class="id"><a href="compcert.driver.CallConv.html#v2">v2</a></span> <span class="id"><a href="compcert.driver.CallConv.html#t">t</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5325')">Proof.</div>
<div class="proofscript" id="proof5325">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="compcert.common.Values.html#Val.has_type_ensure">Val.has_type_ensure</a></span> <span class="id">v1</span> <span class="id">t</span>) <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.ensure_type_inject">Val.ensure_type_inject</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="has_type_inject_list">has_type_inject_list</a></span> <span class="id">f</span> <span class="id">vl1</span> <span class="id">vl2</span> <span class="id">tl</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type_list">Val.has_type_list</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vl1">vl1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#tl">tl</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject_list">Val.inject_list</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vl1">vl1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vl2">vl2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">vl2</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type_list">Val.has_type_list</a></span> <span class="id">vl2</span>' <span class="id"><a href="compcert.driver.CallConv.html#tl">tl</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject_list">Val.inject_list</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vl1">vl1</a></span> <span class="id">vl2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.lessdef_list">Val.lessdef_list</a></span> <span class="id">vl2</span>' <span class="id"><a href="compcert.driver.CallConv.html#vl2">vl2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5326')">Proof.</div>
<div class="proofscript" id="proof5326">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Htl</span> <span class="id">Hv</span>. <span class="id">revert</span> <span class="id">tl</span> <span class="id">Htl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hv</span>; <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">tl</span>; <span class="tactic">try</span> <span class="id">contradiction</span>. <span class="tactic">intros</span> <span class="id">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="tactic">repeat</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">tl</span> <span class="kwd">as</span> [ | <span class="id">t</span> <span class="id">tl</span>]; <span class="tactic">try</span> <span class="id">contradiction</span>. <span class="tactic">intros</span> [<span class="id">Ht</span> <span class="id">Htl</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">IHHv</span> <span class="kwd">as</span> (<span class="id">vl2</span>' &amp; <span class="id">Hvl2</span>' &amp; <span class="id">Hvl</span> &amp; <span class="id">Hvl2</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.common.Values.html#Val.ensure_type">Val.ensure_type</a></span> <span class="id">v</span>' <span class="id">t</span> :: <span class="id">vl2</span>'). <span class="tactic">repeat</span> (<span class="id">constructor</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.ensure_has_type">Val.ensure_has_type</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.driver.CallConv.html#has_type_inject">has_type_inject</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">v</span>', <span class="id">t</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> C-level typing constraints </h2>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="lessdef_c_mq">lessdef_c_mq</a></span>: <span class="id"><a href="compcert.common.LanguageInterface.html#c_query">c_query</a></span> -&gt; <span class="id"><a href="compcert.common.LanguageInterface.html#c_query">c_query</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="lessdef_c_mq_intro">lessdef_c_mq_intro</a></span> <span class="id">vf</span> <span class="id">sg</span> <span class="id">args_</span> <span class="id">args</span> <span class="id">m</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.lessdef_list">Val.lessdef_list</a></span> <span class="id"><a href="compcert.driver.CallConv.html#args_">args_</a></span> <span class="id"><a href="compcert.driver.CallConv.html#args">args</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#lessdef_c_mq">lessdef_c_mq</a></span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cq">cq</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vf">vf</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#args_">args_</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>) (<span class="id"><a href="compcert.common.LanguageInterface.html#cq">cq</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vf">vf</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#args">args</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="lessdef_c_mr">lessdef_c_mr</a></span>: <span class="id"><a href="compcert.common.LanguageInterface.html#c_reply">c_reply</a></span> -&gt; <span class="id"><a href="compcert.common.LanguageInterface.html#c_reply">c_reply</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="lessdef_c_mr_intro">lessdef_c_mr_intro</a></span> <span class="id">res_</span> <span class="id">res</span> <span class="id">m</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.lessdef">Val.lessdef</a></span> <span class="id"><a href="compcert.driver.CallConv.html#res_">res_</a></span> <span class="id"><a href="compcert.driver.CallConv.html#res">res</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#lessdef_c_mr">lessdef_c_mr</a></span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cr">cr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#res_">res_</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>) (<span class="id"><a href="compcert.common.LanguageInterface.html#cr">cr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#res">res</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="lessdef_c">lessdef_c</a></span> : <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.LanguageInterface.html#li_c">li_c</a></span> <span class="id"><a href="compcert.common.LanguageInterface.html#li_c">li_c</a></span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#mk_callconv">ccworld</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_senv</span> <span class="id">_</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_query</span> <span class="id">_</span> := <span class="id"><a href="compcert.driver.CallConv.html#lessdef_c_mq">lessdef_c_mq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_reply</span> <span class="id">_</span> := <span class="id"><a href="compcert.driver.CallConv.html#lessdef_c_mr">lessdef_c_mr</a></span>;<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lessdef_c_cklr">lessdef_c_cklr</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#cceqv">cceqv</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#lessdef_c">lessdef_c</a></span> @ <span class="id"><a href="compcert.common.LanguageInterface.html#cc_c">cc_c</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>) (<span class="id"><a href="compcert.common.LanguageInterface.html#cc_c">cc_c</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5327')">Proof.</div>
<div class="proofscript" id="proof5327">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [[<span class="id">_</span> [ ]] <span class="id">wR</span>] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> [[ ] <span class="id">Hse</span>] (<span class="id">qi</span> &amp; <span class="id">Hq1i</span> &amp; <span class="id">Hqi2</span>). <span class="id">cbn</span> <span class="kwd">in</span> * |-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hqi2</span>. <span class="id">inv</span> <span class="id">Hq1i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> <span class="id">wR</span>. <span class="id">cbn</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">clear</span> - <span class="id">H0</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#val_lessdef_inject_list_compose">val_lessdef_inject_list_compose</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">Hr</span>. <span class="id">exists</span> <span class="id">r1</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">r1</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">wR</span> <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">Hse</span> <span class="id">Hq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se1</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id">wR</span>). <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="id">cbn</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">q1</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">q1</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">induction</span> <span class="id">cq_args</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">ri</span> &amp; <span class="id">Hr1i</span> &amp; <span class="id">wR</span>' &amp; <span class="id">HwR</span>' &amp; <span class="id">Hri2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">wR</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">Hri2</span>; <span class="id">inv</span> <span class="id">Hr1i</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.val_lessdef_inject_compose">Mem.val_lessdef_inject_compose</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="commut_wt_c">commut_wt_c</a></span> (<span class="id">R</span> : <span class="id"><a href="compcert.cklr.CKLR.html#cklr">cklr</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> (<span class="id"><a href="compcert.common.Invariant.html#wt_c">wt_c</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#lessdef_c">lessdef_c</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5328')">Proof.</div>
<div class="proofscript" id="proof5328">
&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_assoc">cc_compose_assoc</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.driver.CallConv.html#lessdef_c_cklr">lessdef_c_cklr</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">_</span> [ ]] <span class="id">wR</span>] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> [[ ] <span class="id">Hse</span>] (<span class="id">qi</span> &amp; <span class="id">Hq1i</span> &amp; <span class="id">Hqi2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hqi2</span>. <span class="id">inv</span> <span class="id">Hq1i</span>. <span class="id">inv</span> <span class="id">H4</span>. <span class="id">cbn</span> [<span class="id">cq_sg</span> <span class="id">cq_args</span>] <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">eexists</span> (<span class="id">se2</span>, <span class="id">wR</span>, (<span class="id">se2</span>, (<span class="id">se2</span>, <span class="id">sg</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>)). <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">repeat</span> <span class="id">constructor</span>; <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">edestruct</span> <span class="id"><a href="compcert.driver.CallConv.html#has_type_inject_list">has_type_inject_list</a></span> <span class="kwd">as</span> (<span class="id">vl2</span> &amp; <span class="id">Hvl2</span> &amp; <span class="id">Hvl</span> &amp; <span class="id">Hvl</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cq">cq</a></span> <span class="id">vf2</span> <span class="id">sg</span> <span class="id">vl2</span> <span class="id">m2</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eexists</span>. <span class="tactic">split</span>; <span class="id">constructor</span>; <span class="id">cbn</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">ri</span> &amp; (<span class="id">wR</span>' &amp; <span class="id">HwR</span>' &amp; <span class="id">Hr1i</span>) &amp; <span class="id">rj</span> &amp; <span class="id">Hrij</span> &amp; <span class="id">Hrj2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hr1i</span>. <span class="id">inv</span> <span class="id">Hrij</span>. <span class="id">inv</span> <span class="id">Hrj2</span>. <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>. <span class="id">cbn</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.Valuesrel.html#val_has_type_inject">val_has_type_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exists</span> <span class="id">wR</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.val_inject_lessdef_compose">Mem.val_inject_lessdef_compose</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<h2> Locset-level typing constraints </h2>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="lessdef_loc_mq">lessdef_loc_mq</a></span> <span class="id">sg</span>: <span class="id"><a href="compcert.backend.Conventions.html#locset_query">locset_query</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#locset_query">locset_query</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="lessdef_loc_mq_intro">lessdef_loc_mq_intro</a></span> <span class="id">vf</span> <span class="id">ls1</span> <span class="id">ls2</span> <span class="id">m</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_external_rel">loc_external_rel</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.common.Values.html#Val.lessdef">Val.lessdef</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ls1">ls1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ls2">ls2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#lessdef_loc_mq">lessdef_loc_mq</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#lq">lq</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vf">vf</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ls1">ls1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#lq">lq</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vf">vf</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ls2">ls2</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="lessdef_loc_mr">lessdef_loc_mr</a></span> <span class="id">sg</span>: <span class="id"><a href="compcert.backend.Conventions.html#locset_reply">locset_reply</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#locset_reply">locset_reply</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="lessdef_loc_mr_intro">lessdef_loc_mr_intro</a></span> <span class="id">ls1</span>' <span class="id">ls2</span>' <span class="id">m</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#loc_result_rel">loc_result_rel</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.common.Values.html#Val.lessdef">Val.lessdef</a></span> <span class="id">ls1</span>' <span class="id">ls2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#lessdef_loc_mr">lessdef_loc_mr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#lr">lr</a></span> <span class="id">ls1</span>' <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#lr">lr</a></span> <span class="id">ls2</span>' <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="lessdef_loc">lessdef_loc</a></span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#mk_callconv">match_senv</a></span> <span class="id">_</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_query</span> := <span class="id"><a href="compcert.driver.CallConv.html#lessdef_loc_mq">lessdef_loc_mq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_reply</span> := <span class="id"><a href="compcert.driver.CallConv.html#lessdef_loc_mr">lessdef_loc_mr</a></span>;<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lessdef_loc_cklr">lessdef_loc_cklr</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#cceqv">cceqv</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#lessdef_loc">lessdef_loc</a></span> @ <span class="id"><a href="compcert.backend.Conventions.html#cc_locset">cc_locset</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#cc_locset">cc_locset</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5329')">Proof.</div>
<div class="proofscript" id="proof5329">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [[<span class="id">_</span> <span class="id">xsg</span>] [<span class="id">sg</span> <span class="id">wR</span>]] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> [[ ] <span class="id">Hse</span>] (<span class="id">qi</span> &amp; <span class="id">Hq1i</span> &amp; <span class="id">Hqi2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hqi2</span>. <span class="id">inv</span> <span class="id">Hq1i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">sg</span>, <span class="id">wR</span>). <span class="id">cbn</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> <span class="id">l</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.val_lessdef_inject_compose">Mem.val_lessdef_inject_compose</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">Hr</span>. <span class="id">exists</span> <span class="id">r1</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">r1</span>. <span class="id">constructor</span>. <span class="tactic">intros</span> <span class="id">l</span> <span class="id">Hl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">sg</span> <span class="id">wR</span>] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">Hse</span> <span class="id">Hq</span>. <span class="id">inv</span> <span class="id">Hq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se1</span>, <span class="id">sg</span>, (<span class="id">sg</span>, <span class="id">wR</span>)). <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>. <span class="tactic">split</span>; <span class="id">constructor</span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> <span class="id">l</span> <span class="id">Hl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">ri</span> &amp; <span class="id">Hr1i</span> &amp; <span class="id">wR</span>' &amp; <span class="id">HwR</span>' &amp; <span class="id">Hri2</span>). <span class="id">exists</span> <span class="id">wR</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hri2</span>. <span class="id">inv</span> <span class="id">Hr1i</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span> <span class="id">Hl</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.val_lessdef_inject_compose">Mem.val_lessdef_inject_compose</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="commut_wt_loc">commut_wt_loc</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> (<span class="id"><a href="compcert.backend.Lineartyping.html#wt_loc">wt_loc</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#lessdef_loc">lessdef_loc</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#cc_locset">cc_locset</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#cc_locset">cc_locset</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5330')">Proof.</div>
<div class="proofscript" id="proof5330">
&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_assoc">cc_compose_assoc</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#lessdef_loc_cklr">lessdef_loc_cklr</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">_</span> [<span class="id">xse</span> <span class="id">xsg</span>]] [<span class="id">sg</span> <span class="id">wR</span>]] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> [[ ] <span class="id">Hse</span>] (<span class="id">qi</span> &amp; <span class="id">Hq1i</span> &amp; <span class="id">Hqi2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hqi2</span>. <span class="id">inv</span> <span class="id">Hq1i</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">inv</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se2</span>, (<span class="id">sg</span>, <span class="id">wR</span>), (<span class="id">se2</span>, (<span class="id">se2</span>, <span class="id">sg</span>), <span class="id">sg</span>)). <span class="id">cbn</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">set</span> (<span class="id">ls2_</span> <span class="id">l</span> := <span class="id"><a href="compcert.common.Values.html#Val.ensure_type">Val.ensure_type</a></span> (<span class="id">ls2</span> <span class="id"><a href="compcert.driver.CallConv.html#l">l</a></span>) (<span class="id"><a href="compcert.backend.Locations.html#Loc.type">Loc.type</a></span> <span class="id"><a href="compcert.driver.CallConv.html#l">l</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.backend.Conventions.html#lq">lq</a></span> <span class="id">vf2</span> <span class="id">sg</span> <span class="id">ls2_</span> <span class="id">m2</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> <span class="id">l</span> <span class="id">Hl</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.driver.CallConv.html#has_type_inject">has_type_inject</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>. <span class="tactic">split</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.ensure_has_type">Val.ensure_has_type</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">l</span> <span class="id">Hl</span>. <span class="tactic">subst</span> <span class="id">ls2_</span>; <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id">ls2</span> <span class="id">l</span>), <span class="id"><a href="compcert.backend.Locations.html#Loc.type">Loc.type</a></span>; <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">ri</span> &amp; (<span class="id">wR</span>' &amp; <span class="id">HwR</span>' &amp; <span class="id">Hr1i</span>) &amp; <span class="id">rj</span> &amp; <span class="id">Hrij</span> &amp; <span class="id">Hrj2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hr1i</span>. <span class="id">inv</span> <span class="id">Hrij</span>. <span class="id">inv</span> <span class="id">Hrj2</span>. <span class="id">inv</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.backend.Conventions.html#lr">lr</a></span> <span class="id">ls1</span>' <span class="id">m1</span>'). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="id">constructor</span>. <span class="tactic">intros</span> <span class="id">r</span> <span class="id">Hr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.Valuesrel.html#val_has_type_inject">val_has_type_inject</a></span>; <span class="tactic">eauto</span>. <span class="tactic">red</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">wR</span>'. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">r</span> <span class="id">Hr</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.val_inject_lessdef_compose">Mem.val_inject_lessdef_compose</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> Another option for <span class="bracket"><span class="id">wt_c</span></span> </h2>
<br/>
<div class="doc">An alternative approach for <span class="bracket"><span class="id">wt_c</span></span> would be to formulate a typing
  constraint on the target queries and replies, which can be
  propagated towards the source as <span class="bracket"><span class="id">ccref</span> (<span class="id">cc</span> @ <span class="id">wt</span>) (<span class="id">wt</span> @ <span class="id">cc</span> @ <span class="id">wt</span>)</span>.
  Then we can use the following property to make it part of the
  source-level compatibility relations to satisfy the typing
  requirements of other components' external calls. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="star_inv_prop">star_inv_prop</a></span> {<span class="id">li</span>} (<span class="id">R</span> : <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.driver.CallConv.html#li">li</a></span> <span class="id"><a href="compcert.driver.CallConv.html#li">li</a></span>) (<span class="id">I</span> : <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.driver.CallConv.html#li">li</a></span>) :<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> 1 <span class="id"><a href="compcert.driver.CallConv.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#cceqv">cceqv</a></span> ((<span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> + <span class="id"><a href="compcert.driver.CallConv.html#I">I</a></span>)^{*} @ <span class="id"><a href="compcert.driver.CallConv.html#I">I</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>^{*} @ <span class="id"><a href="compcert.driver.CallConv.html#I">I</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5331')">Proof.</div>
<div class="proofscript" id="proof5331">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_id_left">cc_compose_id_left</a></span> <span class="id">I</span>)) <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_id_star">cc_id_star</a></span> <span class="id">R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_star_ind_l">cc_star_ind_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_join_distr_l">cc_join_distr_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_join_lub">cc_join_lub</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_one_star">cc_one_star</a></span> <span class="id">R</span>) <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_compose_assoc">cc_compose_assoc</a></span>, <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_star_idemp">cc_star_idemp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id"><a href="compcert.common.Invariant.html#inv_drop">inv_drop</a></span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="id">rstep</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_join_ub_l">cc_join_ub_l</a></span>.<br/>
Qed.</div>
<br/>
<br/>
<h1> Stacking </h1>
<br/>
<div class="doc">The simulation conventions for most passes are simple enough that
  we can express them directly as <span class="bracket"><span class="id">R</span> @ <span class="id">CC</span></span>, where <span class="bracket"><span class="id">R</span></span> is a CKLR
  matching the memory relation used in the simulation proof, and
  <span class="bracket"><span class="id">CC</span></span> expresses the structural correspondance between source- and
  target-level queries and replies. However, the Stacking pass
  involves fairly complex invariants and it is simpler to formulate
  the corresponding simulation convention as a monolithic one, closely
  coupled with the corresponding simulation proof.
  In the following we show that this simulation convention can then be
  decoupled into a CKLR and a structural convention. This form is then
  used as the outside interface for the pass and integrated to the
  strategy outlined above. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical.html">Classical</a></span>.<br/>
<br/>
<h2> Structural convention </h2>
<br/>
<div class="doc">The first step is to define the structural convention we will be
  using between <span class="bracket"><span class="id">li_locset</span></span> and <span class="bracket"><span class="id">li_mach</span></span>. </div>
<br/>
<h3> Dealing with the arguments region </h3>
<br/>
<div class="doc">One key aspect of this convention is the encoding of arguments: at
  the source level, arguments for the call are stored in abstract
  locations, which become either registers or in-memory stack slots at
  the target level. Crucially, these stack slots must not be
  accessible as memory locations in the source program, otherwise the
  invariant relating abstract and concrete stack locations may be
  broken through aliasing. Hence, in the structural convention the
  source memory cannot be *equal* to the target memory, but instead
  must be a version of the target memory where permissions on the
  arguments region of the stack have been removed.
  For queries, this can be expressed using <span class="bracket"><span class="id">Mem.free</span></span>. We also deal
  separately with the case where no arguments are stored in the stack.
  This is both to ensure the compatibility of <span class="bracket"><span class="id">args_removed</span></span> with
  injection, and to allow <span class="bracket"><span class="id">Vnullptr</span></span> as a possible stack pointer for
  the initial call to <span class="bracket"><span class="id">main</span>()</span>. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="args_removed">args_removed</a></span> <span class="id">sg</span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span> -&gt; <span class="id"><a href="compcert.common.Memory.html#mem">mem</a></span> -&gt; <span class="id"><a href="compcert.common.Memory.html#mem">mem</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="args_removed_tailcall_possible">args_removed_tailcall_possible</a></span> <span class="id">sp</span> <span class="id">m</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible">tailcall_possible</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#args_removed">args_removed</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="args_removed_free">args_removed_free</a></span> <span class="id">sb</span> <span class="id">sofs</span> <span class="id">m</span> <span class="id">m_</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.free">Mem.free</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sb">sb</a></span> (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs">sofs</a></span> 0) (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs">sofs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m_">m_</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span>, 0 &lt;= <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> &lt; <span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> -&gt; <span class="id"><a href="compcert.backend.Mach.html#offset_fits">offset_fits</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs">sofs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> &gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">ty</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ty">ty</a></span>) (<span class="id"><a href="compcert.common.AST.html#regs_of_rpairs">regs_of_rpairs</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_arguments">loc_arguments</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>, <span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sb">sb</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs">sofs</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#ty">ty</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#fe_ofs_arg">fe_ofs_arg</a></span> + 4 * <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.driver.CallConv.html#v">v</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#args_removed">args_removed</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> (<span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sb">sb</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs">sofs</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m_">m_</a></span>.<br/>
<br/>
<div class="doc">This takes care of how the LTL memory state is obtained from the
  Mach-level one. In addition, the following construction reconstructs
  the LTL-level <span class="bracket"><span class="id">locset</span></span> from the Mach-level <span class="bracket"><span class="id">regset</span></span> by reading the
  additional stack locations from the Mach memory. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="make_locset">make_locset</a></span> (<span class="id">rs</span>: <span class="id"><a href="compcert.backend.Mach.html#regset">Mach.regset</a></span>) (<span class="id">m</span>: <span class="id"><a href="compcert.common.Memory.html#mem">mem</a></span>) (<span class="id">sp</span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span>) (<span class="id">l</span>: <span class="id"><a href="compcert.backend.Locations.html#loc">loc</a></span>) : <span class="id"><a href="compcert.common.Values.html#val">val</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.driver.CallConv.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#rs">rs</a></span> <span class="id">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="compcert.backend.Locations.html#S">S</a></span> <span class="id"><a href="compcert.backend.Locations.html#Outgoing">Outgoing</a></span> <span class="id">ofs</span> <span class="id">ty</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">v</span> := <span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span> <span class="id">ty</span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> (<span class="id"><a href="compcert.x86.Stacklayout.html#fe_ofs_arg">fe_ofs_arg</a></span> + 4 * <span class="id">ofs</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.maketotal">Val.maketotal</a></span> <span class="id"><a href="compcert.driver.CallConv.html#v">v</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">For replies, in some simulation convention refinement properties
  we want to establish, the source memory state is often given to us
  and we have to establish the relationship. This means we can't use
  <span class="bracket"><span class="id">Mem.free</span></span> in the same way; fortunately, it is enough to give a more
  extensional characterization in terms of <span class="bracket"><span class="id">Mem.unchanged</span></span> involving
  the following address predicate. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="not_init_args">not_init_args</a></span> (<span class="id">sz</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">sp</span>: <span class="id"><a href="compcert.common.Values.html#val">val</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">b</span> <span class="id">ofs</span> =&gt; ~ <span class="id"><a href="compcert.backend.Mach.html#loc_init_args">loc_init_args</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b">b</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>.<br/>
<br/>
<h3> Definition </h3>
<br/>
<div class="doc">We can now define the structural convention
  from <span class="bracket"><span class="id">li_locset</span></span> to <span class="bracket"><span class="id">li_mach</span></span>. </div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="cc_lm_world">cc_lm_world</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="lmw">lmw</a></span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lmw_sg">lmw_sg</a></span> : <span class="id"><a href="compcert.common.AST.html#signature">signature</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lmw_rs">lmw_rs</a></span> : <span class="id"><a href="compcert.backend.Mach.html#regset">Mach.regset</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lmw_m">lmw_m</a></span> : <span class="id"><a href="compcert.common.Memory.html#mem">mem</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="lmw_sp">lmw_sp</a></span> : <span class="id"><a href="compcert.common.Values.html#val">val</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cc_locset_mach_mq">cc_locset_mach_mq</a></span>: <span class="id"><a href="compcert.driver.CallConv.html#cc_lm_world">cc_lm_world</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#locset_query">locset_query</a></span> -&gt; <span class="id"><a href="compcert.backend.Mach.html#mach_query">mach_query</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="cc_locset_mach_mq_intro">cc_locset_mach_mq_intro</a></span> <span class="id">sg</span> <span class="id">vf</span> <span class="id">m_</span> <span class="id">rs</span> <span class="id">sp</span> <span class="id">ra</span> <span class="id">m</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#args_removed">args_removed</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m_">m_</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span> <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ra">ra</a></span> <span class="id"><a href="compcert.common.AST.html#Tptr">Tptr</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#cc_locset_mach_mq">cc_locset_mach_mq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.driver.CallConv.html#lmw">lmw</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#rs">rs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Conventions.html#lq">lq</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vf">vf</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#make_locset">make_locset</a></span> <span class="id"><a href="compcert.driver.CallConv.html#rs">rs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#m_">m_</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.backend.Mach.html#mq">mq</a></span> <span class="id"><a href="compcert.driver.CallConv.html#vf">vf</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ra">ra</a></span> <span class="id"><a href="compcert.driver.CallConv.html#rs">rs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cc_locset_mach_mr">cc_locset_mach_mr</a></span>: <span class="id"><a href="compcert.driver.CallConv.html#cc_lm_world">cc_lm_world</a></span> -&gt; <span class="id"><a href="compcert.backend.Conventions.html#locset_reply">locset_reply</a></span> -&gt; <span class="id"><a href="compcert.backend.Mach.html#mach_reply">mach_reply</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="cc_locset_mach_mr_intro">cc_locset_mach_mr_intro</a></span> <span class="id">sg</span> <span class="id">rs</span> <span class="id">ls</span>' <span class="id">m</span>'<span class="id">_</span> <span class="id">sp</span> <span class="id">m</span> <span class="id">rs</span>' <span class="id">m</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpair">regs_of_rpair</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span>)) -&gt; <span class="id">rs</span>' <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span> = <span class="id">ls</span>' (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id">rs</span>' <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span> = <span class="id"><a href="compcert.driver.CallConv.html#rs">rs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#not_init_args">not_init_args</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span>) <span class="id">m</span>'<span class="id">_</span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> (<span class="id"><a href="compcert.backend.Mach.html#loc_init_args">loc_init_args</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">m</span>'<span class="id">_</span> = <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>, <span class="id"><a href="compcert.backend.Mach.html#loc_init_args">loc_init_args</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b">b</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m</span>'<span class="id">_</span> <span class="id"><a href="compcert.driver.CallConv.html#b">b</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#k">k</a></span> <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#cc_locset_mach_mr">cc_locset_mach_mr</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#lmw">lmw</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#rs">rs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp">sp</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#lr">lr</a></span> <span class="id">ls</span>' <span class="id">m</span>'<span class="id">_</span>) (<span class="id"><a href="compcert.backend.Mach.html#mr">mr</a></span> <span class="id">rs</span>' <span class="id">m</span>').<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="cc_locset_mach">cc_locset_mach</a></span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.backend.Conventions.html#li_locset">li_locset</a></span> <span class="id"><a href="compcert.backend.Mach.html#li_mach">li_mach</a></span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#mk_callconv">match_senv</a></span> <span class="id">_</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_query</span> := <span class="id"><a href="compcert.driver.CallConv.html#cc_locset_mach_mq">cc_locset_mach_mq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_reply</span> := <span class="id"><a href="compcert.driver.CallConv.html#cc_locset_mach_mr">cc_locset_mach_mr</a></span>;<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<h2> Commutation property </h2>
<br/>
<div class="doc">For queries, we need to synthesizing the target-level locset by
  extracting arguments from the memory and then removing them. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="offset_sarg_inject">offset_sarg_inject</a></span> <span class="id">R</span> <span class="id">w</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">sb1</span> <span class="id">sofs1</span> <span class="id">sb2</span> <span class="id">sofs2</span> <span class="id">ofs</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span> (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span> 0) <span class="id"><a href="compcert.common.Memtype.html#Cur">Cur</a></span> <span class="id"><a href="compcert.common.Memtype.html#Freeable">Freeable</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.Valuesrel.html#ptrbits_inject">ptrbits_inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#sb2">sb2</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#sofs2">sofs2</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.Valuesrel.html#ptr_inject">ptr_inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span>, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#sb2">sb2</a></span>, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs2">sofs2</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5332')">Proof.</div>
<div class="proofscript" id="proof5332">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hm</span> <span class="id">Hp</span> <span class="id">Hsp</span>. <span class="id">inv</span> <span class="id">Hsp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_0_r">Z.add_0_r</a></span> <span class="kwd">in</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.cklr.Valuesrel.html#ptr_inject_shift">ptr_inject_shift</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#ptrbits_ptr_inject">ptrbits_ptr_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_assoc">Ptrofs.add_assoc</a></span>, (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id">_</span>)), &lt;- <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_assoc">Ptrofs.add_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="offset_sarg_expand">offset_sarg_expand</a></span> <span class="id">ofs</span> <span class="id">sofs</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs">sofs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> = <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs">sofs</a></span> 0 + 4 * <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5333')">Proof.</div>
<div class="proofscript" id="proof5333">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="offset_sarg_ptrrange_inject">offset_sarg_ptrrange_inject</a></span> <span class="id">R</span> <span class="id">w</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">sb1</span> <span class="id">sofs1</span> <span class="id">sb2</span> <span class="id">sofs2</span> <span class="id">ofs</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span> (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span> 0) <span class="id"><a href="compcert.common.Memtype.html#Cur">Cur</a></span> <span class="id"><a href="compcert.common.Memtype.html#Freeable">Freeable</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.Valuesrel.html#ptrbits_inject">ptrbits_inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span>) (<span class="id"><a href="compcert.driver.CallConv.html#sb2">sb2</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#sofs2">sofs2</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.Valuesrel.html#ptrrange_inject">ptrrange_inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span>, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span> 0, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.driver.CallConv.html#sb2">sb2</a></span>, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs2">sofs2</a></span> 0, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs2">sofs2</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5334')">Proof.</div>
<div class="proofscript" id="proof5334">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> !(<span class="id"><a href="compcert.driver.CallConv.html#offset_sarg_expand">offset_sarg_expand</a></span> <span class="id">ofs</span>).<br/>
&nbsp;&nbsp;<span class="id">rstep</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#offset_sarg_inject">offset_sarg_inject</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="offset_fits_inject">offset_fits_inject</a></span> <span class="id">R</span> <span class="id">w</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">sb1</span> <span class="id">sb2</span> <span class="id">delta</span> <span class="id">sofs1</span> <span class="id">sofs2</span> <span class="id">ofs</span> <span class="id">sz</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span> (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span> 0) (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span>) <span class="id"><a href="compcert.common.Memtype.html#Cur">Cur</a></span> <span class="id"><a href="compcert.common.Memtype.html#Freeable">Freeable</a></span> -&gt;<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> &lt; <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#sb2">sb2</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#delta">delta</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#sofs2">sofs2</a></span> = <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add">Ptrofs.add</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#delta">delta</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#offset_fits">offset_fits</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#offset_fits">offset_fits</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs2">sofs2</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5335')">Proof.</div>
<div class="proofscript" id="proof5335">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hm</span> <span class="id">PERM</span> <span class="id">Hofs</span> <span class="id">Hsb</span> <span class="id">Hsofs2</span> <span class="id">FITS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_fits">offset_fits</a></span>, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *. <span class="tactic">subst</span> <span class="id">sofs2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> !(<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span> <span class="id">sofs1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> !(<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_assoc">Ptrofs.add_assoc</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id">delta</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> !(<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.repr">Ptrofs.repr</a></span> <span class="id">delta</span>)).<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.cklr.CKLR.html#cklr_address_inject">cklr_address_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_assoc">Z.add_assoc</a></span> <span class="id">_</span> <span class="id">delta</span>), (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_comm">Z.add_comm</a></span> <span class="id">delta</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_assoc">Z.add_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">FITS</span>.<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="compcert.cklr.CKLR.html#cklr_address_inject">cklr_address_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">PERM</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">PERM</span>. <span class="id">xomega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="load_stack_inject">load_stack_inject</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id">Monotonic</span> <span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(|= <span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> ++&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> @@ [<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>] ++&gt; - ==&gt; - ==&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">k1</span> <span class="id">option_le</span> (<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> @@ [<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>])).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5336')">Proof.</div>
<div class="proofscript" id="proof5336">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span>. <span class="id">rauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="args_removed_cklr">args_removed_cklr</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id">Monotonic</span> <span class="id"><a href="compcert.driver.CallConv.html#args_removed">args_removed</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(|= - ==&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> @@ [<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>] ++&gt; <span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> ++&gt; <span class="id">k1</span> <span class="id">set_le</span> (&lt;&gt; <span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5337')">Proof.</div>
<div class="proofscript" id="proof5337">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">w</span> <span class="id">sg</span> <span class="id">sp1</span> <span class="id">sp2</span> <span class="id">Hsp</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">Hm</span> <span class="id">m1_</span> <span class="id">Hm1_</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm1_</span> <span class="kwd">as</span> [<span class="id">sp</span> <span class="id">m1</span> | <span class="id">sb1</span> <span class="id">sofs1</span> <span class="id">m1</span> <span class="id">m1_</span> <span class="id">FREE</span> <span class="id">FITS</span>].<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">m2</span>. <span class="tactic">split</span>; [ | <span class="id">rauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hsp</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">sofs2</span> := <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add">Ptrofs.add</a></span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.Valuesrel.html#ptr_inject">ptr_inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id">R</span> <span class="id">w</span>) (<span class="id">sb1</span>, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs1</span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>) (<span class="id">b2</span>, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs2</span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#offset_sarg_inject">offset_sarg_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.cklr.Valuesrel.html#ptrrange_inject">ptrrange_inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id">R</span> <span class="id">w</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sb1</span>, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs1</span> 0, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs1</span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id">sg</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">b2</span>, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs2</span> 0, <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs2</span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id">sg</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.Valuesrel.html#ptr_ptrrange_inject">ptr_ptrrange_inject</a></span>; <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">FREE</span>. <span class="id">transport</span> <span class="id">FREE</span>. <span class="tactic">intros</span> <span class="id">FREE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#args_removed_free">args_removed_free</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">clear</span> - <span class="id">Hm</span> <span class="id">FITS</span> <span class="id">H3</span> <span class="id">FREE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ofs</span> <span class="id">Hofs</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#offset_fits_inject">offset_fits_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">REG</span>. <span class="id">edestruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">v</span> <span class="id">Hv</span>]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">transport</span> <span class="id">Hv</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 1 (<span class="id">Transport</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id">set_le_transport</span> @<span class="id"><a href="compcert.driver.CallConv.html#args_removed">args_removed</a></span> : <span class="id">typeclass_instances</span>.<br/>
<br/>
<div class="doc">For replies, the challenge is to construct a version of the source
  memory state which contains the original arguments, and a version of
  the source <span class="bracket"><span class="id">Mach.regset</span></span> which contains the right mixture of
  original callee-save registers and results from the reply's
  locset. The following lemmas will help. </div>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="Mixable">Mixable</a></span> (<span class="id">R</span> : <span class="id"><a href="compcert.cklr.CKLR.html#cklr">cklr</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a name="result_mem">result_mem</a></span> <span class="id">sz</span> <span class="id">sp1</span> <span class="id">sp2</span> <span class="id">w</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">w</span>' <span class="id">m1</span>'<span class="id">_</span> <span class="id">m2</span>'<span class="id">_</span> <span class="id">m2</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span> ~&gt; <span class="id">w</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#sp1">sp1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp2">sp2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id">w</span>' <span class="id">m1</span>'<span class="id">_</span> <span class="id">m2</span>'<span class="id">_</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> (<span class="id"><a href="compcert.backend.Mach.html#loc_init_args">loc_init_args</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp2">sp2</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#m2">m2</a></span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#not_init_args">not_init_args</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp2">sp2</a></span>) <span class="id">m2</span>'<span class="id">_</span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.extends">Mem.extends</a></span> <span class="id">m2</span>'<span class="id">_</span> <span class="id">m2</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.backend.Mach.html#loc_init_args">loc_init_args</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp2">sp2</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b">b</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#loc_out_of_reach">loc_out_of_reach</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id">w</span>') <span class="id">m1</span>'<span class="id">_</span> <span class="id"><a href="compcert.driver.CallConv.html#b">b</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(2 | <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span> &gt; 0 -&gt; <span class="id"><a href="compcert.backend.Mach.html#valid_blockv">valid_blockv</a></span> (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#sp1">sp1</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span> &gt; 0 -&gt; <span class="kwd">forall</span> <span class="id">b1</span> <span class="id">ofs1</span>, <span class="id"><a href="compcert.driver.CallConv.html#sp1">sp1</a></span> = <span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b1">b1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs1">ofs1</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.range_perm">Mem.range_perm</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b1">b1</a></span> (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs1">ofs1</a></span> 0) (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs1">ofs1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span>) <span class="id"><a href="compcert.common.Memtype.html#Cur">Cur</a></span> <span class="id"><a href="compcert.common.Memtype.html#Freeable">Freeable</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w</span>'' <span class="id">m1</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#w">w</a></span> ~&gt; <span class="id">w</span>'' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id">w</span>') (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id">w</span>'') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> <span class="id">w</span>'' <span class="id">m1</span>' <span class="id">m2</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> (<span class="id"><a href="compcert.backend.Mach.html#loc_init_args">loc_init_args</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp1">sp1</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id">m1</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#not_init_args">not_init_args</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sz">sz</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sp1">sp1</a></span>) <span class="id">m1</span>'<span class="id">_</span> <span class="id">m1</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">m1</span>' = <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">m1</span>'<span class="id">_</span>.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="ext_mixable">ext_mixable</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Mixable">Mixable</a></span> <span class="id"><a href="compcert.cklr.Extends.html#ext">ext</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5338')">Proof.</div>
<div class="proofscript" id="proof5338">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sz</span> <span class="id">sp1</span> <span class="id">sp2</span> [ ] <span class="id">m1</span> <span class="id">m2</span> [ ] <span class="id">m1</span>'<span class="id">_</span> <span class="id">m2</span>'<span class="id">_</span> <span class="id">m2</span>' <span class="id">_</span> <span class="id">Hsp</span> <span class="id">Hm</span> <span class="id">Hm</span>'<span class="id">_</span> <span class="id">UPD</span> <span class="id">UNCH</span> <span class="id">EXT</span> <span class="id">OOR</span> <span class="id">_</span> <span class="id">VB</span>.<br/>
&nbsp;&nbsp;<span class="id">uncklr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">sz</span> &gt; 0 /\ <span class="id">exists</span> <span class="id">sb1</span> <span class="id">sofs1</span>, <span class="id">sp1</span> = <span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span>)).<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">SZ</span> &amp; <span class="id">sb1</span> &amp; <span class="id">sofs1</span> &amp; <span class="id">Hsp1</span>). <span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">Hsp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mixable">Mem.mixable</a></span> <span class="id">m1</span>'<span class="id">_</span> <span class="id">sb1</span> <span class="id">m1</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mext_next">Mem.mext_next</a></span> <span class="id">m1</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mext_next">Mem.mext_next</a></span> <span class="id">m1</span>'<span class="id">_</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mext_next">Mem.mext_next</a></span> <span class="id">m2</span>'<span class="id">_</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_nextblock">Mem.unchanged_on_nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">VB</span> <span class="id">SZ</span>). <span class="id">inv</span> <span class="id">VB</span>. <span class="tactic">auto</span>. <span class="comment">(*&nbsp;could&nbsp;restrict&nbsp;to&nbsp;sz&nbsp;&gt;&nbsp;0&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.mixable_mix">Mem.mixable_mix</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">m1</span>' ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id">m1</span>'. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#inject_incr_refl">inject_incr_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cbn</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.mix_left_extends">Mem.mix_left_extends</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.extends_extends_compose">Mem.extends_extends_compose</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_implies">Mem.unchanged_on_implies</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_</span> <span class="id">ofs</span> [-&gt; <span class="id">Hofs</span>] <span class="id">VLD</span>. <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_implies">Mem.unchanged_on_implies</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.mix_updated">Mem.mix_updated</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_implies">Mem.unchanged_on_implies</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.mix_unchanged">Mem.mix_unchanged</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_</span> <span class="id">ofs</span> <span class="id">NIA</span> <span class="id">_</span> [&lt;- <span class="id">Hofs</span>]. <span class="tactic">apply</span> <span class="id">NIA</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_mix">Mem.nextblock_mix</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id">m1</span>'<span class="id">_</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#inject_incr_refl">inject_incr_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.extends_extends_compose">Mem.extends_extends_compose</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mext_next">Mem.mext_next</a></span> <span class="id">m1</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mext_next">Mem.mext_next</a></span> <span class="id">m1</span>'<span class="id">_</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mext_next">Mem.mext_next</a></span> <span class="id">m2</span>'<span class="id">_</span>) <span class="tactic">by</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_nextblock">Mem.unchanged_on_nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> 1; <span class="id">eelim</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> 1; <span class="id">eelim</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_refl">Mem.unchanged_on_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="inj_mixable">inj_mixable</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Mixable">Mixable</a></span> <span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5339')">Proof.</div>
<div class="proofscript" id="proof5339">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sz</span> <span class="id">sp1</span> <span class="id">sp2</span> <span class="id">w</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">w</span>' <span class="id">m1</span>'<span class="id">_</span> <span class="id">m2</span>'<span class="id">_</span> <span class="id">m2</span>' <span class="id">Hw</span> <span class="id">Hsp</span> <span class="id">Hm</span> <span class="id">Hm</span>'<span class="id">_</span> <span class="id">UPD</span> <span class="id">UNCH</span> <span class="id">EXT</span> <span class="id">OOR</span> <span class="id">SZ</span> <span class="id">VB</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">SZ</span> <span class="kwd">as</span> [<span class="id">k</span> <span class="id">Hk</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">k</span> &gt; 0 /\ <span class="id">exists</span> <span class="id">sb1</span> <span class="id">sofs1</span>, <span class="id">sp1</span> = <span class="id"><a href="compcert.common.Values.html#Vptr">Vptr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sb1">sb1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sofs1">sofs1</a></span>)).<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Hk</span> &amp; <span class="id">sb1</span> &amp; <span class="id">sofs1</span> &amp; <span class="id">Hsp1</span>). <span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">Hsp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mixable">Mem.mixable</a></span> <span class="id">m1</span>'<span class="id">_</span> <span class="id">sb1</span> <span class="id">m1</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Hm</span>, <span class="id">Hm</span>'<span class="id">_</span>. <span class="id">inv</span> <span class="id">Hw</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">SZ</span>: <span class="id">k</span> * 2 &gt; 0) <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">VB</span> <span class="id">SZ</span>). <span class="id">inv</span> <span class="id">VB</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.mixable_mix">Mem.mixable_mix</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">m1</span>' <span class="id">Hm1</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs1</span> (<span class="id">k</span> * 2)) <span class="kwd">in</span> <span class="id">Hm1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs1</span> 0) <span class="kwd">in</span> <span class="id">Hm1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w</span>', <span class="id">m1</span>'. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#inject_incr_refl">inject_incr_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inv</span> <span class="id">Hm</span>. <span class="id">inv</span> <span class="id">Hm</span>'<span class="id">_</span>. <span class="id">inv</span> <span class="id">Hw</span>. <span class="id">cbn</span> -[<span class="id">Z.add</span> <span class="id">Z.mul</span>] <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_mix">Mem.nextblock_mix</a></span> <span class="id">m1</span>'<span class="id">_</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mext_next">Mem.mext_next</a></span> <span class="id">m2</span>'<span class="id">_</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.mix_left_inject">Mem.mix_left_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.inject_extends_compose">Mem.inject_extends_compose</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_implies">Mem.unchanged_on_implies</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_</span> <span class="id">ofs</span> [-&gt; <span class="id">Hofs</span>] <span class="id">VLD</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span> <span class="id">sofs1</span>), <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_assoc">Ptrofs.add_assoc</a></span>, <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.address_inject">Mem.address_inject</a></span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span>); <span class="tactic">eauto</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="id">xomega</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">b1</span>' <span class="id">delta</span>' <span class="id">ofs</span> <span class="id">pk</span> <span class="id">p</span> <span class="id">Hb</span>' <span class="id">Hofs</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">OOR</span> <span class="id">b2</span> <span class="id">ofs</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">constructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span> <span class="id">sofs1</span>), <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_assoc">Ptrofs.add_assoc</a></span>, <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.address_inject">Mem.address_inject</a></span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span>); <span class="tactic">eauto</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="id">xomega</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_max">Mem.perm_max</a></span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm_implies">Mem.perm_implies</a></span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.mi_align">Mem.mi_align</a></span> <span class="kwd">with</span> (<span class="id">chunk</span> := <span class="id"><a href="compcert.common.AST.html#Mint64">Mint64</a></span>); <span class="tactic">eauto</span> <span class="kwd">using</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.mi_inj">Mem.mi_inj</a></span> <span class="id">f</span> <span class="id">m1</span> <span class="id">m2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (2 := <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs1</span> 0). <span class="tactic">intros</span> <span class="id">ofs</span> <span class="id">Hofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_max">Mem.perm_max</a></span>, <span class="id">H</span>; <span class="tactic">eauto</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *; <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Hofs</span>; <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_implies">Mem.unchanged_on_implies</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.mix_updated">Mem.mix_updated</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_implies">Mem.unchanged_on_implies</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.mix_unchanged">Mem.mix_unchanged</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_</span> <span class="id">ofs</span> <span class="id">NIA</span> <span class="id">_</span> [&lt;- <span class="id">Hofs</span>]. <span class="tactic">apply</span> <span class="id">NIA</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_mix">Mem.nextblock_mix</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inv</span> <span class="id">Hm</span>. <span class="id">inv</span> <span class="id">Hm</span>'<span class="id">_</span>. <span class="id">inv</span> <span class="id">Hw</span>. <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> (<span class="id"><a href="compcert.cklr.Inject.html#injw">injw</a></span> <span class="id">f0</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">m1</span>'<span class="id">_</span>) (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">m2</span>')), <span class="id">m1</span>'<span class="id">_</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_nextblock">Mem.unchanged_on_nextblock</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#inject_incr_refl">inject_incr_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.inject_extends_compose">Mem.inject_extends_compose</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> 1; <span class="id">eelim</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> 1; <span class="id">eelim</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_refl">Mem.unchanged_on_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="vainj_mixable">vainj_mixable</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Mixable">Mixable</a></span> <span class="id"><a href="compcert.cklr.VAInject.html#vainj">vainj</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5340')">Proof.</div>
<div class="proofscript" id="proof5340">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sz</span> <span class="id">sp1</span> <span class="id">sp2</span> <span class="id">w</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">w</span>' <span class="id">m1</span>'<span class="id">_</span> <span class="id">m2</span>'<span class="id">_</span> <span class="id">m2</span>' <span class="id">Hw</span> <span class="id">Hsp</span> <span class="id">Hm</span> <span class="id">Hm</span>'<span class="id">_</span> <span class="id">UPD</span> <span class="id">UNCH</span> <span class="id">EXT</span> <span class="id">OOR</span> <span class="id">SZ</span> <span class="id">VB</span> <span class="id">RANGE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm</span>, <span class="id">Hm</span>'<span class="id">_</span>. <span class="id">inv</span> <span class="id">Hw</span>. <span class="id">cbn</span> <span class="kwd">in</span> *. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id"><a href="compcert.driver.CallConv.html#result_mem">result_mem</a></span> (<span class="id">R</span>:=<span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span>) <span class="id">sz</span> <span class="id">sp1</span> <span class="id">sp2</span> <span class="id">w</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">w0</span>) <span class="kwd">as</span> (? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se0</span>, <span class="id">x</span>), <span class="id">x0</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">cu</span> <span class="id">Hcu</span>. <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">cu</span> <span class="id">Hcu</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">id</span> <span class="id">ab</span> <span class="id">Hab</span> <span class="id">Habcu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">H0</span> <span class="kwd">as</span> (? &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">H3</span> <span class="kwd">as</span> (? &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">ofs</span>, <span class="id"><a href="compcert.driver.CallConv.html#not_init_args">not_init_args</a></span> <span class="id">sz</span> <span class="id">sp1</span> <span class="id">b</span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ofs</span>. <span class="tactic">destruct</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H14</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_max">Mem.perm_max</a></span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm_implies">Mem.perm_implies</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">RANGE</span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">x0</span> <span class="id">b</span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#k">k</a></span> <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span> -&gt; <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span> <span class="id">m0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H11</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H16</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">H16</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">intros</span>. <span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_unchanged_on_1">Mem.load_unchanged_on_1</a></span> <span class="kwd">in</span> <span class="id">H22</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_valid_access">Mem.load_valid_access</a></span> <span class="kwd">in</span> <span class="id">H22</span> <span class="kwd">as</span> [? ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H19</span>. <span class="tactic">eapply</span> <span class="id">H22</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.common.Memdata.html#size_chunk_pos">size_chunk_pos</a></span> <span class="id">chunk</span>). <span class="id">instantiate</span> (1 := <span class="id">ofs</span>). <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">intros</span>. <span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.loadbytes_unchanged_on_1">Mem.loadbytes_unchanged_on_1</a></span> <span class="kwd">in</span> <span class="id">H22</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.loadbytes_range_perm">Mem.loadbytes_range_perm</a></span> <span class="kwd">in</span> <span class="id">H22</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H19</span>. <span class="tactic">eapply</span> <span class="id">H22</span>. <span class="id">instantiate</span> (1 := <span class="id">ofs</span>). <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>. <span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_unchanged_on_1">Mem.load_unchanged_on_1</a></span> <span class="kwd">in</span> <span class="id">H21</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_valid_access">Mem.load_valid_access</a></span> <span class="kwd">in</span> <span class="id">H21</span> <span class="kwd">as</span> [? ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H19</span>. <span class="tactic">eapply</span> <span class="id">H21</span>. <span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.common.Memdata.html#size_chunk_pos">size_chunk_pos</a></span> <span class="id">chunk</span>). <span class="id">instantiate</span> (1 := <span class="id">ofs</span>). <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">ofs</span> <span class="id">Hp</span>. <span class="tactic">eapply</span> <span class="id">H17</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_perm">Mem.unchanged_on_perm</a></span> <span class="kwd">in</span> <span class="id">Hp</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H11</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="size_arguments_always_64">size_arguments_always_64</a></span> <span class="id">sg</span>:<br/>
&nbsp;&nbsp;(2 | <span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id"><a href="compcert.driver.CallConv.html#sg">sg</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5341')">Proof.</div>
<div class="proofscript" id="proof5341">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id"><a href="compcert.x86_64.Archi.html#ptr64">Archi.ptr64</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="tactic">by</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">cut</span> (<span class="kwd">forall</span> <span class="id">l</span> <span class="id">i</span> <span class="id">j</span> <span class="id">k</span>, (2 | <span class="id"><a href="compcert.driver.CallConv.html#k">k</a></span>) -&gt; (2 | <span class="id"><a href="compcert.x86.Conventions1.html#size_arguments_64">size_arguments_64</a></span> <span class="id"><a href="compcert.driver.CallConv.html#l">l</a></span> <span class="id"><a href="compcert.driver.CallConv.html#i">i</a></span> <span class="id"><a href="compcert.driver.CallConv.html#j">j</a></span> <span class="id"><a href="compcert.driver.CallConv.html#k">k</a></span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide_0_r">Z.divide_0_r</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="id">cbn</span>; <span class="tactic">auto</span>. <span class="tactic">intros</span> <span class="id">i</span> <span class="id">j</span> <span class="id">k</span> <span class="id">Hk</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">repeat</span> <span class="tactic">destruct</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide_add_r">Z.divide_add_r</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide_refl">Z.divide_refl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="make_locset_cklr">make_locset_cklr</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id">Monotonic</span> <span class="id"><a href="compcert.driver.CallConv.html#make_locset">make_locset</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(|= (- ==&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> @@ [<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>]) ++&gt; <span class="id"><a href="compcert.cklr.CKLR.html#match_mem">match_mem</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span> ++&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> @@ [<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>] ++&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(- ==&gt; <span class="id"><a href="compcert.common.Values.html#Val.inject">Val.inject</a></span> @@ [<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>])).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5342')">Proof.</div>
<div class="proofscript" id="proof5342">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">w</span> <span class="id">rs1</span> <span class="id">rs2</span> <span class="id">Hrs</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">Hm</span> <span class="id">sp1</span> <span class="id">sp2</span> <span class="id">Hsp</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.driver.CallConv.html#make_locset">make_locset</a></span>, <span class="id"><a href="compcert.backend.Mach.html#load_stack">load_stack</a></span>. <span class="id">rauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_on_extends">unchanged_on_extends</a></span> <span class="id">P</span> <span class="id">m</span> <span class="id">m</span>':<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> <span class="id"><a href="compcert.driver.CallConv.html#P">P</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> = <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock">Mem.nextblock</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b">b</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> <span class="id"><a href="compcert.driver.CallConv.html#k">k</a></span> <span class="id"><a href="compcert.driver.CallConv.html#p">p</a></span> -&gt; <span class="id"><a href="compcert.driver.CallConv.html#P">P</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b">b</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.extends">Mem.extends</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5343')">Proof.</div>
<div class="proofscript" id="proof5343">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">UNCH</span> <span class="id">NB</span> <span class="id">PERM</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.common.Values.html#inject_id">inject_id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>. <span class="tactic">replace</span> (<span class="id">ofs</span> + 0) <span class="kwd">with</span> <span class="id">ofs</span> <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hp</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_perm">Mem.unchanged_on_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>. <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide_0_r">Z.divide_0_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>. <span class="tactic">replace</span> (<span class="id">ofs</span> + 0) <span class="kwd">with</span> <span class="id">ofs</span> <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hp</span>. <span class="id">erewrite</span> &lt;- <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_contents">Mem.unchanged_on_contents</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.lib.Maps.html#ZMap.get">ZMap.get</a></span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#val_inject_id">val_inject_id</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Values.html#Val.lessdef_refl">Val.lessdef_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id"><a href="compcert.common.Memtype.html#Max">Max</a></span> <span class="id"><a href="compcert.common.Memtype.html#Nonempty">Nonempty</a></span>)); <span class="tactic">auto</span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_perm">Mem.unchanged_on_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">With this, we can state and prove the commutation property. </div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="commut_locset_mach">commut_locset_mach</a></span> <span class="id">R</span> `{<span class="id">HR</span>: <span class="id"><a href="compcert.driver.CallConv.html#Mixable">Mixable</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>}:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#Commutes">Commutes</a></span> <span class="id"><a href="compcert.driver.CallConv.html#cc_locset_mach">cc_locset_mach</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#cc_locset">cc_locset</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#cc_mach">cc_mach</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5344')">Proof.</div>
<div class="proofscript" id="proof5344">
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">_</span> <span class="id">w</span>] <span class="id">wR</span>] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> [[ ] <span class="id">Hse</span>] (<span class="id">qi</span> &amp; <span class="id">Hq1i</span> &amp; <span class="id">Hqi2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hqi2</span>. <span class="id">inv</span> <span class="id">Hq1i</span>. <span class="tactic">set</span> (<span class="id">ls2</span> := <span class="id"><a href="compcert.driver.CallConv.html#make_locset">make_locset</a></span> <span class="id">rs2</span> <span class="id">m2</span> <span class="id">sp2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">H12</span>. <span class="id">transport</span> <span class="id">H12</span>. <span class="tactic">intros</span> <span class="id">ARGSm1</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists</span> (<span class="id">se2</span>, (<span class="id">sg</span>, <span class="id">wR</span>'), <span class="id"><a href="compcert.driver.CallConv.html#lmw">lmw</a></span> <span class="id">sg</span> <span class="id">rs2</span> <span class="id">m2</span> <span class="id">_</span>). <span class="id">cbn</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#match_stbls_acc">match_stbls_acc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> (<span class="id"><a href="compcert.backend.Conventions.html#lq">lq</a></span> <span class="id">vf2</span> <span class="id">sg</span> <span class="id">ls2</span> <span class="id">x</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="id">rauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">l</span> <span class="id">Hl</span>. <span class="tactic">unfold</span> <span class="id">ls2</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">HwR</span>'. <span class="tactic">repeat</span> <span class="id">rstep</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">H4</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">ri</span> &amp; (<span class="id">wR</span>'' &amp; <span class="id">HwR</span>'' &amp; <span class="id">Hr1i</span>) &amp; <span class="id">Hri2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hr1i</span>. <span class="id">inv</span> <span class="id">Hri2</span>. <span class="tactic">rename</span> <span class="id">rs</span>' <span class="id">into</span> <span class="id">rs2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">rs1</span>' <span class="id">r</span> := <span class="id"><a href="compcert.backend.Conventions.html#result_regs">result_regs</a></span> <span class="id">sg</span> (<span class="id"><a href="compcert.driver.CallConv.html#make_locset">make_locset</a></span> <span class="id">rs1</span> <span class="id">m1</span> <span class="id">sp1</span>) <span class="id">ls1</span>' (<span class="id"><a href="compcert.backend.Locations.html#R">Locations.R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id"><a href="compcert.driver.CallConv.html#result_mem">result_mem</a></span> (<span class="id">R</span>:=<span class="id">R</span>) (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id">sg</span>) <span class="id">sp1</span> <span class="id">sp2</span> <span class="id">wR</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">wR</span>'' <span class="id">m1</span>' <span class="id">m2</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">wR</span>''' &amp; <span class="id">m1</span>'' &amp; <span class="id">HwR</span>''' &amp; <span class="id">INCR</span> &amp; <span class="id">Hm</span>'' &amp; ? &amp; ? &amp; <span class="id">NB</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">etransitivity</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#unchanged_on_extends">unchanged_on_extends</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">k</span> <span class="id">p</span> ? ?. <span class="tactic">eapply</span> <span class="id">H25</span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> 1. <span class="tactic">intros</span> <span class="id">b1</span> <span class="id">delta</span> <span class="id">Hb</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id"><a href="compcert.cklr.CKLR.html#cklr_perm">cklr_perm</a></span> <span class="id">R</span> <span class="id">wR</span>'' <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">H10</span> (<span class="id">b1</span>, <span class="id">ofs</span> - <span class="id">delta</span>) (<span class="id">sb</span>, <span class="id">ofs</span>)) <span class="kwd">in</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Hp</span>. <span class="tactic">eapply</span> <span class="id">H25</span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">replace</span> (<span class="id">sb</span>, <span class="id">ofs</span>) <span class="kwd">with</span> (<span class="id">sb</span>, <span class="id">ofs</span> - <span class="id">delta</span> + <span class="id">delta</span>) <span class="tactic">by</span> (<span class="tactic">f_equal</span>; <span class="id">xomega</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="compcert.driver.CallConv.html#size_arguments_always_64">size_arguments_always_64</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>. <span class="id">inv</span> <span class="id">H2</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#cklr_valid_block">cklr_valid_block</a></span>; <span class="tactic">eauto</span>. <span class="tactic">red</span>. <span class="tactic">red</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">reflexivity</span> |]. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">ARGSm1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H11</span>. <span class="tactic">intros</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">H18</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.backend.Mach.html#mr">mr</a></span> <span class="id">rs1</span>' <span class="id">m1</span>''). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">r</span> <span class="id">Hr</span>. <span class="tactic">unfold</span> <span class="id">rs1</span>'. <span class="id">cbn</span>. <span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">r</span> <span class="id">Hr</span>. <span class="tactic">unfold</span> <span class="id">rs1</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.backend.Allocproof.html#result_regs_agree_callee_save">result_regs_agree_callee_save</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> 1. <span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id">H25</span> <span class="id">b2</span> (<span class="id">ofs</span> + <span class="id">delta</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">constructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span> <span class="id">sofs</span>), <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_assoc">Ptrofs.add_assoc</a></span>, <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.cklr.CKLR.html#mi">mi</a></span> <span class="id">R</span> <span class="id">wR</span>''' <span class="id">sb</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">b2</span>, <span class="id">delta</span>)). { <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#mi_acc">mi_acc</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.cklr.CKLR.html#cklr_address_inject">cklr_address_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">erewrite</span> &lt;- (<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_perm">Mem.unchanged_on_perm</a></span> <span class="id">_</span> <span class="id">m1</span> <span class="id">m1</span>''); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">inv</span> <span class="id">ARGSm1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H17</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span> <span class="kwd">in</span> <span class="id">H26</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H26</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">constructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">inv</span> <span class="id">ARGSm1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H17</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> (<span class="id"><a href="compcert.cklr.CKLR.html#cklr_perm">cklr_perm</a></span> <span class="id">R</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H10</span> (<span class="id">sb</span>, <span class="id">ofs</span>) (<span class="id">b2</span>, <span class="id">ofs</span> + <span class="id">delta</span>)); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#mi_acc">mi_acc</a></span>; <span class="tactic">eauto</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#mi_acc">mi_acc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">wR</span>'''. <span class="tactic">split</span>; [<span class="id">rauto</span> | ]. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">r</span>. <span class="tactic">unfold</span> <span class="id">rs1</span>', <span class="id"><a href="compcert.backend.Conventions.html#result_regs">result_regs</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>. { <span class="tactic">rewrite</span> <span class="id">H19</span>; <span class="tactic">auto</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.Valuesrel.html#val_inject_incr">val_inject_incr</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">eqn</span>:<span class="id">Hr</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H20</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="id">cbn</span>. <span class="tactic">generalize</span> (<span class="id">H5</span> <span class="id">r</span>). <span class="id">rauto</span>.<br/>
Qed.</div>
<br/>
<h2> Matching <span class="bracket"><span class="id">cc_stacking</span></span> </h2>
<br/>
<div class="doc">Next, we show that <span class="bracket"><span class="id">cc_stacking</span></span> can be reduced to simulation
  conventions involving <span class="bracket"><span class="id">cc_locset_mach</span></span>. </div>
<br/>
<h3> Incoming calls </h3>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cc_lm_stacking">cc_lm_stacking</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#ccref">ccref</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#cc_locset_mach">cc_locset_mach</a></span> @ <span class="id"><a href="compcert.backend.Mach.html#cc_mach">cc_mach</a></span> <span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span>) (<span class="id"><a href="compcert.backend.Mach.html#cc_stacking">cc_stacking</a></span> <span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5345')">Proof.</div>
<div class="proofscript" id="proof5345">
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">_</span> <span class="id">wlm</span>] <span class="id">w</span>] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> [[ ] <span class="id">Hse</span>] (<span class="id">qi</span> &amp; <span class="id">Hq1i</span> &amp; <span class="id">Hqi2</span>). <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hqi2</span>. <span class="id">inv</span> <span class="id">Hq1i</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.backend.Mach.html#stkw">stkw</a></span> <span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span> <span class="id">w</span> <span class="id">sg</span> (<span class="id"><a href="compcert.driver.CallConv.html#make_locset">make_locset</a></span> <span class="id">rs1</span> <span class="id">m1</span> <span class="id">sp1</span>) <span class="id">sp2</span> <span class="id">m2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; [ | <span class="tactic">split</span>].<br/>
&nbsp;&nbsp;- <span class="id">cbn</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">cbn</span> -[<span class="id">Z.add</span> <span class="id">Z.mul</span>]. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_refl">Mem.unchanged_on_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intro</span> <span class="id">Hsz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H12</span>. { <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>. <span class="id">eexists</span> <span class="id">_</span>, <span class="id">_</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id">transport</span> <span class="kwd">in</span> <span class="id">H7</span> <span class="kwd">as</span> (<span class="id">m2_</span> &amp; <span class="id">Hm2_</span> &amp; <span class="id">Hm_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> ?<span class="id">x</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span> <span class="id">x</span>) <span class="kwd">in</span> <span class="id">H7</span>. <span class="tactic">repeat</span> <span class="id">rstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#offset_sarg_ptrrange_inject">offset_sarg_ptrrange_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.driver.CallConv.html#offset_sarg_expand">offset_sarg_expand</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id">sg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">intros</span> <span class="id">ofs</span> <span class="id">Hofs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#offset_fits_inject">offset_fits_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">ofs</span> <span class="id">ty</span> <span class="id">REG</span>. <span class="tactic">destruct</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#tailcall_possible_reg">tailcall_possible_reg</a></span> <span class="kwd">in</span> <span class="id">REG</span>; <span class="tactic">auto</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">edestruct</span> <span class="id">H10</span> <span class="kwd">as</span> [<span class="id">v</span> <span class="id">Hv</span>]; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">transport</span> <span class="id">Hv</span>. <span class="tactic">rewrite</span> <span class="id">H11</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H12</span> <span class="kwd">as</span> [ | <span class="id">sb1</span> <span class="id">sofs1</span> <span class="id">m1</span> <span class="id">m1_</span> ]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.extends">Mem.extends</a></span> <span class="id">m1_</span> <span class="id">m1</span>) <span class="tactic">by</span> <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_left_extends">Mem.free_left_extends</a></span>, <span class="id"><a href="compcert.common.Memory.html#Mem.extends_refl">Mem.extends_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span>; <span class="id">cbn</span> <span class="kwd">in</span> *. <span class="id">erewrite</span> &lt;- <span class="id"><a href="compcert.common.Memory.html#Mem.mext_next">Mem.mext_next</a></span> <span class="tactic">by</span> <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.extends_inject_compose">Mem.extends_inject_compose</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> 1 <span class="kwd">as</span> [<span class="id">sb2</span> <span class="id">sofs2</span> <span class="id">ofs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span> <span class="kwd">as</span> [ | | | | <span class="id">sb1</span> <span class="id">sofs1</span> | ]; <span class="tactic">clear</span> <span class="id">H2</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>. <span class="tactic">subst</span> <span class="id">b2</span> <span class="id">ofs2</span> <span class="id">sp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H12</span>; <span class="tactic">clear</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">sb</span> <span class="id">sofs</span> <span class="id">m</span> <span class="id">m_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs1</span> 0 &lt;= <span class="id">ofs</span> - <span class="id">delta</span> &lt; <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="id">sofs1</span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id">sg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.driver.CallConv.html#offset_sarg_expand">offset_sarg_expand</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id">sg</span>)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.driver.CallConv.html#offset_sarg_inject">offset_sarg_inject</a></span> <span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span> <span class="id">w</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">sb1</span> <span class="id">sofs1</span> <span class="id">sb2</span> <span class="id">sofs2</span> 0); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> 1. <span class="tactic">assert</span> (<span class="id">delta0</span> = <span class="id">delta</span>) <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sb1</span>' <span class="id">delta</span>' <span class="id">Hsb1</span>' <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#peq">peq</a></span> <span class="id">sb1</span> <span class="id">sb1</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span> <span class="id">sb1</span>'. <span class="tactic">assert</span> (<span class="id">delta</span>' = <span class="id">delta</span>) <span class="tactic">by</span> <span class="tactic">congruence</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_free_2">Mem.perm_free_2</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.cklr.CKLR.html#cklr_no_overlap">cklr_no_overlap</a></span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id">H6</span> <span class="id">sb1</span> <span class="id">sb2</span> <span class="id">delta</span> <span class="id">sb1</span>' <span class="id">sb2</span> <span class="id">delta</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_max">Mem.perm_max</a></span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm_implies">Mem.perm_implies</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_free_3">Mem.perm_free_3</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H4</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">Hr</span>. <span class="id">inv</span> <span class="id">Hr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id"><a href="compcert.driver.CallConv.html#result_mem">result_mem</a></span> (<span class="id">R</span>:=<span class="id"><a href="compcert.cklr.Inject.html#inj">inj</a></span>) (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id">sg</span>) <span class="id">sp1</span> <span class="id">sp2</span> <span class="id">w</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">w</span>' <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">m2</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">w</span>'' &amp; <span class="id">m1</span>'' &amp; <span class="id">Hw</span>'' &amp; <span class="id">INCR</span> &amp; ? &amp; ? &amp; ? &amp; <span class="id">NB</span>); <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_refl">Mem.unchanged_on_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.extends_refl">Mem.extends_refl</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="compcert.driver.CallConv.html#size_arguments_always_64">size_arguments_always_64</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H12</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>. <span class="tactic">split</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H12</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">rs1</span>' <span class="id">r</span> := <span class="kwd">if</span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span> <span class="kwd">then</span> <span class="id">rs1</span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span> <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id"><a href="compcert.x86.Machregs.html#mreg_eq">mreg_eq</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span> (<span class="id"><a href="compcert.common.AST.html#regs_of_rpair">regs_of_rpair</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span> <span class="id">sg</span>)) <span class="kwd">then</span> <span class="id">ls1</span>' (<span class="id"><a href="compcert.backend.Locations.html#R">R</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>) <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Vundef">Vundef</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.backend.Mach.html#mr">mr</a></span> <span class="id">rs1</span>' <span class="id">m1</span>''). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span> <span class="id">rs1</span>'. <span class="tactic">intros</span> <span class="id">r</span> <span class="id">REG</span>. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">r</span>) <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.x86.Conventions1.html#loc_result_caller_save">loc_result_caller_save</a></span> <span class="id">sg</span>) <span class="kwd">as</span> <span class="id">Hr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.x86.Conventions1.html#loc_result">loc_result</a></span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span> <span class="id">rs1</span>'. <span class="tactic">intros</span> <span class="id">r</span> <span class="id">REG</span>. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">REG</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> 1. <span class="id">inv</span> <span class="id">H2</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H22</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#mi_acc">mi_acc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">ofs</span> + <span class="id">delta</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">replace</span> (<span class="id">ofs</span> + <span class="id">delta</span> - <span class="id">delta</span>) <span class="kwd">with</span> <span class="id">ofs</span> <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_max">Mem.perm_max</a></span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm_implies">Mem.perm_implies</a></span>; <span class="tactic">eauto</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span> <span class="id">sofs</span>), <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_assoc">Ptrofs.add_assoc</a></span>, <span class="id"><a href="compcert.lib.Integers.html#Ptrofs.add_commut">Ptrofs.add_commut</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="compcert.cklr.CKLR.html#cklr_address_inject">cklr_address_inject</a></span>; <span class="tactic">eauto</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.CKLR.html#mi_acc">mi_acc</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- (<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_perm">Mem.unchanged_on_perm</a></span> <span class="id">_</span> <span class="id">m1</span> <span class="id">m1</span>''); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inv</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H11</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">constructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inv</span> <span class="id">H12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H11</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>, <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">w</span>''; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">r</span>. <span class="tactic">subst</span> <span class="id">rs1</span>'. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.x86.Conventions1.html#is_callee_save">is_callee_save</a></span> <span class="id">eqn</span>:<span class="id">CSR</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<h3> Outgoing calls </h3>
<br/>
<span class="kwd">Import</span> <span class="id">Separation</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="inject_incr_separated_inv">inject_incr_separated_inv</a></span> <span class="id">f</span> <span class="id">f</span>' <span class="id">m1</span> <span class="id">m2</span> <span class="id">b1</span> <span class="id">b2</span> <span class="id">delta</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#inject_incr">inject_incr</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> <span class="id">f</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Events.html#inject_separated">inject_separated</a></span> <span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> <span class="id">f</span>' <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m2">m2</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">f</span>' <span class="id"><a href="compcert.driver.CallConv.html#b1">b1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#b2">b2</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#delta">delta</a></span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m1">m1</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b1">b1</a></span> \/ <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m2">m2</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b2">b2</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.driver.CallConv.html#f">f</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b1">b1</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="compcert.driver.CallConv.html#b2">b2</a></span>, <span class="id"><a href="compcert.driver.CallConv.html#delta">delta</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5346')">Proof.</div>
<div class="proofscript" id="proof5346">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">INCR</span> <span class="id">ISEP</span> <span class="id">Hb</span> <span class="id">VALID</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">b1</span>) <span class="kwd">as</span> [[<span class="id">xb2</span> <span class="id">xdelta</span>] | ] <span class="id">eqn</span>:<span class="id">Hb1</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">INCR</span> <span class="kwd">in</span> <span class="id">Hb1</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">eelim</span> <span class="id">ISEP</span>; <span class="tactic">eauto</span>. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_on_combine">unchanged_on_combine</a></span> <span class="id">P</span> <span class="id">Q</span> <span class="id">m</span> <span class="id">m</span>' :<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> <span class="id"><a href="compcert.driver.CallConv.html#P">P</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> (<span class="kwd">fun</span> <span class="id">b</span> <span class="id">ofs</span> =&gt; <span class="id"><a href="compcert.driver.CallConv.html#Q">Q</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b">b</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span> /\ ~ <span class="id"><a href="compcert.driver.CallConv.html#P">P</a></span> <span class="id"><a href="compcert.driver.CallConv.html#b">b</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ofs">ofs</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id">m</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on">Mem.unchanged_on</a></span> <span class="id"><a href="compcert.driver.CallConv.html#Q">Q</a></span> <span class="id"><a href="compcert.driver.CallConv.html#m">m</a></span> <span class="id">m</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5347')">Proof.</div>
<div class="proofscript" id="proof5347">
&nbsp;&nbsp;<span class="tactic">clear</span>. <span class="tactic">intros</span> [ ] [ ].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">eauto</span>; <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">P</span> <span class="id">b</span> <span class="id">ofs</span>)); <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cc_stacking_lm">cc_stacking_lm</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#ccref">ccref</a></span> (<span class="id"><a href="compcert.backend.Mach.html#cc_stacking">cc_stacking</a></span> <span class="id"><a href="compcert.cklr.InjectFootprint.html#injp">injp</a></span>) (<span class="id"><a href="compcert.backend.Conventions.html#cc_locset">cc_locset</a></span> <span class="id"><a href="compcert.cklr.InjectFootprint.html#injp">injp</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#cc_locset_mach">cc_locset_mach</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5348')">Proof.</div>
<div class="proofscript" id="proof5348">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">w</span> <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">Hse</span> <span class="id">Hq</span>. <span class="tactic">destruct</span> <span class="id">Hq</span>. <span class="id">cbn</span> -[<span class="id">Z.add</span> <span class="id">Z.mul</span>] <span class="kwd">in</span> * |- .<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">UNCH</span> &amp; <span class="id">PERM</span> &amp; <span class="id">ARGS</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">ls2</span> := <span class="id"><a href="compcert.driver.CallConv.html#make_locset">make_locset</a></span> <span class="id">rs2</span> <span class="id">m2</span> <span class="id">sp2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>; <span class="id">inv</span> <span class="id">Hse</span>; <span class="id">cbn</span> -[<span class="id">Z.add</span> <span class="id">Z.mul</span>] <span class="kwd">in</span> * |- .<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">exists</span> <span class="id">m2_</span>, <span class="id"><a href="compcert.driver.CallConv.html#args_removed">args_removed</a></span> <span class="id">sg</span> <span class="id">sp2</span> <span class="id">m2</span> <span class="id"><a href="compcert.driver.CallConv.html#m2_">m2_</a></span> /\ <span class="id"><a href="compcert.common.Memory.html#Mem.inject">Mem.inject</a></span> <span class="id">f</span> <span class="id">m1</span> <span class="id"><a href="compcert.driver.CallConv.html#m2_">m2_</a></span>) <span class="kwd">as</span> (<span class="id">m2_</span> &amp; <span class="id">Hm2_</span> &amp; <span class="id">Hm_</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> 0 (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id">sg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">edestruct</span> <span class="id">PERM</span> <span class="kwd">as</span> (<span class="id">sb2</span> &amp; <span class="id">sofs2</span> &amp; <span class="id">Hsp2</span> &amp; <span class="id">PERM</span>' &amp; <span class="id">FITS</span>). <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.range_perm_free">Mem.range_perm_free</a></span> <span class="id">m2</span>) <span class="kwd">as</span> (<span class="id">m2_</span> &amp; <span class="id">Hm2_</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m2_</span>. <span class="tactic">subst</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>. <span class="id">edestruct</span> <span class="id">ARGS</span> <span class="kwd">as</span> (? &amp; ? &amp; ?); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_right_inject">Mem.free_right_inject</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id">H4</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">replace</span> (<span class="id">ofs</span> + <span class="id">delta</span> - <span class="id">delta</span>) <span class="kwd">with</span> <span class="id">ofs</span> <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_max">Mem.perm_max</a></span>, <span class="id"><a href="compcert.common.Memory.html#Mem.perm_implies">Mem.perm_implies</a></span>; <span class="tactic">eauto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">m2</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments_above">size_arguments_above</a></span> <span class="id">sg</span>). <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se2</span>, (<span class="id">sg</span>, <span class="id"><a href="compcert.cklr.InjectFootprint.html#injpw">injpw</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hm_</span>), <span class="id"><a href="compcert.driver.CallConv.html#lmw">lmw</a></span> <span class="id">sg</span> <span class="id">rs2</span> <span class="id">m2</span> <span class="id">sp2</span>). <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">cbn</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm2_</span>; <span class="tactic">eauto</span>. <span class="id">erewrite</span> <span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_free">Mem.nextblock_free</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> (<span class="id"><a href="compcert.backend.Conventions.html#lq">lq</a></span> <span class="id">vf2</span> <span class="id">sg</span> <span class="id">ls2</span> <span class="id">m2_</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">r</span> <span class="id">Hr</span>. <span class="tactic">destruct</span> <span class="id">Hr</span>; <span class="id">cbn</span> -[<span class="id">Z.add</span> <span class="id">Z.mul</span>]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">ARGS</span> <span class="kwd">as</span> (<span class="id">v2</span> &amp; <span class="id">Hv2</span> &amp; <span class="id">Hv</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hv2</span>. <span class="id">cbn</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">ri</span> &amp; (<span class="id">w</span>' &amp; <span class="id">Hw</span>' &amp; <span class="id">Hr1i</span>) &amp; <span class="id">Hri2</span>). <span class="id">cbn</span> -[<span class="id">Z.add</span> <span class="id">Z.mul</span>] <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hw</span>'. <span class="id">inv</span> <span class="id">Hr1i</span>. <span class="id">inv</span> <span class="id">H3</span>. <span class="id">inv</span> <span class="id">Hri2</span>. <span class="id">cbn</span> -[<span class="id">Z.add</span> <span class="id">Z.mul</span>] <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">m1</span>'0 <span class="id">into</span> <span class="id">m1</span>'. <span class="tactic">rename</span> <span class="id">m2</span>'0 <span class="id">into</span> <span class="id">m2</span>'<span class="id">_</span>. <span class="tactic">rename</span> <span class="id">m</span>' <span class="id">into</span> <span class="id">m2</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hm</span>'' : <span class="id"><a href="compcert.common.Memory.html#Mem.inject">Mem.inject</a></span> <span class="id">f</span>' <span class="id">m1</span>' <span class="id">m2</span>'). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="compcert.common.Separation.html#m_pred">m_pred</a></span> (<span class="id"><a href="compcert.common.Separation.html#minjection">minjection</a></span> <span class="id">f</span>' <span class="id">m1</span>') <span class="id">m2</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Separation.html#m_invar">m_invar</a></span>; <span class="id">cbn</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_implies">Mem.unchanged_on_implies</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b2</span> <span class="id">ofs2</span> (<span class="id">b1</span> &amp; <span class="id">delta</span> &amp; <span class="id">Hb</span> &amp; <span class="id">Hp</span>) <span class="id">Hb2</span> <span class="id">Harg</span>. <span class="id">inv</span> <span class="id">Harg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#inject_incr_separated_inv">inject_incr_separated_inv</a></span> <span class="kwd">in</span> <span class="id">Hb</span>; [<span class="tactic">eapply</span> <span class="id">H4</span> | .. ]; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block_inject_1">Mem.valid_block_inject_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">Hm2_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">right</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block_free_1">Mem.valid_block_free_1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">PERM</span> <span class="kwd">as</span> (<span class="id">sb2</span>' &amp; <span class="id">sofs2</span>' &amp; <span class="id">Hsp2</span> &amp; ? &amp; ?); <span class="tactic">eauto</span>. <span class="id">inv</span> <span class="id">Hsp2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="compcert.cklr.InjectFootprint.html#injpw">injpw</a></span> <span class="id">f</span>' <span class="id">m1</span>' <span class="id">m2</span>' <span class="id">Hm</span>''); <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id">p</span> <span class="id">Hb</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id"><a href="compcert.backend.Mach.html#loc_init_args">loc_init_args</a></span> (<span class="id"><a href="compcert.x86.Conventions1.html#size_arguments">size_arguments</a></span> <span class="id">sg</span>) <span class="id">sp2</span> <span class="id">b</span> <span class="id">ofs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_unchanged_on_2">Mem.perm_unchanged_on_2</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">cut</span> (<span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span> <span class="id">m2_</span> <span class="id">b</span> -&gt; <span class="id"><a href="compcert.common.Memory.html#Mem.perm">Mem.perm</a></span> <span class="id">m2_</span> <span class="id">b</span> <span class="id">ofs</span> <span class="id"><a href="compcert.common.Memtype.html#Max">Max</a></span> <span class="id">p</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">destruct</span> <span class="id">Hm2_</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_free_3">Mem.perm_free_3</a></span>, <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block_free_1">Mem.valid_block_free_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="tactic">eapply</span> <span class="id">H10</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block_unchanged_on">Mem.valid_block_unchanged_on</a></span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_unchanged_on_2">Mem.perm_unchanged_on_2</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#unchanged_on_combine">unchanged_on_combine</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_trans">Mem.unchanged_on_trans</a></span> <span class="kwd">with</span> <span class="id">m2_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Hm2_</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_refl">Mem.unchanged_on_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_unchanged_on">Mem.free_unchanged_on</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">i</span> <span class="id">Hi</span> [<span class="id">Hoor</span> <span class="id">Hlia</span>]. <span class="tactic">apply</span> <span class="id">Hlia</span>. <span class="id">constructor</span>. <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_trans">Mem.unchanged_on_trans</a></span> <span class="kwd">with</span> <span class="id">m2</span>'<span class="id">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_implies">Mem.unchanged_on_implies</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.unchanged_on_implies">Mem.unchanged_on_implies</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">ofs</span> [<span class="id">_</span> ?] <span class="id">_</span>. <span class="tactic">red</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">red</span>. <span class="id">inv</span> <span class="id">Hm2_</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block">Mem.valid_block</a></span>. <span class="id">erewrite</span> &lt;- (<span class="id"><a href="compcert.common.Memory.html#Mem.nextblock_free">Mem.nextblock_free</a></span> <span class="id">m2</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r</span> <span class="id">REG</span>. <span class="tactic">rewrite</span> <span class="id">H21</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r</span> <span class="id">REG</span>. <span class="tactic">rewrite</span> <span class="id">H22</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">b2</span> <span class="id">ofs2</span> <span class="id">Hofs2</span> <span class="id">b1</span> <span class="id">delta</span> <span class="id">Hb</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hm2_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="compcert.backend.Conventions.html#zero_size_arguments_tailcall_possible">zero_size_arguments_tailcall_possible</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hofs2</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.backend.Mach.html#offset_sarg">offset_sarg</a></span> <span class="kwd">in</span> *. <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inv</span> <span class="id">Hofs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.driver.CallConv.html#inject_incr_separated_inv">inject_incr_separated_inv</a></span> <span class="kwd">in</span> <span class="id">Hb</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">Hp</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block_inject_1">Mem.valid_block_inject_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_inject">Mem.perm_inject</a></span> <span class="kwd">in</span> <span class="id">Hp</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">ofs2</span> - <span class="id">delta</span> + <span class="id">delta</span>) <span class="kwd">with</span> <span class="id">ofs2</span> <span class="kwd">in</span> <span class="id">Hp</span> <span class="tactic">by</span> <span class="id">xomega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_free_2">Mem.perm_free_2</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.valid_block_free_1">Mem.valid_block_free_1</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.perm_valid_block">Mem.perm_valid_block</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.free_range_perm">Mem.free_range_perm</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<h3> Typing of <span class="bracket"><span class="id">cc_locset_mach</span></span> source state </h3>
<br/>
<div class="doc">This only works for <span class="bracket"><span class="id">Archi.ptr64</span> = <span class="id">true</span></span>, in which case there are
  no actual constraints on register typing. But we need to rely on
  this for now because of the way callee-save register preservation is
  formulated in the stacking proof: there is only a guarantee that the
  original query's source-level register still inject into the reply's
  target-level registers, but there is no guarantee that the
  target-level registers are actually unchanged. This means that on
  incoming calls, <span class="bracket"><span class="id">cc_locset_mach</span></span> must occur first, before the <span class="bracket"><span class="id">inj</span></span>
  component, if we are to satisfy the associated preservation property.
  But this means that the <span class="bracket"><span class="id">lessdef_loc</span></span> component which we must insert
  after <span class="bracket"><span class="id">wt_loc</span></span> for commutation purposes cannot be absorbed into
  <span class="bracket"><span class="id">inj</span></span>, and for similar reasons it cannot be folded into
  <span class="bracket"><span class="id">cc_stacking</span></span> either.
  So we work around it using the following properties. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="type_of_chunk_of_type">type_of_chunk_of_type</a></span> <span class="id">ty</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.AST.html#type_of_chunk">type_of_chunk</a></span> (<span class="id"><a href="compcert.common.AST.html#chunk_of_type">chunk_of_type</a></span> <span class="id"><a href="compcert.driver.CallConv.html#ty">ty</a></span>) = <span class="id"><a href="compcert.driver.CallConv.html#ty">ty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5349')">Proof.</div>
<div class="proofscript" id="proof5349">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ty</span>; <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="always_has_mreg_type">always_has_mreg_type</a></span> <span class="id">v</span> <span class="id">r</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> <span class="id"><a href="compcert.driver.CallConv.html#v">v</a></span> (<span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span> <span class="id"><a href="compcert.driver.CallConv.html#r">r</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5350')">Proof.</div>
<div class="proofscript" id="proof5350">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.x86.Machregs.html#mreg_type">mreg_type</a></span>. <span class="id">change</span> <span class="id"><a href="compcert.x86_64.Archi.html#ptr64">Archi.ptr64</a></span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">v</span>, <span class="id">r</span>; <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wt_loc_out_of_thin_air">wt_loc_out_of_thin_air</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#cceqv">cceqv</a></span> (<span class="id"><a href="compcert.backend.Lineartyping.html#wt_loc">wt_loc</a></span> @ <span class="id"><a href="compcert.driver.CallConv.html#cc_locset_mach">cc_locset_mach</a></span>) <span class="id"><a href="compcert.driver.CallConv.html#cc_locset_mach">cc_locset_mach</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5351')">Proof.</div>
<div class="proofscript" id="proof5351">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [[<span class="id">xse</span> [<span class="id">xxse</span> <span class="id">sg</span>]] <span class="id">w</span>] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> [[<span class="id">Hsei</span>] <span class="id">Hse</span>] (<span class="id">_</span> &amp; [<span class="id">Hq1</span>] &amp; <span class="id">Hq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">Hsei</span>. <span class="id">inv</span> <span class="id">Hq1</span>. <span class="id">exists</span> <span class="id">w</span>; <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">Hr</span>. <span class="tactic">destruct</span> <span class="id">Hr</span>; <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="tactic">split</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">r</span> <span class="id">Hr</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.driver.CallConv.html#always_has_mreg_type">always_has_mreg_type</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">w</span> <span class="id">se</span> <span class="id">_</span> <span class="id">q1</span> <span class="id">q2</span> [ ] <span class="id">Hq</span>. <span class="tactic">destruct</span> <span class="id">Hq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se</span>, (<span class="id">se</span>, <span class="id">sg</span>), <span class="id"><a href="compcert.driver.CallConv.html#lmw">lmw</a></span> <span class="id">sg</span> <span class="id">rs</span> <span class="id">m</span> <span class="id">sp</span>). <span class="id">cbn</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>. <span class="tactic">split</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span> <span class="id">Hl</span>. <span class="tactic">destruct</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="compcert.driver.CallConv.html#always_has_mreg_type">always_has_mreg_type</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">cbn</span> -[<span class="id">Z.add</span> <span class="id">Z.mul</span>]. <span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="compcert.driver.CallConv.html#type_of_chunk_of_type">type_of_chunk_of_type</a></span> <span class="id">ty</span>) <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sp</span>; <span class="id">cbn</span> -[<span class="id">Z.add</span> <span class="id">Z.mul</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load">Mem.load</a></span> <span class="id">eqn</span>:<span class="id">Hl</span>; <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Memory.html#Mem.load_type">Mem.load_type</a></span>. <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r1</span> <span class="id">r2</span> (<span class="id">_</span> &amp; [<span class="id">Hr1</span>] &amp; <span class="id">Hr</span>). <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="wt_loc_qprop">wt_loc_qprop</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#cc_locset">cc_locset</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>) <span class="id"><a href="compcert.backend.Lineartyping.html#wt_loc">wt_loc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5352')">Proof.</div>
<div class="proofscript" id="proof5352">
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">sg</span> <span class="id">wR</span>] [? <span class="id">xsg</span>] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">Hse</span> <span class="id">Hxse</span> <span class="id">Hq</span> <span class="id">Hq2</span>. <span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">Hq</span>. <span class="id">inv</span> <span class="id">Hq2</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se1</span>, <span class="id">sg</span>). <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.Valuesrel.html#val_has_type_inject">val_has_type_inject</a></span>; <span class="tactic">eauto</span>. <span class="tactic">red</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="wt_loc_rprop">wt_loc_rprop</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id"><a href="compcert.backend.Conventions.html#cc_locset">cc_locset</a></span> <span class="id"><a href="compcert.driver.CallConv.html#R">R</a></span>) <span class="id"><a href="compcert.backend.Lineartyping.html#wt_loc">wt_loc</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5353')">Proof.</div>
<div class="proofscript" id="proof5353">
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">se</span> ?] [<span class="id">sg</span> <span class="id">wR</span>] [? ?] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">r1</span> <span class="id">r2</span> <span class="id">Hse</span> ? ? <span class="id">Hq</span> <span class="id">Hq1</span> <span class="id">Hq2</span> (<span class="id">wR</span>' &amp; <span class="id">HwR</span>' &amp; <span class="id">Hr</span>) <span class="id">Hr2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">inv</span> <span class="id">Hq</span>. <span class="id">inv</span> <span class="id">Hq1</span>. <span class="id">inv</span> <span class="id">Hq2</span>. <span class="id">inv</span> <span class="id">Hr</span>. <span class="id">inv</span> <span class="id">Hr2</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.cklr.Valuesrel.html#val_has_type_inject">val_has_type_inject</a></span>; <span class="tactic">eauto</span>. <span class="tactic">red</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
