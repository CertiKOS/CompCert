
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Invariant</title>
<meta name="description" content="Documentation of Coq module Invariant" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Invariant</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.Values.html">Values</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.AST.html">AST</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.Globalenvs.html">Globalenvs</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.Events.html">Events</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.LanguageInterface.html">LanguageInterface</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.CallconvAlgebra.html">CallconvAlgebra</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.cklr.CKLR.html">CKLR</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.common.Smallstep.html">Smallstep</a></span>.<br/>
<br/>
<div class="doc">Simulation proofs sometimes rely on invariants of the source
  and/or target languages, such as type preservation. The
  constructions defined below can be used to decouple these
  preservation and simulation proofs, and to introduce calling
  conventions characterizing the invariant at module boundaries. </div>
<br/>
<br/>
<h1> Invariants </h1>
<br/>
<h2> Interface </h2>
<br/>
<div class="doc">First, we need to define a sort of "invariant interface", which
  will describe how a given invariant impacts the queries and replies
  of the language under consideration. </div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="invariant">invariant</a></span> {<span class="id">li</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#language_interface">language_interface</a></span>} :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="inv_world">inv_world</a></span> : <span class="kwd">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="symtbl_inv">symtbl_inv</a></span> : <span class="id"><a href="compcert.common.Invariant.html#inv_world">inv_world</a></span> -&gt; <span class="id"><a href="compcert.common.Globalenvs.html#Genv.symtbl">Genv.symtbl</a></span> -&gt; <span class="kwd">Prop</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="query_inv">query_inv</a></span> : <span class="id"><a href="compcert.common.Invariant.html#inv_world">inv_world</a></span> -&gt; <span class="id"><a href="compcert.common.LanguageInterface.html#query">query</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> -&gt; <span class="kwd">Prop</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="reply_inv">reply_inv</a></span> : <span class="id"><a href="compcert.common.Invariant.html#inv_world">inv_world</a></span> -&gt; <span class="id"><a href="compcert.common.LanguageInterface.html#reply">reply</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> -&gt; <span class="kwd">Prop</span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="id">Arguments</span> <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> : <span class="tactic">clear</span> <span class="id">implicits</span>.<br/>
<br/>
<div class="doc">As a core example, here is an invariant for the C language
  interface asserting that the queries and replies are well-typed. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="wt_c">wt_c</a></span> : <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.LanguageInterface.html#li_c">li_c</a></span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#Build_invariant">symtbl_inv</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> '(<span class="id">se</span>, <span class="id">sg</span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">query_inv</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> '(<span class="id">se</span>, <span class="id">sg</span>) <span class="id">q</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#sg">sg</a></span> = <span class="id"><a href="compcert.common.LanguageInterface.html#cq_sg">cq_sg</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> /\ <span class="id"><a href="compcert.common.Values.html#Val.has_type_list">Val.has_type_list</a></span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cq_args">cq_args</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span>) (<span class="id"><a href="compcert.common.AST.html#sig_args">sig_args</a></span> <span class="id"><a href="compcert.common.Invariant.html#sg">sg</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reply_inv</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> '(<span class="id">se</span>, <span class="id">sg</span>) <span class="id">r</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Values.html#Val.has_type">Val.has_type</a></span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cr_retval">cr_retval</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span>) (<span class="id"><a href="compcert.common.AST.html#proj_sig_res">proj_sig_res</a></span> <span class="id"><a href="compcert.common.Invariant.html#sg">sg</a></span>);<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<h2> Preservation </h2>
<br/>
<div class="doc">A small step semantics preserves an externally observable
  invariant if the following properties hold. In addition to the
  invariant interfaces for the incoming function call (<span class="bracket"><span class="id">IB</span></span>) and any
  outgoing external calls (<span class="bracket"><span class="id">IA</span></span>), we specify a "state invariant" <span class="bracket"><span class="id">IS</span></span>
  which will be estblished by the initial query and external call
  returns, preserved by internal steps, and ensure the invariant
  interface is respected at external calls and final states. </div>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="lts_preserves">lts_preserves</a></span> {<span class="id">liA</span> <span class="id">liB</span> <span class="id">S</span>} <span class="id">se</span> (<span class="id">L</span>: <span class="id"><a href="compcert.common.Smallstep.html#lts">lts</a></span> <span class="id"><a href="compcert.common.Invariant.html#liA">liA</a></span> <span class="id"><a href="compcert.common.Invariant.html#liB">liB</a></span> <span class="id"><a href="compcert.common.Invariant.html#S">S</a></span>) <span class="id">IA</span> <span class="id">IB</span> (<span class="id">IS</span>: <span class="id">_</span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#S">S</a></span> -&gt; <span class="kwd">Prop</span>) <span class="id">w</span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="preserves_step">preserves_step</a></span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Step</span> <span class="id"><a href="compcert.common.Invariant.html#L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#t">t</a></span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id">s</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="preserves_initial_state">preserves_initial_state</a></span> <span class="id">q</span> <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#initial_state">initial_state</a></span> <span class="id"><a href="compcert.common.Invariant.html#L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="preserves_external">preserves_external</a></span> <span class="id">s</span> <span class="id">q</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#at_external">at_external</a></span> <span class="id"><a href="compcert.common.Invariant.html#L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">wA</span>, <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#wA">wA</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> /\ <span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#wA">wA</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">s</span>', <span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#wA">wA</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#after_external">after_external</a></span> <span class="id"><a href="compcert.common.Invariant.html#L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span> <span class="id">s</span>' -&gt; <span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id">s</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="preserves_final_state">preserves_final_state</a></span> <span class="id">s</span> <span class="id">r</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#final_state">final_state</a></span> <span class="id"><a href="compcert.common.Invariant.html#L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="preserves">preserves</a></span> {<span class="id">liA</span> <span class="id">liB</span>} (<span class="id">L</span>: <span class="id"><a href="compcert.common.Smallstep.html#semantics">semantics</a></span> <span class="id"><a href="compcert.common.Invariant.html#liA">liA</a></span> <span class="id"><a href="compcert.common.Invariant.html#liB">liB</a></span>) (<span class="id">IA</span> <span class="id">IB</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id">_</span>) <span class="id">IS</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span> <span class="id">se</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Globalenvs.html#Genv.valid_for">Genv.valid_for</a></span> (<span class="id"><a href="compcert.common.Smallstep.html#skel">skel</a></span> <span class="id"><a href="compcert.common.Invariant.html#L">L</a></span>) <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#lts_preserves">lts_preserves</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> (<span class="id"><a href="compcert.common.Invariant.html#L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span>.<br/>
<br/>
<h2> As calling conventions </h2>
<br/>
<div class="doc">Invariant interfaces are essentially a unary version of calling
  conventions, and can in fact be lifted into actual, binary calling
  conventions asserting that the source and target queries are
  identical, and furthermore satisfy the given invariant. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="rel_inv">rel_inv</a></span> {<span class="id">A</span>} (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#A">A</a></span> -&gt; <span class="kwd">Prop</span>) (<span class="id">x</span>: <span class="id"><a href="compcert.common.Invariant.html#A">A</a></span>): <span class="id">A</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a name="rel_inv_intro">rel_inv_intro</a></span>: <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#rel_inv">rel_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#x">x</a></span> <span class="id"><a href="compcert.common.Invariant.html#x">x</a></span>.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Coercion</span> <span class="id">cc_inv</span> {<span class="id">li</span>} (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>): <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#mk_callconv">ccworld</a></span> := <span class="id"><a href="compcert.common.Invariant.html#inv_world">inv_world</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_senv</span> <span class="id">w</span> := <span class="id"><a href="compcert.common.Invariant.html#rel_inv">rel_inv</a></span> (<span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_query</span> <span class="id">w</span> := <span class="id"><a href="compcert.common.Invariant.html#rel_inv">rel_inv</a></span> (<span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_reply</span> <span class="id">w</span> := <span class="id"><a href="compcert.common.Invariant.html#rel_inv">rel_inv</a></span> (<span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span>);<br/>
&nbsp;&nbsp;|}.<br/>
<span class="kwd">Solve</span> <span class="id">All</span> <span class="kwd">Obligations</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;<span class="id">cbn</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
<br/>
<div class="doc">With this, an invariant preservation proof can itself be lifted
  into a self-simulation by the invariant calling conventions. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="preserves_fsim">preserves_fsim</a></span> {<span class="id">li</span> <span class="id">res</span>} (<span class="id">L</span>: <span class="id"><a href="compcert.common.Smallstep.html#semantics">semantics</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#res">res</a></span>) <span class="id">IA</span> <span class="id">IB</span> <span class="id">IS</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#preserves">preserves</a></span> <span class="id"><a href="compcert.common.Invariant.html#L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#forward_simulation">forward_simulation</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc_inv">cc_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span>) (<span class="id"><a href="compcert.common.Invariant.html#cc_inv">cc_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span>) <span class="id"><a href="compcert.common.Invariant.html#L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#L">L</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2258')">Proof.</div>
<div class="proofscript" id="proof2258">
&nbsp;&nbsp;<span class="id">fsim</span> (<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Smallstep.html#forward_simulation_step">forward_simulation_step</a></span> <span class="kwd">with</span> (<span class="id">match_states</span> := <span class="id"><a href="compcert.common.Invariant.html#rel_inv">rel_inv</a></span> (<span class="id">IS</span> <span class="id">w</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hse</span>; <span class="tactic">subst</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> 1. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">q</span> <span class="id">_</span> <span class="id">s</span> [<span class="id">Hq</span>] <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#preserves_initial_state">preserves_initial_state</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">_</span> <span class="id">r</span> [<span class="id">Hs</span>] <span class="id">Hr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#preserves_final_state">preserves_final_state</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">_</span> <span class="id">q</span> [<span class="id">Hs</span>] <span class="id">Hq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> @<span class="id"><a href="compcert.common.Invariant.html#preserves_external">preserves_external</a></span> <span class="kwd">as</span> (<span class="id">wA</span> &amp; <span class="id">Hse</span> &amp; <span class="id">HqA</span> &amp; <span class="id">Hr</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">wA</span>, <span class="id">q</span>. <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="id">cbn</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">r</span>' <span class="id">_</span> <span class="id">s</span>' [<span class="id">Hr</span>'] <span class="id">Hs</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Hr</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' <span class="id">Hstep</span> <span class="id">_</span> [<span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>'. <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#preserves_step">preserves_step</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<br/>
<h1> Invariant-based simulation proof methods </h1>
<br/>
<div class="doc">Once we have established that the source or target language
  preserves an invariant of interest, we wish to use that fact to
  help prove the forward simulation for the pass being considered.
  The most basic way to do that is to add an assertion to the
  simulation relation that the states satisfy the invariant. Then,
  we rely on these assertions to prove a simulation step, and use the
  relevant preservation lemmas to establish them again for the
  successor states. This approach is workable and has been used in
  CompCert for typing invariants, but it is somewhat ad-hoc and
  becomes more involved when the interaction with the environment is
  involved in the invariant's preservation.
  Instead, we would like to formulate a weaker simulation diagram,
  where the invariant can be assumed on the current states but does
  not need to be established for the successor states, then show that
  if the language involved <span class="bracket"><span class="id">preserves</span></span> the invariant (in the sense
  defined above), then this weakened diagram is sufficient to
  establish a forward simulation for the pass.
  The most straightforward way to do this would be to define a
  weakened version of <span class="bracket"><span class="id">forward_simulation</span></span> along these lines, however
  this comes with its own pitfall: there already exists many lemmas
  one can use to establish a <span class="bracket"><span class="id">forward_simulation</span></span> using simplified
  diagrams rather than the more complex, general form, and we would
  like to be able to use simplified diagrams for our weakened version
  as well. Under this approach, we would have to duplicate such lemmas
  for the weakened diagram. Instead, the method implemented below
  reuses <span class="bracket"><span class="id">forward_simulation</span></span> and expresses the weakened diagram as a
  special case, making it possible to reuse all existing techniques to
  prove it.
  Since by definition, <span class="bracket"><span class="id">forward_simulation</span></span> uses the same simulation
  relation for the current and successor states, we accomplish this by
  acting on the transition systems themselves:
    - for the source language, we can build a strengthened version of
      the transition system which restricts the transitions to states
      which statisfy the invariant;
    - for the target language, we can build a relaxed version of the
      transition system which adds arbitrary transitions from states
      which do not satisfy the invariant.
  Proving a simulation from the strengthened source semantics, and/or
  to the weakened target semantics, is easier because we have
  hypotheses that the states involved satify the invariant. At the
  same time, for an invariant-preserving language, we can easily show
  a simulation from the original to the strengthened version, and from
  the weakened to the original version, and these simulations can be
  composed with that proved by the user to obtain the desired one. </div>
<br/>
<h2> Strengthening the source semantics </h2>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="RESTRICT">RESTRICT</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">liA</span> <span class="id">liB</span>} (<span class="id">L</span>: <span class="id"><a href="compcert.common.Smallstep.html#semantics">semantics</a></span> <span class="id"><a href="compcert.common.Invariant.html#liA">liA</a></span> <span class="id"><a href="compcert.common.Invariant.html#liB">liB</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">IA</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.liA">liA</a></span>) (<span class="id">IB</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.liB">liB</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">IS</span>: <span class="id"><a href="compcert.common.Invariant.html#inv_world">inv_world</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#state">state</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> -&gt; <span class="kwd">Prop</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="restrict_lts">restrict_lts</a></span> <span class="id">se</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#Build_lts">step</a></span> <span class="id">ge</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#step">step</a></span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#ge">ge</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#t">t</a></span> <span class="id">s</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id">s</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">valid_query</span> <span class="id">q</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#valid_query">valid_query</a></span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">initial_state</span> <span class="id">q</span> <span class="id">s</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#initial_state">initial_state</a></span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">final_state</span> <span class="id">s</span> <span class="id">r</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#final_state">final_state</a></span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">at_external</span> <span class="id">s</span> <span class="id">q</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#at_external">at_external</a></span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w</span> <span class="id">wA</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#wA">wA</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">after_external</span> <span class="id">s</span> <span class="id">r</span> <span class="id">s</span>' :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#after_external">after_external</a></span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span> <span class="id">s</span>' /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w</span> <span class="id">wA</span> <span class="id">q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#at_external">at_external</a></span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#wA">wA</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#wA">wA</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id">s</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">globalenv</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#globalenv">globalenv</a></span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>);<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="restrict">restrict</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#Build_semantics">skel</a></span> := <span class="id"><a href="compcert.common.Smallstep.html#skel">skel</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state</span> := <span class="id"><a href="compcert.common.Smallstep.html#state">state</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">activate</span> <span class="id">se</span> := <span class="id"><a href="compcert.common.Invariant.html#restrict_lts">restrict_lts</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="restrict_fsim">restrict_fsim</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#preserves">preserves</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#forward_simulation">forward_simulation</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc_inv">cc_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IA">IA</a></span>) (<span class="id"><a href="compcert.common.Invariant.html#cc_inv">cc_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span>) <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#restrict">restrict</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2259')">Proof.</div>
<div class="proofscript" id="proof2259">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fsim</span> (<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#forward_simulation_step">forward_simulation_step</a></span> <span class="kwd">with</span> (<span class="id">match_states</span> := <span class="id"><a href="compcert.common.Invariant.html#rel_inv">rel_inv</a></span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id">w</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hse</span>; <span class="tactic">subst</span>); <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> 1. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">q</span> <span class="id">_</span> <span class="id">s</span> [<span class="id">Hq</span>] <span class="id">Hs</span>. <span class="id">exists</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id">w</span> <span class="id">s</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#preserves_initial_state">preserves_initial_state</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> 10 <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">_</span> <span class="id">r</span> [<span class="id">Hs</span>] <span class="id">Hr</span>. <span class="id">exists</span> <span class="id">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IB">IB</a></span> <span class="id">w</span> <span class="id">r</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#preserves_final_state">preserves_final_state</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> 10 <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">_</span> <span class="id">q</span> [<span class="id">Hs</span>] <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> @<span class="id"><a href="compcert.common.Invariant.html#preserves_external">preserves_external</a></span> <span class="kwd">as</span> (<span class="id">wA</span> &amp; <span class="id">HseA</span> &amp; <span class="id">Hq</span> &amp; <span class="id">Hk</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> <span class="id">wA</span>, <span class="id">q</span>. <span class="tactic">intuition</span> <span class="tactic">eauto</span> 10 <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>. <span class="id">exists</span> <span class="id">s1</span>'. <span class="tactic">intuition</span> <span class="tactic">eauto</span> 20 <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' <span class="id">STEP</span> <span class="id">_</span> [<span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.Invariant.html#RESTRICT.IS">IS</a></span> <span class="id">w</span> <span class="id">s</span>') <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#preserves_step">preserves_step</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>'. <span class="tactic">eauto</span> 10 <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="restrict_determinate">restrict_determinate</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#determinate">determinate</a></span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT.L">L</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#determinate">determinate</a></span> <span class="id"><a href="compcert.common.Invariant.html#restrict">restrict</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2260')">Proof.</div>
<div class="proofscript" id="proof2260">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">HL</span> <span class="id">se</span>. <span class="id">specialize</span> (<span class="id">HL</span> <span class="id">se</span>) <span class="kwd">as</span> [ ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.common.Smallstep.html#nostep">nostep</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#not">not</a></span>, <span class="id"><a href="compcert.common.Smallstep.html#single_events">single_events</a></span> <span class="kwd">in</span> *; <span class="id">cbn</span>; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="id">lazymatch</span> <span class="id">goal</span> <span class="kwd">with</span> <span class="id">H</span> : <span class="id">_</span> /\ <span class="id">_</span> |- <span class="id">_</span> =&gt; <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> <span class="id">_</span>] <span class="kwd">end</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<span class="kwd">End</span> <span class="id"><a href="compcert.common.Invariant.html#RESTRICT">RESTRICT</a></span>.<br/>
<br/>
<h2> Weakening the target semantics </h2>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="EXPAND">EXPAND</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">liA</span> <span class="id">liB</span>} (<span class="id">L</span>: <span class="id"><a href="compcert.common.Smallstep.html#semantics">semantics</a></span> <span class="id"><a href="compcert.common.Invariant.html#liA">liA</a></span> <span class="id"><a href="compcert.common.Invariant.html#liB">liB</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">IA</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.liA">liA</a></span>) (<span class="id">IB</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.liB">liB</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">IS</span>: <span class="id"><a href="compcert.common.Invariant.html#inv_world">inv_world</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#state">state</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> -&gt; <span class="kwd">Prop</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="expand_lts">expand_lts</a></span> <span class="id">se</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#Build_lts">valid_query</a></span> <span class="id">q</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#valid_query">valid_query</a></span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">step</span> <span class="id">ge</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span>, <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#step">step</a></span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#ge">ge</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#t">t</a></span> <span class="id">s</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">initial_state</span> <span class="id">q</span> <span class="id">s</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span>, <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#initial_state">initial_state</a></span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">final_state</span> <span class="id">s</span> <span class="id">r</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span>, <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#final_state">final_state</a></span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">at_external</span> <span class="id">s</span> <span class="id">q</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span>, <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#at_external">at_external</a></span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">after_external</span> <span class="id">s</span> <span class="id">r</span> <span class="id">s</span>' :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">w</span> <span class="id">wA</span> <span class="id">q</span>, <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IS">IS</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#at_external">at_external</a></span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#wA">wA</a></span> <span class="id"><a href="compcert.common.Invariant.html#q">q</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#wA">wA</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span> -&gt; <span class="id"><a href="compcert.common.Smallstep.html#after_external">after_external</a></span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>) <span class="id"><a href="compcert.common.Invariant.html#s">s</a></span> <span class="id"><a href="compcert.common.Invariant.html#r">r</a></span> <span class="id">s</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">globalenv</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#globalenv">globalenv</a></span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="expand">expand</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#Build_semantics">skel</a></span> := <span class="id"><a href="compcert.common.Smallstep.html#skel">skel</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state</span> := <span class="id"><a href="compcert.common.Smallstep.html#state">state</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">activate</span> <span class="id">se</span> := <span class="id"><a href="compcert.common.Invariant.html#expand_lts">expand_lts</a></span> <span class="id"><a href="compcert.common.Invariant.html#se">se</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="expand_fsim">expand_fsim</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#preserves">preserves</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IS">IS</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#forward_simulation">forward_simulation</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc_inv">cc_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IA">IA</a></span>) (<span class="id"><a href="compcert.common.Invariant.html#cc_inv">cc_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span>) <span class="id"><a href="compcert.common.Invariant.html#expand">expand</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.L">L</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2261')">Proof.</div>
<div class="proofscript" id="proof2261">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fsim</span> (<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Smallstep.html#forward_simulation_step">forward_simulation_step</a></span> <span class="kwd">with</span> (<span class="id">match_states</span> := <span class="id"><a href="compcert.common.Invariant.html#rel_inv">rel_inv</a></span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.IS">IS</a></span> <span class="id">w</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hse</span>; <span class="tactic">subst</span>); <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> 1; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">q</span> <span class="id">_</span> <span class="id">s</span> [<span class="id">Hq</span>] <span class="id">Hs</span>. <span class="id">exists</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.IS">IS</a></span> <span class="id">w</span> <span class="id">s</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#preserves_initial_state">preserves_initial_state</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">_</span> <span class="id">r</span> [<span class="id">Hs</span>] <span class="id">Hr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND.IB">IB</a></span> <span class="id">w</span> <span class="id">r</span>) <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#preserves_final_state">preserves_final_state</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">_</span> <span class="id">q</span> [<span class="id">Hs</span>] <span class="id">Hk</span>. <span class="id">specialize</span> (<span class="id">Hk</span> <span class="id">w</span> <span class="id">H</span> <span class="id">Hs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> @<span class="id"><a href="compcert.common.Invariant.html#preserves_external">preserves_external</a></span> <span class="kwd">as</span> (<span class="id">wA</span> &amp; <span class="id">HseA</span> &amp; <span class="id">Hq</span> &amp; <span class="id">Hr</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">wA</span>, <span class="id">q</span>. <span class="tactic">intuition</span> <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>. <span class="id">exists</span> <span class="id">s1</span>'. <span class="tactic">intuition</span> <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">t</span> <span class="id">s</span>' <span class="id">STEP</span> <span class="id">_</span> [<span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.common.Invariant.html#EXPAND.IS">IS</a></span> <span class="id">w</span> <span class="id">s</span>') <span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#preserves_step">preserves_step</a></span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>'. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<span class="kwd">End</span> <span class="id"><a href="compcert.common.Invariant.html#EXPAND">EXPAND</a></span>.<br/>
<br/>
<h2> Using invariants to prove simulations </h2>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="METHODS">METHODS</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">liA1</span> <span class="id">liA2</span>} {<span class="id">ccA</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#liA1">liA1</a></span> <span class="id"><a href="compcert.common.Invariant.html#liA2">liA2</a></span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">liB1</span> <span class="id">liB2</span>} {<span class="id">ccB</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#liB1">liB1</a></span> <span class="id"><a href="compcert.common.Invariant.html#liB2">liB2</a></span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">L1</span>: <span class="id"><a href="compcert.common.Smallstep.html#semantics">semantics</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.liA1">liA1</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.liB1">liB1</a></span>) (<span class="id">L2</span>: <span class="id"><a href="compcert.common.Smallstep.html#semantics">semantics</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.liA2">liA2</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.liB2">liB2</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="source_invariant_fsim">source_invariant_fsim</a></span> <span class="id">IA</span> <span class="id">IB</span> <span class="id">IS</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#preserves">preserves</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.L1">L1</a></span> <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#forward_simulation">forward_simulation</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.ccA">ccA</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.ccB">ccB</a></span> (<span class="id"><a href="compcert.common.Invariant.html#restrict">restrict</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.L1">L1</a></span> <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span>) <span class="id"><a href="compcert.common.Invariant.html#METHODS.L2">L2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#forward_simulation">forward_simulation</a></span> (<span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#METHODS.ccA">ccA</a></span>) (<span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#METHODS.ccB">ccB</a></span>) <span class="id"><a href="compcert.common.Invariant.html#METHODS.L1">L1</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.L2">L2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2262')">Proof.</div>
<div class="proofscript" id="proof2262">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">HL1</span> <span class="id">HL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Smallstep.html#compose_forward_simulations">compose_forward_simulations</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Invariant.html#restrict_fsim">restrict_fsim</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="target_invariant_fsim">target_invariant_fsim</a></span> <span class="id">IA</span> <span class="id">IB</span> <span class="id">IS</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#preserves">preserves</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.L2">L2</a></span> <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#forward_simulation">forward_simulation</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.ccA">ccA</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.ccB">ccB</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.L1">L1</a></span> (<span class="id"><a href="compcert.common.Invariant.html#expand">expand</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.L2">L2</a></span> <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span> <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span> <span class="id"><a href="compcert.common.Invariant.html#IS">IS</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.Smallstep.html#forward_simulation">forward_simulation</a></span> (<span class="id"><a href="compcert.common.Invariant.html#METHODS.ccA">ccA</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#IA">IA</a></span>) (<span class="id"><a href="compcert.common.Invariant.html#METHODS.ccB">ccB</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#IB">IB</a></span>) <span class="id"><a href="compcert.common.Invariant.html#METHODS.L1">L1</a></span> <span class="id"><a href="compcert.common.Invariant.html#METHODS.L2">L2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2263')">Proof.</div>
<div class="proofscript" id="proof2263">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">HL2</span> <span class="id">HL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Smallstep.html#compose_forward_simulations">compose_forward_simulations</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Invariant.html#expand_fsim">expand_fsim</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<span class="kwd">End</span> <span class="id"><a href="compcert.common.Invariant.html#METHODS">METHODS</a></span>.<br/>
<br/>
<h2> Algebraic properties </h2>
<br/>
<h3> Commutativity </h3>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="inv_commute_ref">inv_commute_ref</a></span> {<span class="id">li</span>} (<span class="id">I</span> <span class="id">J</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#ccref">ccref</a></span> (<span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#J">J</a></span>) (<span class="id"><a href="compcert.common.Invariant.html#J">J</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2264')">Proof.</div>
<div class="proofscript" id="proof2264">
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">se2</span> <span class="id">wi</span>] <span class="id">wj</span>] <span class="id">se1</span> <span class="id">se3</span> <span class="id">q1</span> <span class="id">q3</span> [<span class="id">Hse12</span> <span class="id">Hse23</span>] (<span class="id">q2</span> &amp; <span class="id">Hq12</span> &amp; <span class="id">Hq23</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se2</span>, <span class="id">wj</span>, <span class="id">wi</span>). <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hse12</span>, <span class="id">Hse23</span>, <span class="id">Hq12</span>, <span class="id">Hq23</span>.<br/>
&nbsp;&nbsp;<span class="tactic">firstorder</span> <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>, <span class="id">H4</span>. <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="inv_commute">inv_commute</a></span> {<span class="id">li</span>} (<span class="id">I</span> <span class="id">J</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#cceqv">cceqv</a></span> (<span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#J">J</a></span>) (<span class="id"><a href="compcert.common.Invariant.html#J">J</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2265')">Proof.</div>
<div class="proofscript" id="proof2265">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#inv_commute_ref">inv_commute_ref</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="inv_dup">inv_dup</a></span> {<span class="id">li</span>} (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#ccref">ccref</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> (<span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2266')">Proof.</div>
<div class="proofscript" id="proof2266">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">w</span> <span class="id">se</span> <span class="id">_</span> <span class="id">q</span> <span class="id">_</span> [<span class="id">Hse</span>] [<span class="id">Hq</span>].<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se</span>, <span class="id">w</span>, <span class="id">w</span>). <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intuition</span> <span class="tactic">eauto</span> 20 <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">_</span> &amp; [<span class="id">Hr</span>] &amp; [<span class="id">_</span>]).<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span> 20 <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
Qed.</div>
<br/>
<h3> Query invariant propagation </h3>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> {<span class="id">li</span>} (<span class="id">cc</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span> : <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="propagates_query">propagates_query</a></span> <span class="id">w</span> <span class="id">w2</span> <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#match_senv">match_senv</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se1">se1</a></span> <span class="id"><a href="compcert.common.Invariant.html#se2">se2</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w2">w2</a></span> <span class="id"><a href="compcert.common.Invariant.html#se2">se2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#match_query">match_query</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#q1">q1</a></span> <span class="id"><a href="compcert.common.Invariant.html#q2">q2</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w2">w2</a></span> <span class="id"><a href="compcert.common.Invariant.html#q2">q2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">w1</span>, <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w1">w1</a></span> <span class="id"><a href="compcert.common.Invariant.html#se1">se1</a></span> /\ <span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w1">w1</a></span> <span class="id"><a href="compcert.common.Invariant.html#q1">q1</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="inv_prop">inv_prop</a></span> {<span class="id">li</span>} <span class="id">cc</span> <span class="id">I</span> `{@<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>} :<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#ccref">ccref</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>) (<span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2267')">Proof.</div>
<div class="proofscript" id="proof2267">
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">se2</span> <span class="id">w</span>] <span class="id">w2</span>] <span class="id">se1</span> <span class="id">_</span> <span class="id">q1</span> <span class="id">_</span> [<span class="id">Hse</span> [<span class="id">Hse2</span>]] (<span class="id">q2</span> &amp; <span class="id">Hq</span> &amp; [<span class="id">Hq2</span>]).<br/>
&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id"><a href="compcert.common.Invariant.html#propagates_query">propagates_query</a></span> <span class="kwd">as</span> (<span class="id">w1</span> &amp; <span class="id">Hse1</span> &amp; <span class="id">Hq1</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se1</span>, <span class="id">w1</span>, (<span class="id">se2</span>, <span class="id">w</span>, <span class="id">w2</span>)).<br/>
&nbsp;&nbsp;<span class="id">cbn</span>; <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">eauto</span> 10 <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">r1</span> <span class="id">_</span> (<span class="id">_</span> &amp; [<span class="id">Hr1</span>] &amp; <span class="id">r2</span> &amp; <span class="id">Hr</span> &amp; [<span class="id">Hr2</span>]). <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="query_prop_ccref">query_prop_ccref</a></span>:<br/>
&nbsp;&nbsp;<span class="id">Monotonic</span> (@<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span>) (<span class="id">forallr</span> -, <span class="id"><a href="compcert.common.CallconvAlgebra.html#ccref">ccref</a></span> --&gt; - ==&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html#impl">impl</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2268')">Proof.</div>
<div class="proofscript" id="proof2268">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">li</span> <span class="id">cc</span>' <span class="id">cc</span> <span class="id">Hcc</span> <span class="id">I</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> <span class="id">Hcc</span> <span class="kwd">as</span> (<span class="id">w</span>' &amp; <span class="id">Hse</span>' &amp; <span class="id">Hq</span>' &amp; <span class="id">Hr</span>'); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#propagates_query">propagates_query</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> {<span class="id">li</span>} (<span class="id">cc</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span> : <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="propagates_reply">propagates_reply</a></span> <span class="id">w1</span> <span class="id">w</span> <span class="id">w2</span> <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">r1</span> <span class="id">r2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#match_senv">match_senv</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#se1">se1</a></span> <span class="id"><a href="compcert.common.Invariant.html#se2">se2</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w1">w1</a></span> <span class="id"><a href="compcert.common.Invariant.html#se1">se1</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#symtbl_inv">symtbl_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w2">w2</a></span> <span class="id"><a href="compcert.common.Invariant.html#se2">se2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#match_query">match_query</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#q1">q1</a></span> <span class="id"><a href="compcert.common.Invariant.html#q2">q2</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w1">w1</a></span> <span class="id"><a href="compcert.common.Invariant.html#q1">q1</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#query_inv">query_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w2">w2</a></span> <span class="id"><a href="compcert.common.Invariant.html#q2">q2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.common.LanguageInterface.html#match_reply">match_reply</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#w">w</a></span> <span class="id"><a href="compcert.common.Invariant.html#r1">r1</a></span> <span class="id"><a href="compcert.common.Invariant.html#r2">r2</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w2">w2</a></span> <span class="id"><a href="compcert.common.Invariant.html#r2">r2</a></span> -&gt; <span class="id"><a href="compcert.common.Invariant.html#reply_inv">reply_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#w1">w1</a></span> <span class="id"><a href="compcert.common.Invariant.html#r1">r1</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="inv_drop">inv_drop</a></span> {<span class="id">li</span>} <span class="id">cc</span> <span class="id">I</span> `{@<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>} :<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.CallconvAlgebra.html#ccref">ccref</a></span> (<span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>) (<span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2269')">Proof.</div>
<div class="proofscript" id="proof2269">
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">_</span> <span class="id">w1</span>] [[<span class="id">se2</span> <span class="id">w</span>] <span class="id">w2</span>]] <span class="id">se1</span> <span class="id">_</span> <span class="id">q1</span> <span class="id">_</span> [[<span class="id">Hse1</span>] [<span class="id">Hse</span> [<span class="id">Hse2</span>]]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">_</span> &amp; [<span class="id">Hq1</span>] &amp; <span class="id">q2</span> &amp; <span class="id">Hq</span> &amp; [<span class="id">Hq2</span>]).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se2</span>, <span class="id">w</span>, <span class="id">w2</span>). <span class="id">cbn</span>; <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">r1</span> <span class="id">_</span> (<span class="id">r2</span> &amp; <span class="id">Hr</span> &amp; [<span class="id">Hr2</span>]).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r1</span>. <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="compcert.common.Invariant.html#rel_inv_intro">rel_inv_intro</a></span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.common.Invariant.html#propagates_reply">propagates_reply</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Instances </div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="id_query_prop">id_query_prop</a></span> {<span class="id">li</span>} (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.LanguageInterface.html#cc_id">cc_id</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2270')">Proof.</div>
<div class="proofscript" id="proof2270">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">subst</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="inv_query_prop">inv_query_prop</a></span> {<span class="id">li</span>} (<span class="id">I</span> <span class="id">J</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> <span class="id"><a href="compcert.common.Invariant.html#J">J</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2271')">Proof.</div>
<div class="proofscript" id="proof2271">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">wi</span> <span class="id">wj</span> <span class="id">se</span> <span class="id">_</span> <span class="id">q</span> <span class="id">_</span> [<span class="id">Hsei</span>] <span class="id">Hsej</span> [<span class="id">Hqi</span>] <span class="id">Hqj</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="compose_query_prop">compose_query_prop</a></span> {<span class="id">li</span>} (<span class="id">cc12</span> <span class="id">cc23</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc12">cc12</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc23">cc23</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc12">cc12</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#cc23">cc23</a></span>) <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2272')">Proof.</div>
<div class="proofscript" id="proof2272">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [[<span class="id">se2</span> <span class="id">w12</span>] <span class="id">w23</span>] <span class="id">w3</span> <span class="id">se1</span> <span class="id">se3</span> <span class="id">q1</span> <span class="id">q3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Hse12</span> <span class="id">Hse23</span>] <span class="id">Hse3</span> (<span class="id">q2</span> &amp; <span class="id">Hq12</span> &amp; <span class="id">Hq23</span>) <span class="id">Hq3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id"><a href="compcert.common.Invariant.html#propagates_query">propagates_query</a></span> <span class="id">w23</span>) <span class="kwd">as</span> (<span class="id">w2</span> &amp; <span class="id">Hse2</span> &amp; <span class="id">Hq2</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id"><a href="compcert.common.Invariant.html#propagates_query">propagates_query</a></span> <span class="id">w12</span>) <span class="kwd">as</span> (<span class="id">w1</span> &amp; <span class="id">Hse1</span> &amp; <span class="id">Hq1</span>); <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id">_</span> @ <span class="id">_</span>) <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id">class_apply</span> <span class="id">compose_query_prop</span> : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="compose_reply_prop">compose_reply_prop</a></span> {<span class="id">li</span>} (<span class="id">cc12</span> <span class="id">cc23</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc12">cc12</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc23">cc23</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc23">cc23</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc12">cc12</a></span> @ <span class="id"><a href="compcert.common.Invariant.html#cc23">cc23</a></span>) <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2273')">Proof.</div>
<div class="proofscript" id="proof2273">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">w1</span> [[<span class="id">se2</span> <span class="id">w12</span>] <span class="id">w23</span>] <span class="id">w3</span> <span class="id">se1</span> <span class="id">se3</span> <span class="id">q1</span> <span class="id">q3</span> <span class="id">r1</span> <span class="id">r3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Hse12</span> <span class="id">Hse23</span>] <span class="id">Hse1</span> <span class="id">Hse3</span> (<span class="id">q2</span> &amp; <span class="id">Hq12</span> &amp; <span class="id">Hq23</span>) <span class="id">Hq1</span> <span class="id">Hq3</span> (<span class="id">r2</span> &amp; <span class="id">Hr12</span> &amp; <span class="id">Hr23</span>) <span class="id">Hr3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edestruct</span> (<span class="id"><a href="compcert.common.Invariant.html#propagates_query">propagates_query</a></span> <span class="id">w23</span>) <span class="kwd">as</span> (<span class="id">w2</span> &amp; <span class="id">Hse2</span> &amp; <span class="id">Hq2</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id"><a href="compcert.common.Invariant.html#propagates_reply">propagates_reply</a></span> <span class="id">w1</span> <span class="id">w12</span> <span class="id">w2</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> (<span class="id"><a href="compcert.common.Invariant.html#propagates_reply">propagates_reply</a></span> <span class="id">w2</span> <span class="id">w23</span> <span class="id">w3</span>); <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id">_</span> @ <span class="id">_</span>) <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id">class_apply</span> <span class="id">compose_reply_prop</span> : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="join_query_prop">join_query_prop</a></span> {<span class="id">li</span>} (<span class="id">cc1</span> <span class="id">cc2</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc1">cc1</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc2">cc2</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc1">cc1</a></span> + <span class="id"><a href="compcert.common.Invariant.html#cc2">cc2</a></span>) <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2274')">Proof.</div>
<div class="proofscript" id="proof2274">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">w</span>|<span class="id">w</span>]; <span class="id">cbn</span>; <span class="tactic">apply</span> (<span class="id"><a href="compcert.common.Invariant.html#propagates_query">propagates_query</a></span> <span class="id">w</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id">_</span> + <span class="id">_</span>) <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id">class_apply</span> <span class="id">join_query_prop</span> : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="join_reply_prop">join_reply_prop</a></span> {<span class="id">li</span>} (<span class="id">cc1</span> <span class="id">cc2</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc1">cc1</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc2">cc2</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc1">cc1</a></span> + <span class="id"><a href="compcert.common.Invariant.html#cc2">cc2</a></span>) <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2275')">Proof.</div>
<div class="proofscript" id="proof2275">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">w1</span> [<span class="id">w</span>|<span class="id">w</span>]; <span class="id">cbn</span>; <span class="tactic">apply</span> (<span class="id"><a href="compcert.common.Invariant.html#propagates_reply">propagates_reply</a></span> <span class="id">w1</span> <span class="id">w</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id">_</span> + <span class="id">_</span>) <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id">class_apply</span> <span class="id">join_reply_prop</span> : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pow_query_prop">pow_query_prop</a></span> {<span class="id">li</span>} (<span class="id">cc</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> ^ <span class="id"><a href="compcert.common.Invariant.html#n">n</a></span>) <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2276')">Proof.</div>
<div class="proofscript" id="proof2276">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="id">cbn</span>; <span class="id">typeclasses</span> <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_pow">cc_pow</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id">class_apply</span> <span class="id">pow_query_prop</span> : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="star_query_prop">star_query_prop</a></span> {<span class="id">li</span>} (<span class="id">cc</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span>^{*}) <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2277')">Proof.</div>
<div class="proofscript" id="proof2277">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">n</span> <span class="id">w12s</span>]. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Invariant.html#propagates_query">propagates_query</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 2 (<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_star">cc_star</a></span> <span class="id">_</span>) <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id">class_apply</span> <span class="id">star_query_prop</span> : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pow_reply_prop">pow_reply_prop</a></span> {<span class="id">li</span>} (<span class="id">cc</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.LanguageInterface.html#cc_id">cc_id</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> ^ <span class="id"><a href="compcert.common.Invariant.html#n">n</a></span>) <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2278')">Proof.</div>
<div class="proofscript" id="proof2278">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hid</span> <span class="id">HQ</span> <span class="id">HR</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="id">cbn</span>; <span class="id">typeclasses</span> <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 3 (<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_pow">cc_pow</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id">class_apply</span> <span class="id">pow_reply_prop</span> : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="star_reply_prop">star_reply_prop</a></span> {<span class="id">li</span>} (<span class="id">cc</span>: <span class="id"><a href="compcert.common.LanguageInterface.html#callconv">callconv</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>) (<span class="id">I</span>: <span class="id"><a href="compcert.common.Invariant.html#invariant">invariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#li">li</a></span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.LanguageInterface.html#cc_id">cc_id</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc">cc</a></span>^{*}) <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2279')">Proof.</div>
<div class="proofscript" id="proof2279">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">w1</span> [<span class="id">n</span> <span class="id">w12s</span>]. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.common.Invariant.html#propagates_reply">propagates_reply</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Extern</span> 3 (<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id"><a href="compcert.common.CallconvAlgebra.html#cc_star">cc_star</a></span> <span class="id">_</span>) <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;<span class="id">class_apply</span> <span class="id">star_reply_prop</span> : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="wt_c_query_prop">wt_c_query_prop</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesQueryInvariant">PropagatesQueryInvariant</a></span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cc_c">cc_c</a></span> <span class="id"><a href="compcert.common.Invariant.html#R">R</a></span>) <span class="id"><a href="compcert.common.Invariant.html#wt_c">wt_c</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2280')">Proof.</div>
<div class="proofscript" id="proof2280">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">w</span> [<span class="id">se</span> <span class="id">sg</span>] <span class="id">se1</span> <span class="id">se2</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">Hse</span> <span class="id">Hse2</span> <span class="id">Hq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Hsg</span> <span class="id">Hq2</span>]. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hq</span>; <span class="id">cbn</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">se1</span>, <span class="id">sg</span>). <span class="id">cbn</span>. <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hq2</span>. <span class="tactic">generalize</span> (<span class="id"><a href="compcert.common.AST.html#sig_args">sig_args</a></span> <span class="id">sg</span>). <span class="tactic">clear</span> - <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H0</span>; <span class="tactic">auto</span>. <span class="id">cbn</span>. <span class="tactic">intros</span> [ | <span class="id">t</span> <span class="id">tl</span>]; <span class="tactic">auto</span>. <span class="tactic">intuition</span> <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>, <span class="id">t</span>; <span class="id">cbn</span> <span class="kwd">in</span> *; <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="wt_c_reply_prop">wt_c_reply_prop</a></span> <span class="id">R</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id"><a href="compcert.common.LanguageInterface.html#cc_c">cc_c</a></span> <span class="id"><a href="compcert.common.Invariant.html#R">R</a></span>) <span class="id"><a href="compcert.common.Invariant.html#wt_c">wt_c</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2281')">Proof.</div>
<div class="proofscript" id="proof2281">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">se1</span> <span class="id">sg1</span>] <span class="id">w</span> [<span class="id">se2</span> <span class="id">sg2</span>] <span class="id">xse1</span> <span class="id">xse2</span> <span class="id">q1</span> <span class="id">q2</span> <span class="id">r1</span> <span class="id">r2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hse</span> [ ] [ ] <span class="id">Hq</span> [<span class="id">Hsg1</span> <span class="id">Hargs1</span>] [<span class="id">Hsg2</span> <span class="id">Hargs2</span>] <span class="id">Hr</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hr</span> <span class="kwd">as</span> (<span class="id">w</span>' &amp; <span class="id">Hw</span>' &amp; <span class="id">Hr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hq</span>; <span class="id">cbn</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">Hr</span>; <span class="id">cbn</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> -<span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>; <span class="tactic">auto</span>. <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="wt_c_id_prop">wt_c_id_prop</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> <span class="id"><a href="compcert.common.LanguageInterface.html#cc_id">cc_id</a></span> <span class="id"><a href="compcert.common.Invariant.html#wt_c">wt_c</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2282')">Proof.</div>
<div class="proofscript" id="proof2282">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">se</span> <span class="id">sg</span>] [ ] [<span class="id">se1</span> <span class="id">xsg</span>] <span class="id">se2</span> <span class="id">se3</span> <span class="id">q</span> <span class="id">q1</span> <span class="id">r</span> <span class="id">r1</span>. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intuition</span> <span class="tactic">subst</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="wt_c_inv_prop">wt_c_inv_prop</a></span> <span class="id">I</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.common.Invariant.html#PropagatesReplyInvariant">PropagatesReplyInvariant</a></span> (<span class="id"><a href="compcert.common.Invariant.html#cc_inv">cc_inv</a></span> <span class="id"><a href="compcert.common.Invariant.html#I">I</a></span>) <span class="id"><a href="compcert.common.Invariant.html#wt_c">wt_c</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2283')">Proof.</div>
<div class="proofscript" id="proof2283">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">se</span> <span class="id">sg</span>] <span class="id">w</span> [<span class="id">se1</span> <span class="id">xsg</span>] <span class="id">se2</span> <span class="id">se3</span> <span class="id">q</span> <span class="id">q1</span> <span class="id">r</span> <span class="id">r1</span>. <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Hse</span>] ? ? [<span class="id">Hq</span>] [? <span class="id">Hwt_q</span>] [? <span class="id">_</span>] [<span class="id">Hr</span>]. <span class="tactic">subst</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
