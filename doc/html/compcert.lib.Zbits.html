
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Zbits</title>
<meta name="description" content="Documentation of Coq module Zbits" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Zbits</h1>
<div class="coq">
<br/>
<div class="doc">Additional operations and proofs about binary integers,
    on top of the ZArith standard library. </div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.micromega.Psatz.html">Psatz</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zquot.html">Zquot</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="compcert.lib.Coqlib.html">Coqlib</a></span>.<br/>
<br/>
<h2> Modulo arithmetic </h2>
<br/>
<div class="doc">We define and state properties of equality and arithmetic modulo a
  positive integer. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="EQ_MODULO">EQ_MODULO</a></span>.<br/>
<br/>
<span class="kwd">Variable</span> <span class="id"><a name="EQ_MODULO.modul">modul</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="EQ_MODULO.modul_pos">modul_pos</a></span>: <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span> &gt; 0.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="eqmod">eqmod</a></span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="kwd">Prop</span> := <span class="id">exists</span> <span class="id">k</span>, <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#k">k</a></span> * <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span> + <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_refl">eqmod_refl</a></span>: <span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof377')">Proof.</div>
<div class="proofscript" id="proof377">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>. <span class="id">exists</span> 0. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_refl2">eqmod_refl2</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof378')">Proof.</div>
<div class="proofscript" id="proof378">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">subst</span> <span class="id">y</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#eqmod_refl">eqmod_refl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_sym">eqmod_sym</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof379')">Proof.</div>
<div class="proofscript" id="proof379">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> [<span class="id">k</span> <span class="id">EQ</span>]; <span class="tactic">red</span>. <span class="id">exists</span> (-<span class="id">k</span>). <span class="tactic">subst</span> <span class="id">x</span>. <span class="tactic">ring</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_trans">eqmod_trans</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#z">z</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#z">z</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof380')">Proof.</div>
<div class="proofscript" id="proof380">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> [<span class="id">k1</span> <span class="id">EQ1</span>] [<span class="id">k2</span> <span class="id">EQ2</span>]; <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">k1</span> + <span class="id">k2</span>). <span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">subst</span> <span class="id">y</span>. <span class="tactic">ring</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_small_eq">eqmod_small_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> &lt; <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof381')">Proof.</div>
<div class="proofscript" id="proof381">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> [<span class="id">k</span> <span class="id">EQ</span>] <span class="id">I1</span> <span class="id">I2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.lib.Coqlib.html#Zdiv_unique">Zdiv_unique</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">EQ</span> <span class="id">I2</span>). <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div_small">Z.div_small</a></span> <span class="id">x</span> <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span> <span class="id">I1</span>) <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span> <span class="id">k</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_mod_eq">eqmod_mod_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id">mod</span> <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id">mod</span> <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof382')">Proof.</div>
<div class="proofscript" id="proof382">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> [<span class="id">k</span> <span class="id">EQ</span>]. <span class="tactic">subst</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_comm">Z.add_comm</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_mod_plus">Z_mod_plus</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_mod">eqmod_mod</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id">mod</span> <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof383')">Proof.</div>
<div class="proofscript" id="proof383">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>. <span class="id">exists</span> (<span class="id">x</span> / <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.mul_comm">Z.mul_comm</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_div_mod_eq">Z_div_mod_eq</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_add">eqmod_add</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#a">a</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#c">c</a></span> <span class="id"><a href="compcert.lib.Zbits.html#d">d</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#a">a</a></span> + <span class="id"><a href="compcert.lib.Zbits.html#c">c</a></span>) (<span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> + <span class="id"><a href="compcert.lib.Zbits.html#d">d</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof384')">Proof.</div>
<div class="proofscript" id="proof384">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span> [<span class="id">k1</span> <span class="id">EQ1</span>] [<span class="id">k2</span> <span class="id">EQ2</span>]; <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">a</span>; <span class="tactic">subst</span> <span class="id">c</span>. <span class="id">exists</span> (<span class="id">k1</span> + <span class="id">k2</span>). <span class="tactic">ring</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_neg">eqmod_neg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> (-<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) (-<span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof385')">Proof.</div>
<div class="proofscript" id="proof385">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> [<span class="id">k</span> <span class="id">EQ</span>]; <span class="tactic">red</span>. <span class="id">exists</span> (-<span class="id">k</span>). <span class="tactic">rewrite</span> <span class="id">EQ</span>. <span class="tactic">ring</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_sub">eqmod_sub</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#a">a</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#c">c</a></span> <span class="id"><a href="compcert.lib.Zbits.html#d">d</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#a">a</a></span> - <span class="id"><a href="compcert.lib.Zbits.html#c">c</a></span>) (<span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> - <span class="id"><a href="compcert.lib.Zbits.html#d">d</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof386')">Proof.</div>
<div class="proofscript" id="proof386">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span> [<span class="id">k1</span> <span class="id">EQ1</span>] [<span class="id">k2</span> <span class="id">EQ2</span>]; <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">a</span>; <span class="tactic">subst</span> <span class="id">c</span>. <span class="id">exists</span> (<span class="id">k1</span> - <span class="id">k2</span>). <span class="tactic">ring</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_mult">eqmod_mult</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#a">a</a></span> <span class="id"><a href="compcert.lib.Zbits.html#c">c</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="id"><a href="compcert.lib.Zbits.html#d">d</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#a">a</a></span> * <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span>) (<span class="id"><a href="compcert.lib.Zbits.html#c">c</a></span> * <span class="id"><a href="compcert.lib.Zbits.html#d">d</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof387')">Proof.</div>
<div class="proofscript" id="proof387">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span> [<span class="id">k1</span> <span class="id">EQ1</span>] [<span class="id">k2</span> <span class="id">EQ2</span>]; <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">a</span>; <span class="tactic">subst</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">k1</span> * <span class="id">k2</span> * <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO.modul">modul</a></span> + <span class="id">c</span> * <span class="id">k2</span> + <span class="id">k1</span> * <span class="id">d</span>).<br/>
&nbsp;&nbsp;<span class="tactic">ring</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="compcert.lib.Zbits.html#EQ_MODULO">EQ_MODULO</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_divides">eqmod_divides</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">m</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.divide">Z.divide</a></span> <span class="id"><a href="compcert.lib.Zbits.html#m">m</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> <span class="id"><a href="compcert.lib.Zbits.html#m">m</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof388')">Proof.</div>
<div class="proofscript" id="proof388">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">k1</span> <span class="id">EQ1</span>]. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">k2</span> <span class="id">EQ2</span>].<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">k1</span>*<span class="id">k2</span>). <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.mul_assoc">Z.mul_assoc</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">EQ2</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> Fast normalization modulo <span class="bracket">2^<span class="id">n</span></span> </h2>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="P_mod_two_p">P_mod_two_p</a></span> (<span class="id">p</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) {<span class="kwd">struct</span> <span class="id">n</span>} : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span> =&gt; 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.double">Z.double</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id">q</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ_double">Z.succ_double</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id">q</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Z_mod_two_p">Z_mod_two_p</a></span> (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z0">Z0</a></span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span> =&gt; <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id">p</span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zneg">Zneg</a></span> <span class="id">p</span> =&gt; <span class="kwd">let</span> <span class="id">r</span> := <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id">p</span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">in</span> <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id"><a href="compcert.lib.Zbits.html#r">r</a></span> 0 <span class="kwd">then</span> 0 <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> - <span class="id"><a href="compcert.lib.Zbits.html#r">r</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="P_mod_two_p_range">P_mod_two_p_range</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">p</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof389')">Proof.</div>
<div class="proofscript" id="proof389">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#two_power_nat_O">two_power_nat_O</a></span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat_S">two_power_nat_S</a></span>. <span class="tactic">destruct</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">generalize</span> (<span class="id">IHn</span> <span class="id">p</span>). <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ_double_spec">Z.succ_double_spec</a></span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">generalize</span> (<span class="id">IHn</span> <span class="id">p</span>). <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.double_spec">Z.double_spec</a></span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">generalize</span> (<span class="id"><a href="compcert.lib.Coqlib.html#two_power_nat_pos">two_power_nat_pos</a></span> <span class="id">n</span>). <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="P_mod_two_p_eq">P_mod_two_p_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">p</span>, <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span>) <span class="id">mod</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof390')">Proof.</div>
<div class="proofscript" id="proof390">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">n</span> <span class="id">p</span>, <span class="id">exists</span> <span class="id">y</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> + <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#two_power_nat_O">two_power_nat_O</a></span>. <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span>). <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat_S">two_power_nat_S</a></span>. <span class="tactic">destruct</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">IHn</span> <span class="id">p</span>) <span class="kwd">as</span> [<span class="id">y</span> <span class="id">EQ</span>]. <span class="id">exists</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span>~1) <span class="kwd">with</span> (2 * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span> + 1). <span class="tactic">rewrite</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ_double_spec">Z.succ_double_spec</a></span>. <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">IHn</span> <span class="id">p</span>) <span class="kwd">as</span> [<span class="id">y</span> <span class="id">EQ</span>]. <span class="id">exists</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span>~0) <span class="kwd">with</span> (2 * <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span>). <span class="tactic">rewrite</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.double_spec">Z.double_spec</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id">p</span> <span class="id">n</span>)). <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> 0; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H</span> <span class="id">n</span> <span class="id">p</span>) <span class="kwd">as</span> [<span class="id">y</span> <span class="id">EQ</span>].<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#Zmod_unique">Zmod_unique</a></span> <span class="kwd">with</span> <span class="id">y</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p_range">P_mod_two_p_range</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_mod_two_p_range">Z_mod_two_p_range</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#Z_mod_two_p">Z_mod_two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof391')">Proof.</div>
<div class="proofscript" id="proof391">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_mod_two_p">Z_mod_two_p</a></span>. <span class="tactic">generalize</span> (<span class="id"><a href="compcert.lib.Coqlib.html#two_power_nat_pos">two_power_nat_pos</a></span> <span class="id">n</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p_range">P_mod_two_p_range</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">set</span> (<span class="id">r</span> := <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id">p</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (0 &lt;= <span class="id">r</span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id">n</span>) <span class="tactic">by</span> <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p_range">P_mod_two_p_range</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">r</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">Psatz.lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_mod_two_p_eq">Z_mod_two_p_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, <span class="id"><a href="compcert.lib.Zbits.html#Z_mod_two_p">Z_mod_two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id">mod</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof392')">Proof.</div>
<div class="proofscript" id="proof392">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_mod_two_p">Z_mod_two_p</a></span>. <span class="tactic">generalize</span> (<span class="id"><a href="compcert.lib.Coqlib.html#two_power_nat_pos">two_power_nat_pos</a></span> <span class="id">n</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Zmod_0_l">Zmod_0_l</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p_eq">P_mod_two_p_eq</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">generalize</span> (<span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p_range">P_mod_two_p_range</a></span> <span class="id">n</span> <span class="id">p</span>) (<span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p_eq">P_mod_two_p_eq</a></span> <span class="id">n</span> <span class="id">p</span>). <span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_div_mod_eq">Z_div_mod_eq</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id">n</span>)); <span class="tactic">auto</span>. <span class="tactic">intros</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">q</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span> / <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id">n</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">r</span> := <span class="id"><a href="compcert.lib.Zbits.html#P_mod_two_p">P_mod_two_p</a></span> <span class="id">p</span> <span class="id">n</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">B</span> <span class="kwd">in</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.neg">Z.neg</a></span> <span class="id">p</span>) <span class="kwd">with</span> (- (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">p</span>)). <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">r</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#Zmod_unique">Zmod_unique</a></span> <span class="kwd">with</span> (-<span class="id">q</span>). <span class="tactic">rewrite</span> <span class="id">C</span>; <span class="tactic">rewrite</span> <span class="id">e</span>. <span class="id">Psatz.lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#Zmod_unique">Zmod_unique</a></span> <span class="kwd">with</span> (-<span class="id">q</span> - 1). <span class="tactic">rewrite</span> <span class="id">C</span>. <span class="id">Psatz.lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<h2> Bit-level operations and properties </h2>
<br/>
<div class="doc">Shift <span class="bracket"><span class="id">x</span></span> left by one and insert <span class="bracket"><span class="id">b</span></span> as the low bit of the result. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Zshiftin">Zshiftin</a></span> (<span class="id">b</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ_double">Z.succ_double</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.double">Z.double</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Ztestbit_0">Ztestbit_0</a></span>: <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> 0 <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<span class="kwd">Proof</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit_0_l">Z.testbit_0_l</a></span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Ztestbit_1">Ztestbit_1</a></span>: <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> 1 <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> = <span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof393')">Proof.</div>
<div class="proofscript" id="proof393">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Ztestbit_m1">Ztestbit_m1</a></span>: <span class="kwd">forall</span> <span class="id">n</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (-1) <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof394')">Proof.</div>
<div class="proofscript" id="proof394">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Zshiftin_spec">Zshiftin_spec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">x</span>, <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = 2 * <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> + (<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="kwd">then</span> 1 <span class="kwd">else</span> 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof395')">Proof.</div>
<div class="proofscript" id="proof395">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ_double_spec">Z.succ_double_spec</a></span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.double_spec">Z.double_spec</a></span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Zshiftin_inj">Zshiftin_inj</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b1</span> <span class="id">x1</span> <span class="id">b2</span> <span class="id">x2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b1">b1</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x1">x1</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b2">b2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x2">x2</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#b1">b1</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#b2">b2</a></span> /\ <span class="id"><a href="compcert.lib.Zbits.html#x1">x1</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#x2">x2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof396')">Proof.</div>
<div class="proofscript" id="proof396">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b1</span>; <span class="tactic">destruct</span> <span class="id">b2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">auto</span>|<span class="tactic">omega</span>].<br/>
&nbsp;&nbsp;<span class="id">omegaContradiction</span>.<br/>
&nbsp;&nbsp;<span class="id">omegaContradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">auto</span>|<span class="tactic">omega</span>].<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Zdecomp">Zdecomp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof397')">Proof.</div>
<div class="proofscript" id="proof397">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">auto</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.pred_double_succ">Pos.pred_double_succ</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Ztestbit_shiftin">Ztestbit_shiftin</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">x</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> = <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> 0 <span class="kwd">then</span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof398')">Proof.</div>
<div class="proofscript" id="proof398">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">n</span> 0).<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span> <span class="id">n</span>. <span class="tactic">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit_odd_0">Z.testbit_odd_0</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_0_r">Z.add_0_r</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit_even_0">Z.testbit_even_0</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span> (0 &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id">n</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">n</span>' := <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id">n</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">n</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id">n</span>') <span class="tactic">by</span> (<span class="tactic">unfold</span> <span class="id">n</span>'; <span class="tactic">omega</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit_odd_succ">Z.testbit_odd_succ</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_0_r">Z.add_0_r</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit_even_succ">Z.testbit_even_succ</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Ztestbit_shiftin_base">Ztestbit_shiftin_base</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) 0 = <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof399')">Proof.</div>
<div class="proofscript" id="proof399">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_true">zeq_true</a></span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Ztestbit_shiftin_succ">Ztestbit_shiftin_succ</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">x</span> <span class="id">n</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof400')">Proof.</div>
<div class="proofscript" id="proof400">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_false">zeq_false</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred_succ">Z.pred_succ</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zshiftin_ind">Zshiftin_ind</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">P</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> 0 -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof401')">Proof.</div>
<div class="proofscript" id="proof401">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">induction</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">change</span> (<span class="id">P</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">p</span>))). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">change</span> (<span class="id">P</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">p</span>))). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">change</span> (<span class="id">P</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> 0)). <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">compute</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zshiftin_pos_ind">Zshiftin_pos_ind</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">P</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> 1 -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">b</span> <span class="id">x</span>, 0 &lt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, 0 &lt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof402')">Proof.</div>
<div class="proofscript" id="proof402">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">change</span> (<span class="id">P</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">p</span>))). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">change</span> (<span class="id">P</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">p</span>))). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> Bit-wise decomposition (<span class="bracket"><span class="id">Z.testbit</span></span>) </h2>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Ztestbit_eq">Ztestbit_eq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> = <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> 0 <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof403')">Proof.</div>
<div class="proofscript" id="proof403">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>) <span class="tactic">at</span> 1. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Ztestbit_base">Ztestbit_base</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof404')">Proof.</div>
<div class="proofscript" id="proof404">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_eq">Ztestbit_eq</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_true">zeq_true</a></span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Ztestbit_succ">Ztestbit_succ</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof405')">Proof.</div>
<div class="proofscript" id="proof405">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_eq">Ztestbit_eq</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_false">zeq_false</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred_succ">Z.pred_succ</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_same_bits">eqmod_same_bits</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof406')">Proof.</div>
<div class="proofscript" id="proof406">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> 0) <span class="kwd">with</span> 1. <span class="id">exists</span> (<span class="id">x</span>-<span class="id">y</span>); <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat_S">two_power_nat_S</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id">n</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHn</span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- !<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_succ">Ztestbit_succ</a></span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Nat2Z.inj_succ">Nat2Z.inj_succ</a></span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">k</span> <span class="id">EQ</span>].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">k</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>). <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">y</span>).<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">y</span>) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">EQ</span>. <span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>. <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">H</span> 0). <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Nat2Z.inj_succ">Nat2Z.inj_succ</a></span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_base">Ztestbit_base</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_bits_eqmod">same_bits_eqmod</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">y</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof407')">Proof.</div>
<div class="proofscript" id="proof407">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">omegaContradiction</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Nat2Z.inj_succ">Nat2Z.inj_succ</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat_S">two_power_nat_S</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !(<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_eq">Ztestbit_eq</a></span> <span class="id">i</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">k</span> <span class="id">EQ</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EQ</span>': <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">y</span>) (<span class="id">k</span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id">n</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>) <span class="kwd">in</span> <span class="id">EQ</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">y</span>) <span class="kwd">in</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">EQ</span>. <span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>. <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_inj">Zshiftin_inj</a></span>; <span class="tactic">eauto</span>. <span class="tactic">intros</span> [<span class="id">A</span> <span class="id">B</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">i</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHn</span>. <span class="id">exists</span> <span class="id">k</span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equal_same_bits">equal_same_bits</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>.<br/>
<span class="kwd">Proof</span> <span class="id">Z.bits_inj</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_one_complement">Z_one_complement</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (-<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>-1) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof408')">Proof.</div>
<div class="proofscript" id="proof408">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">i0</span> <span class="id">POS0</span>. <span class="tactic">pattern</span> <span class="id">i0</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Wf_Z.html#Zlt_0_ind">Zlt_0_ind</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">i</span> <span class="id">IND</span> <span class="id">POS</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>). <span class="tactic">set</span> (<span class="id">y</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (- <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>) <span class="id">y</span> - 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>)) (- <span class="id">y</span> - 1)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">i</span> 0). <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">IND</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>); <span class="tactic">simpl</span> <span class="id">negb</span>; <span class="tactic">ring</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Ztestbit_above">Ztestbit_above</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &gt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof409')">Proof.</div>
<div class="proofscript" id="proof409">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> 0) <span class="kwd">with</span> 1 <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">x</span> <span class="kwd">with</span> 0 <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit_0_l">Z.testbit_0_l</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Nat2Z.inj_succ">Nat2Z.inj_succ</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_eq">Ztestbit_eq</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_false">zeq_false</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHn</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat_S">two_power_nat_S</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Ztestbit_above_neg">Ztestbit_above_neg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;-<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; 0 -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &gt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof410')">Proof.</div>
<div class="proofscript" id="proof410">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">set</span> (<span class="id">y</span> := -<span class="id">x</span>-1).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id">y</span> <span class="id">i</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_above">Ztestbit_above</a></span> <span class="kwd">with</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">y</span>; <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">y</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_one_complement">Z_one_complement</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>). <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_involutive">negb_involutive</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zsign_bit">Zsign_bit</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) = <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof411')">Proof.</div>
<div class="proofscript" id="proof411">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> 1) <span class="kwd">with</span> 2 <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> = 0 \/ <span class="id">x</span> = 1) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Nat2Z.inj_succ">Nat2Z.inj_succ</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_eq">Ztestbit_eq</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_false">zeq_false</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred_succ">Z.pred_succ</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHn</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat_S">two_power_nat_S</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id">n</span>)); <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>); <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_true">zlt_true</a></span>. <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_false">zlt_false</a></span>. <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>) <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat_S">two_power_nat_S</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Ztestbit_le">Ztestbit_le</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt;= <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof412')">Proof.</div>
<div class="proofscript" id="proof412">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y0</span> <span class="id">POS0</span>; <span class="id">revert</span> <span class="id">x</span>; <span class="tactic">pattern</span> <span class="id">y0</span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_ind">Zshiftin_ind</a></span>; <span class="tactic">auto</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">replace</span> <span class="id">x</span> <span class="kwd">with</span> 0. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#equal_same_bits">equal_same_bits</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_0">Ztestbit_0</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id">x</span> <span class="id">i</span>) <span class="kwd">as</span> [] <span class="id">eqn</span>:<span class="id">E</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> <span class="id">H</span>; <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_0">Ztestbit_0</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x0</span> &lt;= <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">intros</span>. <span class="id">exploit</span> (<span class="id">H1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_succ">Ztestbit_succ</a></span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin_succ">Ztestbit_shiftin_succ</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x0</span>). <span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x0</span>) <span class="kwd">as</span> [] <span class="id">eqn</span>:<span class="id">E1</span>; <span class="tactic">destruct</span> <span class="id">b</span> <span class="kwd">as</span> [] <span class="id">eqn</span>:<span class="id">E2</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">H1</span> 0). <span class="tactic">omega</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_base">Ztestbit_base</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin_base">Ztestbit_shiftin_base</a></span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Ztestbit_mod_two_p">Ztestbit_mod_two_p</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id">mod</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>)) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof413')">Proof.</div>
<div class="proofscript" id="proof413">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">n0</span> <span class="id">x</span> <span class="id">i</span> <span class="id">N0POS</span>. <span class="id">revert</span> <span class="id">x</span> <span class="id">i</span>; <span class="tactic">pattern</span> <span class="id">n0</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Wf_Z.html#natlike_ind">natlike_ind</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> 0) <span class="kwd">with</span> 1. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Zmod_1_r">Zmod_1_r</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit_0_l">Z.testbit_0_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_false">zlt_false</a></span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_S">two_p_S</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">x0</span> <span class="id">mod</span> (2 * <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x0</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x0</span> <span class="id">mod</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span>; <span class="tactic">auto</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_eq">Ztestbit_eq</a></span> <span class="id">i</span> <span class="id">x0</span>); <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">i</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_true">zlt_true</a></span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id">i</span>) <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_true">zlt_true</a></span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_false">zlt_false</a></span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x0</span>) <span class="tactic">at</span> 3. <span class="tactic">set</span> (<span class="id">x1</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x0</span>). <span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#Zmod_unique">Zmod_unique</a></span> <span class="kwd">with</span> (<span class="id">x1</span> / <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_assoc">Z.add_assoc</a></span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">transitivity</span> (2 * (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span> * (<span class="id">x1</span> / <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span>) + <span class="id">x1</span> <span class="id">mod</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_div_mod_eq">Z_div_mod_eq</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_gt_ZERO">two_p_gt_ZERO</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>. <span class="id">exploit</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_mod_lt">Z_mod_lt</a></span> <span class="id">x1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span>)). <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_gt_ZERO">two_p_gt_ZERO</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x0</span>); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="Ztestbit_two_p_m1">Ztestbit_two_p_m1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> - 1) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof414')">Proof.</div>
<div class="proofscript" id="proof414">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">n</span> - 1) <span class="kwd">with</span> ((-1) <span class="id">mod</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_mod_two_p">Ztestbit_mod_two_p</a></span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">i</span> <span class="id">n</span>); <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_m1">Ztestbit_m1</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#Zmod_unique">Zmod_unique</a></span> <span class="kwd">with</span> (-1). <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_gt_ZERO">two_p_gt_ZERO</a></span> <span class="id">n</span>). <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="Ztestbit_neg_two_p">Ztestbit_neg_two_p</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (- (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>)) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof415')">Proof.</div>
<div class="proofscript" id="proof415">
&nbsp;&nbsp;<span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (- <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">n</span>) <span class="kwd">with</span> (- (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">n</span> - 1) - 1) <span class="tactic">by</span> <span class="tactic">omega</span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_one_complement">Z_one_complement</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_two_p_m1">Ztestbit_two_p_m1</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">i</span> <span class="id">n</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_add_is_or">Z_add_is_or</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">j</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#j">j</a></span> &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#j">j</a></span> &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#j">j</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> + <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> || <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof416')">Proof.</div>
<div class="proofscript" id="proof416">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">i0</span> <span class="id">POS0</span>. <span class="tactic">pattern</span> <span class="id">i0</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Wf_Z.html#Zlt_0_ind">Zlt_0_ind</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">i</span> <span class="id">IND</span> <span class="id">POS</span> <span class="id">x</span> <span class="id">y</span> <span class="id">EXCL</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>) <span class="kwd">in</span> *. <span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">y</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">transitivity</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span> || <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">y</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">y</span>)) <span class="id">i</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">f_equal</span>. <span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">EXCL</span> 0). <span class="tactic">omega</span>. <span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin_base">Ztestbit_shiftin_base</a></span>. <span class="tactic">intros</span>.<br/>
<span class="id">Opaque</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.mul">Z.mul</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>); <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">y</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">discriminate</span> || <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">i</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IND</span>. <span class="tactic">omega</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id">EXCL</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id">j</span>)). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin_succ">Ztestbit_shiftin_succ</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<h2> Zero and sign extensions </h2>
<br/>
<div class="doc">In pseudo-code:
<pre>
    Fixpoint Zzero_ext (n: Z) (x: Z) : Z :=
      if zle n 0 then
        0
      else
        Zshiftin (Z.odd x) (Zzero_ext (Z.pred n) (Z.div2 x)).
    Fixpoint Zsign_ext (n: Z) (x: Z) : Z :=
      if zle n 1 then
        if Z.odd x then -1 else 0
      else
        Zshiftin (Z.odd x) (Zzero_ext (Z.pred n) (Z.div2 x)).</pre>
  We encode this <span class="bracket"><span class="id">nat</span></span>-like recursion using the <span class="bracket"><span class="id">Z.iter</span></span> iteration
  function, in order to make the <span class="bracket"><span class="id">Zzero_ext</span></span> and <span class="bracket"><span class="id">Zsign_ext</span></span>
  functions efficiently executable within Coq.
</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Zzero_ext">Zzero_ext</a></span> (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.iter">Z.iter</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">rec</span> <span class="id">x</span> =&gt; <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) (<span class="id"><a href="compcert.lib.Zbits.html#rec">rec</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> =&gt; 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Zsign_ext">Zsign_ext</a></span> (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.iter">Z.iter</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">rec</span> <span class="id">x</span> =&gt; <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) (<span class="id"><a href="compcert.lib.Zbits.html#rec">rec</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &amp;&amp; <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> 0 <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">then</span> -1 <span class="kwd">else</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Ziter_base">Ziter_base</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) <span class="id">n</span> (<span class="id">f</span>: <span class="id"><a href="compcert.lib.Zbits.html#A">A</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#A">A</a></span>) <span class="id">x</span>, <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> &lt;= 0 -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.iter">Z.iter</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#f">f</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof417')">Proof.</div>
<div class="proofscript" id="proof417">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.iter">Z.iter</a></span>. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">auto</span>. <span class="tactic">compute</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Ziter_succ">Ziter_succ</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) <span class="id">n</span> (<span class="id">f</span>: <span class="id"><a href="compcert.lib.Zbits.html#A">A</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#A">A</a></span>) <span class="id">x</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.iter">Z.iter</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#f">f</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#f">f</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.iter">Z.iter</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#f">f</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof418')">Proof.</div>
<div class="proofscript" id="proof418">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.add_1_r">Pos.add_1_r</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.iter_succ">Pos.iter_succ</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">compute</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Znatlike_ind">Znatlike_ind</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">P</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> &lt;= 0 -&gt; <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="compcert.lib.Zbits.html#P">P</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof419')">Proof.</div>
<div class="proofscript" id="proof419">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zle">zle</a></span> 0 <span class="id">n</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Wf_Z.html#natlike_ind">natlike_ind</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zzero_ext_spec">Zzero_ext_spec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof420')">Proof.</div>
<div class="proofscript" id="proof420">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span>. <span class="tactic">induction</span> <span class="id">n</span> <span class="kwd">using</span> <span class="id"><a href="compcert.lib.Zbits.html#Znatlike_ind">Znatlike_ind</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ziter_base">Ziter_base</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_false">zlt_false</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_0">Ztestbit_0</a></span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ziter_succ">Ziter_succ</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_eq">Ztestbit_eq</a></span> <span class="id">i</span> <span class="id">x</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">i</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span> <span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_true">zlt_true</a></span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">IHn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id">i</span>) <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_true">zlt_true</a></span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_false">zlt_false</a></span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zsign_ext_spec">Zsign_ext_spec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext">Zsign_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">then</span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="kwd">else</span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> - 1).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof421')">Proof.</div>
<div class="proofscript" id="proof421">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">n0</span> <span class="id">x</span> <span class="id">i</span> <span class="id">I0</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext">Zsign_ext</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Coqlib.html#proj_sumbool">proj_sumbool</a></span>; <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> 0 <span class="id">n0</span>) <span class="kwd">as</span> [<span class="id">N0</span>|<span class="id">N0</span>]; <span class="tactic">simpl</span>.<br/>
- <span class="id">revert</span> <span class="id">x</span> <span class="id">i</span> <span class="id">I0</span>. <span class="tactic">pattern</span> <span class="id">n0</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Wf_Z.html#Zlt_lower_bound_ind">Zlt_lower_bound_ind</a></span> <span class="kwd">with</span> (<span class="id">z</span> := 1); [ | <span class="tactic">omega</span> ].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext">Zsign_ext</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">x</span> 1).<br/>
&nbsp;&nbsp;+ <span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">i</span> 1 <span class="kwd">then</span> <span class="id">i</span> <span class="kwd">else</span> 0) <span class="kwd">with</span> 0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_base">Ztestbit_base</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x0</span>); [ <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_m1">Ztestbit_m1</a></span>; <span class="tactic">auto</span> | <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_0">Ztestbit_0</a></span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">i</span> 1); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">set</span> (<span class="id">x1</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id">x</span>). <span class="tactic">replace</span> <span class="id">x1</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id">x1</span>)) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ziter_succ">Ziter_succ</a></span> <span class="tactic">by</span> (<span class="tactic">unfold</span> <span class="id">x1</span>; <span class="tactic">omega</span>). <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">i</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span> <span class="id">i</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_true">zlt_true</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_base">Ztestbit_base</a></span>; <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">H</span> <span class="tactic">by</span> (<span class="tactic">unfold</span> <span class="id">x1</span>; <span class="tactic">omega</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">x1</span>; <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id">i</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_true">zlt_true</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_eq">Ztestbit_eq</a></span> <span class="id">i</span> <span class="id">x0</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_false">zeq_false</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_false">zlt_false</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_eq">Ztestbit_eq</a></span> (<span class="id">x</span> - 1) <span class="id">x0</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_false">zeq_false</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ziter_base">Ziter_base</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_r">andb_false_r</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit_0_l">Z.testbit_0_l</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit_neg_r">Z.testbit_neg_r</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">i</span> <span class="id">n0</span>); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">Zzero_ext</span> <span class="id">n</span> <span class="id">x</span></span> is <span class="bracket"><span class="id">x</span> <span class="id">modulo</span> 2^<span class="id">n</span></span> </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zzero_ext_mod">Zzero_ext_mod</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id">mod</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof422')">Proof.</div>
<div class="proofscript" id="proof422">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#equal_same_bits">equal_same_bits</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext_spec">Zzero_ext_spec</a></span>, <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_mod_two_p">Ztestbit_mod_two_p</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">Zzero_ext</span> <span class="id">n</span> <span class="id">x</span></span> is the unique integer congruent to <span class="bracket"><span class="id">x</span></span> modulo <span class="bracket">2^<span class="id">n</span></span> in the range <span class="bracket">0...2^<span class="id">n</span>-1</span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zzero_ext_range">Zzero_ext_range</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof423')">Proof.</div>
<div class="proofscript" id="proof423">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext_mod">Zzero_ext_mod</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_mod_lt">Z_mod_lt</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_gt_ZERO">two_p_gt_ZERO</a></span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_Zzero_ext">eqmod_Zzero_ext</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof424')">Proof.</div>
<div class="proofscript" id="proof424">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext_mod">Zzero_ext_mod</a></span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#eqmod_sym">eqmod_sym</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#eqmod_mod">eqmod_mod</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_gt_ZERO">two_p_gt_ZERO</a></span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Relation between <span class="bracket"><span class="id">Zsign_ext</span> <span class="id">n</span> <span class="id">x</span></span> and (Zzero_ext n x] </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zsign_ext_zero_ext">Zsign_ext_zero_ext</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext">Zsign_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> - (<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> - 1) <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">else</span> 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof425')">Proof.</div>
<div class="proofscript" id="proof425">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#equal_same_bits">equal_same_bits</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext_spec">Zsign_ext_spec</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id">x</span> (<span class="id">n</span> - 1)) <span class="id">eqn</span>:<span class="id">SIGNBIT</span>.<br/>
- <span class="tactic">set</span> (<span class="id">n</span>' := - <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">n</span>). <br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id">n</span> <span class="id">x</span> - <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">n</span>) <span class="kwd">with</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id">n</span> <span class="id">x</span> + <span class="id">n</span>') <span class="tactic">by</span> (<span class="tactic">unfold</span> <span class="id">n</span>'; <span class="tactic">omega</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_add_is_or">Z_add_is_or</a></span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext_spec">Zzero_ext_spec</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">unfold</span> <span class="id">n</span>'; <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_neg_two_p">Ztestbit_neg_two_p</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">i</span> <span class="id">n</span>). <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_false_r">orb_false_r</a></span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext_spec">Zzero_ext_spec</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">unfold</span> <span class="id">n</span>'; <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_neg_two_p">Ztestbit_neg_two_p</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">j</span> <span class="id">n</span>); <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_r">andb_false_r</a></span>.<br/>
- <span class="tactic">replace</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id">n</span> <span class="id">x</span> - 0) <span class="kwd">with</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id">n</span> <span class="id">x</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext_spec">Zzero_ext_spec</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">i</span> <span class="id">n</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">Zsign_ext</span> <span class="id">n</span> <span class="id">x</span></span> is the unique integer congruent to <span class="bracket"><span class="id">x</span></span> modulo <span class="bracket">2^<span class="id">n</span></span>
    in the range <span class="bracket">-2^(<span class="id">n</span>-1)...2^(<span class="id">n</span>-1) - 1</span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zsign_ext_range">Zsign_ext_range</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, 0 &lt; <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; -<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>-1) &lt;= <span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext">Zsign_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>-1).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof426')">Proof.</div>
<div class="proofscript" id="proof426">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id">n</span> <span class="id">x</span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">n</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext_range">Zzero_ext_range</a></span>; <span class="tactic">omega</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">B</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id">n</span> <span class="id">x</span>) (<span class="id">n</span> - 1) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id">n</span> <span class="id">x</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id">n</span> - 1)) <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">set</span> (<span class="id">N</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.to_nat">Z.to_nat</a></span> (<span class="id">n</span> - 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsign_bit">Zsign_bit</a></span> <span class="id">N</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id">n</span> <span class="id">x</span>)). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id"><a href="compcert.lib.Coqlib.html#two_power_nat_two_p">two_power_nat_two_p</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#inj_S">inj_S</a></span>.  <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#N">N</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Z2Nat.id">Z2Nat.id</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">X</span>; <span class="tactic">apply</span> <span class="id">X</span>.  <span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> (<span class="id">n</span> - 1)) <span class="kwd">with</span> <span class="id">n</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">exact</span> <span class="id">A</span>. <br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">C</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">n</span> = 2 * <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id">n</span> - 1)).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_S">two_p_S</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">f_equal</span>; <span class="tactic">omega</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext_spec">Zzero_ext_spec</a></span>, <span class="id"><a href="compcert.lib.Coqlib.html#zlt_true">zlt_true</a></span> <span class="kwd">in</span> <span class="id">B</span> <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext_zero_ext">Zsign_ext_zero_ext</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">rewrite</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id">n</span> <span class="id">x</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id">n</span> - 1))); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="eqmod_Zsign_ext">eqmod_Zsign_ext</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#eqmod">eqmod</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>) (<span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext">Zsign_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof427')">Proof.</div>
<div class="proofscript" id="proof427">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext_zero_ext">Zsign_ext_zero_ext</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#eqmod_trans">eqmod_trans</a></span> <span class="kwd">with</span> (<span class="id">x</span> - 0). <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#eqmod_sub">eqmod_sub</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#eqmod_Zzero_ext">eqmod_Zzero_ext</a></span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id">x</span> (<span class="id">n</span> - 1) <span class="kwd">then</span> 1 <span class="kwd">else</span> 0). <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id">x</span> (<span class="id">n</span> - 1)); <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#eqmod_refl2">eqmod_refl2</a></span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<h2> Decomposition of a number as a sum of powers of two. </h2>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="Z_one_bits">Z_one_bits</a></span> (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) {<span class="kwd">struct</span> <span class="id">n</span>}: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> :: <span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id">m</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) (<span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id">m</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) (<span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>+1)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="powerserie">powerserie</a></span> (<span class="id">l</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Zbits.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id">x</span> :: <span class="id">xs</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span> + <span class="id"><a href="compcert.lib.Zbits.html#powerserie">powerserie</a></span> <span class="id">xs</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_one_bits_powerserie">Z_one_bits_powerserie</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#powerserie">powerserie</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof428')">Proof.</div>
<div class="proofscript" id="proof428">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat">two_power_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#powerserie">powerserie</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>)).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#two_power_nat_O">two_power_nat_O</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> = 0) <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">subst</span> <span class="id">x</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_nat_S">two_power_nat_S</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">simpl</span> <span class="id">Z_one_bits</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>) <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">EQ</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x</span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id">i</span> + 1) = <span class="id"><a href="compcert.lib.Zbits.html#powerserie">powerserie</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id">n</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x</span>) (<span class="id">i</span> + 1))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHn</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_is_exp">two_p_is_exp</a></span> <span class="kwd">in</span> <span class="id">EQ</span>. <span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> 1) <span class="kwd">with</span> 2 <span class="kwd">in</span> <span class="id">EQ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span> <span class="id">x</span>) <span class="tactic">at</span> 1. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>); <span class="tactic">simpl</span> <span class="id">powerserie</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">EQ</span>; <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>. <span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> 0) <span class="kwd">with</span> 1. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">exact</span> <span class="id">H0</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_one_bits_range">Z_one_bits_range</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> 0) -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof429')">Proof.</div>
<div class="proofscript" id="proof429">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span> <span class="id">j</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="compcert.lib.Zbits.html#j">j</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>) -&gt; <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &lt;= <span class="id"><a href="compcert.lib.Zbits.html#j">j</a></span> &lt; <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">simpl</span> <span class="id">In</span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">i</span> <span class="id">j</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Nat2Z.inj_succ">Nat2Z.inj_succ</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">j</span> (<span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id">n</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> <span class="id">x</span>) (<span class="id">i</span> + 1)) -&gt; <span class="id">i</span> &lt;= <span class="id">j</span> &lt; <span class="id">i</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">exploit</span> <span class="id">IHn</span>; <span class="tactic">eauto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> <span class="id">x</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">A</span>|<span class="id">B</span>]. <span class="tactic">subst</span> <span class="id">j</span>. <span class="tactic">omega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">generalize</span> (<span class="id">H</span> <span class="id">n</span> <span class="id">x</span> 0 <span class="id">i</span> <span class="id">H0</span>). <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Z_one_bits_zero">Z_one_bits_zero</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">i</span>, <span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> 0 <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof430')">Proof.</div>
<div class="proofscript" id="proof430">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Z_one_bits_two_p">Z_one_bits_two_p</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits">Z_one_bits</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = (<span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> + <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof431')">Proof.</div>
<div class="proofscript" id="proof431">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">omegaContradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Nat2Z.inj_succ">Nat2Z.inj_succ</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> = 0 \/ 0 &lt; <span class="id">x</span>) <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">simpl</span>. <span class="id">decEq</span>. <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_one_bits_zero">Z_one_bits_zero</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.odd">Z.odd</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.div2">Z.div2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">x</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id">x</span>-1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_inj">Zshiftin_inj</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.lib.Zbits.html#Zdecomp">Zdecomp</a></span>. <span class="tactic">rewrite</span> !<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_spec">Zshiftin_spec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_S">two_p_S</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_0_r">Z.add_0_r</a></span>. <span class="tactic">f_equal</span>; <span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">rewrite</span> <span class="id">A</span>; <span class="tactic">rewrite</span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHn</span>. <span class="tactic">f_equal</span>; <span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<h2> Recognition of powers of two </h2>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="P_is_power2">P_is_power2</a></span> (<span class="id">p</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="compcert.lib.Zbits.html#P_is_power2">P_is_power2</a></span> <span class="id">q</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Z_is_power2">Z_is_power2</a></span> (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z0">Z0</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Zbits.html#P_is_power2">P_is_power2</a></span> <span class="id">p</span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2">Z.log2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zneg">Zneg</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="P_is_power2_sound">P_is_power2_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span>, <span class="id"><a href="compcert.lib.Zbits.html#P_is_power2">P_is_power2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2">Z.log2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id"><a href="compcert.lib.Zbits.html#p">p</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof432')">Proof.</div>
<div class="proofscript" id="proof432">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">p</span>; <span class="tactic">simpl</span> <span class="id">P_is_power2</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">discriminate</span>.<br/>
- <span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">p</span>~0) <span class="kwd">with</span> (2 * <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">p</span>).  <span class="tactic">apply</span> <span class="id">IHp</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2_double">Z.log2_double</a></span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_S">two_p_S</a></span>.  <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2_nonneg">Z.log2_nonneg</a></span>.<br/>
- <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_is_power2_nonneg">Z_is_power2_nonneg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">i</span>, <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2">Z_is_power2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof433')">Proof.</div>
<div class="proofscript" id="proof433">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2">Z_is_power2</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Zbits.html#P_is_power2">P_is_power2</a></span> <span class="id">p</span>) <span class="id">eqn</span>:<span class="id">P</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">i</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2">Z.log2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">p</span>)) <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2_nonneg">Z.log2_nonneg</a></span>.<br/>
Qed.</div>
&nbsp;<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_is_power2_sound">Z_is_power2_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">i</span>, <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2">Z_is_power2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> /\ <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2">Z.log2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof434')">Proof.</div>
<div class="proofscript" id="proof434">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2">Z_is_power2</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Zbits.html#P_is_power2">P_is_power2</a></span> <span class="id">p</span>) <span class="id">eqn</span>:<span class="id">P</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#P_is_power2_sound">P_is_power2_sound</a></span> <span class="kwd">in</span> <span class="id">P</span>. <span class="tactic">rewrite</span> <span class="id">P</span>; <span class="tactic">split</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="Z_is_power2_range">Z_is_power2_range</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2">Z_is_power2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &lt; <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof435')">Proof.</div>
<div class="proofscript" id="proof435">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> &lt;&gt; 0) <span class="tactic">by</span> (<span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2_sound">Z_is_power2_sound</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">P</span> <span class="id">Q</span>]. <span class="tactic">subst</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2_nonneg">Z.log2_nonneg</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2_lt_pow2">Z.log2_lt_pow2</a></span>. <span class="tactic">omega</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_equiv">two_p_equiv</a></span>; <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_is_power2_complete">Z_is_power2_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2">Z_is_power2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof436')">Proof.</div>
<div class="proofscript" id="proof436">
<span class="id">Opaque</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2">Z.log2</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">A</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">i</span>, <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2">Z_is_power2</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2">Z_is_power2</a></span> (2 * <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (2 * <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> <span class="id">p</span>) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pos">Z.pos</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">p</span>)); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Zbits.html#P_is_power2">P_is_power2</a></span> <span class="id">p</span>); <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.log2_double">Z.log2_double</a></span> <span class="tactic">by</span> <span class="id">xomega</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">i</span> <span class="kwd">using</span> <span class="id"><a href="compcert.lib.Zbits.html#Znatlike_ind">Znatlike_ind</a></span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">replace</span> <span class="id">i</span> <span class="kwd">with</span> 0 <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">reflexivity</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_S">two_p_S</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id">A</span>. <span class="tactic">apply</span> <span class="id">IHi</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Z_is_power2m1">Z_is_power2m1</a></span> (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> := <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2">Z_is_power2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_is_power2m1_nonneg">Z_is_power2m1_nonneg</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">i</span>, <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2m1">Z_is_power2m1</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof437')">Proof.</div>
<div class="proofscript" id="proof437">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2m1">Z_is_power2m1</a></span>; <span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2_nonneg">Z_is_power2_nonneg</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_is_power2m1_sound">Z_is_power2m1_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">i</span>, <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2m1">Z_is_power2m1</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> - 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof438')">Proof.</div>
<div class="proofscript" id="proof438">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2m1">Z_is_power2m1</a></span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2_sound">Z_is_power2_sound</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_is_power2m1_complete">Z_is_power2m1_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">i</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2m1">Z_is_power2m1</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> - 1) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof439')">Proof.</div>
<div class="proofscript" id="proof439">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2m1">Z_is_power2m1</a></span>. <span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">i</span> - 1)) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">i</span>) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2_complete">Z_is_power2_complete</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Z_is_power2m1_range">Z_is_power2m1_range</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">x</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2m1">Z_is_power2m1</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof440')">Proof.</div>
<div class="proofscript" id="proof440">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">x</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">n</span> - 1)).<br/>
- <span class="tactic">subst</span> <span class="id">x</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2m1_complete">Z_is_power2m1_complete</a></span> <span class="kwd">in</span> <span class="id">H1</span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="id">inv</span> <span class="id">H1</span>; <span class="tactic">omega</span>.<br/>
- <span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2m1">Z_is_power2m1</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> (<span class="id"><a href="compcert.lib.Zbits.html#Z_is_power2_range">Z_is_power2_range</a></span> <span class="id">n</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> <span class="id">x</span>) <span class="id">i</span>) <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<h2> Relation between bitwise operations and multiplications / divisions by powers of 2 </h2>
<br/>
<div class="doc">Left shifts and multiplications by powers of 2. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zshiftl_mul_two_p">Zshiftl_mul_two_p</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">n</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftl">Z.shiftl</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof441')">Proof.</div>
<div class="proofscript" id="proof441">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">pattern</span> <span class="id">p</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.peano_ind">Pos.peano_ind</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_pos">two_power_pos</a></span> 1) <span class="kwd">with</span> 2. <span class="tactic">simpl</span>. <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.iter_succ">Pos.iter_succ</a></span>. <span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pplus_one_succ_l">Pplus_one_succ_l</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_pos_is_exp">two_power_pos_is_exp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_pos">two_power_pos</a></span> 1) <span class="kwd">with</span> 2. <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">compute</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Right shifts and divisions by powers of 2. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zshiftr_div_two_p">Zshiftr_div_two_p</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">n</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftr">Z.shiftr</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> / <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof442')">Proof.</div>
<div class="proofscript" id="proof442">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftr">Z.shiftr</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Zdiv_1_r">Zdiv_1_r</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">pattern</span> <span class="id">p</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.peano_ind">Pos.peano_ind</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_pos">two_power_pos</a></span> 1) <span class="kwd">with</span> 2. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Zdiv2_div">Zdiv2_div</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.iter_succ">Pos.iter_succ</a></span>. <span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pplus_one_succ_l">Pplus_one_succ_l</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_pos_is_exp">two_power_pos_is_exp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_pos">two_power_pos</a></span> 1) <span class="kwd">with</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Zdiv2_div">Zdiv2_div</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.mul_comm">Z.mul_comm</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#Zdiv_Zdiv">Zdiv_Zdiv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_power_pos_nat">two_power_pos_nat</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#two_power_nat_pos">two_power_nat_pos</a></span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">compute</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<h2> Properties of <span class="bracket"><span class="id">shrx</span></span> (signed division by a power of 2) </h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zquot_Zdiv">Zquot_Zdiv</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> &gt; 0 -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.quot">Z.quot</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> = <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> 0 <span class="kwd">then</span> (<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> + <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> - 1) / <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="kwd">else</span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> / <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof443')">Proof.</div>
<div class="proofscript" id="proof443">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">x</span> 0).<br/>
&nbsp;&nbsp;- <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zquot.html#Zquot_unique_full">Zquot_unique_full</a></span> <span class="kwd">with</span> ((<span class="id">x</span> + <span class="id">y</span> - 1) <span class="id">mod</span> <span class="id">y</span> - (<span class="id">y</span> - 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">red</span>. <span class="id">right</span>; <span class="tactic">split</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_mod_lt">Z_mod_lt</a></span> (<span class="id">x</span> + <span class="id">y</span> - 1) <span class="id">y</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.abs_eq">Z.abs_eq</a></span>. <span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">transitivity</span> ((<span class="id">y</span> * ((<span class="id">x</span> + <span class="id">y</span> - 1) / <span class="id">y</span>) + (<span class="id">x</span> + <span class="id">y</span> - 1) <span class="id">mod</span> <span class="id">y</span>) - (<span class="id">y</span>-1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_div_mod_eq">Z_div_mod_eq</a></span>. <span class="tactic">ring</span>. <span class="tactic">auto</span>. <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zquot.html#Zquot_Zdiv_pos">Zquot_Zdiv_pos</a></span>; <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zdiv_shift">Zdiv_shift</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> &gt; 0 -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> + (<span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> - 1)) / <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> = <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> / <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> + <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.modulo">Z.modulo</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>) 0 <span class="kwd">then</span> 0 <span class="kwd">else</span> 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof444')">Proof.</div>
<div class="proofscript" id="proof444">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">generalize</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_div_mod_eq">Z_div_mod_eq</a></span> <span class="id">x</span> <span class="id">y</span> <span class="id">H</span>). <span class="tactic">generalize</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_mod_lt">Z_mod_lt</a></span> <span class="id">x</span> <span class="id">y</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">q</span> := <span class="id">x</span> / <span class="id">y</span>). <span class="tactic">set</span> (<span class="id">r</span> := <span class="id">x</span> <span class="id">mod</span> <span class="id">y</span>). <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">r</span> 0).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#Zdiv_unique">Zdiv_unique</a></span> <span class="kwd">with</span> (<span class="id">y</span> - 1). <span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">e</span>. <span class="tactic">ring</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Coqlib.html#Zdiv_unique">Zdiv_unique</a></span> <span class="kwd">with</span> (<span class="id">r</span> - 1). <span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="tactic">ring</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<h2> Size of integers, in bits. </h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Zsize">Zsize</a></span> (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.size">Pos.size</a></span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; 0<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Zsize_pos">Zsize_pos</a></span>: <span class="kwd">forall</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof445')">Proof.</div>
<div class="proofscript" id="proof445">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>. <span class="tactic">omega</span>. <span class="tactic">compute</span>; <span class="tactic">intuition</span> <span class="tactic">congruence</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id">Zsize_pos</span>': <span class="kwd">forall</span> <span class="id">x</span>, 0 &lt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; 0 &lt; <span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof446')">Proof.</div>
<div class="proofscript" id="proof446">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>. <span class="tactic">compute</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zsize_shiftin">Zsize_shiftin</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">x</span>, 0 &lt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="compcert.lib.Zbits.html#b">b</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof447')">Proof.</div>
<div class="proofscript" id="proof447">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">compute</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span>)) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> (<span class="id">p</span>~1)).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">f_equal</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.add_1_r">Pos.add_1_r</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> <span class="id">p</span>)) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Zpos">Zpos</a></span> (<span class="id">p</span>~0)).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">f_equal</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.BinPos.html#Pos.add_1_r">Pos.add_1_r</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Ztestbit_size_1">Ztestbit_size_1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, 0 &lt; <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof448')">Proof.</div>
<div class="proofscript" id="proof448">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x0</span> <span class="id">POS0</span>; <span class="tactic">pattern</span> <span class="id">x0</span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_pos_ind">Zshiftin_pos_ind</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsize_shiftin">Zsize_shiftin</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id">x</span>))) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.succ">Z.succ</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id">x</span>))) <span class="tactic">by</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin_succ">Ztestbit_shiftin_succ</a></span>. <span class="tactic">auto</span>. <span class="tactic">generalize</span> (<span class="id">Zsize_pos</span>' <span class="id">x</span> <span class="id">H</span>); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Ztestbit_size_2">Ztestbit_size_2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="kwd">forall</span> <span class="id">i</span>, <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &gt;= <span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof449')">Proof.</div>
<div class="proofscript" id="proof449">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x0</span> <span class="id">POS0</span>. <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">x0</span> 0).<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span> <span class="id">x0</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_0">Ztestbit_0</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">pattern</span> <span class="id">x0</span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Zshiftin_pos_ind">Zshiftin_pos_ind</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">intros</span>. <span class="id">change</span> 1 <span class="kwd">with</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zshiftin">Zshiftin</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> 0). <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_false">zeq_false</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_0">Ztestbit_0</a></span>. <span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsize_shiftin">Zsize_shiftin</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">Zsize_pos</span>' <span class="id">_</span> <span class="id">H</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_shiftin">Ztestbit_shiftin</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zeq_false">zeq_false</a></span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zsize_interval_1">Zsize_interval_1</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof450')">Proof.</div>
<div class="proofscript" id="proof450">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> = <span class="id">x</span> <span class="id">mod</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#equal_same_bits">equal_same_bits</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_mod_two_p">Ztestbit_mod_two_p</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">i</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id">x</span>)). <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_size_2">Ztestbit_size_2</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsize_pos">Zsize_pos</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="tactic">at</span> 1. <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="tactic">at</span> 3. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Z_mod_lt">Z_mod_lt</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p_gt_ZERO">two_p_gt_ZERO</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsize_pos">Zsize_pos</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zsize_interval_2">Zsize_interval_2</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">n</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#n">n</a></span> &gt;= <span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof451')">Proof.</div>
<div class="proofscript" id="proof451">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">set</span> (<span class="id">N</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.to_nat">Z.to_nat</a></span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">N</span> = <span class="id">n</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Znat.html#Z2Nat.id">Z2Nat.id</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="compcert.lib.Coqlib.html#two_power_nat_two_p">two_power_nat_two_p</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zeq">zeq</a></span> <span class="id">x</span> 0).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">n</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id">x</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_above">Ztestbit_above</a></span> <span class="id">N</span> <span class="id">x</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.pred">Z.pred</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id">x</span>))). <span class="tactic">auto</span>. <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_size_1">Ztestbit_size_1</a></span>. <span class="tactic">congruence</span>. <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zsize_monotone">Zsize_monotone</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt;= <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> -&gt; <span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> &lt;= <span class="id"><a href="compcert.lib.Zbits.html#Zsize">Zsize</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof452')">Proof.</div>
<div class="proofscript" id="proof452">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.ge_le">Z.ge_le</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsize_interval_2">Zsize_interval_2</a></span>. <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsize_pos">Zsize_pos</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exploit</span> (<span class="id"><a href="compcert.lib.Zbits.html#Zsize_interval_1">Zsize_interval_1</a></span> <span class="id">y</span>). <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<h2> Bit insertion, bit extraction </h2>
<br/>
<div class="doc">Extract and optionally sign-extend bits <span class="bracket"><span class="id">from</span>...<span class="id">from</span>+<span class="id">len</span>-1</span> of <span class="bracket"><span class="id">x</span></span> </div>
<span class="kwd">Definition</span> <span class="id"><a name="Zextract_u">Zextract_u</a></span> (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">from</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">len</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext">Zzero_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftr">Z.shiftr</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#from">from</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Zextract_s">Zextract_s</a></span> (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">from</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">len</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext">Zsign_ext</a></span> <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftr">Z.shiftr</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#from">from</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zextract_u_spec">Zextract_u_spec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">from</span> <span class="id">len</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#from">from</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zextract_u">Zextract_u</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#from">from</a></span> <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> =<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#from">from</a></span> + <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>) <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof453')">Proof.</div>
<div class="proofscript" id="proof453">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Zextract_u">Zextract_u</a></span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zzero_ext_spec">Zzero_ext_spec</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftr_spec">Z.shiftr_spec</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_comm">Z.add_comm</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zextract_s_spec">Zextract_s_spec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">from</span> <span class="id">len</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#from">from</a></span> -&gt; 0 &lt; <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zextract_s">Zextract_s</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#from">from</a></span> <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> =<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#from">from</a></span> + (<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span> <span class="kwd">then</span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> <span class="kwd">else</span> <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span> - 1)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof454')">Proof.</div>
<div class="proofscript" id="proof454">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Zextract_s">Zextract_s</a></span>; <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Zbits.html#Zsign_ext_spec">Zsign_ext_spec</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftr_spec">Z.shiftr_spec</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.add_comm">Z.add_comm</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id">i</span> <span class="id">len</span>); <span class="tactic">omega</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Insert bits <span class="bracket">0...<span class="id">len</span>-1</span> of <span class="bracket"><span class="id">y</span></span> into bits <span class="bracket"><span class="id">to</span>...<span class="id">to</span>+<span class="id">len</span>-1</span> of <span class="bracket"><span class="id">x</span></span> </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Zinsert">Zinsert</a></span> (<span class="id">x</span> <span class="id">y</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">to</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">len</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mask</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftl">Z.shiftl</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span> - 1) <span class="id"><a href="compcert.lib.Zbits.html#to">to</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lor">Z.lor</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.land">Z.land</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftl">Z.shiftl</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#to">to</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#mask">mask</a></span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.ldiff">Z.ldiff</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#mask">mask</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Zinsert_spec">Zinsert_spec</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">to</span> <span class="id">len</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#to">to</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span> -&gt; 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#Zinsert">Zinsert</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> <span class="id"><a href="compcert.lib.Zbits.html#to">to</a></span> <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span>) <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zle">zle</a></span> <span class="id"><a href="compcert.lib.Zbits.html#to">to</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> &amp;&amp; <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#to">to</a></span> + <span class="id"><a href="compcert.lib.Zbits.html#len">len</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#y">y</a></span> (<span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span> - <span class="id"><a href="compcert.lib.Zbits.html#to">to</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id"><a href="compcert.lib.Zbits.html#x">x</a></span> <span class="id"><a href="compcert.lib.Zbits.html#i">i</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof455')">Proof.</div>
<div class="proofscript" id="proof455">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Zbits.html#Zinsert">Zinsert</a></span>; <span class="tactic">intros</span>. <span class="tactic">set</span> (<span class="id">mask</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.Zpower.html#two_p">two_p</a></span> <span class="id">len</span> - 1).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">M</span>: <span class="kwd">forall</span> <span class="id">j</span>, 0 &lt;= <span class="id"><a href="compcert.lib.Zbits.html#j">j</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.testbit">Z.testbit</a></span> <span class="id">mask</span> <span class="id"><a href="compcert.lib.Zbits.html#j">j</a></span> = <span class="kwd">if</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> <span class="id"><a href="compcert.lib.Zbits.html#j">j</a></span> <span class="id">len</span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="compcert.lib.Zbits.html#Ztestbit_two_p_m1">Ztestbit_two_p_m1</a></span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lor_spec">Z.lor_spec</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.land_spec">Z.land_spec</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.ldiff_spec">Z.ldiff_spec</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zle">zle</a></span> <span class="id">to</span> <span class="id">i</span>).<br/>
- <span class="tactic">rewrite</span> ! <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftl_spec">Z.shiftl_spec</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">rewrite</span> ! <span class="id">M</span> <span class="tactic">by</span> <span class="tactic">omega</span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="compcert.lib.Coqlib.html#proj_sumbool">proj_sumbool</a></span>; <span class="tactic">destruct</span> (<span class="id"><a href="compcert.lib.Coqlib.html#zlt">zlt</a></span> (<span class="id">i</span> - <span class="id">to</span>) <span class="id">len</span>); <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_r">andb_true_r</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_r">andb_false_r</a></span>.<br/>
+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_true">zlt_true</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_false_r">orb_false_r</a></span>.<br/>
+ <span class="tactic">rewrite</span> <span class="id"><a href="compcert.lib.Coqlib.html#zlt_false">zlt_false</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> ! <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.shiftl_spec_low">Z.shiftl_spec_low</a></span> <span class="tactic">by</span> <span class="tactic">omega</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_r">andb_true_r</a></span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
